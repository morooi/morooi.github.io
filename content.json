{"pages":[],"posts":[{"title":"è§£å†³ Parallels Desktop 16 by TNT ç½‘ç»œåˆå§‹åŒ–å¤±è´¥çš„é—®é¢˜","text":"Parallels Desktop 16 â€œæ­ªé—¨é‚ªé“ç‰ˆâ€ åœ¨ macOS Big Sur ä¸‹é¢å¯åŠ¨ä¼šæç¤ºï¼šç½‘ç»œåˆå§‹åŒ–å¤±è´¥ï¼ˆæ‚¨çš„è™šæ‹Ÿæœºå°†ç»§ç»­æ­£å¸¸è¿ä½œï¼Œä½†å°†æ— æ³•è¿æ¥ç½‘ç»œã€‚ï¼‰ ç›®å‰ç½‘ç»œä¸Šçš„æ–¹æ³•éƒ½æ˜¯ç”¨ sudo å¯åŠ¨ prl_client_app è¿›ç¨‹ï¼Œä½†æ˜¯æ•ˆæœå¹¶ä¸å¥½ï¼Œè€Œä¸” USB ä¸å¯ä»¥ä½¿ç”¨ã€‚ è¿™é‡Œé€šè¿‡ä¿®æ”¹æ–‡ä»¶å‚æ•°çš„æ–¹å¼ï¼Œç«‹å³ç”Ÿæ•ˆï¼Œå®Œç¾è§£å†³ï¼ æœ¬æ–‡ä½¿ç”¨ç¯å¢ƒå¦‚ä¸‹ï¼š macOS Big Sur 11.1 Parallels Desktop 16.1.1-49141 by TNT è§£å†³ç½‘ç»œåˆå§‹åŒ–å¤±è´¥é—®é¢˜å…³é—­ PD16ï¼Œä½¿ç”¨ sudo ç¼–è¾‘æ–‡ä»¶ /Library/Preferences/Parallels/network.desktop.xml 1sudo vim /Library/Preferences/Parallels/network.desktop.xml æ›´æ”¹ UseKextless é¡¹ï¼ˆæˆ‘çš„ç¯å¢ƒä¸­åœ¨ 5 è¡Œï¼‰ï¼Œ -1 æ”¹ä¸º 0 /Library/Preferences/Parallels/network.desktop.xml12- &lt;UseKextless&gt;-1&lt;/UseKextless&gt;+ &lt;UseKextless&gt;0&lt;/UseKextless&gt; ä¿å­˜å¹¶é€€å‡ºï¼Œå¯åŠ¨ PD16 ç«‹å³ç”Ÿæ•ˆï¼ è§£å†³ USB æ— æ³•ä½¿ç”¨çš„é—®é¢˜å…³é—­ PD16ï¼Œä½¿ç”¨ sudo ç¼–è¾‘æ–‡ä»¶ /Library/Preferences/Parallels/dispatcher.desktop.xml 1sudo vim /Library/Preferences/Parallels/dispatcher.desktop.xml æ›´æ”¹ Usb é¡¹ï¼ˆæˆ‘çš„ç¯å¢ƒä¸­åœ¨ 367 è¡Œï¼‰ï¼Œ0 æ”¹ä¸º 1 /Library/Preferences/Parallels/dispatcher.desktop.xml12- &lt;Usb&gt;0&lt;/Usb&gt;+ &lt;Usb&gt;1&lt;/Usb&gt; ä¿å­˜å¹¶é€€å‡ºï¼Œå¯åŠ¨ PD16 ç«‹å³ç”Ÿæ•ˆï¼","link":"/2020/FixPD16/"},{"title":"ä½¿ç”¨ acme.sh è‡ªåŠ¨ç­¾å‘ ZeroSSL çš„ ECC è¯ä¹¦","text":"acme.sh ä½¿ç”¨ ACME åè®®è‡ªåŠ¨ç”³è¯· SSL è¯ä¹¦ï¼Œé¡¹ç›®åœ°å€ï¼šacme.sh ç¯å¢ƒï¼šCentOS 8 å®‰è£… acme.shå…ˆå®‰è£…å¥½ curlï¼Œç„¶åï¼š 1curl https://get.acme.sh | sh è¯¥å®‰è£…è„šæœ¬åšäº†å‡ ä»¶äº‹ï¼š æŠŠ acme.sh å®‰è£…åˆ°äº† home ç›®å½•ä¸‹ï¼š~/.acme.sh/ åˆ›å»ºäº†ä¸€ä¸ª bash çš„ alias, æ–¹ä¾¿ä½¿ç”¨: alias acme.sh=~/.acme.sh/acme.sh åˆ›å»ºäº† cronjobï¼Œæ¯å¤© 0:00 ç‚¹è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰çš„è¯ä¹¦ï¼Œå¦‚æœå¿«è¿‡æœŸäº†ï¼Œåˆ™ä¼šè‡ªåŠ¨æ›´æ–°è¯ä¹¦ã€‚ å¦‚æœå› ä¸ºç½‘ç»œé—®é¢˜ï¼Œæ— æ³•è¿æ¥åˆ° https://raw.githubusercontent.com åŸŸåï¼Œåˆ™è¦æ‰‹åŠ¨æ›´æ”¹å®‰è£…è„šæœ¬å†…å®¹ï¼š 1234567# ä¸‹è½½å¹¶ä¿å­˜è„šæœ¬curl https://get.acme.sh -o acme_install.sh# æ›´æ”¹è„šæœ¬å†…åŸŸåï¼Œä½¿ç”¨ä»£ç†åŠ é€Ÿsed -i 's/raw/ghproxy.com\\/https:\\/\\/raw/g' acme_install.sh# å®‰è£…chmod +x acme_install.sh./acme_install.sh æ³¨å†Œ ZeroSSL è´¦å· acme.sh é»˜è®¤ä½¿ç”¨ Letâ€™s Encrypt è¿›è¡Œè¯ä¹¦æ³¨å†Œï¼Œæœ¬æœ¬ç« ä½¿ç”¨ ZeroSSL è¿›è¡Œæ³¨å†Œï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œç›¸å…³é…ç½® å®˜ç½‘æ³¨å†Œï¼šhttps://zerossl.com/ æ³¨å†Œå®Œæˆä¹‹åè¿›å…¥ Dashboardï¼Œé€‰æ‹©å³ä¾§çš„ Developer æ ‡ç­¾ï¼Œç”Ÿæˆ EAB Credentials å¹¶è®°å½•ä¸‹æ¥ã€‚ å°† acme.sh çš„æ³¨å†ŒæœåŠ¡å™¨æ”¹ä¸º ZeroSSL æ–‡æ¡£ï¼šhttps://github.com/acmesh-official/acme.sh/wiki/ZeroSSL.com-CA è¿è¡Œï¼Œæ›¿æ¢ eab-kid å’Œ eab-hmac-key ä¸ºä¸Šä¸€æ­¥ä¸­ç”Ÿæˆçš„ï¼š 123acme.sh --register-account --server zerossl \\ --eab-kid xxxxxxxxxxxx \\ --eab-hmac-key xxxxxxxxx å°†å…¶è®¾ç½®ä¸ºé»˜è®¤ Server 1acme.sh --set-default-ca --server zerossl ç­¾å‘è¯ä¹¦æœ¬æ–‡ç« ä½¿ç”¨ DNS éªŒè¯çš„æ–¹æ³•æ¥éªŒè¯åŸŸåï¼Œacme.sh å¯ä»¥é€šè¿‡ DNS æä¾›å•†çš„ API è‡ªåŠ¨è®¾ç½®éªŒè¯è®°å½•ï¼Œå…·ä½“ç”¨æ³•è¯¦è§æ–‡æ¡£ï¼šhttps://github.com/acmesh-official/acme.sh/wiki/dnsapi 1234acme.sh --issue \\ --dns dns_dp \\ -d morooi.cn -d \\*.morooi.cn \\ --keylength ec-256 å…¶ä¸­ï¼š --dns æŒ‡å®š DNS æœåŠ¡å•†ï¼Œdns_dp ä»£è¡¨ DNSPodï¼Œè¿˜æœ‰ dns_cf ä»£è¡¨ CloudFlareï¼Œæ›´å¤šçš„å­—æ®µè§ https://github.com/acmesh-official/acme.sh/tree/master/dnsapiå¦‚æœä¸ä½¿ç”¨ API è‡ªåŠ¨æ·»åŠ éªŒè¯ï¼Œåˆ™ä¸ç”¨æ·»åŠ åç»­å‚æ•°ï¼Œå¦‚ï¼šacme.sh --issue --dns -d morooi.cn .... -d \\*.morooi.cn è¡¨ç¤ºç­¾å‘æ³›åŸŸåè¯ä¹¦ï¼Œ\\* ä¸ºè½¬ä¹‰ï¼ˆæœ¬äººä½¿ç”¨ zsh shellï¼Œå®æµ‹éœ€è¦è½¬ä¹‰ï¼Œbash è²Œä¼¼å¹¶ä¸éœ€è¦åŠ åæ–œçº¿ï¼‰ --keylength ec-256 è¡¨ç¤ºç­¾å‘ ECC è¯ä¹¦ï¼Œä¸æ·»åŠ åˆ™ç­¾å‘ RSA è¯ä¹¦ï¼Œå¯é€‰å‚æ•°è¿˜æœ‰ ec-384 å’Œ ec-521 å®‰è£…è¯ä¹¦ä½¿ç”¨ --install-cert å‘½ä»¤å®‰è£…è¯ä¹¦åˆ°æŒ‡å®šç›®å½•ï¼Œåˆ‡è®°ä¸è¦æ‰‹åŠ¨å»å¤åˆ¶ç­¾å‘çš„è¯ä¹¦æ–‡ä»¶ï¼Œä¼šå½±å“åç»­ä½¿ç”¨ 1234acme.sh --install-cert -d morooi.cn --ecc \\ --key-file \"/ssl/_.morooi.cn.key\" \\ --fullchain-file \"/ssl/_.morooi.cn.crt\" \\ --reloadcmd \"nginx -s reload\" å…¶ä¸­ï¼š --ecc è¡¨ç¤ºå®‰è£… ECC è¯ä¹¦ --key-file å’Œ -fullchain-file åæ¥æƒ³è¦å®‰è£…åˆ°çš„ç›®å½•åŠè¯ä¹¦å --reloadcmd åæ¥æœåŠ¡çš„é‡å¯å‘½ä»¤ï¼Œç¨‹åºè‡ªåŠ¨ç»­æœŸè¯ä¹¦åä¼šè¿è¡Œè¯¥å‘½ä»¤ä½¿å…¶ç”Ÿæ•ˆ å¤§åŠŸå‘Šæˆï¼ æ›´å¤šä¿¡æ¯å¯å‚è€ƒå¦‚ä¸‹ï¼š acme.sh wiki acme.sh è‡ªåŠ¨æ›´æ–° RSAã€ECC åŒè¯ä¹¦å®è·µ Blogs and tutorials","link":"/2021/acme-sh/"},{"title":"Conda å¸¸ç”¨å‘½ä»¤çš„æ•´ç†","text":"Anaconda æ˜¯ä¸€ä¸ªé’ˆå¯¹æ•°æ®åˆ†æé¢†åŸŸ Python å‘è¡Œç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†åŒ…ç®¡ç†ï¼ˆpackagesï¼‰å·¥å…·å’Œè™šæ‹Ÿç¯å¢ƒï¼ˆenvironmentï¼‰ç®¡ç†ï¼Œ conda å‘½ä»¤å¯ç”¨äºå®‰è£…ã€å¸è½½ã€æ›´æ–°åŒ…ã€åˆ›å»ºä¸åŒç‰ˆæœ¬çš„ Python ç‹¬ç«‹ç¯å¢ƒï¼Œå¯ç”¨äºæ›¿æ¢ pip å’Œ virtualenv è¿™ä¸¤ä¸ªå·¥å…·ã€‚ æ–‡ä¸­è®°å½•äº†ä½¿ç”¨ conda çš„å¸¸ç”¨å‘½ä»¤ã€‚ å¯ç›´æ¥ä» Anaconda å®˜æ–¹ç½‘ç«™ https://www.anaconda.com/download/ è¿›è¡Œä¸‹è½½ï¼Œé€‰æ‹© Python 3.7 çš„ç‰ˆæœ¬ã€‚ ä¹Ÿå¯ä»¥ä»æ¸…åé•œåƒ https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/ ä¸‹è½½ã€‚ MinicondaMiniconda æ˜¯ä¸€ä¸ª Anaconda çš„è½»é‡çº§æ›¿ä»£ï¼Œé»˜è®¤åªåŒ…å«äº† python å’Œ condaï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ pip å’Œ conda æ¥å®‰è£…æ‰€éœ€è¦çš„åŒ…ã€‚ Miniconda å®‰è£…åŒ…å¯ä»¥åˆ° https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/ ä¸‹è½½ã€‚ æˆ–ä»å®˜æ–¹æ–‡æ¡£å¤„ https://docs.conda.io/en/latest/miniconda.html ä¸‹è½½ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·å®‰è£…ï¼Œå¦‚ apt-get, yum, brew cask ç­‰ å®‰è£…å¥½ Conda åï¼Œå¦‚ä½¿ç”¨ zshï¼Œè¾“å…¥ï¼š 123export PATH=\"/usr/local/miniconda3/bin:$PATH\" # æ³¨æ„ä¿®æ”¹æˆè‡ªå·±çš„å®‰è£…è·¯å¾„conda init zsh # æˆ–å…¶ä»– shellconda config --set auto_activate_base false # å…³é—­è‡ªåŠ¨æ¿€æ´»ç¯å¢ƒ ä½¿ç”¨æ¸…åçš„ Anaconda ä»“åº“é•œåƒè¿è¡Œä»¥ä¸‹å‘½ä»¤ 123conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/conda config --set show_channel_urls yes å³å¯æ·»åŠ  Anaconda Python å…è´¹ä»“åº“ã€‚ è¿è¡Œ conda install numpy æµ‹è¯•ä¸€ä¸‹å§ã€‚ æ¸…åçš„ Anaconda é•œåƒä½¿ç”¨å¸®åŠ©ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/help/anaconda/ å¸¸ç”¨ conda å‘½ä»¤1234567891011121314151617# æ£€æŸ¥ conda ç‰ˆæœ¬conda --version# å‡çº§å½“å‰ç‰ˆæœ¬çš„ condaconda update conda# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…conda list# åŒ…æ›´æ–°conda update $package# åˆ é™¤åŒ…conda remove $package# å–æ¶ˆè‡ªåŠ¨æ¿€æ´»condaç¯å¢ƒconda config --set auto_activate_base false ç¯å¢ƒç®¡ç†123456789101112131415161718192021# åˆ›å»ºç¯å¢ƒï¼Œ$envname æ¢æˆæ–°å»ºçš„ç¯å¢ƒåï¼Œ'python='åå¯ä»¥æŒ‡å®šç‰ˆæœ¬conda create --name $envname python=3.7# åˆ›å»ºç¯å¢ƒå¹¶æŒ‡å®šè·¯å¾„conda create --prefix=$dirpath python=3.7# æ¿€æ´»ç¯å¢ƒactivate $envnameconda activate $envname # Linux or macOS# é€€å‡ºå½“å‰ç¯å¢ƒdeactivate $envname# åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒconda info -e# åˆ é™¤ç¯å¢ƒconda remove -n $envname --all# åˆ é™¤æŒ‡å®šè·¯å¾„çš„ç¯å¢ƒconda remove --prefix=$dirpath --all å¤åˆ¶ Conda ç¯å¢ƒåœ¨æœ¬åœ°çš„ conda é‡Œå·²ç»æœ‰ä¸€ä¸ª AAA çš„ç¯å¢ƒï¼Œæˆ‘æƒ³åˆ›å»ºä¸€ä¸ªæ–°ç¯å¢ƒè·Ÿå®ƒä¸€æ¨¡ä¸€æ ·çš„å« BBBï¼Œé‚£ä¹ˆè¿™æ ·ä¸€å¥å°±æå®šäº†ï¼š 1234conda create -n BBB --clone AAAconda create -p $dirpath_new --clone $dirpath_old","link":"/2019/anaconda/"},{"title":"ä½¿ç”¨ dockerfile-maven-plugin æ’ä»¶æ„å»ºå¹¶æ¨é€ Docker é•œåƒ","text":"è¿™ç¯‡ç¬”è®°çš„ç›®æ ‡æ˜¯ä½¿ç”¨æœ¬åœ° IDEA ç¼–è¯‘ SpringBoot å·¥ç¨‹ä¸º jar åŒ…ï¼Œå¹¶ä¸”ä½¿ç”¨å®‰è£…å¥½ Docker çš„è¿œç¨‹ Linux ä¸»æœºæ„å»º Docker é•œåƒï¼ŒPush åˆ°é˜¿é‡Œäº‘çš„é•œåƒæ‰˜ç®¡æœåŠ¡ã€‚ æ·»åŠ ç¯å¢ƒå˜é‡ ä¿®æ”¹ POM æ–‡ä»¶é…ç½® éšè— POM æ–‡ä»¶ä¸­çš„å¯†ç  ç¼–å†™ Dockerfile é¦–å…ˆéœ€è¦ä¸€å°å®‰è£…å¥½ Docker çš„ Linux ä¸»æœºæˆ–è™šæ‹Ÿæœºï¼Œå¹¶ä¸”å¼€æ”¾è¿œç¨‹æ§åˆ¶ï¼ˆè§ -&gt; å¼€å¯ Docker çš„è¿œç¨‹æ§åˆ¶ï¼‰ æ·»åŠ ç¯å¢ƒå˜é‡IDEA è®¾ç½®é‡Œæ·»åŠ  Maven ç¯å¢ƒå˜é‡ï¼Œå‘ŠçŸ¥ Docker Host åœ°å€ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š æ‰¾åˆ° Preference -&gt; Build, Execution, Deployment -&gt; Build Tools -&gt; Maven -&gt; Runner åœ¨ Environment variables ä¸­å¡«å†™ DOCKER_HOST=tcp://xxx.xxx.xxx.xxx:2375 ä¿®æ”¹ POM æ–‡ä»¶é…ç½®åœ¨é¡¹ç›® POM æ–‡ä»¶ä¸­æ·»åŠ  dockerfile-maven-plugin æ’ä»¶é…ç½®ï¼Œæ³¨æ„ä¿®æ”¹ repository, username, passwordã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.13&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;build-tag-push-version&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;build&lt;/goal&gt; &lt;goal&gt;tag&lt;/goal&gt; &lt;goal&gt;push&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;tag&gt;${project.version}&lt;/tag&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;execution&gt; &lt;id&gt;tag-push-latest&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;tag&lt;/goal&gt; &lt;goal&gt;push&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;tag&gt;latest&lt;/tag&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;repository&gt;registry.cn-shanghai.aliyuncs.com/xxxxx/xxxxx&lt;/repository&gt; &lt;username&gt;userName&lt;/username&gt; &lt;password&gt;userPassword&lt;/password&gt; &lt;buildArgs&gt; &lt;JAR_FILE&gt;${project.build.finalName}.jar&lt;/JAR_FILE&gt; &lt;/buildArgs&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; æœ¬é…ç½®çš„ä½œç”¨æ˜¯ï¼Œè¿è¡Œ mvn package æ“ä½œæ—¶ï¼š jar åŒ…ç¼–è¯‘ ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ Dockerfile æ„å»ºä»¥ç‰ˆæœ¬å·ä¸º Tag çš„ Docker é•œåƒï¼Œå¹¶ push åˆ°é˜¿é‡Œäº‘é•œåƒæ‰˜ç®¡æœåŠ¡ æ„å»º Tag ä¸º latest çš„ Docker é•œåƒï¼Œå¹¶ push åˆ°é˜¿é‡Œäº‘é•œåƒæ‰˜ç®¡æœåŠ¡ æ›´å¤šé…ç½®é€‰é¡¹æŸ¥çœ‹å®˜æ–¹ä¿¡æ¯ï¼š https://github.com/spotify/dockerfile-maven å¤š Tag çš„é…ç½®å¯å‚è€ƒæ­¤ issueï¼š https://github.com/spotify/dockerfile-maven/issues/10 éšè— POM æ–‡ä»¶ä¸­çš„å¯†ç maven æä¾›å¯†ç åŠ å¯†çš„åŠŸèƒ½ï¼Œå…·ä½“è¿‡ç¨‹è§ï¼šhttps://maven.apache.org/guides/mini/guide-encryption.html é…ç½®å®Œ ~/.m2/setting-security.xml åï¼Œåœ¨ ~/.m2/setting.xml æ‰¾åˆ° servers æ ‡ç­¾ï¼Œæ·»åŠ ï¼š 1234567&lt;servers&gt; &lt;server&gt; &lt;id&gt;registry.cn-shanghai.aliyuncs.com&lt;/id&gt; &lt;username&gt;userName&lt;/username&gt; &lt;password&gt;{encryptedPassword}&lt;/password&gt; &lt;/server&gt;&lt;/servers&gt; ä¿®æ”¹ POM æ–‡ä»¶ä¸­çš„é…ç½®å³å¯ 123456789&lt;configuration&gt; &lt;repository&gt;registry.cn-shanghai.aliyuncs.com/xxxxx/xxxxx&lt;/repository&gt;- &lt;username&gt;userName&lt;/username&gt;- &lt;password&gt;userPassword&lt;/password&gt;+ &lt;useMavenSettingsForAuth&gt;true&lt;/useMavenSettingsForAuth&gt; &lt;buildArgs&gt; &lt;JAR_FILE&gt;${project.build.finalName}.jar&lt;/JAR_FILE&gt; &lt;/buildArgs&gt;&lt;/configuration&gt; ç¼–å†™ Dockerfileåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ–°å»º Dockerfileï¼Œæ³¨æ„å…¶ä¸­ ARG JAR_FILE å­—æ®µæ˜¯ä¸ POM æ–‡ä»¶ä¸­çš„è®¾ç½®å¯¹åº”çš„ï¼Œä¾‹ï¼š 123456789101112FROM openjdk:11.0.8-jreMAINTAINER SJ Zhou &lt;morooiu@gmail.com&gt;WORKDIR /projectARG JAR_FILEADD target/${JAR_FILE} project.jarRUN ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\ &amp;&amp; echo Asis/Shanghai &gt; /etc/timezoneEXPOSE 8080CMD [\"java\", \"-jar\", \"project.jar\"]","link":"/2020/docker-maven/"},{"title":"Docker å®‰è£…ã€ä½¿ç”¨è®°å½•","text":"å†…å®¹: å®‰è£… Docker CE é…ç½®å›½å†… Docker ä»“åº“é•œåƒ å¸¸ç”¨å‘½ä»¤ DockerFile å¼€å¯ Docker çš„è¿œç¨‹æ§åˆ¶ å°šç¡…è°· Docker å…¥é—¨è§†é¢‘ï¼šhttps://www.bilibili.com/video/av26993050 å®‰è£… Docker CE å¤šå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼ˆInstall Docker Engineï¼‰ï¼Œé‡Œé¢æä¾›äº†å„ç§ Linux å‘è¡Œç‰ˆçš„å®‰è£…æ–¹å¼ã€‚ ç”±äºç½‘ç»œåŸå› ï¼Œä½¿ç”¨å®˜æ–¹é•œåƒå¯èƒ½é€Ÿåº¦ä¸å¤Ÿç†æƒ³ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„é•œåƒè¿›è¡Œå®‰è£…ï¼Œè¿™é‡Œä»¥ CentOS 7 ä¸ºä¾‹ï¼Œå…¶ä»–ç³»ç»Ÿå®‰è£…è¯¦è§é˜¿é‡Œäº‘åœ°å€ï¼šhttps://developer.aliyun.com/mirror/docker-ce è¿è¡Œå¦‚ä¸‹ï¼Œå³å¯å®‰è£…æˆåŠŸ 123456789101112# step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·sudo yum install -y yum-utils device-mapper-persistent-data lvm2# Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo# Step 3: æ›´æ–°å¹¶å®‰è£…Docker-CEsudo yum makecache fastsudo yum -y install docker-ce# Step 4: å¼€å¯DockeræœåŠ¡sudo systemctl start docker é…ç½®å›½å†… Docker ä»“åº“é•œåƒä»¥é˜¿é‡Œäº‘é•œåƒä¸ºä¾‹ï¼Œæ‰“å¼€ https://www.aliyun.com/product/acr ç”³è¯·é˜¿é‡Œäº‘çš„å®¹å™¨é•œåƒæœåŠ¡ (å…è´¹) è¿›å…¥æ§åˆ¶å°ï¼Œé€‰æ‹©é•œåƒåŠ é€Ÿå™¨ æŒ‰ç…§æ“ä½œæ–‡æ¡£æ“ä½œ é™„ CentOS 7 / Ubuntu çš„æ“ä½œå‘½ä»¤ 12345678sudo mkdir -p /etc/dockersudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'{ \"registry-mirrors\": [\"https://xxxxxx.mirror.aliyuncs.com\"]}EOFsudo systemctl daemon-reloadsudo systemctl restart docker å®‰è£…å®Œæˆåè¿è¡Œ: docker run hello-worldï¼Œå‡ºç°å¦‚ä¸‹å†…å®¹å³å®‰è£…è¿è¡ŒæˆåŠŸã€‚ å¸¸ç”¨å‘½ä»¤å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š Docker run reference docker (base command) é•œåƒå‘½ä»¤ï¼š 12345678910111213141516171819202122# Docker å¸®åŠ©docker --help -h# æŸ¥çœ‹æœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒdocker images [OPTION] -a: åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒ(å«ä¸­é—´æ˜ åƒå±‚) -q: åªæ˜¾ç¤ºé•œåƒ ID --digests: æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯ --no-trunc: æ˜¾ç¤ºé•œåƒçš„å®Œæ•´ä¿¡æ¯# æœç´¢é•œåƒåå­—docker search -s: åˆ—å‡ºæ”¶è—æ•°ä¸å°äºæŒ‡å®šå€¼çš„é•œåƒ (docker search -s 30 xxx)# ä¸‹è½½é•œåƒdocker pull xxx[:TAG] # ä¸å†™[:TAG]é»˜è®¤ä¸‹è½½æœ€æ–°# åˆ é™¤é•œåƒdocker rmi xxx1[:TAG] xxx2[:TAG] # ä¸å†™[:TAG]é»˜è®¤åˆ é™¤æœ€æ–°docker rmi $(docker images -qa) # å…¨éƒ¨åˆ é™¤ -f: å¼ºåˆ¶åˆ é™¤ å®¹å™¨å‘½ä»¤ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162# æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨docker run [OPTION] image [COMMAND] [ARG...] --name: åˆ«å -i: ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨, é€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ -t: ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯, é€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ -d: åå°è¿è¡Œå®¹å™¨, å¹¶è¿”å›å®¹å™¨ ID, ä¹Ÿå³å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨ -P: éšæœºç«¯å£æ˜ å°„ -p: æŒ‡å®šç«¯å£æ˜ å°„, æœ‰ä»¥ä¸‹å››ç§æ ¼å¼ ip:hostPort:containerPort ip::containerPort hostPort:containerPort containerPort -v å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•(:ro åªè¯»ä¸å¯å†™): æ·»åŠ å®¹å™¨æ•°æ®å· # åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨docker ps [OPTION] -a: åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ + å†å²ä¸Šè¿è¡Œè¿‡çš„ -l: æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ -n: æ˜¾ç¤ºæœ€è¿‘ n ä¸ªåˆ›å»ºçš„å®¹å™¨ -q: é™é»˜æ¨¡å¼, åªæ˜¾ç¤ºå®¹å™¨ç¼–å· --no-trunc: ä¸æˆªæ–­è¾“å‡º# é€€å‡ºå®¹å™¨(åœ¨å®¹å™¨é‡Œ)exit # é€€å‡ºå¹¶åœæ­¢å®¹å™¨Ctrl + P + Q # é€€å‡ºä¸åœæ­¢å®¹å™¨# å¯åŠ¨å®¹å™¨docker start [å®¹å™¨åæˆ–å®¹å™¨ID]# é‡å¯å®¹å™¨docker restart [å®¹å™¨åæˆ–å®¹å™¨ID]# åœæ­¢å®¹å™¨docker stop [å®¹å™¨åæˆ–å®¹å™¨ID]# å¼ºè¡Œåœæ­¢å®¹å™¨docker kill [å®¹å™¨åæˆ–å®¹å™¨ID]# åˆ é™¤å·²åœæ­¢çš„å®¹å™¨docker rm [å®¹å™¨åæˆ–å®¹å™¨ID] -f: å¼ºåˆ¶åˆ é™¤docker rm -f $(docker ps -aq) # åˆ é™¤å…¨éƒ¨å®¹å™¨docker ps -aq | xargs docker rm # åˆ é™¤å…¨éƒ¨å®¹å™¨# æŸ¥çœ‹å®¹å™¨æ—¥å¿—docker logs [OPTION] [å®¹å™¨ID] -t: åŠ å…¥æ—¶é—´æˆ³ -f: è·Ÿéšæœ€æ–°çš„æ—¥å¿—æ‰“å° --tail: æ•°å­— æ˜¾ç¤ºæœ€åå¤šå°‘æ¡# æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹docker top [å®¹å™¨ID]# æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚docker inspect [å®¹å™¨ID]# è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’docker exec -it [å®¹å™¨ID] COMMAND [ARG...] # åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯, å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹docker attach [å®¹å™¨ID] # ç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯, ä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹# ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºdocker cp å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ æœ¬æœºè·¯å¾„ DockerFileå®˜æ–¹æ–‡æ¡£ï¼šDockerfile reference ä¿ç•™å…³é”®å­—: FROMï¼šåŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ MAINTAINERï¼šé•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®± RUNï¼šå®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤ EXPOSEï¼šå½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£ WORKDIRï¼šæŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥å·¥ä½œç›®å½• ENVï¼šç”¨æ¥æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾è®¡ç¯å¢ƒå˜é‡ ADDï¼šå°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒï¼Œä¸” ADD å‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç† URL å’Œè§£å‹ tar å‹ç¼©åŒ… COPYï¼šç±»ä¼¼ ADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ VOLUMEï¼šå®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ CMDï¼šæŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMD ä¼šè¢« docker run ä¹‹åçš„å‚æ•°æ›¿æ¢ï¼‰ ENTRYPOINTï¼šæŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼ˆç›®çš„å’Œ CMD ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå‚æ•°ï¼‰ ONBUILDï¼šå½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿çš„ Dockerfile æ—¶è¿è¡Œå‘½ä»¤ï¼Œçˆ¶é•œåƒåœ¨è¢«å­ç»§æ‰¿åçˆ¶é•œåƒçš„ onbuild è¢«è§¦å‘ å¼€å¯ Docker çš„è¿œç¨‹æ§åˆ¶ç¼–è¾‘ /usr/lib/systemd/system/docker.service æœåŠ¡ /usr/lib/systemd/system/docker.service12345678[Service]Type=notify- ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock+ ExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0:2375 --containerd=/run/containerd/containerd.sockExecReload=/bin/kill -s HUP $MAINPIDTimeoutSec=0RestartSec=2Restart=always æ·»åŠ  -H tcp://0.0.0.0:2375 è¡¨ç¤ºç›‘å¬æœ¬æœºæ‰€æœ‰ IP çš„ 2375 ç«¯å£ï¼Œä¹Ÿå¯æŒ‡å®šç‰¹å®šçš„ IPï¼Œå¦‚ -H tcp://192.168.123.132:2375 é‡å¯æœåŠ¡ä»¥ç”Ÿæ•ˆ 12systemctl daemon-reloadsystemctl restart docker å…¶ä»–å¼€å¯æ–¹å¼è§å‚è€ƒä¸€ å‚è€ƒï¼š Docker å®˜æ–¹æ–‡æ¡£ - Daemon socket option Docker å¼€å¯ Remote API è®¿é—® 2375 ç«¯å£","link":"/2020/docker/"},{"title":"åœ¨ macOS ä¸­ä½¿ç”¨ GPG ç­¾åæäº¤è‡³ Github","text":"åœ¨ Github æ˜¾ç¤ºçš„ commit ä¸­å‘ç°æœ‰ä¸€ä¸ªç»¿è‰²çš„ â€œVerifiedâ€ å°æ ‡è®°ï¼Œäºæ˜¯å°è¯•å®ç°ã€‚ ä½¿ç”¨ GPG åœ¨æœ¬åœ°ç­¾å commitï¼ŒGitHub å¯ä»¥éªŒè¯è¿™äº›ç­¾åï¼Œä»¥ä¾¿å…¶ä»–äººçŸ¥é“æäº¤æ¥è‡ªå¯ä¿¡çš„æ¥æºã€‚ å®‰è£… GPGmacOS ä¸‹ï¼Œä½¿ç”¨ homebrew è¿›è¡Œå®‰è£… 1$ brew install gpg â€¦ ç”Ÿæˆ GPG å¯†é’¥å¯¹ å¦‚æœä½¿ç”¨çš„æ˜¯ 2.1.17 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ GPG å¯†é’¥å¯¹ 1$ gpg --full-generate-key å¦‚æœä½¿ç”¨çš„ä¸æ˜¯ 2.1.17 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ GPG å¯†é’¥å¯¹ 1$ gpg --default-new-key-algo rsa4096 --gen-key åŠ å¯†æ–¹å¼é»˜è®¤é€‰æ‹©: RSA and DSA è¾“å…¥æ‰€éœ€çš„å¯†é’¥é•¿åº¦: 4096 æœ‰æ•ˆæ—¶é•¿ï¼šæŒ‰éœ€æŒ‡å®š ç”¨æˆ·ä¿¡æ¯è¿™ä¸€æ­¥éœ€è¦è¾“å…¥ GitHub å¸æˆ·ä¸­ç»è¿‡éªŒè¯çš„ç”µå­é‚®ä»¶åœ°å€ã€‚ è¾“å…¥è‡ªå®šä¹‰çš„å®‰å…¨å¯†ç ï¼ˆç•Œé¢å¯èƒ½ä¼šæ˜¯ä¹±ç ï¼Œä¸å½±å“å¯†ç çš„è¾“å…¥ï¼‰ æŸ¥çœ‹å¹¶å¯¼å‡ºç”Ÿæˆçš„å¯†é’¥å¯¹ä½¿ç”¨å‘½ä»¤ 1$ gpg --list-secret-keys --keyid-format LONG ä» GPG å¯†é’¥åˆ—è¡¨ä¸­å¤åˆ¶æƒ³è¦ä½¿ç”¨çš„ GPG å¯†é’¥ IDã€‚ åœ¨æ­¤ä¾‹ä¸­ï¼ŒGPG å¯†é’¥ ID æ˜¯ 3AA5C34371567BD2ï¼š 123456$ gpg --list-secret-keys --keyid-format LONG/Users/hubot/.gnupg/secring.gpg------------------------------------sec 4096R/3AA5C34371567BD2 2016-03-10 [expires: 2017-03-10]uid Hubot ssb 4096R/42B317FD4BA89E7A 2016-03-10 å¯¼å‡ºè¦ä½¿ç”¨çš„å¯†é’¥å¯¹ï¼Œä»¥æ­¤å¯†é’¥ä¸ºä¾‹ 1gpg --armor --export 3AA5C34371567BD2 å¤åˆ¶ GPG å¯†é’¥ ä» -----BEGIN PGP PUBLIC KEY BLOCK----- å¼€å§‹åˆ° -----END PGP PUBLIC KEY BLOCK----- ç»“æŸ æ·»åŠ å¯†é’¥è‡³ Githubåœ¨ Github çš„è®¾ç½®ä¸­æ‰¾åˆ° SSH and GPG keys é€‰é¡¹ï¼Œæˆ–ç‚¹å‡»é“¾æ¥ï¼šhttps://github.com/settings/keys å•å‡» New GPG keyï¼ˆæ–° GPG å¯†é’¥ï¼‰ï¼Œç„¶åç²˜è´´ä¸Šä¸€æ­¥ä¸­å¤åˆ¶çš„å¯†é’¥ ä½¿ç”¨å¯†é’¥åœ¨ Git ä¸­è®¾ç½® GPG ç­¾åå¯†é’¥ï¼Œè®°å¾—æ›¿æ¢ä¸ºè‡ªå·±çš„ GPG å¯†é’¥ ID 1git config --global user.signingkey 3AA5C34371567BD2 ä¸ºå½“å‰çš„å•ä¸ªé¡¹ç›®é…ç½®å¯†é’¥è®¤è¯ 1$ git config commit.gpgsign true ä¸ºå…¨éƒ¨é¡¹ç›®é…ç½®å¯†é’¥è®¤è¯ 1$ git config --global commit.gpgsign true é”™è¯¯è§£å†³ä½¿ç”¨ VS Code æäº¤ä»£ç æ—¶æŠ¥é”™ error: gpg failed to sign the datafatal: failed to write commit object åŒæ ·ï¼Œä½¿ç”¨ IntelliJ IDEA æäº¤ä»£ç æ—¶æŠ¥é”™ï¼š gpg failed to sign the data failed to write commit object éœ€å®‰è£… pinentry-mac 1$ brew install pinentry-mac æ–°å»º ~/.gnupg/gpg-agent.confï¼ŒåŠ å…¥ ~/.gnupg/gpg-agent.conf1pinentry-program /usr/local/bin/pinentry-mac é‡è½½ gpg-agent ç”Ÿæ•ˆ 1$ gpg-connect-agent reloadagent æ­¤æ—¶å¯ä»¥æ­£å¸¸æäº¤äº†ï¼Œcommit æ—¶ä¼šå¼¹å‡ºæç¤ºæ¡†ï¼ŒæŒ‰ç…§æç¤ºè¾“å…¥ Password å³å¯ å‚è€ƒé“¾æ¥ Github - ç®¡ç†æäº¤ç­¾åéªŒè¯ åœ¨ GitHub commit ä¸ŠåŠ ä¸Š GPG ç°½ç« ","link":"/2020/github-gpg/"},{"title":"Hexo - Next ä½¿ç”¨ï¼Œä¼˜åŒ–è®°å½•","text":"å›¾ç‰‡è·¯å¾„é—®é¢˜çªç„¶å‘ç°åšå®¢é‡Œé¢æ‰€æœ‰éç½‘ç»œå›¾åºŠçš„å›¾ç‰‡å…¨éƒ¨å¤±æ•ˆï¼Œæ’æŸ¥å‘ç°æ‰€æœ‰å›¾ç‰‡é“¾æ¥åœ¨åŸŸååé¢éƒ½åŠ ä¸Šäº† /.cn/xxxxï¼Œååœ¨ Github æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ ä¿®æ”¹åšå®¢æ ¹ç›®å½• node_modules/hexo-asset-image/index.js æ–‡ä»¶ç¬¬ 24 è¡Œï¼š 1234else {- var endPos = link.lastIndexOf('.');+ var endPos = link.length-1; } é—®é¢˜è§£å†³ï½ï¼ Github issue: https://github.com/xcodebuild/hexo-asset-image/issues/47","link":"/2020/hexo-next/"},{"title":"åœ¨ CentOS 7 ä¸­å®‰è£… Hadoop ä¸ HBase","text":"æœ¬å®éªŒåœ¨ VMware è™šæ‹Ÿæœºä¸­å®‰è£… CentOS ç³»ç»Ÿï¼Œæ­å»º Hadoop ä¼ªåˆ†å¸ƒå¼æ¨¡å¼ç¯å¢ƒï¼Œå®‰è£… HBaseã€‚å®éªŒå¿…è¦çš„ç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼šVMware Workstation Pro 15, CentOS 7.6.1810, Java SE Development Kit 8u201, Hadoop 2.9.2, HBase 1.4.9ã€‚ ä¸‹è½½åœ°å€ï¼š VMware Workstation Pro 15ï¼šhttps://pan.baidu.com/s/1LO6DxDw71vecyfvsJXv1jA æå–ç : 98kc CentOSï¼šCentOS-7-x86_64-Minimal-1810.iso Java SDKï¼šjdk-8u201-linux-x64.tar.gz Hadoopï¼šhadoop-2.9.2.tar.gz HBaseï¼šhbase-1.4.9-bin.tar.gz æœ¬æŠ¥å‘Šä¸€å…±åˆ†ä¸ºå››ä¸ªéƒ¨åˆ† ç¬¬ä¸€éƒ¨åˆ†ï¼šåœ¨ VMware ä¸­å®‰è£… CentOS ç¬¬äºŒéƒ¨åˆ†ï¼šå®‰è£… Javaï¼Œå¹¶é…ç½®ç¯å¢ƒå˜é‡ ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®‰è£…å¹¶é…ç½® Hadoopï¼ˆä¼ªåˆ†å¸ƒå¼æ¨¡å¼ï¼‰ ç¬¬å››éƒ¨åˆ†ï¼šå®‰è£…å¹¶é…ç½® HBase ç¬¬ä¸€éƒ¨åˆ†ï¼šåœ¨ VMware ä¸­å®‰è£… CentOSå®‰è£…å®Œæˆåä½¿ç”¨ SSH å®¢æˆ·ç«¯è¿æ¥åˆ°è™šæ‹Ÿæœºã€‚ ç”±äºå†™æ­¤æŠ¥å‘Šæ—¶å·²ç»å®‰è£…å®Œæˆï¼Œå¹¶æ²¡æœ‰å°†è¿‡ç¨‹æˆªå›¾ï¼Œæ­¤éƒ¨åˆ†ç•¥ã€‚ è®¾ç½® CentOS çš„éƒ¨åˆ†å‘½ä»¤ï¼ˆå‡ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œï¼‰ï¼š å…³é—­é˜²ç«å¢™ï¼š 12$ systemctl stop firewalld.service #åœæ­¢firewall$ systemctl disable firewalld.service #ç¦æ­¢firewallå¼€æœºå¯åŠ¨ å…³é—­ selinuxï¼š 1$ vim /etc/sysconfig/selinux ä¿®æ”¹ SELINUX=enabled ä¸º SELINUX=disabledï¼Œå¦‚å›¾ ç¬¬äºŒéƒ¨åˆ†ï¼šå®‰è£… Javaï¼Œå¹¶é…ç½®ç¯å¢ƒå˜é‡å®‰è£… Javaè¿›å…¥å®éªŒç›®å½•ï¼Œè¿™é‡Œé€‰æ‹©åœ¨ /opt/app ç›®å½•ä¸‹ï¼Œä¸‹è½½ Java SDK å®‰è£…åŒ… 12$ cd /opt/app$ wget https://download.oracle.com/otn-pub/java/jdk/8u201-b09/42970487e3af4f5aa5bca3f542482c60/jdk-8u201-linux-x64.tar.gz ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è§£å‹ï¼štar zxvf ./jdk-8u201-linux-x64.tar.gzï¼Œå¾—åˆ°ç›®å½• /opt/app/jdk1.8.0_201ã€‚ æ·»åŠ ç¯å¢ƒå˜é‡ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œ vim /etc/profileï¼Œåœ¨å°¾éƒ¨æ·»åŠ  12export JAVA_HOME=\"/opt/app/jdk1.8.0_201\"export PATH=$JAVA_HOME/bin:$PATH å¦‚å›¾ ä¿®æ”¹å®Œæ¯•åï¼Œæ‰§è¡Œå‘½ä»¤ source /etc/profile ä½¿å…¶ç”Ÿæ•ˆã€‚ æ‰§è¡Œå‘½ä»¤ java -versionï¼Œçœ‹åˆ°ä¸‹å›¾ï¼Œå³ä¸ºå®‰è£…æˆåŠŸ ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®‰è£…å¹¶é…ç½® Hadoopï¼ˆä¼ªåˆ†å¸ƒå¼æ¨¡å¼ï¼‰å®‰è£… Hadoopä¸‹è½½ Hadoop 2.9.2 å®‰è£…åŒ… 1$ wget http://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.9.2/hadoop-2.9.2.tar.gz ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è§£å‹ï¼štar zxvf ./hadoop-2.9.2.tar.gzï¼Œå¾—åˆ°ç›®å½• /opt/app/hadoop-2.9.2ã€‚ æ·»åŠ ç¯å¢ƒå˜é‡ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œ vim /etc/profileï¼Œåœ¨å°¾éƒ¨æ·»åŠ  12export HADOOP_HOME=\"/opt/app/hadoop-2.9.2\"export PATH=$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH å¦‚å›¾ ä¿®æ”¹å®Œæ¯•åï¼Œæ‰§è¡Œ source /etc/profile ä½¿å…¶ç”Ÿæ•ˆã€‚ æ‰§è¡Œ hadoop versionï¼Œçœ‹åˆ°ä¸‹å›¾ï¼Œå³ä¸ºå®‰è£…æˆåŠŸ é…ç½® Hadoop ä¿®æ”¹ hadoop-env.sh æ‰§è¡Œå‘½ä»¤ 1$ vim /opt/app/hadoop-2.9.2/etc/hadoop/hadoop-env.sh ä¿®æ”¹æ–‡ä»¶ä¸­çš„ JAVA_HOME å‚æ•°ä¸º Java å®‰è£…è·¯å¾„ï¼Œç»“æœå¦‚å›¾ é…ç½® core-site.xml æ‰§è¡Œå‘½ä»¤ 1$ vim /opt/app/hadoop-2.9.2/etc/hadoop/core-site.xml æ·»åŠ å¦‚ä¸‹é…ç½® 12345678910&lt;configuration&gt; &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://192.168.29.127:8020&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/data/tmp&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; å…¶ä¸­ fs.defaultFS å‚æ•°é…ç½®çš„æ˜¯ HDFS çš„åœ°å€ï¼Œ192.168.29.127 ä¸ºæœ¬è™šæ‹Ÿæœº IP åœ°å€ã€‚ hadoop.tmp.dir å‚æ•°é…ç½®çš„æ˜¯ Hadoop ä¸´æ—¶ç›®å½•ï¼Œè¿™é‡Œè®¾ç½®ä¸º /opt/data/tmpï¼Œå¹¶æ‰‹åŠ¨åˆ›å»ºæ­¤ç›®å½•ã€‚ é…ç½® hdfs-site.xml æ‰§è¡Œå‘½ä»¤ 1$ vim /opt/app/hadoop-2.9.2/etc/hadoop/hdfs-site.xml æ·»åŠ å¦‚ä¸‹é…ç½® 123456&lt;configuration&gt; &lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;value&gt;1&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; dfs.replication å‚æ•°é…ç½®çš„æ˜¯ HDFS å­˜å‚¨æ—¶çš„å¤‡ä»½æ•°é‡ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º 1ã€‚ æ ¼å¼åŒ– HDFS æ‰§è¡Œå‘½ä»¤ hdfs namenode -formatï¼Œå½“é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ä¸´æ—¶ç›®å½• /opt/data/tmp ä¸‹å‡ºç° dfs æ–‡ä»¶å¤¹æ—¶ï¼Œè¯´æ˜æ ¼å¼åŒ–æˆåŠŸã€‚ é…ç½® mapred-site.xml é»˜è®¤æ²¡æœ‰ mapred-site.xml æ–‡ä»¶ï¼Œä» mapred-site.xml.template æ¨¡æ¿æ–‡ä»¶å¤åˆ¶ç”Ÿæˆ mapred-site.xmlã€‚ åœ¨ Hadoop ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ 1$ cp etc/hadoop/mapred-site.xml.template etc/hadoop/mapred-site.xml æ‰“å¼€ mapred-site.xmlï¼Œæ·»åŠ å¦‚ä¸‹é…ç½® 123456&lt;configuration&gt; &lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; æ­¤å¤„è®¾ç½® mapreduce.framework.name å‚æ•°æŒ‡å®š mapreduce è¿è¡Œåœ¨ yarn æ¡†æ¶ä¸Šã€‚ é…ç½® yarn-site.xml æ‰§è¡Œå‘½ä»¤ 1$ vim /opt/app/hadoop-2.9.2/etc/hadoop/yarn-site.xml æ·»åŠ å¦‚ä¸‹é…ç½® 12345678910&lt;configuration&gt; &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt; &lt;value&gt;192.168.29.127&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; yarn.nodemanager.aux-services é…ç½®äº† yarn çš„é»˜è®¤æ··æ´—æ–¹å¼ï¼Œé€‰æ‹©ä¸º mapreduce çš„é»˜è®¤æ··æ´—ç®—æ³•ã€‚ yarn.resourcemanager.hostname æŒ‡å®šäº† Resourcemanager è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ­¤å¤„ä¸ºæœ¬è™šæ‹Ÿæœº IPã€‚ è®¾ç½®å…å¯†ç™»å½• å…³äºå…å¯†ç™»å½•è¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹ Linux ç¬”è®° é€šå¸¸ Hadoop é›†ç¾¤ä¸­çš„å„ä¸ªæœºå™¨é—´ä¼šç›¸äº’åœ°é€šè¿‡ SSH è®¿é—®ï¼Œæ¯æ¬¡è®¿é—®éƒ½è¾“å…¥å¯†ç æ˜¯ä¸ç°å®çš„ï¼Œæ‰€ä»¥è¦é…ç½®å…å¯†ç™»å½•ã€‚ è¿™é‡Œæ˜¯ä¼ªåˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥åªç»™æœ¬æœºé…ç½®å°± OK äº†ã€‚ åœ¨æœ¬æœºä¸Šç”Ÿæˆå…¬é’¥ æ‰§è¡Œå‘½ä»¤ 1$ ssh-keygen -t rsa ä¸€è·¯å›è½¦ï¼Œéƒ½è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œç„¶åå†å½“å‰ç”¨æˆ·çš„ç›®å½•ä¸‹çš„.ssh ç›®å½•ä¸­ä¼šç”Ÿæˆå…¬é’¥æ–‡ä»¶ id_rsa.pub å’Œç§é’¥æ–‡ä»¶ id_rsaã€‚ åˆ†å‘å…¬é’¥ 1$ ssh-copy-id 192.168.29.127 ## åé¢å¡«å†™ç›®çš„åœ°å€ï¼Œæ­¤å¤„æ˜¯æœ¬æœºIP è‡³æ­¤ï¼Œå¼€å¯å’Œå…³é—­ Hadoop æœåŠ¡éƒ½æ— éœ€è¾“å…¥å¯†ç ã€‚ å¯åŠ¨ Hadoopåœ¨ Hadoop ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ sbin/start-all.shï¼Œå¼€å§‹å¯åŠ¨ Hadoop è¿è¡Œå‘½ä»¤ jps å¯ä»¥çœ‹åˆ°æœåŠ¡å‡å¼€å§‹è¿è¡Œ è¿›å…¥ http://192.168.27.127:50070 ï¼Œå¯ä»¥çœ‹åˆ° Namenode çŠ¶æ€ä¸º â€œactiveâ€ã€‚ Hadoop æŒ‡å®š SSH è¿æ¥çš„ç«¯å£å·å½“å› ä¸ºæŸäº›åŸå› è‡ªå®šä¹‰ SSH ç«¯å£å·çš„æ—¶å€™ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å‘Šè¯‰ Hadoop ä½ çš„ SSH ç«¯å£å·ã€‚ ç¼–è¾‘ Hadoop ç›®å½•ä¸‹ /etc/hadoop/hadoop-env.shï¼Œæ·»åŠ  1export HADOOP_SSH_OPTS=\"-p xxx\" //xxxä¸ºè‡ªå®šä¹‰çš„SSHç«¯å£å· ç¬¬å››éƒ¨åˆ†ï¼šå®‰è£…å¹¶é…ç½® HBaseå®‰è£… HBaseä¸‹è½½ HBase 1.4.9 å®‰è£…åŒ… 1$ wget http://mirrors.tuna.tsinghua.edu.cn/apache/hbase/1.4.9/hbase-1.4.9-bin.tar.gz ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è§£å‹ï¼štar zxvf hbase-1.4.9-bin.tar.gzï¼Œå¾—åˆ°ç›®å½• /opt/app/hbase-1.4.9ã€‚ æ·»åŠ ç¯å¢ƒå˜é‡ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œ vim /etc/profileï¼Œåœ¨å°¾éƒ¨æ·»åŠ  12export HBASE_HOME=/opt/app/hbase-1.4.9export PATH=$HBASE_HOME/bin:$PATH å¦‚å›¾ ä¿®æ”¹å®Œæ¯•åï¼Œæ‰§è¡Œ source /etc/profile ä½¿å…¶ç”Ÿæ•ˆã€‚ æ‰§è¡Œ hbase versionï¼Œçœ‹åˆ°ä¸‹å›¾ï¼Œå³ä¸ºå®‰è£…æˆåŠŸ é…ç½® HBase é…ç½® hbase-site.xml æ‰§è¡Œå‘½ä»¤ 1$ vim /opt/app/hbase-1.4.9/conf/hbase-site.xml æ·»åŠ å¦‚ä¸‹é…ç½® 1234567891011121314&lt;configuration&gt; &lt;property&gt; &lt;name&gt;hbase.rootdir&lt;/name&gt; &lt;value&gt;hdfs://192.168.29.127:8020/hbase&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.tmp.dir&lt;/name&gt; &lt;value&gt;/opt/data/hbase/tmp&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.cluster.distributed&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; hbase.rootdir é…ç½®çš„è¿™ä¸ªç›®å½•æ˜¯ region server çš„å…±äº«ç›®å½•ï¼Œç”¨æ¥æŒä¹…åŒ– HBaseã€‚ hbase.tmp.dir æŒ‡å®šäº† HBase çš„ä¸´æ—¶ç›®å½•ã€‚ hbase.cluster.distributed é…ç½® HBase çš„è¿è¡Œæ¨¡å¼ï¼Œfalse æ˜¯å•æœºæ¨¡å¼ï¼Œtrue æ˜¯åˆ†å¸ƒå¼æ¨¡å¼ã€‚ é…ç½® hbase-env.sh æ‰§è¡Œå‘½ä»¤ 1$ vim /opt/app/hbase-1.4.9/conf/hbase-env.sh æ·»åŠ å¦‚ä¸‹é…ç½® 1234export JAVA_HOME=/opt/app/jdk1.8.0_201export HADOOP_HOME=/opt/app/hadoop-2.9.2export HBASE_HOME=/opt/app/hbase-1.4.9export HBASE_CLASSPATH=/opt/app/hadoop-2.9.2/etc/hadoop å¯åŠ¨ HBase åœ¨å¯åŠ¨ HBase å‰å…ˆå¯åŠ¨ Hadoop åœ¨ HBase ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ bin/start-hbase.shï¼Œçœ‹åˆ°ä»¥ä¸‹çŠ¶æ€ æŸ¥çœ‹ Java è¿›ç¨‹ï¼šjps å¯ä»¥çœ‹åˆ° HMaster è¿›ç¨‹å·²ç»å¯åŠ¨äº†ã€‚ è‡³æ­¤ï¼ŒHadoop å’Œ HBase åœ¨ CentOS 7 ä¸Šçš„å®‰è£…å·²å…¨éƒ¨å®Œæˆã€‚","link":"/2019/installhadoop/"},{"title":"Jupyter Notebook è¿œç¨‹è®¿é—®ä¸åå°é™é»˜è¿è¡Œ","text":"å…è®¸è¿œç¨‹è®¿é—®12345jupyter notebook --generate-config # åˆå§‹åŒ–é…ç½®æ–‡ä»¶echo \"c.NotebookApp.ip = '*'\" &gt;&gt; ~/.jupyter/jupyter_notebook_config.pyecho \"c.NotebookApp.open_browser = False\" &gt;&gt; ~/.jupyter/jupyter_notebook_config.pyecho \"c.NotebookApp.port = 8888\" &gt;&gt; ~/.jupyter/jupyter_notebook_config.py å¯åŠ¨ Notebook12cd ~/ # è¿›å…¥æŒ‡å®šç›®å½•nohup jupyter notebook &gt; ./jupyter.log 2&gt;&amp;1 &amp; # åå°é™é»˜è¿è¡Œ æ‰“å¼€ ./jupyter.logï¼Œæ‰¾åˆ°è®¿é—®è·¯å¾„ï¼Œå°†åœ°å€æ”¹æˆä¸»æœºå¯¹åº”çš„ IPï¼Œå³å¯æ­£å¸¸è®¿é—®ã€‚ æƒ³å…³æ‰åå°è¿è¡Œçš„ Jupyter Notebookï¼Œå¯è¿è¡Œ ps -aï¼ŒçŸ¥é“å¯¹åº”çš„ PIDï¼Œç„¶å kill -9 $PID å¦‚æœé€€å‡ºäº† SSH è¿æ¥ï¼Œä¸‹æ¬¡è¿æ¥æƒ³å…³é—­åå°çš„ Jupyter Notebookï¼Œè¿è¡Œ ps -ef | grep jupyter-notebookï¼Œç„¶å kill -9 $PIDã€‚","link":"/2019/jupyter/"},{"title":"ç»™ Ubuntu å®‰è£… NVIDIA æ˜¾å¡é©±åŠ¨","text":"åœ¨ Ubuntu 18.04 ä¸Šå®‰è£… NVIDIA æœ‰ä¸‰ç§æ–¹æ³•ï¼š ä½¿ç”¨æ ‡å‡† Ubuntu ä»“åº“è¿›è¡Œè‡ªåŠ¨åŒ–å®‰è£… ä½¿ç”¨ PPA ä»“åº“è¿›è¡Œè‡ªåŠ¨åŒ–å®‰è£… ä½¿ç”¨å®˜æ–¹çš„ NVIDIA é©±åŠ¨è¿›è¡Œæ‰‹åŠ¨å®‰è£… â€¦ ç¦ç”¨ Nouveau é©±åŠ¨ åœ¨å®‰è£…ä¹‹å‰é¦–å…ˆè¦ç¦ç”¨ Nouveau çš„é©±åŠ¨ï¼Œå¯åœ¨å®‰è£…ç³»ç»Ÿå‰ç¦ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨å®‰è£…å®Œæˆåç¦ç”¨ï¼Œçœ‹æƒ…å†µç¦ç”¨å³å¯ã€‚ åœ¨å®‰è£…ç³»ç»Ÿå‰ç¦ç”¨æ‘˜è‡ªï¼šhttps://blog.csdn.net/tjuyanming/article/details/79267984 å®‰è£… Linux ä¹‹å‰å…ˆå…³é—­ Security Bootï¼ˆä¸åŒä¸»æ¿å¼•å¯¼ç•Œé¢ä¸­è¯¥é€‰é¡¹çš„ä½ç½®å¯èƒ½ä¸å¤ªä¸€è‡´ï¼Œä½†æ˜¯å¤§å¤šæ•°éƒ½æ˜¯åœ¨ boot é€‰é¡¹ä¸­çš„ï¼‰ åœ¨è¿›å…¥ grub å®‰è£…ç•Œé¢çš„æ—¶å€™ï¼Œåœ¨ Install Ubuntu é€‰é¡¹ï¼ŒæŒ‰ e, è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼Œç„¶ååœ¨ quiet slash -- åé¢ (ä¹Ÿå¯èƒ½æ²¡æœ‰ â€“)ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œç„¶åæŒ‰ F10 é‡æ–°å¼•å¯¼ 1acpi_osi=linux nomodeset ä¿®æ”¹ä¸Šè¿°é€‰é¡¹å¯ä»¥åœ¨å¼€æœºçš„æ—¶å€™ï¼Œç¦ç”¨ nouveau æ˜¾å¡ é‡æ–°å¼•å¯¼ä¹‹åï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œå®‰è£…çš„çª—å£æœ‰ä¸€éƒ¨åˆ†å±å¹•ä¸‹æ–¹ï¼Œå¯¼è‡´éƒ¨åˆ†æŒ‰é’®æ— æ³•ç‚¹å‡»ã€‚æ­¤æ—¶ï¼ŒæŒ‰ä¸‹ Alt+F7ï¼Œé¼ æ ‡ä¼šå˜æˆæ‰‹æŒ‡å›¾æ ‡ï¼Œå³å°†çª—å£å‘ä¸Šæ‹–åŠ¨å³å¯ã€‚ åœ¨å®‰è£…ç³»ç»Ÿåç¦ç”¨æ‘˜è‡ªï¼šhttps://zhuanlan.zhihu.com/p/59618999 æ‰§è¡Œï¼š 123sudo bash -c \"echo blacklist nouveau &gt; /etc/modprobe.d/blacklist-nouveau.conf\"sudo bash -c \"echo options nouveau modeset=0 &gt;&gt; /etc/modprobe.d/blacklist-nouveau.conf\"sudo update-initramfs -u æ‰§è¡Œå®Œä¸Šé¢ä¸¤æ¡æŒ‡ä»¤åï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤çœ‹çœ‹æ˜¯å¦æˆåŠŸç¦ç”¨äº†å¼€æºé©±åŠ¨ï¼šcat /etc/modprobe.d/blacklist-nouveau.confã€‚å¦‚æœå’Œä¸‹é¢ä¸€æ ·ï¼Œè¡¨ç¤ºæˆåŠŸäº†ã€‚ 123$ cat /etc/modprobe.d/blacklist-nouveau.confblacklist nouveauoptions nouveau modeset=0 é‡å¯ç³»ç»Ÿï¼Œå®Œæˆ å®‰è£… NVIDIA é©±åŠ¨ä½¿ç”¨æ ‡å‡† Ubuntu ä»“åº“è¿›è¡Œè‡ªåŠ¨åŒ–å®‰è£…è¿™ç§æ–¹æ³•å‡ ä¹æ˜¯æ‰€æœ‰çš„ç¤ºä¾‹ä¸­æœ€ç®€å•çš„æ–¹æ³•ã€‚é¦–å…ˆï¼Œæ£€æµ‹ NVIDIA æ˜¾å¡å‹å·å’Œæ¨èçš„é©±åŠ¨ç¨‹åºã€‚ åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼šubuntu-drivers devices 1234567$ ubuntu-drivers devices== /sys/devices/pci0000:64/0000:64:00.0/0000:65:00.0 ==modalias : pci:v000010DEd00001E04sv00001458sd000037C4bc03sc00i00vendor : NVIDIA Corporationdriver : nvidia-driver-435 - distro non-free recommendeddriver : nvidia-driver-430 - distro non-freedriver : xserver-xorg-video-nouveau - distro free builtin ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç›®å‰ç³»ç»Ÿå·²è¿æ¥ Nvidia æ˜¾å¡ï¼Œå»ºè®®å®‰è£…é©±åŠ¨ç¨‹åºæ˜¯ nvidia-driver-435 ç‰ˆæœ¬çš„é©±åŠ¨ã€‚å¦‚æœæ‚¨åŒæ„è¯¥å»ºè®®ï¼Œè¯·å†æ¬¡ä½¿ç”¨ Ubuntu é©±åŠ¨ç¨‹åºå‘½ä»¤æ¥å®‰è£…æ‰€æœ‰æ¨èçš„é©±åŠ¨ç¨‹åºã€‚ è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1$ sudo ubuntu-drivers autoinstall ä¸€æ—¦å®‰è£…ç»“æŸï¼Œé‡æ–°å¯åŠ¨ç³»ç»Ÿï¼Œå°±å®Œæˆäº†ã€‚ ä½¿ç”¨ PPA ä»“åº“è¿›è¡Œè‡ªåŠ¨å®‰è£…ä½¿ç”¨å›¾å½¢é©±åŠ¨ç¨‹åº PPA å­˜å‚¨åº“å…è®¸æˆ‘ä»¬å®‰è£… NVIDIA beta é©±åŠ¨ç¨‹åºï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨ä¸ç¨³å®šçš„é£é™©ã€‚ é¦–å…ˆï¼Œå°† ppa:graphics-drivers/ppa å­˜å‚¨åº“æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼š 12$ sudo add-apt-repository ppa:graphics-drivers/ppa$ sudo apt update æ¥ä¸‹æ¥ï¼Œè¯†åˆ«æ˜¾å¡æ¨¡å‹å’Œæ¨èçš„é©±åŠ¨ç¨‹åºï¼š 1$ ubuntu-drivers devices è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1$ sudo apt install nvidia-440 ä¸€æ—¦å®Œæˆï¼Œå³å¯é‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚ å¯ä»¥å¸è½½è¯¥æºï¼š 12$ sudo add-apt-repository -r ppa:graphics-drivers/ppa$ sudo apt update ä½¿ç”¨å®˜æ–¹çš„ NVIDIA é©±åŠ¨è¿›è¡Œæ‰‹åŠ¨å®‰è£…ä¸‹è½½ NVIDIA å®˜æ–¹é©±åŠ¨ï¼Œhttps://www.nvidia.cn/Download/index.aspx?lang=cn åœæ­¢å¯è§†åŒ–æ¡Œé¢ï¼šsudo telinit 3 åœ¨ç›¸åº”è·¯å¾„ä¸‹å®‰è£… NVIDIA é©±åŠ¨: 1$ sudo bash ./NVIDIA-Linux-x86_64-440.31.run æŒ‰æç¤ºå®‰è£…å³å¯ï¼Œé‡å¯å®Œæˆï¼","link":"/2019/nvidia-ubuntu/"},{"title":"å’Œç®¡å°å§åœ¨ä¸€èµ·ä¸€å‘¨å¹´ï¼Œå‰ªäº†ä¸ªçŸ­è§†é¢‘çºªå¿µä¸€ä¸‹ï½","text":"ä¸€å‘¨å¹´å¿«ä¹ï¼ğŸ† å…­ä¸€å„¿ç«¥èŠ‚å¿«ä¹ï¼ğŸ¥³ B ç«™ä¼ é€é—¨ï¼šhttps://www.bilibili.com/video/BV11Z4y1p794/ åˆšå¥½è¿™æ®µæ—¶é—´ Bilibili å¼€æ”¾äº† 4k åˆ†è¾¨ç‡æŠ•ç¨¿ï¼Œæ‰€ä»¥å‰ªäº†ä¸ª 4k çš„ç‰ˆæœ¬ å‰ªè¾‘è½¯ä»¶ï¼šFinal Cut Pro Xã€Motion","link":"/2020/one-year/"},{"title":"Hadoop HDFS å®è·µï¼ˆ1ï¼‰â€”â€” å®‰è£… IDEA å¹¶åˆ›å»ºé¡¹ç›®","text":"æœ¬å®éªŒä½¿ç”¨ IntelliJ IDEA 2019.1 åˆ›å»ºé¡¹ç›®ï¼Œä½¿ç”¨ maven ç®¡ç†ä¾èµ–ã€‚ å®‰è£… IntelliJ IDEA 2019.1è¿›å…¥å®˜ç½‘ï¼Œä¸‹è½½ Windows ç‰ˆæœ¬çš„ IDEAï¼ˆç›´è¾¾é“¾æ¥ï¼šhttps://www.jetbrains.com/idea/download/#section=Windowsï¼‰ï¼Œè¿™é‡Œé€‰æ‹© Community ç‰ˆæœ¬ã€‚ é¦–æ¬¡å¯åŠ¨éœ€è¦è¿›è¡Œç›¸å…³é…ç½®ï¼ŒæŒ‰æç¤ºè¿›è¡Œã€‚ åˆ›å»ºé¡¹ç›®ç‚¹å‡» Create New Projectï¼Œåœ¨å·¦è¾¹é€‰æ‹© Mavenï¼ŒProject SDK é€‰æ‹© Java çš„å®‰è£…ç›®å½•ï¼Œæˆ‘è¿™é‡Œç‰ˆæœ¬æ˜¯ 1.8ï¼Œé€‰æ‹© Create from archetypeï¼Œåœ¨ä¸‹æ–¹é€‰æ‹© org.apache.maven.archetypes:maven-archetype-quickstart å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç®€å•çš„ Maven é¡¹ç›®ã€‚ é€‰æ‹©å®Œæ¯•åè¿›å…¥ä¸‹ä¸€æ­¥ã€‚ å¡«å†™é¡¹ç›®ç›¸å…³ä¿¡æ¯ï¼ŒGroupId å¯ä»¥ç†è§£æˆå¼€å‘è€…ä¿¡æ¯ï¼ŒArtifactId å¯ä»¥ç†è§£æˆé¡¹ç›®åç§°ï¼ŒVersion ä¸ç”¨æ›´æ”¹ï¼Œé»˜è®¤å°±è¡Œã€‚ å¡«å¥½åè¿›å…¥ä¸‹ä¸€æ­¥ã€‚ æ­¤é¡µæ€»ç»“é¡¹ç›®çš„ç›¸å…³ä¿¡æ¯ï¼Œæ— éœ€æ”¹åŠ¨ï¼Œç¡®è®¤æ— è¯¯åç›´æ¥ä¸‹ä¸€æ­¥ã€‚ æ¥ä¸‹æ¥è®¾ç½® Project nameï¼Œæ­¤å¤„é»˜è®¤å¡«å†™ä¸Šé¢å¡«å…¥ ArtifactId çš„å­—æ®µã€‚ Project location æ˜¯é¡¹ç›®å­˜å‚¨åœ°å€ï¼Œæ­¤å¤„éšæ„é€‰æ‹©ï¼Œæˆ‘é€‰æ‹©äº†é»˜è®¤ã€‚ ç‚¹å‡» FINISHï¼Œé¡¹ç›®åˆ›å»ºæˆåŠŸã€‚ æ·»åŠ æœ¬æ¬¡å®éªŒéœ€è¦çš„ç›¸å…³ä¾èµ–é¡¹ç›®åˆ›å»ºæˆåŠŸåä¼šè‡ªåŠ¨æ‰“å¼€ï¼ŒMaven ä¼šè‡ªåŠ¨ä¸‹è½½åˆå§‹é¡¹ç›®çš„ä¾èµ–ï¼Œå³ä¸‹è§’å¼¹å‡º Maven projects need to be importedï¼Œè¿™é‡Œé€‰æ‹© Enable Auto-Import å°±å¥½ã€‚ è®¾ç½® pom.xmlä½¿ç”¨ Java è¯­è¨€å¯¹ Hadoop HDFS è¿›è¡Œç›¸å…³æ“ä½œéœ€è¦ä½¿ç”¨ç›¸å…³ä¾èµ–ï¼Œè¿™é‡Œç”¨ Maven æ·»åŠ ã€‚ è¿›å…¥ https://mvnrepository.comï¼ŒæŸ¥æ‰¾éœ€è¦çš„ä¾èµ–ã€‚ æœç´¢åŒ…åç§°ï¼Œé€‰æ‹©ç›¸åº”ç‰ˆæœ¬ï¼Œç„¶åå¤åˆ¶çº¢æ¡†ä¸­çš„å†…å®¹ã€‚ æ‰“å¼€ IDEA é¡¹ç›®ï¼Œç¼–è¾‘ç›®å½•ä¸‹çš„ pom.xml æ–‡ä»¶ï¼Œé¦–å…ˆç¡®å®šç¼–è¯‘å™¨çš„ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ Java SDK 1.8 ç‰ˆæœ¬ï¼Œå°†æ–‡ä»¶ä¸­ 12345&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;&lt;/properties&gt; ä¸­é—´æ•°å­—è®¾ç½®ä¸º 1.8ã€‚ ç„¶ååœ¨ &lt;dependencies&gt;...&lt;/dependencies&gt; ä¸­é—´ç²˜è´´åˆšæ‰å¤åˆ¶çš„ä¾èµ–ä¿¡æ¯ã€‚ ä»¥ä¸‹æ˜¯æˆ‘è®¾ç½®å¥½çš„å®Œæ•´ä¾èµ–ä¿¡æ¯ã€‚ 123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-hdfs&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; å…¶ä»–éƒ¨åˆ†ä¸ä½œä¿®æ”¹ï¼Œè®¾ç½®å®Œæˆåï¼ŒMaven ä¼šè‡ªåŠ¨åœ¨åå°ä¸‹è½½ä¾èµ–ï¼Œæ­¤æ—¶å¯ä»¥å¼€å§‹ç¼–å†™é¡¹ç›®ä»£ç ã€‚ æ³¨ï¼šåœ¨ Maven ä¸‹è½½å®Œä¾èµ–å‰ï¼Œå¯¼å…¥åŒ…ä¼šæœ‰æç¤ºé”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºä¾èµ–æ²¡æœ‰ä¸‹è½½å®Œæˆï¼Œç­‰å¾…å®Œæˆåé”™è¯¯ä¼šæ¶ˆå¤±ã€‚","link":"/2019/operatehadoop01/"},{"title":"Hadoop HDFS å®è·µï¼ˆ2ï¼‰â€”â€” ä½¿ç”¨ Java ç¼–ç¨‹æ“ä½œ HDFS æ–‡ä»¶","text":"æ¥ç€ä¸Šä¸€ç¯‡ï¼šHadoop HDFS å®è·µï¼ˆ1ï¼‰â€”â€” å®‰è£… IDEA å¹¶åˆ›å»ºé¡¹ç›® æœ¬ç¬”è®°ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š æŸ¥çœ‹ HDFS ä¸­çš„æ–‡ä»¶åˆ—è¡¨ é”™è¯¯å¤„ç† åœ¨ HDFS ä¸­åˆ›å»ºæ–°ç›®å½• ä¸Šä¼ æ–‡ä»¶åˆ° HDFS ä» HDFS ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ° ä» HDFS ä¸­åˆ é™¤æ–‡ä»¶ é‡å‘½å HDFS ä¸­çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ æµæ–¹å¼è¯»å–æ–‡ä»¶éƒ¨åˆ†å†…å®¹ æŸ¥çœ‹ HDFS ä¸­çš„æ–‡ä»¶åˆ—è¡¨åœ¨é¡¹ç›®ç›®å½• ~/src/main/java ä¸‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸º Ls.javaï¼Œå†™å…¥ä»£ç  ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import java.net.URI;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.BlockLocation;import org.apache.hadoop.fs.FileStatus;import org.apache.hadoop.fs.LocatedFileStatus;import org.apache.hadoop.fs.Path;import org.apache.hadoop.fs.RemoteIterator;public class Ls { public static void main(String[] args) throws Exception { String uri = \"hdfs://192.168.29.127:8020/\"; // HDFSåœ°å€ Configuration config = new Configuration(); FileSystem fs = FileSystem.get(URI.create(uri), config, \"root\"); // æ–¹æ³•1ï¼šç›´æ¥è·å– FileStatus[] listStatus = fs.listStatus(new Path(\"/\")); for (FileStatus file : listStatus) { System.out.println(\"[\" + (file.isFile() ? \"file\" : \"dir\") + \"]\" + file.getPath().getName()); } // æ–¹æ³•2ï¼šä½¿ç”¨è¿­ä»£å™¨ï¼Œå¹¶é€’å½’è·å–æ‰€æœ‰å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ RemoteIterator&lt;LocatedFileStatus&gt; listFiles = fs.listFiles(new Path(\"/\"), true); while (listFiles.hasNext()) { System.out.println(\"========================\"); LocatedFileStatus fileStatus = listFiles.next(); System.out.println(\"å—å¤§å°ï¼š\" + fileStatus.getBlockSize()); System.out.println(\"æ‰€å±ï¼š\" + fileStatus.getOwner()); System.out.println(\"å¤‡ä»½æ•°ï¼š\" + fileStatus.getReplication()); System.out.println(\"æƒé™ï¼š\" + fileStatus.getPermission()); System.out.println(\"åç§°ï¼š\" + fileStatus.getPath().getName()); System.out.println(\"---------å—ä¿¡æ¯---------\"); BlockLocation[] blockLocations = fileStatus.getBlockLocations(); for (BlockLocation b : blockLocations) { System.out.println(\"å—èµ·å§‹åç§»é‡\" + b.getOffset()); System.out.println(\"å—é•¿åº¦\" + b.getLength()); // å—æ‰€åœ¨çš„datanodeèŠ‚ç‚¹ String[] datanodes = b.getHosts(); for (String dn : datanodes) { System.out.println(\"DataNode:\" + dn); } } } }} é¦–å…ˆå¯åŠ¨ Hadoopï¼Œè¿è¡Œ 1$ /opt/app/hadoop-2.9.2/sbin/start-all.sh å¾… Hadoop æˆåŠŸè¿è¡Œåï¼Œå³é”®ç‚¹å‡»ä»£ç ï¼Œé€‰æ‹© Run 'Ls.main()' è¿è¡Œç»“æœ (ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ­¤å¤„çœç•¥éƒ¨åˆ†è¾“å‡ºç»“æœ)ï¼š 1234567891011121314151617181920212223242526272829303132333435363738[dir]hbase========================å—å¤§å°ï¼š134217728æ‰€å±ï¼šrootå¤‡ä»½æ•°ï¼š1æƒé™ï¼šrw-r--r--åç§°ï¼šstate-00000000000000000006.log---------å—ä¿¡æ¯---------............========================å—å¤§å°ï¼š134217728æ‰€å±ï¼šrootå¤‡ä»½æ•°ï¼š1æƒé™ï¼šrw-r--r--åç§°ï¼šhadoop%2C33452%2C1553933199568.1553944017981---------å—ä¿¡æ¯---------å—èµ·å§‹åç§»é‡0å—é•¿åº¦83DataNode:hadoop========================å—å¤§å°ï¼š134217728æ‰€å±ï¼šrootå¤‡ä»½æ•°ï¼š1æƒé™ï¼šrw-r--r--åç§°ï¼šhbase.version---------å—ä¿¡æ¯---------å—èµ·å§‹åç§»é‡0å—é•¿åº¦7DataNode:hadoopProcess finished with exit code 0 å¯ä»¥çœ‹å‡ºè¿™äº›æ–‡ä»¶æ˜¯ç”± HBase åˆ›å»ºçš„ï¼Œæ¨æµ‹æ˜¯ä¹‹å‰åˆå§‹åŒ– HBase çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆã€‚ é”™è¯¯å¤„ç†åœ¨åˆæ¬¡è¿è¡Œæ—¶ä¼šå‡ºç°å¦‚å›¾æ‰€ç¤ºæŠ¥é”™ï¼Œä¸”ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚ è¿™æ˜¯ç”±äº log4j æ²¡æœ‰é…ç½®æ—¥å¿—è®°å½•çš„ä½ç½®ï¼Œéœ€è¦é…ç½® log4j.propertiesã€‚ è§£å†³æ–¹æ³• åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å»º resources æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨é‡Œé¢æ–°å»ºæ–‡ä»¶ log4j.propertiesï¼Œåœ¨æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ 123456hadoop.root.logger = DEBUG, consolelog4j.rootLogger = DEBUG, consolelog4j.appender.console = org.apache.log4j.ConsoleAppenderlog4j.appender.console.target = System.outlog4j.appender.console.layout = org.apache.log4j.PatternLayoutlog4j.appender.console.layout.ConversionPattern = %d{yy/MM/dd HH:mm:ss} %p %c{2}: %m%n é‡æ–°è¿è¡Œä»£ç ï¼Œä¼šæœ‰æ­£å¸¸ç»“æœè¾“å‡ºã€‚ åœ¨ HDFS ä¸­åˆ›å»ºæ–°ç›®å½•åœ¨ HDFS ä¸­åˆ›å»ºç›®å½• /mkdir/a/b åœ¨é¡¹ç›®ç›®å½• ~/src/main/java ä¸‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸º Mkdir.javaï¼Œå†™å…¥ä»£ç  ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415import java.net.URI;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;public class Mkdir { public static void main(String[] args) throws Exception { String uri = \"hdfs://192.168.29.127:8020/\"; // HDFSåœ°å€ Configuration config = new Configuration(); FileSystem fs = FileSystem.get(URI.create(uri), config, \"root\"); boolean mkdirs = fs.mkdirs(new Path(\"/mkdir/a/b\")); System.out.println(\"åˆ›å»ºç›®å½•ç»“æœï¼š\" + mkdirs); }} è¿è¡Œï¼Œè¾“å‡ºç»“æœï¼š 1åˆ›å»ºç›®å½•ç»“æœï¼štrue ä½¿ç”¨ hdfs å‘½ä»¤éªŒè¯ 1$ hdfs dfs -ls /mkdir/a/b æ²¡æœ‰æŠ¥ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œåˆ›å»ºæˆåŠŸï¼ ä¸Šä¼ æ–‡ä»¶åˆ° HDFSåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹æ–°å»ºæµ‹è¯•æ–‡ä»¶ï¼Œä¸Šä¼ åˆ° HDFS ä¸­çš„ /mkdir å…ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ Hello_World.txtï¼Œå†™å…¥å†…å®¹ï¼šThis is a test file. æ³¨æ„è¦åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºï¼Œè€Œä¸èƒ½åœ¨ src ç›®å½•ä¸‹åˆ›å»º ç„¶ååœ¨ ~/src/main/java é‡Œåˆ›å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸º Put.javaï¼Œå†™å…¥ä»£ç  ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516import java.net.URI;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;public class Put { public static void main(String[] args) throws Exception { String uri = \"hdfs://192.168.29.127:8020/\"; //HDFSåœ°å€ Configuration config = new Configuration(); FileSystem fs = FileSystem.get(URI.create(uri), config, \"root\"); String localpath = \"Hello_World.txt\"; fs.copyFromLocalFile(new Path(localpath), new Path(\"/mkdir\")); fs.close(); }} è¿è¡Œã€‚ ä½¿ç”¨ hdfs å‘½ä»¤éªŒè¯ 1$ hdfs dfs -ls /mkdir å¯ä»¥çœ‹åˆ°æ–‡ä»¶å·²ç»æˆåŠŸä¸Šä¼ ï¼ ä» HDFS ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°æŠŠ HDFS ä¸­çš„ /mkdir/Hello_World.txt ä¸‹è½½åˆ°æŒ‡å®šç›®å½•ä¸‹ åœ¨é¡¹ç›®ç›®å½• ~/src/main/java ä¸‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸º Get.javaï¼Œå†™å…¥ä»£ç  ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415import java.net.URI;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;public class Get { public static void main(String[] args) throws Exception { String uri = \"hdfs://192.168.29.127:8020/\"; //HDFSåœ°å€ Configuration config = new Configuration(); FileSystem fs = FileSystem.get(URI.create(uri), config, \"root\"); String localpath = \"Hello_World_2.txt\"; fs.copyToLocalFile(new Path(\"/mkdir/Hello_World.txt\"), new Path(localpath)); }} è¿è¡Œã€‚ å®Œæ¯•åå¯ä»¥çœ‹åˆ°åœ¨é¡¹ç›®ç›®å½•ä¸‹å¤šå‡ºæ–‡ä»¶ Hello_World_2.txtï¼Œæ‰“å¼€åå†…å®¹å’Œä¹‹å‰å¡«å…¥çš„ä¸€è‡´ã€‚ ä¸‹è½½æˆåŠŸï¼ ä» HDFS ä¸­åˆ é™¤æ–‡ä»¶åˆ é™¤ HDFS ä¸­çš„ /mkdir/Hello_World.txt æ–‡ä»¶ åœ¨é¡¹ç›®ç›®å½• ~/src/main/java ä¸‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸º Del.javaï¼Œå†™å…¥ä»£ç  ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415import java.net.URI;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;public class Del { public static void main(String[] args) throws Exception { String uri = \"hdfs://192.168.29.127:8020/\"; //HDFSåœ°å€ Configuration config = new Configuration(); FileSystem fs = FileSystem.get(URI.create(uri), config, \"root\"); boolean ret = fs.delete(new Path(\"/mkdir/Hello_World.txt\"), true); System.out.println(\"åˆ é™¤ç»“æœï¼š\" + ret); }} è¿è¡Œï¼Œè¾“å‡ºç»“æœï¼š 1åˆ é™¤ç»“æœï¼štrue ä½¿ç”¨ hdfs å‘½ä»¤éªŒè¯ 1$ hdfs dfs -ls /mkdir å¯ä»¥çœ‹åˆ°æ–‡ä»¶æˆåŠŸè¢«åˆ é™¤ï¼ é‡å‘½å HDFS ä¸­çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æŠŠ HDFS ä¸­çš„ /mkdir/a é‡å‘½åä¸º /mkdir/a_2 åœ¨é¡¹ç›®ç›®å½• ~/src/main/java ä¸‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸º Rename.javaï¼Œå†™å…¥ä»£ç  ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314import java.net.URI;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;public class Rename { public static void main(String[] args) throws Exception { String uri = \"hdfs://192.168.29.127:8020/\"; //HDFSåœ°å€ Configuration config = new Configuration(); FileSystem fs = FileSystem.get(URI.create(uri), config, \"root\"); fs.rename(new Path(\"/mkdir/a\"), new Path(\"/mkdir/a_2\")); }} è¿è¡Œ ä½¿ç”¨ hdfs å‘½ä»¤éªŒè¯ 1$ hdfs dfs -ls /mkdir é‡å‘½åæˆåŠŸï¼ æµæ–¹å¼è¯»å–æ–‡ä»¶éƒ¨åˆ†å†…å®¹ä¸Šä¼ ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨æµæ–¹å¼è¯»å–éƒ¨åˆ†å†…å®¹ä¿å­˜åˆ°å½“å‰é¡¹ç›®ç›®å½• é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ New.txtï¼Œå†…å®¹ä¸ºï¼š 1qwerasdfzxcv123456 ä¸Šä¼ åˆ° HDFS æ ¹ç›®å½• 1$ hdfs dfs -put New.txt / åœ¨é¡¹ç›®ç›®å½• ~/src/main/java ä¸‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œå‘½åä¸º StreamGet.javaï¼Œå†™å…¥ä»£ç  ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920import java.io.FileOutputStream;import java.net.URI;import org.apache.commons.io.IOUtils;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FSDataInputStream;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;public class StreamGet { public static void main(String[] args) throws Exception { String uri = \"hdfs://192.168.29.127:8020/\"; //HDFSåœ°å€ Configuration config = new Configuration(); FileSystem fs = FileSystem.get(URI.create(uri), config, \"root\"); FSDataInputStream inputStream = fs.open(new Path(\"/New.txt\")); inputStream.seek(5); //æŒ‡å®šè¯»å–çš„å¼€å§‹ä½ç½®ï¼Œè¿™é‡Œè®¾ç½®ä¸º5ï¼Œå³ä»'s'å¼€å§‹ FileOutputStream outputStream = new FileOutputStream(\"New.txt.part2\"); //æ–°çš„æ–‡ä»¶åä¸ºNew.txt.part2 IOUtils.copy(inputStream, outputStream); }} è¿è¡Œ å¯ä»¥çœ‹åˆ°é¡¹ç›®ç›®å½•ä¸‹å¤šå‡º New.txt.part2 æ–‡ä»¶ï¼Œæ‰“å¼€å¯ä»¥çœ‹åˆ°æ–‡ä»¶å†…å®¹ã€‚ å…¨æ–‡å®Œ","link":"/2019/operatehadoop02/"},{"title":"Shell è„šæœ¬çš„å­¦ä¹ ç¬”è®°å’Œä¸€äº›å¸¸ç”¨è„šæœ¬","text":"æŒç»­æ›´æ–°ä¸­ â€¦ Github Repo: https://github.com/morooi/shell-script å­¦ä¹ è®°å½•TO DO å¸¸ç”¨è„šæœ¬å¿«é€Ÿå®‰è£… Trojan-gotrojan-go-quickstart.sh 12345678# ä½¿ç”¨ root ç”¨æˆ·è¿è¡Œï¼Œæˆ–æ·»åŠ  sudowget -N --no-check-certificate \"https://raw.githubusercontent.com/morooi/shell-script/master/trojan-go-quickstart.sh\"chmod +x trojan-go-quickstart.sh./trojan-go-quickstart.sh# æˆ–bash &lt;(wget -qO- https://raw.githubusercontent.com/morooi/shell-script/master/trojan-go-quickstart.sh)# æˆ–bash &lt;(curl -sL https://raw.githubusercontent.com/morooi/shell-script/master/trojan-go-quickstart.sh) å¦‚æœæ— æ³•è¿æ¥ï¼Œä½¿ç”¨å¦‚ä¸‹ 12345678# ä½¿ç”¨ root ç”¨æˆ·è¿è¡Œï¼Œæˆ–æ·»åŠ  sudowget -N --no-check-certificate \"https://cdn.jsdelivr.net/gh/morooi/shell-script/trojan-go-quickstart.sh\"chmod +x trojan-go-quickstart.sh./trojan-go-quickstart.sh# æˆ–bash &lt;(wget -qO- https://cdn.jsdelivr.net/gh/morooi/shell-script/trojan-go-quickstart.sh)# æˆ–bash &lt;(curl -sL https://cdn.jsdelivr.net/gh/morooi/shell-script/trojan-go-quickstart.sh) å®‰è£… zsh å’Œ oh-my-zshinstall-zsh.sh 1234567wget -N --no-check-certificate \"https://raw.githubusercontent.com/morooi/shell-script/master/install-zsh.sh\"chmod +x install-zsh.sh./install-zsh.sh# æˆ–bash &lt;(wget -qO- https://raw.githubusercontent.com/morooi/shell-script/master/install-zsh.sh)# æˆ–bash &lt;(curl -sL https://raw.githubusercontent.com/morooi/shell-script/master/install-zsh.sh) å¦‚æœæ— æ³•è¿æ¥ï¼Œä½¿ç”¨å¦‚ä¸‹ 1234567wget -N --no-check-certificate \"https://cdn.jsdelivr.net/gh/morooi/shell-script/install-zsh.sh\"chmod +x install-zsh.sh./install-zsh.sh# æˆ–bash &lt;(wget -qO- https://cdn.jsdelivr.net/gh/morooi/shell-script/install-zsh.sh)# æˆ–bash &lt;(curl -sL https://cdn.jsdelivr.net/gh/morooi/shell-script/install-zsh.sh)","link":"/2020/shell-script/"},{"title":"å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›† (Resilient Distributed Datasets, RDD)","text":"RDD ç®€ä»‹RDDï¼Œå…¨ç§° Resilient Distributed Datasetsï¼ˆå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼‰ï¼Œæ˜¯ Spark æœ€ä¸ºæ ¸å¿ƒçš„æ¦‚å¿µï¼Œæ˜¯ Spark å¯¹æ•°æ®çš„æŠ½è±¡ã€‚ RDD æ˜¯åˆ†å¸ƒå¼çš„å…ƒç´ é›†åˆï¼Œæ¯ä¸ª RDD åªæ”¯æŒè¯»æ“ä½œï¼Œä¸”æ¯ä¸ª RDD éƒ½è¢«åˆ†ä¸ºå¤šä¸ªåˆ†åŒºå­˜å‚¨åˆ°é›†ç¾¤çš„ä¸åŒèŠ‚ç‚¹ä¸Šã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRDD è¿˜å…è®¸ç”¨æˆ·æ˜¾ç¤ºçš„æŒ‡å®šæ•°æ®å­˜å‚¨åˆ°å†…å­˜å’Œç£ç›˜ä¸­ã€‚ å¯¹ RDD çš„æ“ä½œï¼Œä»ç±»å‹ä¸Šä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒåŒ…æ‹¬ï¼šåˆ›å»º RDDã€è½¬åŒ–å·²æœ‰çš„ RDD ä»¥åŠåœ¨å·²æœ‰ RDD çš„åŸºç¡€ä¸Šè¿›è¡Œæ±‚å€¼ã€‚ RDD ç¼–ç¨‹ç»ƒä¹ flatMapflatMap() æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°å°†æ¯ä¸ªå…ƒç´ è½¬ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œæœ€ç»ˆ flatMap() å¹¶ä¸æ˜¯è¿”å›ç”±ä¸Šè¿°åˆ—è¡¨ä½œä¸ºå…ƒç´ ç»„æˆçš„ RDDï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªåŒ…å«æ¯ä¸ªåˆ—è¡¨æ‰€æœ‰å…ƒç´ çš„ RDD flatMap() ç»ƒä¹ ä»£ç ï¼š 12345678910111213141516171819import org.apache.log4j.{Level, Logger}import org.apache.spark.{SparkConf, SparkContext}object flatMap { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(\"RDDFlatMap\") Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) transformationOps(sc) sc.stop() } def transformationOps(sc:SparkContext): Unit = { val list = List(\"hello you\", \"hello he\", \"hello me\") val listRDD = sc.parallelize(list) val wordsRDD = listRDD.flatMap(line =&gt; line.split(\" \")) wordsRDD.foreach(println) }} ç»“æœå¦‚ä¸‹å›¾ï¼š samplesample() é‡‡æ ·å˜æ¢æ ¹æ®ç»™å®šçš„éšæœºç§å­ï¼Œä» RDD ä¸­éšæœºåœ°æŒ‰æŒ‡å®šæ¯”ä¾‹é€‰ä¸€éƒ¨åˆ†è®°å½•ï¼Œåˆ›å»ºæ–°çš„ RDDã€‚ è¯­æ³• 1def sample(withReplacement: Boolean, fraction: Double, seed: Long = Utils.random.nextLong): RDD[T] å‚æ•°withReplacement: Boolean, True è¡¨ç¤ºè¿›è¡Œæ›¿æ¢é‡‡æ ·ï¼ŒFalse è¡¨ç¤ºè¿›è¡Œéæ›¿æ¢é‡‡æ ·fraction: Double, åœ¨ 0~1 ä¹‹é—´çš„ä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œè¡¨ç¤ºè¦é‡‡æ ·çš„è®°å½•åœ¨å…¨ä½“è®°å½•ä¸­çš„æ¯”ä¾‹seed: éšæœºç§å­ sample() ç»ƒä¹ ä»£ç ï¼š 12345678910111213141516171819202122import org.apache.log4j.{Level, Logger}import org.apache.spark.{SparkConf, SparkContext}object sample { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(sample.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) transformationOps(sc) sc.stop() } def transformationOps(sc: SparkContext): Unit = { val list = 1 to 1000 val listRDD = sc.parallelize(list) val sampleRDD = listRDD.sample(false, 0.2) sampleRDD.foreach(num =&gt; print(num + \" \")) println println(\"sampleRDD count: \" + sampleRDD.count()) println(\"Another sampleRDD count: \" + sc.parallelize(list).sample(false, 0.2).count()) }} ç»“æœå¦‚ä¸‹å›¾ï¼š unionunion() åˆå¹¶å˜æ¢å°†ä¸¤ä¸ª RDD åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ RDDï¼Œé‡å¤çš„è®°å½•ä¸ä¼šè¢«å‰”é™¤ã€‚ è¯­æ³• 1def union(other: RDD[T]): RDD[T] å‚æ•°other: ç¬¬äºŒä¸ª RDD union() ç»ƒä¹ ä»£ç ï¼š 12345678910111213141516171819202122import org.apache.log4j.{Level, Logger}import org.apache.spark.{SparkConf, SparkContext}object union { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(union.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) transformationOps(sc) sc.stop() } def transformationOps(sc: SparkContext): Unit = { val list1 = List(1, 2, 3, 4, 5, 6, 7, 8, 9, 10) val list2 = List(7, 8, 9, 10, 11, 12) val listRDD1 = sc.parallelize(list1) val listRDD2 = sc.parallelize(list2) val unionRDD = listRDD1.union(listRDD2) unionRDD.foreach(println) }} ç»“æœå¦‚ä¸‹å›¾ï¼š groupByKeygroupByKey() å°† RDD ä¸­æ¯ä¸ªé”®çš„å€¼åˆ†ç»„ä¸ºå•ä¸ªåºåˆ—ã€‚ groupByKey() ç»ƒä¹ ä»£ç ï¼š 1234567891011121314151617181920212223import org.apache.log4j.{Level, Logger}import org.apache.spark.{SparkConf, SparkContext}object groupByKey { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(groupByKey.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) transformationOps(sc) sc.stop() def transformationOps(sc: SparkContext): Unit = { val list = List(\"hello you\", \"hello he\", \"hello me\") val listRDD = sc.parallelize(list) val wordsRDD = listRDD.flatMap(line =&gt; line.split(\" \")) val pairsRDD = wordsRDD.map(word =&gt; (word, 1)) pairsRDD.foreach(println) val gbkRDD = pairsRDD.groupByKey() println(\"==============================\") gbkRDD.foreach(t =&gt; println(t._1 + \"...\" + t._2)) } }} ç»“æœå¦‚ä¸‹å›¾ï¼š reduceByKeyä¸ groupByKey() ç±»ä¼¼ï¼Œå´æœ‰ä¸åŒã€‚ å¦‚ (a,1), (a,2), (b,1), (b,2)ï¼ŒgroupByKey() äº§ç”Ÿä¸­é—´ç»“æœä¸º ((a,1), (a,2)), ((b,1), (b,2))ï¼ŒreduceByKey() ä¸º (a,3), (b,3)ã€‚ reduceByKey() ä¸»è¦ä½œç”¨æ˜¯èšåˆï¼ŒgroupByKey() ä¸»è¦ä½œç”¨æ˜¯åˆ†ç»„ã€‚ reduceByKey() ç»ƒä¹ ä»£ç ï¼š 1234567891011121314151617181920212223import org.apache.log4j.{Level, Logger}import org.apache.spark.rdd.RDDimport org.apache.spark.{SparkConf, SparkContext}object reduceByKey { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(reduceByKey.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) transformationOps(sc) sc.stop() } def transformationOps(sc: SparkContext): Unit = { val list = List(\"hello you\", \"hello he\", \"hello me\") val listRDD = sc.parallelize(list) val wordsRDD = listRDD.flatMap(line =&gt; line.split(\" \")) val pairsRDD: RDD[(String, Int)] = wordsRDD.map(word =&gt; (word, 1)) val retRDD: RDD[(String, Int)] = pairsRDD.reduceByKey((v1, v2) =&gt; v1 + v2) retRDD.foreach(t =&gt; println(t._1 + \"...\" + t._2)) }} ç»“æœå¦‚ä¸‹å›¾ï¼š sortByKeysortByKey([ascending], [numTasks]) sortByKey() ä½œç”¨äº Key-Value å½¢å¼çš„ RDDï¼Œå¹¶å¯¹ Key è¿›è¡Œæ’åºã€‚ [ascending] å‡åºï¼Œé»˜è®¤ä¸º trueï¼Œå³å‡åº 12345678910111213141516171819202122232425262728293031323334import org.apache.log4j.{Level, Logger}import org.apache.spark.rdd.RDDimport org.apache.spark.{SparkConf, SparkContext}object sortByKey { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(sortByKey.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) transformationOps(sc) sc.stop() } /** * sortByKeyï¼šå°†å­¦ç”Ÿèº«é«˜è¿›è¡Œï¼ˆé™åºï¼‰æ’åº * èº«é«˜ç›¸ç­‰ï¼ŒæŒ‰ç…§å¹´é¾„æ’ï¼ˆå‡åºï¼‰ */ def transformationOps(sc: SparkContext): Unit = { val list = List( \"1,æ ç£Š,22,175\", \"2,åˆ˜é“¶é¹,23,175\", \"3,é½å½¦é¹,22,180\", \"4,æ¨ æŸ³,22,168\", \"5,æ•¦ é¹,20,175\" ) val listRDD:RDD[String] = sc.parallelize(list) // ä½¿ç”¨sortByKeyå®Œæˆæ“ä½œ,åªåšèº«é«˜é™åºæ’åº val heightRDD:RDD[(String, String)] = listRDD.map(line =&gt; { val fields = line.split(\",\") (fields(3), line) }) val retRDD:RDD[(String, String)] = heightRDD.sortByKey(ascending = false, numPartitions = 1) retRDD.foreach(println) }} combineByKey ä¸ aggregeteByKeyä¸‹é¢çš„ä»£ç åˆ†åˆ«ä½¿ç”¨ aggregateByKey() å’Œ combineByKey() æ¥æ¨¡æ‹Ÿ groupByKey() å’Œ reduceBykey() ä½¿ç”¨ aggregateByKey æ¨¡æ‹Ÿ groupByKey 12345678910111213141516171819202122232425262728293031323334353637import org.apache.log4j.{Level, Logger}import org.apache.spark.rdd.RDDimport org.apache.spark.{SparkConf, SparkContext}import scala.collection.mutable.ArrayBufferobject aggregateByKey_1 { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(aggregateByKey_1.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) aggregateByKey2GroupByKey(sc) sc.stop() /** * ä½¿ç”¨aggregateByKeyæ¨¡æ‹ŸgroupByKey */ def aggregateByKey2GroupByKey(sc: SparkContext): Unit = { val list = List(\"hello bo bo\", \"zhou xin xin\", \"hello song bo\") val lineRDD = sc.parallelize(list) val wordsRDD = lineRDD.flatMap(line =&gt; line.split(\" \")) val pairsRDD = wordsRDD.map(word =&gt; (word, 1)) val retRDD: RDD[(String, ArrayBuffer[Int])] = pairsRDD.aggregateByKey(ArrayBuffer[Int]())( (part, num) =&gt; { part.append(num) part }, (part1, part2) =&gt; { part1.++=(part2) part1 } ) retRDD.foreach(println) } }} è¿è¡Œç»“æœï¼š ä½¿ç”¨ aggregateByKey æ¨¡æ‹Ÿ reduceByKey 1234567891011121314151617181920212223242526272829import org.apache.log4j.{Level, Logger}import org.apache.spark.rdd.RDDimport org.apache.spark.{SparkConf, SparkContext}object aggregateByKey_2 { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(aggregateByKey_2.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) aggregateByKey2ReduceByKey(sc) sc.stop() /** * ä½¿ç”¨aggregateByKeyæ¨¡æ‹ŸreduceByKey */ def aggregateByKey2ReduceByKey(sc: SparkContext): Unit = { val list = List(\"hello bo bo\", \"zhou xin xin\", \"hello song bo\") val lineRDD = sc.parallelize(list) val wordsRDD = lineRDD.flatMap(line =&gt; line.split(\" \")) val pairsRDD = wordsRDD.map(word =&gt; (word, 1)) val retRDD: RDD[(String, Int)] = pairsRDD.aggregateByKey(0)( (partNum, num) =&gt; partNum + num, // ä¹Ÿå°±æ˜¯mergeValue (partNum1, partNum2) =&gt; partNum1 + partNum2 // ä¹Ÿå°±æ˜¯mergeCombiners ) retRDD.foreach(println) } }} è¿è¡Œç»“æœï¼š ä½¿ç”¨ combineByKey æ¨¡æ‹Ÿ reduceByKey 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758import org.apache.log4j.{Level, Logger}import org.apache.spark.rdd.RDDimport org.apache.spark.{SparkConf, SparkContext}object combineByKey_1 { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(combineByKey_1.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) combineByKey2ReduceByKey(sc) sc.stop() /** * ä½¿ç”¨combineByKeyæ¨¡æ‹ŸreduceByKey */ def combineByKey2ReduceByKey(sc: SparkContext): Unit = { val list = List(\"hello bo bo\", \"zhou xin xin\", \"hello song bo\") val lineRDD = sc.parallelize(list) val wordsRDD = lineRDD.flatMap(line =&gt; line.split(\" \")) val pairsRDD = wordsRDD.map(word =&gt; (word, 1)) /** * å¯¹äºcreateCombiner1, mergeValue1, mergeCombiners1 * ä»£ç çš„å‚æ•°å·²ç»ä½“ç°å¾—å¾ˆæ¸…æ¥šäº†ï¼Œå…¶å®åªè¦ç†è§£äº†combineByKeyæ¨¡æ‹ŸgroupByKeyçš„ä¾‹å­ï¼Œè¿™ä¸ªå°±éå¸¸å®¹æ˜“äº† */ val retRDD: RDD[(String, Int)] = pairsRDD.combineByKey(createCombiner1, mergeValue1, mergeCombiners1) retRDD.foreach(println) } /** * reduceByKeyæ“ä½œï¼Œvalueå°±æ˜¯è¯¥æ•°å€¼æœ¬èº«ï¼Œåˆ™ä¸Šé¢çš„æ•°æ®ä¼šäº§ç”Ÿï¼š * (hello, 1) (bo, 1) (bo, 1) * (zhou, 1) (xin, 1) (xin, 1) * (hello, 1) (song, 1) (bo, 1) * æ³¨æ„æœ‰åˆ«äºgroupByKeyçš„æ“ä½œï¼Œå®ƒæ˜¯åˆ›å»ºä¸€ä¸ªå®¹å™¨ */ def createCombiner1(num: Int): Int = { num } /** * åŒä¸€partitionå†…ï¼Œå¯¹äºæœ‰ç›¸åŒkeyçš„ï¼Œè¿™é‡Œçš„mergeValueç›´æ¥å°†å…¶valueç›¸åŠ  * æ³¨æ„æœ‰åˆ«äºgroupByKeyçš„æ“ä½œï¼Œå®ƒæ˜¯æ·»åŠ åˆ°valueåˆ°ä¸€ä¸ªå®¹å™¨ä¸­ */ def mergeValue1(localNum1: Int, localNum2: Int): Int = { localNum1 + localNum2 } /** * å°†ä¸¤ä¸ªä¸åŒpartitionä¸­çš„keyç›¸åŒçš„valueå€¼ç›¸åŠ èµ·æ¥ * æ³¨æ„æœ‰åˆ«äºgroupByKeyçš„æ“ä½œï¼Œå®ƒæ˜¯åˆå¹¶ä¸¤ä¸ªå®¹å™¨ */ def mergeCombiners1(thisPartitionNum1: Int, anotherPartitionNum2: Int): Int = { thisPartitionNum1 + anotherPartitionNum2 } }} è¿è¡Œç»“æœï¼š ä½¿ç”¨ combineByKey æ¨¡æ‹Ÿ groupByKey 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465import org.apache.log4j.{Level, Logger}import org.apache.spark.rdd.RDDimport org.apache.spark.{SparkConf, SparkContext}import scala.collection.mutable.ArrayBufferobject combineByKey_2 { def main(args: Array[String]): Unit = { val conf = new SparkConf().setMaster(\"local[2]\").setAppName(combineByKey_2.getClass.getSimpleName) Logger.getLogger(\"org.apache.spark\").setLevel(Level.OFF) val sc = new SparkContext(conf) combineByKey2GroupByKey(sc) sc.stop() /** * ä½¿ç”¨combineByKeyæ¨¡æ‹ŸgroupByKey */ def combineByKey2GroupByKey(sc: SparkContext): Unit = { val list = List(\"hello bo bo\", \"zhou xin xin\", \"hello song bo\") val lineRDD = sc.parallelize(list) val wordsRDD = lineRDD.flatMap(line =&gt; line.split(\" \")) val pairsRDD = wordsRDD.map(word =&gt; (word, 1)) // è¾“å‡ºæ¯ä¸ªpartitionä¸­çš„mapå¯¹ pairsRDD.foreachPartition(partition =&gt; { println(\"&lt;=========partition-start=========&gt;\") partition.foreach(println) println(\"&lt;=========partition-end=========&gt;\") }) val gbkRDD: RDD[(String, ArrayBuffer[Int])] = pairsRDD.combineByKey(createCombiner, mergeValue, mergeCombiners) gbkRDD.foreach(println) } /** * åˆå§‹åŒ–ï¼Œå°†valueè½¬å˜æˆä¸ºæ ‡å‡†çš„æ ¼å¼æ•°æ® * æ˜¯åœ¨æ¯ä¸ªåˆ†åŒºä¸­è¿›è¡Œçš„æ“ä½œï¼Œå»é‡åçš„keyæœ‰å‡ ä¸ªï¼Œå°±è°ƒç”¨æ¬¡ï¼Œ * å› ä¸ºå¯¹äºæ¯ä¸ªkeyï¼Œå…¶å®¹å™¨åˆ›å»ºä¸€æ¬¡å°±okäº†ï¼Œä¹‹åæœ‰keyç›¸åŒçš„ï¼Œåªéœ€è¦æ‰§è¡ŒmergeValueåˆ°å·²ç»åˆ›å»ºçš„å®¹å™¨ä¸­å³å¯ */ def createCombiner(num: Int): ArrayBuffer[Int] = { println(\"----------createCombiner----------\") ArrayBuffer[Int](num) } /** * å°†keyç›¸åŒçš„valueï¼Œæ·»åŠ åˆ°createCombinerå‡½æ•°åˆ›å»ºçš„ArrayBufferå®¹å™¨ä¸­ * ä¸€ä¸ªåˆ†åŒºå†…çš„èšåˆæ“ä½œï¼Œå°†ä¸€ä¸ªåˆ†åŒºå†…keyç›¸åŒçš„æ•°æ®ï¼Œåˆå¹¶ */ def mergeValue(ab: ArrayBuffer[Int], num: Int): ArrayBuffer[Int] = { println(\"----------mergeValue----------\") ab.append(num) ab } /** * å°†keyç›¸åŒçš„å¤šä¸ªvalueæ•°ç»„ï¼Œè¿›è¡Œæ•´åˆ * åˆ†åŒºé—´çš„åˆå¹¶æ“ä½œ */ def mergeCombiners(ab1: ArrayBuffer[Int], ab2: ArrayBuffer[Int]): ArrayBuffer[Int] = { println(\"----------mergeCombiners----------\") ab1 ++= ab2 ab1 } }}","link":"/2019/spark/"},{"title":"SSH ç›¸å…³æ“ä½œ","text":"å¯ç”¨ SSH å¹¶ä½¿ç”¨ root è´¦æˆ·ç™»å½•è™½è¯´é€šè¿‡åº”ç”¨çš„å½¢å¼åœ¨ Windows 10 ä¸Šä½“éªŒ Linux æ˜¯ä¸€ä¸ªä¸èµ–çš„é€‰æ‹©ï¼Œä½†å¾ˆå¤šæ—¶å€™ä½¿ç”¨ Windows å†…ç½®çš„ CMD æˆ–è€… PowerShell æ¥æ“ä½œ Linux ä¾æ—§æœ‰ç€å¾ˆå¤šä¸ä¹ æƒ¯ã€‚ è€Œæœ€ä¸ºå…³é”®çš„æ˜¯å½“éœ€è¦å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œæ—¶ï¼Œä½¿ç”¨äº¤äº’å‘½ä»¤è¿œä¸å¦‚ä½¿ç”¨ SFTP æ¥çš„æ›´ä¸ºã€Œç®€å•ç²—æš´ã€ã€‚å› æ­¤åªè¦é€šè¿‡é…ç½® SSH è¿œç¨‹ç™»å½•ï¼Œå°±å¯ä»¥åƒç®¡ç†è¿œç¨‹æœåŠ¡å™¨é‚£æ ·æ¥æ“ä½œè¿™ä¸ª Linux ç³»ç»Ÿäº†ã€‚ é¦–å…ˆï¼Œå› ä¸º Ubuntu ç³»ç»Ÿé™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯ä»¥ä¸º root ç”¨æˆ·è®¾ç½®æ–°å¯†ç ï¼Œè¿™é‡Œè¾“å…¥ï¼š 1sudo passwd root é…ç½®å¥½ä¹‹åï¼Œæœªæ¥ä½¿ç”¨ SSH å®¢æˆ·ç«¯æˆ–è€… SFTP å®¢æˆ·ç«¯ç™»å½•ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ root æƒé™è¿›è¡Œç™»å½•ã€‚ ä½¿ç”¨ cp å‘½ä»¤å°† SSH ç›¸å…³é…ç½®æ–‡ä»¶è¿›è¡Œå¤‡ä»½ï¼š 1sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak ä¹‹åä½¿ç”¨ vim ç¼–è¾‘å™¨ç¼–è¾‘ sshd_config æ–‡ä»¶ï¼š 1sudo vim /etc/ssh/sshd_config ç¼–è¾‘å¹¶è°ƒæ•´ä»¥ä¸‹è®¾ç½®é¡¹ï¼š 12345Port 22ListenAddress 0.0.0.0PermitRootLogin yes # ä¿®æ”¹æˆ yes#StrictModes yes #æ³¨é‡Šæ‰è¿™ä¸€è¡ŒPasswordAuthentication yes # åŸæ¥æ˜¯ noï¼Œæ”¹æˆ yes ç„¶åè¾“å…¥å‘½ä»¤ï¼š 1systemctl restart sshd å¯åŠ¨ SSH å¦‚æœè¦ä»å…¶ä»–ç”µè„‘è¿æ¥ï¼Œè®°å¾—é˜²ç«å¢™æ”¾è¡Œç«¯å£ 22 é”™è¯¯å¤„ç†å¦‚æœå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡ ssh-keygen è‡ªåŠ¨äº§ç”Ÿç¼ºå°‘çš„ key 1234* Stopping OpenBSD Secure Shell server sshd [ OK ] * Starting OpenBSD Secure Shell server sshd Could not load host key: /etc/ssh/ssh_host_rsa_keyCould not load host key: /etc/ssh/ssh_host_ecdsa_keyCould not load host key: /etc/ssh/ssh_host_ed25519_key ä¿®å¤æ–¹æ³• æ‰§è¡Œ 1sudo ssh-keygen -A é‡å¯ ssh æœåŠ¡ 123root@Monster:~$ sudo service ssh --full-restart * Stopping OpenBSD Secure Shell server sshd [ OK ] * Starting OpenBSD Secure Shell server sshd [ OK ] è®¾ç½®å…å¯†ç™»å½•é€šå¸¸æ¥è¯´ï¼Œå¯åŠ¨ root ç™»å½•ï¼Œå¹¶ä½¿ç”¨å¯†ç è¿›è¡Œè¿æ¥ä¸ä»…ä¸å®‰å…¨ï¼Œè€Œä¸”è¿æ¥éœ€è¦è¾“å…¥å¯†ç ï¼Œè¿™é‡Œæè¿°å¦‚ä½•ä½¿ç”¨æ›´å®‰å…¨çš„å…å¯†ç™»å½•ã€‚ STEP 1ï¼šåœ¨æœ¬åœ°ç”Ÿæˆå…¬é’¥å’Œç§é’¥å¯¹1234# RSA ç®—æ³•ï¼Œé•¿åº¦ 4096ï¼ˆé»˜è®¤ä¸º 2048ï¼‰ssh-keygen -t rsa -b 4096 -f [FILE_NAME] -C [USERNAME]# ED25519 ç®—æ³•ssh-keygen -t ed25519 -f [FILE_NAME] -C [USERNAME] ä¸€è·¯å›è½¦ï¼Œéƒ½è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œå³åœ¨æœ¬åœ°ç”Ÿæˆäº†å…¬é’¥å’Œç§é’¥ï¼Œè®¾ç½® passphraseï¼ˆæ›´å®‰å…¨ï¼Œä½†æ˜¯æ¯æ¬¡è¿æ¥å‰éœ€è¦è¾“å…¥å¯†ç ï¼‰ï¼Œå­˜å‚¨åœ¨å½“å‰ç›®å½•ä¸‹ï¼ˆå¦‚æœä¸ä½¿ç”¨ -f å‚æ•°ï¼Œåˆ™ä¼šé»˜è®¤ç”Ÿæˆåœ¨ï½/.ssh/ ç›®å½•ä¸‹ï¼‰ 123456&gt; .ssh tree -a.â”œâ”€â”€ authorized_keys â”œâ”€â”€ id_rsaâ”œâ”€â”€ id_rsa.pub â””â”€â”€ known_hosts å…¶ä¸­ï¼š id_rsa æ˜¯é»˜è®¤ç”Ÿæˆçš„ç§é’¥ id_rsa.pub æ˜¯é»˜è®¤ç”Ÿæˆçš„å…¬é’¥ authorized_keys æ–‡ä»¶å­˜æ”¾å…¶ä»–ä¸»æœºçš„å…¬é’¥ï¼Œå…¶ä»–ä¸»æœºå³å¯ ssh ç™»å½•è¯¥æœº know_hosts è®°å½•ä¸»æœºç™»é™†è¿‡çš„å…¶ä»–ä¸»æœºçš„å…¬é’¥ä¿¡æ¯ã€‚ STEP 2ï¼šæŠŠå…¬é’¥åŠ å…¥åˆ°æœåŠ¡å™¨çš„ authorized_keys æ–‡ä»¶ä¸­ä½¿ç”¨ ssh-copy-id å‘½ä»¤ï¼Œssh-copy-id å‘½ä»¤å¯ä»¥æŠŠæœ¬åœ°ä¸»æœºçš„å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„ authorized_keys æ–‡ä»¶ä¸Šï¼Œssh-copy-id å‘½ä»¤ä¹Ÿä¼šç»™è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·ä¸»ç›®å½•ä¸­ ~/.ssh/authorized_keys è®¾ç½®åˆé€‚çš„æƒé™ã€‚ æŠŠæœ¬åœ°çš„ ssh å…¬é’¥æ–‡ä»¶å®‰è£…åˆ°è¿œç¨‹ä¸»æœºå¯¹åº”çš„è´¦æˆ·ä¸‹ï¼š 12345ssh-copy-id user@server# æˆ–ssh-copy-id -i ~/.ssh/id_rsa.pub user@server # æŒ‡å®šå…¬é’¥è·¯å¾„# æˆ–ssh-copy-id -i ~/.ssh/id_rsa.pub -p xxx user@server # å½“ç«¯å£å·éé»˜è®¤çš„22æ—¶ï¼Œä½¿ç”¨æ­¤å‘½ä»¤ï¼Œxxxå¤„ä¸ºæŒ‡å®šç«¯å£å· å¯é€‰æ­¥éª¤ï¼šé…ç½®æœ¬åœ° config æ–‡ä»¶åœ¨æœ¬åœ°æœºå™¨çš„ç›®å½• ~/.ssh ä¸‹æ‰¾åˆ° config æ–‡ä»¶ï¼ŒæŒ‰å¦‚ä¸‹è¿›è¡Œé…ç½®ï¼š 12345Host xxx # xxxï¼šä¸€ä¸ªæœåŠ¡å™¨æ˜µç§° HostName xx.xx.xx.xx # ç›®çš„æœºå™¨çš„ip User username # sshç™»é™†æ—¶å€™çš„ç”¨æˆ·å Port 22 # sshæ‰€ä½¿ç”¨çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯22 IdentityFile /Users/morooi/.ssh/vultr # å¯¹åº”æœåŠ¡å™¨å…¬é’¥çš„æœ¬åœ°ç§é’¥æ–‡ä»¶è·¯å¾„ ä»¥ååªè¦ ssh xxx ä¾¿å¯ç™»é™†æœåŠ¡å™¨å•¦ï½ SCP å‘½ä»¤scp å‘½ä»¤å¯ç”¨äº linux/macOS ä¹‹é—´å¤åˆ¶æ–‡ä»¶å’Œç›®å½•ã€‚scp æ˜¯ secure copy çš„ç¼©å†™ï¼Œscp æ˜¯ linux/macOS ç³»ç»Ÿä¸‹åŸºäº ssh ç™»é™†è¿›è¡Œå®‰å…¨çš„è¿œç¨‹æ–‡ä»¶æ‹·è´å‘½ä»¤ã€‚scp æ˜¯åŠ å¯†çš„ ä»æœ¬åœ°å¤åˆ¶åˆ°è¿œç¨‹123456789101112131415161718192021222324# æŒ‡å®šäº†ç”¨æˆ·åï¼Œå‘½ä»¤æ‰§è¡Œåéœ€è¦å†è¾“å…¥å¯†ç ï¼Œä»…æŒ‡å®šäº†è¿œç¨‹çš„ç›®å½•ï¼Œæ–‡ä»¶åå­—ä¸å˜scp local_file remote_username@remote_ip:remote_folder# æŒ‡å®šäº†ç”¨æˆ·åï¼Œå‘½ä»¤æ‰§è¡Œåéœ€è¦å†è¾“å…¥å¯†ç ï¼ŒæŒ‡å®šäº†æ–‡ä»¶åscp local_file remote_username@remote_ip:remote_file# æ²¡æœ‰æŒ‡å®šç”¨æˆ·åï¼Œå‘½ä»¤æ‰§è¡Œåéœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œä»…æŒ‡å®šäº†è¿œç¨‹çš„ç›®å½•ï¼Œæ–‡ä»¶åå­—ä¸å˜scp local_file remote_ip:remote_folder# æ²¡æœ‰æŒ‡å®šç”¨æˆ·åï¼Œå‘½ä»¤æ‰§è¡Œåéœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ŒæŒ‡å®šäº†æ–‡ä»¶åscp local_file remote_ip:remote_file# å¤åˆ¶ç›®å½•ï¼Œå°†local_folderå¤åˆ¶åˆ°remote_folderä¸‹scp -r local_folder remote_username@remote_ip:remote_folder scp -r local_folder remote_ip:remote_folder# å®ä¾‹scp ~/Downloads/paper.pdf morooi@192.168.1.1:~/Downloadsscp ~/Downloads/paper.pdf morooi@192.168.1.1:~/Downloads/paper.pdfscp ~/Downloads/paper.pdf 192.168.1.1:~/Downloadsscp ~/Downloads/paper.pdf 192.168.1.1:~/Downloads/paper.pdfscp -r ~/Downloads/papercode morooi@192.168.1.1:~/Downloads/scp -r ~/Downloads/papercode 192.168.1.1:~/Downloads/ ä»è¿œç¨‹å¤åˆ¶åˆ°æœ¬åœ°12345# åªè¦å°†ä»æœ¬åœ°å¤åˆ¶åˆ°è¿œç¨‹çš„å‘½ä»¤çš„å2ä¸ªå‚æ•°è°ƒæ¢é¡ºåºå³å¯ï¼Œå¦‚ä¸‹scp morooi@192.168.1.1:~/Downloads ~/Downloads/paper.pdfscp -r morooi@192.168.1.1:~/Downloads/ ~/Downloads/papercode# å¯ä½¿ç”¨-pæŒ‡å®šç«¯å£","link":"/2019/ssh_nopassw/"},{"title":"ç»™ CentOS 7 minimal å®‰è£…å›¾å½¢ç•Œé¢","text":"ä»¥ä¸‹æ“ä½œä¸è¦ä½¿ç”¨ SSH è¿æ¥ï¼ŒSSH å®¢æˆ·ç«¯æ— æ³•æ˜¾ç¤ºå›¾å½¢ç•Œé¢ã€‚ å®‰è£…å¯ç”¨å›¾å½¢ç•Œé¢è¿›å…¥è™šæ‹Ÿæœºï¼Œç™»å½•ã€‚ æ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£… GNOME Desktop Environmentã€‚ 1$ yum -y groups install \"GNOME Desktop\" æ¥ä¸‹æ¥æ˜¯æ¼«é•¿çš„ç­‰å¾…æ—¶é—´â€¦â€¦â€¦â€¦.. å¾…æ‰€æœ‰å®‰è£…å®Œæˆåï¼Œè¿è¡Œ 1$ startx GNOME æ¡Œé¢ç¯å¢ƒï¼Œå¯åŠ¨ï¼ é…ç½®å¼€æœºé»˜è®¤è¿›å…¥å›¾å½¢ç•Œé¢ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹æŸ¥çœ‹æ˜¯å“ªä¸ªæ¨¡å¼ã€‚ 1$ systemctl get-default å¼€æœºé»˜è®¤å¯åŠ¨å›¾å½¢ç•Œé¢ã€‚ 12$ systemctl set-default graphical.target # å›¾å½¢ç•Œé¢æ¨¡å¼$ reboot # é‡å¯ç³»ç»Ÿ å¦‚æœæƒ³æ”¹å›å­—ç¬¦ç•Œé¢æ¨¡å¼ã€‚ 12$ systemctl set-default multi-user.target # å­—ç¬¦ç•Œé¢æ¨¡å¼$ reboot # é‡å¯ç³»ç»Ÿ å®‰è£… VMware Toolsåœ¨æ­¤ä¹‹å‰éœ€è¦å®‰è£…å¼€å‘ç¯å¢ƒã€‚ 1$ yum install perl gcc make kernel-headers kernel-devel -y åœ¨ VMware ä¸­é€‰æ‹©è™šæ‹Ÿæœºâ€“&gt; å®‰è£… VMware Toolsï¼ŒæŒ‰æç¤ºæ“ä½œã€‚ ç”±äºæˆ‘å·²ç»å®‰è£…å¥½ï¼Œæ‰€ä»¥å›¾ç‰‡é‡Œæ˜¾ç¤ºçš„æ˜¯ â€œé‡æ–°å®‰è£… VMware Toolsâ€ã€‚ å®‰è£…è¿‡ç¨‹ä¸€è·¯å›è½¦ï¼Œå…¨éƒ¨é»˜è®¤è®¾ç½®ã€‚ å¦‚é‡åˆ°æç¤º 1234The path \"/usr/src/kernels/3.10.0-957.5.1.el7.x86_64/include\" is not a valid path to the 3.10.0-957.el7.x86_64 kernel headers.Would you like to change it? [yes] æ­¤å¤„è¾“å…¥ noï¼Œå›è½¦ï¼Œç»§ç»­å®‰è£…ã€‚ è€å¿ƒç­‰å¾…åï¼Œå®‰è£…å®Œæˆï¼","link":"/2019/startx/"},{"title":"Tmux çš„ä½¿ç”¨å’Œè®°å½•","text":"ä¹‹å‰å¬è¯´è¿‡ Tmuxï¼Œæœ‰å¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œä¼šè¯å¤ç”¨ï¼Œåˆ†å±ï¼Œä¿å­˜å½“å‰ä¼šè¯ï¼Œå…±äº«ä¼šè¯â€¦ ä»Šå¤©ä¸“é—¨å­¦ä¹ äº†è§£äº†ä¸‹è¿™ç©æ„ï¼Œæœ¬æ–‡æ˜¯ä¸€ç¯‡å®‰è£…é…ç½®è®°å½•ï¼ˆåªæ˜¯æ€•å¿˜äº†å¿«æ·é”® ğŸ™‚) å†…å®¹å¦‚ä¸‹ï¼š å®‰è£… Tmux é…ç½® Tmux å¸¸ç”¨å‘½ä»¤ å¿«æ·é”® ä¼šè¯ çª—å£ï¼ˆæ ‡ç­¾é¡µï¼‰ è°ƒæ•´çª—å£æ’åº çª—æ ¼ è°ƒæ•´çª—æ ¼å°ºå¯¸ å…¶ä»– å…¶ä»–è®¾ç½® å¯åŠ¨ shell æ—¶è‡ªåŠ¨å¯åŠ¨ tmux æ–‡ä¸­ä½¿ç”¨ç¯å¢ƒä¸º CentOS 7 å®‰è£… TmuxCentOS 7 ä¸­ä½¿ç”¨ yum å®‰è£…åªæœ‰ 1.8 ç‰ˆæœ¬ï¼Œæ‰€ä»¥å»ºè®®ä¸‹è½½æºç ç¼–è¯‘å®‰è£… åŒ…ç®¡ç†æ–¹å¼å®‰è£…ï¼ˆé™¤ macOS å¤–ï¼Œå¯èƒ½ç‰ˆæœ¬ä¸æ˜¯æœ€æ–°ï¼‰ï¼š 12345678# CentOSyum install tmux# Ubuntu &amp; Debainapt-get install tmux# macOSbrew install tmux æºç ç¼–è¯‘å®‰è£…ï¼Œç¼–è¯‘å‰éœ€å…ˆå®‰è£…ï¼šncurses å’Œ libevent 1234567# ä¸‹è½½æœ€æ–°çš„ release ç‰ˆæœ¬: https://github.com/tmux/tmux/releases/latest# ä»¥å½“å‰ï¼ˆ2020-7-3ï¼‰æœ€æ–° 3.1b ä¸ºä¾‹wget https://github.com/tmux/tmux/releases/download/3.1b/tmux-3.1b.tar.gztar -zxvf tmux-3.1b.tar.gzcd tmux-3.1b./configure &amp;&amp; makesudo make install é…ç½® Tmuxåœ¨ç”¨æˆ·ç›®å½•æ–°å»º .tmux.conf æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031set -g prefix C-a # ä¿®æ”¹ Prefix ç»„åˆé”®ä¸º Ctrl + aunbind C-b # å–æ¶ˆ Ctrl + b çš„å¿«æ·é”®ç»„åˆbind C-a send-prefix # ä¿®æ”¹ Prefix ç»„åˆé”®ä¸º Ctrl + aset -g prefix2 ` # ä¿®æ”¹ Prefix å¤‡ç”¨ç»„åˆé”®ä¸º `set -g base-index 1 # çª—å£ç¼–å·ä» 1 å¼€å§‹è®¡æ•°set -g pane-base-index 1 # çª—æ ¼ç¼–å·ä» 1 å¼€å§‹è®¡æ•°set -g status-bg black # è®¾ç½®çŠ¶æ€æ èƒŒæ™¯é»‘è‰²set -g status-fg yellow # è®¾ç½®çŠ¶æ€æ å‰æ™¯é»„è‰²set -g mouse on # å¼€å¯é¼ æ ‡set -g default-terminal \"screen-256color\" # è®¾ç½®é»˜è®¤ç»ˆç«¯æ¨¡å¼ä¸º 256colorsetw -g allow-rename off # ç¦æ­¢æ´»åŠ¨è¿›ç¨‹ä¿®æ”¹çª—å£åsetw -g automatic-rename off # ç¦æ­¢è‡ªåŠ¨å‘½åæ–°çª—å£setw -g mode-keys vi # è¿›å…¥å¤åˆ¶æ¨¡å¼çš„æ—¶å€™ä½¿ç”¨ vi é”®ä½ï¼ˆé»˜è®¤æ˜¯ EMACSï¼‰# -----------------------------------------------------------------------------# ä½¿ç”¨æ’ä»¶ - via tpm# 1. æ‰§è¡Œ git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm# 2. æ‰§è¡Œ bash ~/.tmux/plugins/tpm/bin/install_plugins æˆ–åœ¨ Tmux å†… Prefix + I# -----------------------------------------------------------------------------setenv -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins'set -g @plugin 'tmux-plugins/tmux-pain-control' # æ–¹ä¾¿åˆ†å±æ“ä½œset -g @plugin 'tmux-plugins/tmux-resurrect' # ä¿å­˜ä¼šè¯# tmux-resurrectset -g @resurrect-dir '~/.tmux/resurrect'# åˆå§‹åŒ– TPM æ’ä»¶ç®¡ç†å™¨ (æ”¾åœ¨é…ç½®æ–‡ä»¶çš„æœ€å)run '~/.tmux/plugins/tpm/tpm' å¸¸ç”¨å‘½ä»¤å¯åŠ¨æ–°ä¼šè¯ï¼š 1tmux [new -s ä¼šè¯å -n çª—å£å] æ¢å¤ä¼šè¯ï¼š 1tmux at [-t ä¼šè¯å] åˆ—å‡ºæ‰€æœ‰ä¼šè¯ï¼š 1tmux ls å…³é—­ä¼šè¯ï¼š 1tmux kill-session -t ä¼šè¯å å…³é—­æ‰€æœ‰ä¼šè¯ï¼š 1tmux ls | grep : | cut -d. -f1 | awk '{print substr($1, 0, length($1)-1)}' | xargs kill å¿«æ·é”®å…ˆæŒ‰ä¸‹è®¾ç½®å¥½çš„ Prefix é”®ï¼Œé»˜è®¤ä¸º Ctrl + bï¼Œä¸Šé¢é…ç½®æ–‡ä»¶å·²ä¿®æ”¹ä¸º Ctrl + a æˆ– `ï¼Œç„¶åæŒ‰å¦‚ä¸‹æŒ‰é”® ä¼šè¯123:new &lt;å›è½¦&gt; å¯åŠ¨æ–°ä¼šè¯s åˆ—å‡ºæ‰€æœ‰ä¼šè¯$ é‡å‘½åå½“å‰ä¼šè¯ çª—å£ï¼ˆæ ‡ç­¾é¡µï¼‰1234567c åˆ›å»ºæ–°çª—å£w åˆ—å‡ºæ‰€æœ‰çª—å£n åä¸€ä¸ªçª—å£p å‰ä¸€ä¸ªçª—å£f æŸ¥æ‰¾çª—å£, é‡å‘½åå½“å‰çª—å£&amp; å…³é—­å½“å‰çª—å£ è°ƒæ•´çª—å£æ’åº123swap-window -s 3 -t 1 äº¤æ¢ 3 å·å’Œ 1 å·çª—å£swap-window -t 1 äº¤æ¢å½“å‰å’Œ 1 å·çª—å£move-window -t 1 ç§»åŠ¨å½“å‰çª—å£åˆ° 1 å· çª—æ ¼123456789101112131415% å‚ç›´åˆ†å‰²\" æ°´å¹³åˆ†å‰²o äº¤æ¢çª—æ ¼x å…³é—­çª—æ ¼â½ å·¦è¾¹è¿™ä¸ªç¬¦å·ä»£è¡¨ç©ºæ ¼é”® - åˆ‡æ¢å¸ƒå±€q æ˜¾ç¤ºæ¯ä¸ªçª—æ ¼æ˜¯ç¬¬å‡ ä¸ªï¼Œå½“æ•°å­—å‡ºç°çš„æ—¶å€™æŒ‰æ•°å­—å‡ å°±é€‰ä¸­ç¬¬å‡ ä¸ªçª—æ ¼{ ä¸ä¸Šä¸€ä¸ªçª—æ ¼äº¤æ¢ä½ç½®} ä¸ä¸‹ä¸€ä¸ªçª—æ ¼äº¤æ¢ä½ç½®z åˆ‡æ¢çª—æ ¼æœ€å¤§åŒ–/æœ€å°åŒ–# ä½¿ç”¨ tmux-pain-control æ’ä»¶| å‚ç›´åˆ†å‰²- æ°´å¹³åˆ†å‰²\\ æ•´ä½“å‚ç›´åˆ†å‰²_ æ•´ä½“æ°´å¹³åˆ†å‰² è°ƒæ•´çª—æ ¼å°ºå¯¸123456789101112PREFIX : resize-pane -D å½“å‰çª—æ ¼å‘ä¸‹æ‰©å¤§ 1 æ ¼PREFIX : resize-pane -U å½“å‰çª—æ ¼å‘ä¸Šæ‰©å¤§ 1 æ ¼PREFIX : resize-pane -L å½“å‰çª—æ ¼å‘å·¦æ‰©å¤§ 1 æ ¼PREFIX : resize-pane -R å½“å‰çª—æ ¼å‘å³æ‰©å¤§ 1 æ ¼PREFIX : resize-pane -D 20 å½“å‰çª—æ ¼å‘ä¸‹æ‰©å¤§ 20 æ ¼PREFIX : resize-pane -t 2 -L 20 ç¼–å·ä¸º 2 çš„çª—æ ¼å‘å·¦æ‰©å¤§ 20 æ ¼# ä½¿ç”¨ tmux-pain-control æ’ä»¶shift + h å°†åˆ†å‰²çº¿å·¦ç§» 5 æ ¼shift + j å°†åˆ†å‰²çº¿ä¸‹ç§» 5 æ ¼shift + k å°†åˆ†å‰²çº¿ä¸Šç§» 5 æ ¼shift + l å°†åˆ†å‰²çº¿å³ç§» 5 æ ¼ å…¶ä»–åŒæ­¥çª—æ ¼ï¼ŒæŒ‰ä¸‹ Prefixï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹åå›è½¦ï¼Œè¿™ä¸ªé€‰é¡¹å€¼é’ˆå¯¹æŸä¸ªçª—å£æœ‰æ•ˆï¼Œä¸ä¼šå½±å“åˆ«çš„ä¼šè¯å’Œçª—å£ 1:setw synchronize-panes on/off æ‚é¡¹ï¼š 1234d é€€å‡º tmuxï¼ˆtmux ä»åœ¨åå°è¿è¡Œï¼‰t çª—å£ä¸­å¤®æ˜¾ç¤ºä¸€ä¸ªæ•°å­—æ—¶é’Ÿ? åˆ—å‡ºæ‰€æœ‰å¿«æ·é”®: å‘½ä»¤æç¤ºç¬¦ å…¶ä»–è®¾ç½®å¯åŠ¨ shell æ—¶è‡ªåŠ¨å¯åŠ¨ tmuxä¸‹é¢çš„é…ç½®ä¼šå°è¯•åªå¯åŠ¨ä¸€ä¸ªä¼šè¯ï¼Œç™»å½•æ—¶ï¼Œå¦‚æœä¹‹å‰å¯åŠ¨è¿‡ä¼šè¯ï¼Œé‚£ä¹ˆå®ƒä¼šç›´æ¥ attachï¼Œè€Œä¸æ˜¯æ–°å¼€ä¸€ä¸ªã€‚ åŠ å…¥åˆ° .bashrc æˆ– .zshrc ä¸­ã€‚ 12345# TMUXif which tmux &gt;/dev/null 2&gt;&amp;1; then #i f not inside a tmux session, and if no session is started, start a new session test -z \"$TMUX\" &amp;&amp; (tmux attach || tmux new-session)fi å‚è€ƒï¼š Tmux å¿«æ·é”® &amp; é€ŸæŸ¥è¡¨ &amp; ç®€æ˜æ•™ç¨‹ Tmux ä½¿ç”¨æ‰‹å†Œ Tmux Pain Control","link":"/2020/tmux/"},{"title":"Hexo åšå®¢è½¬ç§»åˆ°é˜¿é‡Œäº‘","text":"ä¹‹å‰å°ç«™ä¸€ç›´æ‰˜ç®¡åœ¨ Github Pages ä¸­ï¼Œç„¶è€Œå›½å†…è®¿é—®å®åœ¨å¤ªæ…¢ï¼Œç™¾åº¦ä¹Ÿæ— æ³•æ”¶å½•ã€‚æ­£å¥½è¶ç€ç–«æƒ…ï¼Œåœ¨é˜¿é‡Œäº‘æ’¸äº†ä¸€å°è½»é‡åº”ç”¨æœåŠ¡å™¨ã€‚è®°å½•ä¸‹è½¬ç§»è¿‡ç¨‹ã€‚ è¿™é‡ŒæœåŠ¡å™¨é€‰æ‹©çš„ç³»ç»Ÿæ˜¯ CentOS 7.3 é…ç½®è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼šæ­å»º Git ç§åº“ â€“&gt; æ­å»º Nginx æœåŠ¡å™¨ â€“&gt; å¯ç”¨ https è®¿é—® â€¦ æ­å»º Git ç§æœ‰åº“åšå®¢æ˜¯ç”± Hexo åœ¨æœ¬åœ°ç”Ÿæˆç„¶åé€šè¿‡ Git éƒ¨ç½²åˆ°æœåŠ¡å™¨ç«¯çš„ï¼Œæ‰€ä»¥è¦åœ¨æœåŠ¡å™¨ç«¯æ­å»ºä¸€ä¸ª Git ç§æœ‰åº“ å®‰è£… Git1$ yum install -y git åˆ›å»ºç”¨æˆ·å¹¶é…ç½®ä»“åº“123456789useradd gitpasswd git # è®¾ç½®å¯†ç su git # è¿™æ­¥å¾ˆé‡è¦ï¼Œä¸åˆ‡æ¢ç”¨æˆ·åé¢ä¼šå¾ˆéº»çƒ¦cd /home/git/mkdir -p projects/blog # é¡¹ç›®å­˜åœ¨çš„çœŸå®ç›®å½•mkdir repos &amp;&amp; cd reposgit init --bare blog.git # åˆ›å»ºä¸€ä¸ªè£¸éœ²çš„ä»“åº“cd blog.git/hooks vi post-receiveï¼Œåˆ›å»º hook é’©å­å‡½æ•°ï¼Œè¾“å…¥å†…å®¹å¦‚ä¸‹ 12#!/bin/shgit --work-tree=/home/git/projects/blog --git-dir=/home/git/repos/blog.git checkout -f æ·»åŠ å®Œæ¯•åä¿®æ”¹æƒé™ 123chmod +x post-receiveexit # é€€å‡ºåˆ° root ç™»å½•chown -R git:git /home/git/repos/blog.git # æ·»åŠ æƒé™ æµ‹è¯• Git ä»“åº“æ˜¯å¦å¯ç”¨åœ¨æœ¬åœ°ç”µè„‘ clone è¿œç¨‹ä»“åº“ 1git clone git@server_ip:/home/git/repos/blog.git å¦‚æç¤º 12git@server_ip: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).fatal: æ— æ³•è¯»å–è¿œç¨‹ä»“åº“ åˆ™éœ€è¦åœ¨æœåŠ¡å™¨ç«¯æ‰“å¼€ ssh å…è®¸å¯†ç ç™»å½•ï¼Œä¿®æ”¹ /etc/ssh/sshd_config ä¸­ PasswordAuthentication é¡¹ä¸º yes å»ºç«‹ ssh ä¿¡ä»»å…³ç³»åœ¨æœ¬åœ°ç”µè„‘ 12ssh-copy-id -i ~/.ssh/id_rsa.pub git@server_ipssh git@server_ip # æµ‹è¯•èƒ½å¦ç™»å½• ç¦ç”¨ Git ç”¨æˆ·çš„ shell ç™»å½•æƒé™ä¸ºäº†å®‰å…¨èµ·è§ç¦ç”¨ git ç”¨æˆ·çš„ shell ç™»å½•æƒé™ï¼Œä»è€Œåªèƒ½ç”¨ git cloneï¼Œgit push ç­‰ç™»å½• 12345cat /etc/shells # æŸ¥çœ‹ git-shell æ˜¯å¦åœ¨ç™»å½•æ–¹å¼é‡Œé¢which git-shell # æŸ¥çœ‹æ˜¯å¦å®‰è£…# æ·»åŠ ä¸Šæ­¥æ˜¾ç¤ºå‡ºæ¥çš„è·¯å¾„ï¼Œé€šå¸¸æ˜¯ /usr/bin/git-shellvi /etc/shells ä¿®æ”¹ /etc/passwd ä¸­çš„æƒé™ï¼Œåªéœ€å°†åŸæ¥çš„ /bin/shell ä¿®æ”¹ä¸º /usr/bin/git-shell 12- git:x:1000:1000::/home/git:/bin/shell+ git:x:1000:1000:,,,:/home/git:/usr/bin/git-shell Hexo éƒ¨ç½²åˆ°ç§æœ‰åº“ä¿®æ”¹åšå®¢æ ¹ç›®å½•_config.yml æ–‡ä»¶ä¸­ deploy è®¾ç½® _config.yml1234deploy: - type: git repository: git@xxx.xxx.xxx.xxx:/home/git/repos/blog.git branch: master åœ¨åšå®¢æ ¹ç›®å½•è¿è¡Œ hexo g -d éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ç§æœ‰åº“ æ­å»º Nginx æœåŠ¡å™¨å®‰è£… Nginx1yum -y install nginx å¯åŠ¨ Nginxï¼Œæµè§ˆå™¨è®¿é—®æœåŠ¡å™¨ IP 1nginx é…ç½® Nginxæœ¬ç«™å…¨ç«™ä½¿ç”¨ https è®¿é—® 1nginx -s stop # åœæ­¢ Nginx å°† SSL è¯ä¹¦å’Œç§é’¥æ”¾åœ¨ /home/git/ ç›®å½•ä¸‹ ä¿®æ”¹ /etc/nginx/nginx.conf server éƒ¨åˆ†ä¸ºå¦‚ä¸‹é…ç½® /etc/nginx/nginx.conf123456789101112131415161718192021222324252627282930313233343536373839404142434445server { # é‡å®šå‘ http è¯·æ±‚ listen 80; server_name morooi.cn; rewrite ^ https://$http_host$request_uri? permanent; }# Settings for a TLS enabled server.server { listen 443 ssl http2; # listen [::]:443 ssl http2; server_name morooi.cn; root /home/git/projects/blog; ssl_certificate \"/home/git/morooi.cn.crt\"; ssl_certificate_key \"/home/git/morooi.cn.key\"; ssl_session_cache shared:SSL:1m; ssl_session_timeout 10m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; # HSTS add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains;preload\" always; # Load configuration files for the default server block. include /etc/nginx/default.d/*.conf; #å‡å°‘ç‚¹å‡»åŠ«æŒ add_header X-Frame-Options DENY; #ç¦æ­¢æœåŠ¡å™¨è‡ªåŠ¨è§£æèµ„æºç±»å‹ add_header X-Content-Type-Options nosniff; #é˜²XSSæ”»å‡» add_header X-Xss-Protection 1; location / { } error_page 404 /404.html; location = /40x.html { } error_page 500 502 503 504 /50x.html; location = /50x.html { }} æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡® nginx -t 12nginx: the configuration file /etc/nginx/nginx.conf syntax is oknginx: configuration file /etc/nginx/nginx.conf test is successful é€šè¿‡æ£€æµ‹ï½ é‡è½½é…ç½® nginx -s reload è®¿é—®æˆåŠŸï¼ ä¸»è¦å‚è€ƒï¼š å¸¦ä½ è·³è¿‡å„ç§å‘ï¼Œä¸€æ¬¡æ€§æŠŠ Hexo åšå®¢éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ Nginx é…ç½® HTTPS æœåŠ¡å™¨","link":"/2020/toaliyun/"},{"title":"macOSã€iOSã€Windows è§£é”ç½‘æ˜“äº‘éŸ³ä¹ç°è‰²æ­Œæ›²","text":"åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šæ•ˆæœå›¾ï¼ æ„Ÿè°¢å¤§ç¥ä»¬çš„å¼€å‘ï¼Œæœ¬æ–‡ä»…è®°å½•è‡ªå·±çš„é…ç½®è¿‡ç¨‹ï¼Œå¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ¥è‡ªé¡¹ç›®çš„ issue é¡¹ç›®åœ°å€ï¼šhttps://github.com/nondanee/UnblockNeteaseMusic æ„Ÿè°¢ã€æ„Ÿè°¢ã€æ„Ÿè°¢ ç›´æ¥å¼€å§‹ï¼ ä½¿ç”¨ Docker éƒ¨ç½²https://hub.docker.com/r/nondanee/unblockneteasemusic/ 1docker pull nondanee/unblockneteasemusic ä½¿ç”¨è‡ªç­¾è¯ä¹¦ 1234567# æ³¨æ„æ›¿æ¢ä¸‹æ–¹ -p åçš„ç«¯å£ï¼Œ-v åçš„è·¯å¾„docker run --name unblockneteasemusic \\ -p 2333:2333 -p 2334:2334 \\ -v /path/to/server.crt:/usr/src/app/server.crt \\ -v /path/to/server.key:/usr/src/app/server.key \\ -d nondanee/unblockneteasemusic \\ -s -e https://è‡ªå·±çš„åŸŸå -p 2333:2334 ä½¿ç”¨è‡ªå¸¦è¯ä¹¦ 12345# æ³¨æ„æ›¿æ¢ä¸‹æ–¹ -p åçš„ç«¯å£ï¼Œ-v åçš„è·¯å¾„docker run --name unblockneteasemusic \\ -p 2333:2333 -p 2334:2334 \\ -d nondanee/unblockneteasemusic \\ -s -e https://è‡ªå·±çš„åŸŸå -p 2333:2334 æ—§ï¼šä»¥ä¸‹ä¸ºæ‰‹åŠ¨é…ç½® æœåŠ¡ç«¯è®¾ç½®åŸæœåŠ¡æ”¯æŒåœ¨æœ¬åœ°è¿è¡Œï¼Œä¸ºæ–¹ä¾¿æˆ‘éƒ¨ç½²åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½¿ç”¨é˜¿é‡Œäº‘çš„è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ŒCentOS 7 å‡†å¤‡ä¸€ä¸ªåŸŸåï¼Œå¹¶ç­¾å‘ SSL è¯ä¹¦ å®‰è£… NodeJSï¼šhttps://github.com/nodesource/distributions/blob/master/README.md åœ¨ CentOS 7 ä¸­å®‰è£… NodeJS 13.x 1234567yum install gcc-c++ make# root ç”¨æˆ·curl -sL https://rpm.nodesource.com/setup_13.x | bash -# é root ç”¨æˆ·curl -sL https://rpm.nodesource.com/setup_13.x | sudo bash - åœ¨æœåŠ¡å™¨ç«¯ clone é¡¹ç›® 1git clone https://github.com/nondanee/UnblockNeteaseMusic.git â€”â€”â€”â€”â€”- å¯é€‰æ­¥éª¤ â€”â€”â€”â€”â€”- åœ¨æœ¬åœ°ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ (æ­¤æ­¥å¯çœç•¥ï¼Œä½¿ç”¨ä½œè€…æä¾›çš„è¯ä¹¦äº¦å¯) 1234567891011121314# ç”Ÿæˆ CA ç§é’¥openssl genrsa -out ca.key 2048# ç”Ÿæˆ CA è¯ä¹¦ (\"YOURNAME\" å¤„å¡«ä¸Šä½ è‡ªå·±çš„åå­—)openssl req -x509 -new -nodes -key ca.key -sha256 -days 1825 -out ca.crt -subj \"/C=CN/CN=UnblockNeteaseMusic Root CA/O=YOURNAME\"# ç”ŸæˆæœåŠ¡å™¨ç§é’¥openssl genrsa -out server.key 2048# ç”Ÿæˆè¯ä¹¦ç­¾å‘è¯·æ±‚openssl req -new -sha256 -key server.key -out server.csr -subj \"/C=CN/L=Hangzhou/O=NetEase (Hangzhou) Network Co., Ltd/OU=IT Dept./CN=*.music.163.com\"# ä½¿ç”¨ CA ç­¾å‘æœåŠ¡å™¨è¯ä¹¦openssl x509 -req -extfile &lt;(printf \"subjectAltName=DNS:music.163.com,DNS:*.music.163.com\") -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt ä¸Šè¿°æ­¥éª¤å®Œæˆå å°†æœåŠ¡å™¨ç§é’¥ (server.key) å’ŒæœåŠ¡å™¨è¯ä¹¦ (server.crt) æ‹·è´åˆ°è¿œç¨‹æœåŠ¡å™¨ä»“åº“ä¸­è¦†ç›–åŸæœ‰æ–‡ä»¶ â€”â€”â€”â€”â€”- å¯é€‰æ­¥éª¤ç»“æŸ â€”â€”â€”â€”â€”- ä¸ºè§£å†³ iOS èƒ½å¤Ÿä½¿ç”¨ï¼Œè¿™é‡Œä½¿ç”¨è‡ªå·±çš„åŸŸåè¿›è¡Œè½¬å‘ï¼Œå¦‚æ²¡æœ‰åŸŸååˆ™å‚è€ƒå®˜æ–¹ä¿¡ä»»è‡ªç­¾å‘è¯ä¹¦çš„æ–¹æ³•ï¼Œè¿™é‡Œä¸å±•å¼€æè¿°ï¼šiOS é£Ÿç”¨æŒ‡å— é…ç½® Nginx æœåŠ¡ï¼Œåœ¨ Nginx é…ç½®ååŠ å…¥å¦‚ä¸‹é…ç½® 123456789101112131415server { listen 443 ssl http2; server_name xxx.xxx.com; # å‡†å¤‡çš„åŸŸå ssl_certificate /root/UnblockNeteaseMusic/xxx.xxx.xxx.crt; # SSL è¯ä¹¦è·¯å¾„ ssl_certificate_key /root/UnblockNeteaseMusic/xxx.xxx.xxx.key; # SSL å¯†é’¥è·¯å¾„ ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; location / { proxy_pass http://localhost:2333; # ä»£ç†åˆ° Unblock æœåŠ¡åœ°å€ï¼Œç«¯å£å¯è‡ªè¡Œä¿®æ”¹ }} å®Œäº‹åæµ‹è¯•å¹¶é‡è½½ Nginx é…ç½® 12345$ nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is oknginx: configuration file /etc/nginx/nginx.conf test is successful$ nginx -s reload ä½¿ç”¨ service ç®¡ç†æœåŠ¡ï¼Œæ–°å»º /etc/systemd/system/UnblockNeteaseMusic.service å†™å…¥å¦‚ä¸‹å†…å®¹ /etc/systemd/system/UnblockNeteaseMusic.service12345678910111213[Unit]Description=UnblockNeteaseMusic[Service]Type=simpleExecStart=/usr/bin/node /root/UnblockNeteaseMusic/app.js -s -e https://è‡ªå·±çš„åŸŸå -p 2333:2334WorkingDirectory=/root/UnblockNeteaseMusicRestart=alwaysRestartSec=10User=root[Install]WantedBy=multi-user.target æ³¨æ„ï¼š ExecStart å’Œ WorkingDirectory æ ¹æ®æƒ…å†µæ”¹åŠ¨ ExecStart ä¸­ -e åæ¥å·²ç»ç­¾å‘è¯ä¹¦çš„åŸŸåï¼Œè®°å¾—ä¸º httpsã€‚è¿™ä¸€å‚æ•°çš„åŸå› è¯¦è§ï¼šiOS é…ç½®ç»éªŒåˆ†äº« ExecStart ä¸­ -s è¡¨ç¤ºå¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œä»…å…è®¸ç½‘æ˜“äº‘ç›¸å…³çš„é€šè¿‡ï¼Œé˜²æ­¢ HTTP ä»£ç†æ»¥ç”¨ï¼Œå¯é€‰ ExecStart ä¸­ -p åæ¥ç«¯å£ï¼Œéšæ„è®¾ç½®ï¼Œå¦‚ 2333:2334ï¼Œç¬¬ä¸€ä¸ªç«¯å£ä¿æŒå’Œ nginx é…ç½®ä¸­è®¾ç½®çš„ä¸€è‡´ è®°å¾—åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é˜²ç«å¢™ä¸­æ”¾è¡Œç¬¬ä¸€ä¸ªç«¯å£ 2333 å¯åŠ¨æœåŠ¡ 12systemctl daemon-reloadsystemctl start UnblockNeteaseMusic æœåŠ¡ç«¯å®Œæˆ ç®¡ç†å‘½ä»¤ 123456systemctl status UnblockNeteaseMusic # æŸ¥çœ‹æœåŠ¡çŠ¶æ€systemctl start UnblockNeteaseMusic # å¯åŠ¨æœåŠ¡systemctl restart UnblockNeteaseMusic # é‡å¯æœåŠ¡systemctl stop UnblockNeteaseMusic # åœæ­¢æœåŠ¡systemctl enable UnblockNeteaseMusic # å¼€æœºè‡ªå¯åŠ¨systemctl disable UnblockNeteaseMusic # å–æ¶ˆå¼€æœºè‡ªå¯åŠ¨ macOS é…åˆ Proxifier é£Ÿç”¨ Proxies æ·»åŠ  HTTPS ä»£ç† æ·»åŠ è§„åˆ™ Applications æ·»åŠ ï¼šNeteaseMusic; com.apple.WebKit.Networking Target Hosts æ·»åŠ ï¼š*.music.163.com; *.netease.com; Action é€‰æ‹©ä¸Šä¸€æ­¥æ·»åŠ çš„ HTTPS ä»£ç† æ‰“å¼€ç½‘æ˜“äº‘éŸ³ä¹ Appï¼Œå¦‚å‡ºç°ä»¥ä¸‹æç¤ºï¼Œåˆ™è¿˜éœ€è¦ä¿¡ä»»ä¸€ä¸ªè¯ä¹¦ ä½¿ç”¨ Safari æ‰“å¼€ music.163.comï¼Œä¼šå‡ºç°å±é™©è­¦å‘Šï¼Œé€‰æ‹©æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ç‚¹å‡»æœ€åè®¿é—®æ­¤ç½‘ç«™ï¼Œç„¶åä¿¡ä»»è¯ä¹¦ æå®šï¼ æ³¨æ„ï¼šProxifier éœ€è¦ä¸€ç›´åœ¨åå°è¿è¡Œï¼Œæ‰èƒ½è½¬å‘ç½‘æ˜“äº‘çš„æµé‡ iOSé…åˆ Quantumult X é£Ÿç”¨ æ‰‹åŠ¨ä¿®æ”¹ Quantumult X é…ç½®æ–‡ä»¶ åœ¨ [policy] ä¸‹æ·»åŠ ç»„ç­–ç•¥ï¼š 1static=NeteaseMusic, NeteaseUnlocker, direct, img-url=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Netease_Music_Unlock.png åœ¨ [server_local] ä¸‹æ·»åŠ  HTTP ä»£ç†ï¼š 1http=xxx.xxx.xxx.xxx:2333, over-tls=false, fast-open=false, udp-relay=false, tag=NeteaseUnlocker xxx.xxx.xxx.xxx:2333 æ›¿æ¢ä¸ºæœåŠ¡å™¨ IP å’ŒæŒ‡å®šç«¯å£ åœ¨ [filter_local] ä¸‹æ·»åŠ è§„åˆ™ï¼š 1234DOMAIN-SUFFIX,music.163.com,NeteaseMusicDOMAIN-SUFFIX,api.iplay.163.com,NeteaseMusicDOMAIN-SUFFIX,mam.netease.com,NeteaseMusicDOMAIN-SUFFIX,hz.netease.com,NeteaseMusic å®Œæˆï¼ Windowsé…ç½®ç®€å•ï¼Œæ‰“å¼€ç½‘æ˜“äº‘éŸ³ä¹çš„è®¾ç½® å·¥å…· -&gt; è‡ªå®šä¹‰ä»£ç† -&gt; HTTP ä»£ç† å¡«å…¥ç›¸åº”çš„æœåŠ¡å™¨å’Œç«¯å£ï¼Œé‡å¯åº”ç”¨ç”Ÿæ•ˆ å®Œæˆï¼ å‚è€ƒèµ„æ–™ï¼š ç½‘æ˜“äº‘éŸ³ä¹ç°è‰²ç‰ˆæƒè§£é” - UnblockNeteaseMusic é¡¹ç›®é£Ÿç”¨æŒ‡å— iOS é…ç½®ç»éªŒåˆ†äº« é£Ÿç”¨æŒ‡å— è¿›é˜¶é…ç½® ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„æ•™ç¨‹ iOS é£Ÿç”¨æŒ‡å—","link":"/2020/unblockneteasemusic/"},{"title":"å®‰è£… Zshï¼Œå¹¶ä½¿ç”¨ Oh My Zsh","text":"Zsh æ˜¯ä»€ä¹ˆshell ä¿—ç§°å£³ï¼Œc è¯­è¨€ç¼–å†™çš„å‘½ä»¤è§£æå™¨ç¨‹åºï¼Œæ˜¯ç”¨æˆ·ä½¿ç”¨ linux çš„æ¡¥æ¢ã€‚Linux/Unix æä¾›äº†å¾ˆå¤šç§ Shellã€‚å¸¸ç”¨çš„ Shell æœ‰è¿™ä¹ˆå‡ ç§ï¼Œshã€bashã€csh ç­‰ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæœ‰å‡ ç§ shellï¼š 1$ cat /etc/shells ç›®å‰å¸¸ç”¨çš„ Linux ç³»ç»Ÿå’Œ macOS X ç³»ç»Ÿçš„é»˜è®¤ Shell éƒ½æ˜¯ bashã€‚ä½†æ˜¯çœŸæ­£å¼ºå¤§çš„ Shell æ˜¯æ·±è—ä¸éœ²çš„ zshï¼Œå²ç§°ã€ç»ˆæ Shellã€ï¼Œç”±äºä¸ bash ç›¸ä¼¼ï¼ŒåŠŸèƒ½åˆæœ‰æ‰€åŠ å¼ºï¼Œzsh åœ¨ Linux ç¤¾åŒºè·å¾—äº†å…³æ³¨ã€‚ä½†å› é…ç½®è¿‡äºå¤æ‚ï¼Œæ‰€ä»¥åˆæœŸæ— äººé—®æ´¥ã€‚ç›´åˆ°å›½å¤–æœ‰ä¸ªç¨‹åºå‘˜å¼€å‘å‡ºäº†ä¸€ä¸ªèƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹çš„ zsh é¡¹ç›®ï¼Œå«åšã€ŒOh My Zshã€ï¼ŒGithub ç½‘å€æ˜¯ï¼šhttps://github.com/ohmyzsh/ohmyzsh å®‰è£… zsh2020.12.18 æ›´æ–°ï¼šæ’¸äº†ä¸ªå®‰è£…è„šæœ¬ï¼Œä¼ é€é—¨ -&gt; Github æŸ¥çœ‹ç³»ç»Ÿä¸­æœ‰æ—  zsh ï¼Œä»¥åŠå…¶ç‰ˆæœ¬ 123$ cat /etc/shells$ zsh --version$ echo $ZSH_VERSION è‹¥ç³»ç»Ÿä¸­æ²¡æœ‰ zsh ï¼Œåˆ™éœ€è¦å®‰è£… 12345$ sudo apt-get install zsh # Ubuntu$ sudo yum install zsh # CentOS# macOS ç³»ç»Ÿè‡ªå¸¦äº†zsh, ä¸€èˆ¬ä¸æ˜¯æœ€æ–°ç‰ˆï¼Œå¦‚æœéœ€è¦æœ€æ–°ç‰ˆå¯é€šè¿‡Homebrewæ¥å®‰è£…$ brew install zsh ä¿®æ”¹é»˜è®¤ shell 12345$ chsh -s /bin/zsh# æˆ–$ chsh -s /usr/bin/zsh# æˆ–$ chsh -s $(which zsh) å®‰è£… Oh My Zshä¸€é”®å®‰è£…ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š 12345678910#æ–¹æ³•ä¸€ï¼šwgetæ–¹å¼è‡ªåŠ¨åŒ–å®‰è£…oh my zshï¼šsh -c \"$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\"#æ–¹æ³•äºŒï¼šsh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" #å®˜ç½‘ä¸Šçš„å¦å¤–ä¸€ç§å†™æ³• curl -Lo install.sh https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.shsh install.sh ç¾åŒ–ã€æ’ä»¶ã€é…ç½® ä»¥ä¸‹æ˜¯è‡ªç”¨é…ç½®ï¼Œåšä¸ªå¤‡ä»½ ä¿®æ”¹ä¸»é¢˜1$ vim ~/.zshrc ä¿®æ”¹ ZSH_THEME=\"robbyrussell\" ä¸º ZSH_THEME=\"ys\" ä¿®æ”¹æ˜¾ç¤ºæ–¹å¼1$ vim ~/.oh-my-zsh/themes/ys.zsh-theme ä¿®æ”¹æœ€ä¸‹é¢éƒ¨åˆ†ä¸º 12345678910PROMPT=\"%{$terminfo[bold]$fg[blue]%}#%{$reset_color%} \\%(#,%{$bg[yellow]%}%{$fg[black]%}%n%{$reset_color%},%{$fg[cyan]%}%n) \\%{$fg[white]%}in \\%{$terminfo[bold]$fg[yellow]%}%~%{$reset_color%}\\${hg_info}\\${git_info}\\ \\%{$fg[white]%}[%*] $exit_code%{$terminfo[bold]$fg[red]%}$ %{$reset_color%}\" æˆ–æ”¹ä¸ºï¼ˆ2020.1.7ï¼‰ï¼š 123456789101112PROMPT=\"%{$terminfo[bold]$fg[blue]%}#%{$reset_color%} \\%(#,%{$bg[yellow]%}%{$fg[black]%}%n%{$reset_color%},%{$fg[cyan]%}%n) \\%{$fg[white]%}@ \\%{$fg[green]%}morooi's MacBook Pro \\%{$fg[white]%}in \\%{$terminfo[bold]$fg[yellow]%}%~%{$reset_color%}\\${hg_info}\\${git_info}\\ \\%{$fg[white]%}[%*] $exit_code%{$terminfo[bold]$fg[red]%}$ %{$reset_color%}\" æ’ä»¶ï¼šzsh-syntax-highlightingshell å‘½ä»¤çš„ä»£ç é«˜äº®ï¼ŒGithub åœ°å€ï¼šhttps://github.com/zsh-users/zsh-syntax-highlighting å®‰è£…ï¼š Clone this repository in oh-my-zshâ€™s plugins directory: 1git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting Activate the plugin in ~/.zshrc: 1plugins=( [plugins...] zsh-syntax-highlighting) Restart zsh (such as by opening a new instance of your terminal emulator). æ’ä»¶ï¼šzsh-autosuggestionsåœ¨è¾“å…¥å‘½ä»¤çš„è¿‡ç¨‹ä¸­æ ¹æ®ä½ çš„å†å²è®°å½•æ˜¾ç¤ºä½ å¯èƒ½æƒ³è¦è¾“å…¥çš„å‘½ä»¤ï¼ŒæŒ‰ tab è¡¥å…¨ã€‚ å®‰è£…ï¼š Clone this repository into $ZSH_CUSTOM/plugins (by default ~/.oh-my-zsh/custom/plugins) 1git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions Add the plugin to the list of plugins for Oh My Zsh to load (inside ~/.zshrc): 1plugins=(zsh-autosuggestions) Start a new terminal session. æ’ä»¶ï¼šextract, zextract ç”¨äºè§£å‹ä»»ä½•å‹ç¼©æ–‡ä»¶ï¼Œä¸å¿…æ ¹æ®å‹ç¼©æ–‡ä»¶çš„åç¼€åæ¥è®°å¿†å‹ç¼©è½¯ä»¶ z ç”¨äºç›®å½•é—´å¿«é€Ÿè·³è½¬ æ·»åŠ åˆ° ~/.zshrc 1plugins=(extract z) è‹¥æç¤ºå­—ä½“é¢œè‰²æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œæ‰§è¡Œ1$ echo \"export TERM=xterm-256color\" &gt;&gt; ~/.zshrc è‡ªç”¨ .zshrc æ–‡ä»¶å¤‡ä»½123456789101112131415161718192021222324252627282930313233343536373839404142434445464748export ZSH=\"/Users/morooi/.oh-my-zsh\"ZSH_THEME=\"ys\"HIST_STAMPS=\"yyyy-mm-dd\"plugins=(git zsh-completions z zsh-syntax-highlighting zsh-autosuggestions extract)source $ZSH/oh-my-zsh.sh# Example aliases# alias zshconfig=\"mate ~/.zshrc\"# alias ohmyzsh=\"mate ~/.oh-my-zsh\"# Brewalias bs=\"brew search\"alias bi=\"brew install\"alias bu=\"brew rmtree\"alias bup=\"brew upgrade\"alias bci=\"brew install --cask\"alias bcup=\"brew cu -a -f --cleanup\"alias bcu=\"brew uninstall --cask\"alias cleanbrewcache=\"rm -rf /Users/morooi/Library/Caches/Homebrew\"export PATH=\"/usr/local/sbin:$PATH\"# Javaexport JAVA_HOME_8=\"/Library/Java/JavaVirtualMachines/jdk1.8.0_231.jdk/Contents/Home\"export JAVA_HOME_11=\"/Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home\"export JAVA_HOME_13=\"/Library/Java/JavaVirtualMachines/openjdk-13.jdk/Contents/Home\"export JAVA_HOME=$JAVA_HOME_13alias jdk8=\"export JAVA_HOME=$JAVA_HOME_8\"alias jdk11=\"export JAVA_HOME=$JAVA_HOME_11\"alias jdk13=\"export JAVA_HOME=$JAVA_HOME_13\"# NodeJSexport PATH=\"/usr/local/opt/node@12/bin:$PATH\"# &gt;&gt;&gt; conda initialize &gt;&gt;&gt;# !! Contents within this block are managed by 'conda init' !!__conda_setup=\"$('/usr/local/miniconda3/bin/conda' 'shell.zsh' 'hook' 2&gt; /dev/null)\"if [ $? -eq 0 ]; then eval \"$__conda_setup\"else if [ -f \"/usr/local/miniconda3/etc/profile.d/conda.sh\" ]; then . \"/usr/local/miniconda3/etc/profile.d/conda.sh\" else export PATH=\"/usr/local/miniconda3/bin:$PATH\" fifiunset __conda_setup# &lt;&lt;&lt; conda initialize &lt;&lt;&lt;","link":"/2019/zsh/"},{"title":"ä½¿ç”¨ Docker è‡ªå»ºæ”¯æŒ DoHã€DoT çš„ DNS æœåŠ¡å™¨","text":"DoH (DNS over HTTPS) å’Œ DoT (DNS over TLS) æœ‰æ•ˆé¿å…äº†è¿è¥å•†çš„ DNS ç›‘å¬å’ŒåŠ«æŒï¼Œæœ¬æ–‡è®°å½•åœ¨å…¬ç½‘æ­å»ºä¸€ä¸ªå¯ä»¥å»å¹¿å‘Šçš„ DNS æœåŠ¡å™¨ï¼ˆå€ŸåŠ© Adguard Homeï¼‰ã€‚ å‰æœŸå‡†å¤‡ å…¬ç½‘æœåŠ¡å™¨ä¸€å° åŸŸåä¸€ä¸ªï¼Œå¹¶ä¸”æŒ‡å‘è¯¥å…¬ç½‘æœåŠ¡å™¨ åŸŸåæŒ‡å‘è¯¥å…¬ç½‘æœåŠ¡å™¨ï¼Œå¹¶ç”³è¯·å¥½ TLS è¯ä¹¦ï¼ˆå¯ä½¿ç”¨ Letâ€™s Encrypt ç”³è¯·ï¼‰ Docker éƒ¨ç½²Docker Hub é•œåƒåœ°å€ï¼šhttps://hub.docker.com/r/adguard/adguardhome å®‰è£…å¥½ Docker åä¸‹è½½é•œåƒï¼Œä»¥ä¸‹ä»»é€‰å…¶ä¸€ 12docker pull adguard/adguardhome:latest # ç¨³å®šç‰ˆdocker pull adguard/adguardhome:edge # æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¸ç¨³å®š æ–°å»ºé…ç½®ç›®å½•å’Œå·¥ä½œç›®å½• 12mkdir /root/adguardhome/workdirmkdir /root/adguardhome/confdir å¯åŠ¨é•œåƒï¼Œå®Œæˆåè¿›å…¥é…ç½®é¡µé¢ï¼šHostIP:3000 123456docker run --name adguardhome \\ -v /root/adguardhome/workdir:/opt/adguardhome/work \\ -v /root/adguardhome/confdir:/opt/adguardhome/conf \\ --restart always \\ -p 443:443 -p 853:853 -p 3000:3000 -p 53:53/udp -p 53:53/tcp \\ -d adguard/adguardhome:edge æ³¨æ„ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥é…ç½®é¡µé¢éœ€è¦é…ç½®ç›‘å¬ç«¯å£ï¼Œé…ç½®å¥½åæ³¨æ„ä¿®æ”¹å®¹å™¨å¯åŠ¨æ—¶ç«¯å£çš„æ˜ å°„ï¼Œå¹¶ä»¥æ–°çš„å‘½ä»¤é‡æ–°å¯åŠ¨å®¹å™¨ ä¸Šæ¸¸æœåŠ¡å™¨è®¾ç½®è¿›å…¥ Adguard Home æ§åˆ¶å°ï¼Œæ‰¾åˆ°ã€Œè®¾ç½® - DNS è®¾ç½®ã€ ã€Œä¸Šæ¸¸ DNS æœåŠ¡å™¨ã€å¯å¡«å…¥å…¬å…± DNS æœåŠ¡å™¨ å›½å†…å¸¸ç”¨çš„å…¬å…± DNS å¦‚ä¸‹ï¼š DNS æœåŠ¡å™¨åœ°å€ ç±»å‹ æä¾›å•† https://dns.alidns.com/dns-query DNS over HTTPS é˜¿é‡Œ DNS tls://dns.alidns.com DNS over TLS é˜¿é‡Œ DNS https://doh.360.cn/dns-query DNS over HTTPS 360 DNS 119.29.29.29 å¸¸è§„ DNS DNSPod 182.254.116.116 å¸¸è§„ DNS DNSPod 223.5.5.5 å¸¸è§„ DNS é˜¿é‡Œ DNS 223.6.6.6 å¸¸è§„ DNS é˜¿é‡Œ DNS 114.114.114.114 å¸¸è§„ DNS 114 DNS ã€ŒBootstrap DNS æœåŠ¡å™¨ã€å¡«å…¥ä¸€åˆ°ä¸¤ä¸ªå¸¸è§„ DNS æœåŠ¡å™¨å°±å¯ä»¥ï¼Œå¦‚ 223.5.5.5 å’Œ 119.29.29.29 åœ¨ ã€ŒDNS æœåŠ¡è®¾å®šä¸­ã€ï¼Œå‹¾é€‰ã€Œä½¿ç”¨å®¢æˆ·ç«¯çš„å­ç½‘åœ°å€ï¼ˆEDNSï¼‰ã€ï¼Œå¯ä»¥ä½¿æŸ¥è¯¢çš„å®¢æˆ·ç«¯å¾—åˆ°ç¦»å…¶æœ€è¿‘çš„ç½‘ç«™ IP è§£æã€‚ DoH &amp; DoT è®¾ç½®è¿›å…¥ã€Œè®¾ç½® - åŠ å¯†è®¾ç½®ã€ å‹¾é€‰ã€Œå¯ç”¨åŠ å¯†ã€ï¼Œå¡«å†™å‡†å¤‡çš„åŸŸåï¼Œã€ŒHTTPS ç«¯å£ã€å’Œã€ŒDNS-over-TLS ç«¯å£ã€å‡å¯è‡ªå®šä¹‰ï¼Œå¦‚æœ‰æ”¹æ­£è®°å¾—é‡æ–°ä¿®æ”¹å®¹å™¨å¯åŠ¨æ—¶çš„ç«¯å£æ˜ å°„é…ç½®ã€‚ è¯ä¹¦å¯ä»¥é€‰æ‹©ã€Œè®¾ç½®è¯ä¹¦è·¯å¾„ã€å’Œã€Œç²˜è´´è¯ä¹¦å†…å®¹ã€ï¼ŒæŒ‰è¦æ±‚é…ç½®ã€‚ é…ç½®å®Œæˆåå¯ä»¥ä½¿ç”¨ã€Œhttps://åŸŸåã€è®¿é—®æ§åˆ¶å° å»å¹¿å‘Šè®¾ç½®è¿›å…¥ã€Œè¿‡æ»¤å™¨ - DNS å°é”æ¸…å•ã€ é™„ä¸€äº›å¸¸ç”¨çš„è§„åˆ™ï¼š HalfLifeï¼Œè§„åˆ™åˆå¹¶è‡ª EasylistChinaã€EasylistLiteã€CJXâ€™sAnnoyance åˆå¹¶è§„åˆ™ï¼šhttps://gitee.com/halflife/list/raw/master/ad.txt EasyPrivacyï¼Œéšç§ä¿æŠ¤ï¼šhttps://easylist-downloads.adblockplus.org/easyprivacy.txt I donâ€™t care about cookiesï¼Œæˆ‘ä¸å…³å¿ƒ Cookie çš„é—®é¢˜ï¼Œå±è”½ç½‘ç«™çš„ cookies ç›¸å…³çš„è­¦å‘Šï¼šhttps://www.i-dont-care-about-cookies.eu/abp/ anti-ADï¼Œè‡ªç§°æ˜¯ç›®å‰ä¸­æ–‡åŒºå‘½ä¸­ç‡æœ€é«˜çš„å¹¿å‘Šè¿‡æ»¤åˆ—è¡¨ï¼šhttps://gitee.com/privacy-protection-tools/anti-ad/raw/master/easylist.txt ä¹˜é£å¹¿å‘Šã€è§†é¢‘è¿‡æ»¤è§„åˆ™ï¼šhttps://gitee.com/xinggsf/Adblock-Rule/raw/master/rule.txtã€https://gitee.com/xinggsf/Adblock-Rule/raw/master/mv.txt è‡³æ­¤é…ç½®å®Œæˆã€‚ ä½¿ç”¨æ™®é€š DNS è§£æï¼Œåœ¨å®¢æˆ·ç«¯å¡«å…¥æœåŠ¡å™¨çš„ IP å³å¯ï¼Œè‹¥è¦ä½¿ç”¨ DoH å’Œ DoT åˆ™éœ€ä½¿ç”¨å¦å¤–çš„å·¥å…·ã€‚ æœ€æ–°ç‰ˆçš„ Chrome å·²ç»æ”¯æŒä½¿ç”¨ DoH è§£æï¼Œåœ¨ Chrome ä¸­æ‰¾åˆ°ã€Œè®¾ç½® - å®‰å…¨ - ä½¿ç”¨å®‰å…¨ DNSã€ï¼ŒæŒ‰è§„åˆ™å¡«å…¥åŸŸåå³å¯","link":"/2020/%E6%90%AD%E5%BB%BADNS%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"title":"MapReduce çš„å­¦ä¹ ","text":"HDFS å’Œ MapReduce æ˜¯ Hadoop çš„ä¸¤ä¸ªé‡è¦æ ¸å¿ƒï¼Œå…¶ä¸­ MapReduce æ˜¯ Hadoop çš„åˆ†å¸ƒå¼è®¡ç®—æ¨¡å‹ã€‚MapReduce ä¸»è¦åˆ†ä¸ºä¸¤æ­¥ Map æ­¥å’Œ Reduce æ­¥ï¼Œå¼•ç”¨ç½‘ä¸Šæµä¼ å¾ˆå¹¿çš„ä¸€ä¸ªæ•…äº‹æ¥è§£é‡Šï¼Œç°åœ¨ä½ è¦ç»Ÿè®¡ä¸€ä¸ªå›¾ä¹¦é¦†é‡Œé¢æœ‰å¤šå°‘æœ¬ä¹¦ï¼Œä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œä½ å¯ä»¥æŒ‡æ´¾å°æ˜å»ç»Ÿè®¡ä¹¦æ¶ 1ï¼ŒæŒ‡æ´¾å°çº¢å»ç»Ÿè®¡ä¹¦æ¶ 2ï¼Œè¿™ä¸ªæŒ‡æ´¾çš„è¿‡ç¨‹å°±æ˜¯ Map æ­¥ï¼Œæœ€åï¼Œæ¯ä¸ªäººç»Ÿè®¡å®Œå±äºè‡ªå·±è´Ÿè´£çš„ä¹¦æ¶åï¼Œå†å¯¹æ¯ä¸ªäººçš„ç»“æœè¿›è¡Œç´¯åŠ ç»Ÿè®¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ Reduce æ­¥ã€‚ æœ¬ä»£ç è¿è¡Œç¯å¢ƒä¸º ubuntu 18.04ï¼Œä½¿ç”¨ Hadoop 2.9.2 ç‰ˆæœ¬é¦–å…ˆæŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•ï¼ˆåœ¨ CentOS 7 ä¸­å®‰è£… Hadoop ä¸ HBaseï¼‰æ­å»ºå¹¶å¯åŠ¨ Hadoop MapReduce åŸç† åˆ†æ MapReduce æ‰§è¡Œè¿‡ç¨‹ Mapper ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹è¯¦è§£ Reducer ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹è¯¦è§£ å¯¼å…¥ MapReduce çš„ç›¸å…³ä¾èµ– Wordcount å®ä¾‹ Wordcount æ•´ä½“æµç¨‹ WordCount ä»£ç å®ç° ç»Ÿè®¡è®¿é—®æ¬¡æ•° ç»Ÿè®¡æ¯å¹´æœ€é«˜æ°”æ¸© æ•°æ®å»é‡ æ—¥å¿—åˆ†æï¼šåˆ†æéç»“æ„åŒ–æ–‡ä»¶ MapReduce åŸç†åˆ†æ MapReduce æ‰§è¡Œè¿‡ç¨‹MapReduce è¿è¡Œçš„æ—¶å€™ï¼Œä¼šé€šè¿‡ Mapper è¿è¡Œçš„ä»»åŠ¡è¯»å– HDFS ä¸­çš„æ•°æ®æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨è‡ªå·±çš„æ–¹æ³•ï¼Œå¤„ç†æ•°æ®ï¼Œæœ€åè¾“å‡ºã€‚Reducer ä»»åŠ¡ä¼šæ¥æ”¶ Mapper ä»»åŠ¡è¾“å‡ºçš„æ•°æ®ï¼Œä½œä¸ºè‡ªå·±çš„è¾“å…¥æ•°æ®ï¼Œè°ƒç”¨è‡ªå·±çš„æ–¹æ³•ï¼Œæœ€åè¾“å‡ºåˆ° HDFS çš„æ–‡ä»¶ä¸­ã€‚ Mapper ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹è¯¦è§£æ¯ä¸ª Mapper ä»»åŠ¡æ˜¯ä¸€ä¸ª java è¿›ç¨‹ï¼Œå®ƒä¼šè¯»å– HDFS ä¸­çš„æ–‡ä»¶ï¼Œè§£ææˆå¾ˆå¤šçš„é”®å€¼å¯¹ï¼Œç»è¿‡æˆ‘ä»¬è¦†ç›–çš„ map æ–¹æ³•å¤„ç†åï¼Œè½¬æ¢ä¸ºå¾ˆå¤šçš„é”®å€¼å¯¹å†è¾“å‡ºã€‚æ•´ä¸ª Mapper ä»»åŠ¡çš„å¤„ç†è¿‡ç¨‹åˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å…­ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µæ˜¯æŠŠè¾“å…¥æ–‡ä»¶æŒ‰ç…§ä¸€å®šçš„æ ‡å‡†åˆ†ç‰‡ (InputSplit)ï¼Œæ¯ä¸ªè¾“å…¥ç‰‡çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å…¥ç‰‡ (InputSplit) çš„å¤§å°ä¸æ•°æ®å— (Block) çš„å¤§å°æ˜¯ç›¸åŒçš„ã€‚å¦‚æœæ•°æ®å— (Block) çš„å¤§å°æ˜¯é»˜è®¤å€¼ 64MBï¼Œè¾“å…¥æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ 32MBï¼Œä¸€ä¸ªæ˜¯ 72MBã€‚é‚£ä¹ˆå°çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªè¾“å…¥ç‰‡ï¼Œå¤§æ–‡ä»¶ä¼šåˆ†ä¸ºä¸¤ä¸ªæ•°æ®å—ï¼Œé‚£ä¹ˆæ˜¯ä¸¤ä¸ªè¾“å…¥ç‰‡ã€‚ä¸€å…±äº§ç”Ÿä¸‰ä¸ªè¾“å…¥ç‰‡ã€‚æ¯ä¸€ä¸ªè¾“å…¥ç‰‡ç”±ä¸€ä¸ª Mapper è¿›ç¨‹å¤„ç†ã€‚è¿™é‡Œçš„ä¸‰ä¸ªè¾“å…¥ç‰‡ï¼Œä¼šæœ‰ä¸‰ä¸ª Mapper è¿›ç¨‹å¤„ç†ã€‚ ç¬¬äºŒé˜¶æ®µæ˜¯å¯¹è¾“å…¥ç‰‡ä¸­çš„è®°å½•æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è§£ææˆé”®å€¼å¯¹ã€‚æœ‰ä¸ªé»˜è®¤è§„åˆ™æ˜¯æŠŠæ¯ä¸€è¡Œæ–‡æœ¬å†…å®¹è§£ææˆé”®å€¼å¯¹ã€‚â€œé”®â€ æ˜¯æ¯ä¸€è¡Œçš„èµ·å§‹ä½ç½® (å•ä½æ˜¯å­—èŠ‚)ï¼Œâ€œå€¼â€ æ˜¯æœ¬è¡Œçš„æ–‡æœ¬å†…å®¹ã€‚ ç¬¬ä¸‰é˜¶æ®µæ˜¯è°ƒç”¨ Mapper ç±»ä¸­çš„ map æ–¹æ³•ã€‚ç¬¬äºŒé˜¶æ®µä¸­è§£æå‡ºæ¥çš„æ¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œè°ƒç”¨ä¸€æ¬¡ map æ–¹æ³•ã€‚å¦‚æœæœ‰ 1000 ä¸ªé”®å€¼å¯¹ï¼Œå°±ä¼šè°ƒç”¨ 1000 æ¬¡ map æ–¹æ³•ã€‚æ¯ä¸€æ¬¡è°ƒç”¨ map æ–¹æ³•ä¼šè¾“å‡ºé›¶ä¸ªæˆ–è€…å¤šä¸ªé”®å€¼å¯¹ã€‚ ç¬¬å››é˜¶æ®µæ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å¯¹ç¬¬ä¸‰é˜¶æ®µè¾“å‡ºçš„é”®å€¼å¯¹è¿›è¡Œåˆ†åŒºã€‚æ¯”è¾ƒæ˜¯åŸºäºé”®è¿›è¡Œçš„ã€‚æ¯”å¦‚æˆ‘ä»¬çš„é”®è¡¨ç¤ºçœä»½ï¼ˆå¦‚åŒ—äº¬ã€ä¸Šæµ·ã€å±±ä¸œç­‰ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ç…§ä¸åŒçœä»½è¿›è¡Œåˆ†åŒºï¼ŒåŒä¸€ä¸ªçœä»½çš„é”®å€¼å¯¹åˆ’åˆ†åˆ°ä¸€ä¸ªåŒºä¸­ã€‚é»˜è®¤æ˜¯åªæœ‰ä¸€ä¸ªåŒºã€‚åˆ†åŒºçš„æ•°é‡å°±æ˜¯ Reducer ä»»åŠ¡è¿è¡Œçš„æ•°é‡ã€‚é»˜è®¤åªæœ‰ä¸€ä¸ª Reducer ä»»åŠ¡ã€‚ ç¬¬äº”é˜¶æ®µæ˜¯å¯¹æ¯ä¸ªåˆ†åŒºä¸­çš„é”®å€¼å¯¹è¿›è¡Œæ’åºã€‚é¦–å…ˆï¼ŒæŒ‰ç…§é”®è¿›è¡Œæ’åºï¼Œå¯¹äºé”®ç›¸åŒçš„é”®å€¼å¯¹ï¼ŒæŒ‰ç…§å€¼è¿›è¡Œæ’åºã€‚æ¯”å¦‚ä¸‰ä¸ªé”®å€¼å¯¹ &lt;2,2&gt;,&lt;1,3&gt;,&lt;2,1&gt;ï¼Œé”®å’Œå€¼åˆ†åˆ«æ˜¯æ•´æ•°ã€‚é‚£ä¹ˆæ’åºåçš„ç»“æœæ˜¯ &lt;1,3&gt;,&lt;2,1&gt;,&lt;2,2&gt;ã€‚å¦‚æœæœ‰ç¬¬å…­é˜¶æ®µï¼Œé‚£ä¹ˆè¿›å…¥ç¬¬å…­é˜¶æ®µï¼›å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥è¾“å‡ºåˆ°æœ¬åœ°çš„ linux æ–‡ä»¶ä¸­ã€‚ ç¬¬å…­é˜¶æ®µæ˜¯å¯¹æ•°æ®è¿›è¡Œå½’çº¦å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ reduce å¤„ç†ã€‚é”®ç›¸ç­‰çš„é”®å€¼å¯¹ä¼šè°ƒç”¨ä¸€æ¬¡ reduce æ–¹æ³•ã€‚ç»è¿‡è¿™ä¸€é˜¶æ®µï¼Œæ•°æ®é‡ä¼šå‡å°‘ã€‚å½’çº¦åçš„æ•°æ®è¾“å‡ºåˆ°æœ¬åœ°çš„ linxu æ–‡ä»¶ä¸­ã€‚æœ¬é˜¶æ®µé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±å¢åŠ è¿™ä¸€é˜¶æ®µçš„ä»£ç ã€‚ Reducer ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹è¯¦è§£æ¯ä¸ª Reducer ä»»åŠ¡æ˜¯ä¸€ä¸ª Java è¿›ç¨‹ã€‚Reducer ä»»åŠ¡æ¥æ”¶ Mapper ä»»åŠ¡çš„è¾“å‡ºï¼Œå½’çº¦å¤„ç†åå†™å…¥åˆ° HDFS ä¸­ï¼Œå¯ä»¥åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µæ˜¯ Reducer ä»»åŠ¡ä¼šä¸»åŠ¨ä» Mapper ä»»åŠ¡å¤åˆ¶å…¶è¾“å‡ºçš„é”®å€¼å¯¹ã€‚Mapper ä»»åŠ¡å¯èƒ½ä¼šæœ‰å¾ˆå¤šï¼Œå› æ­¤ Reducer ä¼šå¤åˆ¶å¤šä¸ª Mapper çš„è¾“å‡ºã€‚ ç¬¬äºŒé˜¶æ®µæ˜¯æŠŠå¤åˆ¶åˆ° Reducer æœ¬åœ°æ•°æ®ï¼Œå…¨éƒ¨è¿›è¡Œåˆå¹¶ï¼Œå³æŠŠåˆ†æ•£çš„æ•°æ®åˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°æ®ã€‚å†å¯¹åˆå¹¶åçš„æ•°æ®æ’åºã€‚ ç¬¬ä¸‰é˜¶æ®µæ˜¯å¯¹æ’åºåçš„é”®å€¼å¯¹è°ƒç”¨ reduce æ–¹æ³•ã€‚é”®ç›¸ç­‰çš„é”®å€¼å¯¹è°ƒç”¨ä¸€æ¬¡ reduce æ–¹æ³•ï¼Œæ¯æ¬¡è°ƒç”¨ä¼šäº§ç”Ÿé›¶ä¸ªæˆ–è€…å¤šä¸ªé”®å€¼å¯¹ã€‚æœ€åæŠŠè¿™äº›è¾“å‡ºçš„é”®å€¼å¯¹å†™å…¥åˆ° HDFS æ–‡ä»¶ä¸­ã€‚åœ¨æ•´ä¸ª MapReduce ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ€å¤§çš„å·¥ä½œé‡æ˜¯è¦†ç›– map å‡½æ•°å’Œè¦†ç›– reduce å‡½æ•°ã€‚ å¯¼å…¥ MapReduce çš„ç›¸å…³ä¾èµ– ä½¿ç”¨ Java è¯­è¨€è¿›è¡Œ MapReduce æ“ä½œé¦–å…ˆéœ€è¦å¯¼å…¥å¿…è¦çš„ä¾èµ– å¦‚æœä½¿ç”¨çš„æ˜¯ maven ç®¡ç†é¡¹ç›®ï¼Œåˆ™éœ€è¦ç¼–è¾‘é¡¹ç›®ç›®å½•çš„ pom.xml æ–‡ä»¶ æ‰“å¼€ pom.xmlï¼Œåœ¨ &lt;dependencies&gt;...&lt;dependencies&gt; ä¹‹é—´åŠ å…¥ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-mapreduce-client-core&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt;&lt;/dependency&gt; å¦‚æœä¸ä½¿ç”¨ Maven ç®¡ç†ï¼Œå¯ä»¥æ‰‹åŠ¨å¯¼å…¥ç›¸å…³åŒ…ã€‚ Wordcount å®ä¾‹ åŠŸèƒ½ï¼šç»Ÿè®¡æ¯ä¸€ä¸ªå•è¯åœ¨æ•´ä¸ªæ•°æ®é›†ä¸­å‡ºç°çš„æ€»æ¬¡æ•° WordCount å®ç°çš„å®˜æ–¹æ–‡æ¡£ï¼šExample: WordCount v1.0 Wordcount æ•´ä½“æµç¨‹æœ€ç®€å•çš„ MapReduce åº”ç”¨ç¨‹åºè‡³å°‘åŒ…å« 3 ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ª Map å‡½æ•°ã€ä¸€ä¸ª Reduce å‡½æ•°å’Œä¸€ä¸ª main å‡½æ•°ã€‚åœ¨è¿è¡Œä¸€ä¸ª MapReduce è®¡ç®—ä»»åŠ¡æ—¶å€™ï¼Œä»»åŠ¡è¿‡ç¨‹è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šmap é˜¶æ®µå’Œ reduce é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æ˜¯ç”¨é”®å€¼å¯¹ï¼ˆkey/valueï¼‰ä½œä¸ºè¾“å…¥ï¼ˆinputï¼‰å’Œè¾“å‡ºï¼ˆoutputï¼‰ã€‚main å‡½æ•°å°†ä½œä¸šæ§åˆ¶å’Œæ–‡ä»¶è¾“å…¥ / è¾“å‡ºç»“åˆèµ·æ¥ã€‚ è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š å¯¹ä¸€ä¸ªæœ‰ä¸‰è¡Œæ–‡æœ¬çš„æ–‡ä»¶è¿›è¡Œ MapReduce æ“ä½œã€‚ Map è¿‡ç¨‹ï¼šå¹¶è¡Œè¯»å–æ–‡æœ¬ï¼Œå¯¹è¯»å–çš„å•è¯è¿›è¡Œ map æ“ä½œï¼Œæ¯ä¸ªè¯éƒ½ä»¥ &lt;key,value&gt; å½¢å¼ç”Ÿæˆã€‚ Reduce è¿‡ç¨‹ï¼šå¯¹ map çš„ç»“æœè¿›è¡Œæ’åºï¼Œåˆå¹¶ï¼Œæœ€åå¾—å‡ºè¯é¢‘ã€‚ WordCount ä»£ç å®ç°æ–°å»ºæ–‡ä»¶ input.txtï¼Œå†…å®¹ï¼š 123Deer Bear RiverCar Car RiverDeer Car Bear å°†å…¶ä¸Šä¼ åˆ° HDFS ä¸­ï¼Œåœ¨ç»ˆç«¯è¿è¡Œï¼š 123hadoop fs -mkdir /wordcounthadoop fs -mkdir /wordcount/inputhadoop fs -put input.txt /wordcount/input å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import java.io.IOException;import java.util.StringTokenizer;public class WordCount { /** map å‡½æ•°çš„è¾“å…¥é”®ã€è¾“å…¥å€¼ã€è¾“å‡ºé”®å’Œè¾“å‡ºå€¼ Text ç›¸å½“äºjavaçš„stringç±»å‹ IntWritable ç›¸å½“äºjavaä¸­çš„Integer */ public static class TokenizerMapper extends Mapper&lt;Object, Text, Text, IntWritable&gt;{ private final static IntWritable one = new IntWritable(1); private Text word = new Text(); public void map(Object key, Text value, Context context) throws IOException, InterruptedException{ //contentç”¨äºè¾“å‡ºå†…å®¹çš„å†™å…¥ //map()æ–¹æ³•çš„è¾“å…¥æ˜¯ä¸€ä¸ªé”®å’Œä¸€ä¸ªå€¼ã€‚æˆ‘ä»¬é¦–å…ˆå°†åŒ…å«ä¸€è¡Œè¾“å…¥çš„Textå€¼è½¬æ¢æˆjavaä¸­çš„stringç±»å‹ StringTokenizer itr = new StringTokenizer(value.toString()); //è¿™æ˜¯ä¸€ä¸ªåˆ†å‰²å­—ç¬¦ä¸²çš„ç±»ï¼Œjavaä¸­é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯:\"ç©ºæ ¼\",\"\\t\"åˆ¶è¡¨ç¬¦,\"\\n\"æ¢è¡Œç¬¦,\"\\r\"å›è½¦ç¬¦ while (itr.hasMoreTokens()) { //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åˆ†éš”ç¬¦ word.set(itr.nextToken()); //ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºTextç±»å‹ï¼ŒnextToken()ï¼šè¿”å›ä»å½“å‰ä½ç½®åˆ°ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦çš„å­—ç¬¦ä¸²ã€‚ context.write(word, one); } } } //reduceå‡½æ•°ä¹Ÿæœ‰å››ä¸ªå½¢å¼å‚æ•°ç±»å‹ç”¨äºæŒ‡å®šè¾“å…¥å’Œè¾“å‡ºç±»å‹ã€‚ //reduceå‡½æ•°çš„è¾“å…¥ç±»å‹å¿…é¡»åŒ¹é…mapå‡½æ•°çš„è¾“å‡ºç±»å‹:å³Textç±»å‹å’ŒIntwritableåœ¨è¿™ç§æƒ…å†µä¸‹,reduceçš„è¾“å‡ºä¹Ÿæ˜¯Textå’ŒIntwritable public static class IntSumReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; { private IntWritable result = new IntWritable(); public void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException{ int sum = 0; for (IntWritable val : values){ sum += val.get(); } result.set(sum); context.write(key, result); } } public static void main(String[] args) throws Exception { Configuration conf = new Configuration(); Job job = Job.getInstance(conf, \"Word Count\"); job.setJarByClass(WordCount.class); job.setMapperClass(TokenizerMapper.class); //æŒ‡å®šè¦ç”¨çš„mapç±»å‹ job.setCombinerClass(IntSumReducer.class); job.setReducerClass(IntSumReducer.class); //æŒ‡å®šè¦ç”¨çš„reduceç±»å‹ job.setOutputKeyClass(Text.class); //æ§åˆ¶reduceå‡½æ•°çš„è¾“å‡ºç±»å‹ job.setOutputValueClass(IntWritable.class); //å®šä¹‰è¾“å…¥æ•°æ®çš„è·¯å¾„,å¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶,ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•(æ­¤æ—¶,å°†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å½“åšè¾“å…¥) FileInputFormat.addInputPath(job, new Path(\"hdfs://localhost:8020/wordcount/input/input.txt\")); //å®šä¹‰è¾“å‡ºè·¯å¾„,æŒ‡å®šreduceå‡½æ•°è¾“å‡ºæ–‡ä»¶çš„å†™å…¥ç›®å½•ã€‚åœ¨è¿è¡Œä½œä¸šå‰è¯¥ç›®å½•æ˜¯ä¸åº”è¯¥å­˜åœ¨çš„ï¼Œå¦åˆ™Hadoopä¼šæŠ¥é”™å¹¶æ‹’ç»è¿è¡Œä½œä¸š FileOutputFormat.setOutputPath(job, new Path(\"hdfs://localhost:8020/wordcount/output\")); System.exit(job.waitForCompletion(true) ? 0 : 1); }} å®éªŒç»“æœ è¿è¡Œç¨‹åºï¼ŒæˆåŠŸåå¯ä»¥çœ‹åˆ°åœ¨ /wordcount/output/ ä¸‹å¤šå‡ºä¸¤ä¸ªæ–‡ä»¶ å…¶ä¸­ç¬¬äºŒä¸ªæ–‡ä»¶é‡Œä¸ºè¿è¡Œå®Œæˆåçš„ç»“æœ WordCount å®Œæˆï¼ ç»Ÿè®¡è®¿é—®æ¬¡æ•°ç»Ÿè®¡ç”¨æˆ·åœ¨ 2019 å¹´åº¦æ¯ä¸ªè‡ªç„¶æ—¥çš„æ€»è®¿é—®æ¬¡æ•°ã€‚åŸå§‹æ•°æ®æ–‡ä»¶ä¸­æä¾›äº†ç”¨æˆ·åç§°ä¸è®¿é—®æ—¥æœŸã€‚è¿™ä¸ªä»»åŠ¡å°±æ˜¯è¦è·å–ä»¥æ¯ä¸ªè‡ªç„¶æ—¥ä¸ºå•ä½çš„æ‰€æœ‰ç”¨æˆ·è®¿é—®æ¬¡æ•°çš„ç´¯åŠ å€¼ã€‚å¦‚æœé€šè¿‡ MapReduce ç¼–ç¨‹å®ç°è¿™ä¸ªä»»åŠ¡ï¼Œé¦–å…ˆè¦è€ƒè™‘çš„æ˜¯ï¼ŒMapper ä¸ Reducer å„è‡ªçš„å¤„ç†é€»è¾‘æ˜¯æ€æ ·çš„ï¼›ç„¶åæ ¹æ®å¤„ç†é€»è¾‘ç¼–å†™å‡ºæ ¸å¿ƒä»£ç ï¼›æœ€ååœ¨ Idea ä¸­ç¼–å†™å®Œæ•´ä»£ç ï¼Œç¼–è¯‘æ‰“åŒ…åæäº¤ç»™é›†ç¾¤è¿è¡Œã€‚ åˆ†ææ€è·¯å’Œé€»è¾‘ è¾“å…¥ / è¾“å‡ºæ ¼å¼ã€‚ è¿™é‡Œç¤¾äº¤ç½‘ç«™ç”¨æˆ·çš„è®¿é—®æ—¥æœŸåœ¨æ ¼å¼ä¸Šéƒ½å±äºæ–‡æœ¬æ ¼å¼ï¼Œè®¿é—®æ¬¡æ•°ä¸ºæ•´å‹æ•°æ®æ ¼å¼ã€‚å…¶ç»„æˆçš„é”®å€¼å¯¹ä¸º &lt;è®¿é—®æ—¥æœŸï¼Œè®¿é—®æ¬¡æ•°&gt;ï¼Œå› æ­¤ Mapper çš„è¾“å‡ºä¸ Reducer çš„è¾“å‡ºéƒ½é€‰ç”¨ Text ç±»ä¸ IntWritble ç±»ã€‚ Mapper è¦å®ç°çš„è®¡ç®—é€»è¾‘ Map å‡½æ•°çš„ä¸»è¦ä»»åŠ¡æ˜¯è¯»å–ç”¨æˆ·è®¿é—®æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œè¾“å‡ºæ‰€æœ‰è®¿é—®æ—¥æœŸä¸åˆå§‹æ¬¡æ•°çš„é”®å€¼å¯¹ã€‚&lt;è®¿é—®æ—¥æœŸï¼Œ1 &gt; Reducer è¦å®ç°çš„è®¡ç®—é€»è¾‘ è¯»å– Mapper è¾“å‡ºçš„é”®å€¼å¯¹ &lt;è®¿é—®æ—¥æœŸï¼Œ1&gt;ï¼Œè¿›è¡Œç´¯åŠ ã€‚ user_login.txt è®¿é—®æ—¥æœŸå†…å®¹å¦‚ä¸‹ å°†å…¶ä¸Šä¼ åˆ° HDFS ä¸­ï¼Œè·¯å¾„ä¸º /DailyAccessCount/input 12345678910111213141516Nehru,2019-01-01Dane,2019-01-01Walter,2019-01-01Gloria,2019-01-01Clarke,2019-01-01Madeline,2019-01-01Kevyn,2019-01-01Rebecca,2019-01-01Calista,2019-01-01Madeline,2019-01-02Kevyn,2019-01-02Rebecca,2019-01-03Calista,2019-01-04Walter,2019-03-12Gloria,2019-03-12Clarke,2019-03-12 ç¨‹åºä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import java.io.IOException;public class DailyAccessCount { public static class MyMapper extends Mapper&lt;Object, Text, Text, IntWritable&gt; { private final static IntWritable one = new IntWritable(1); public void map(Object key, Text value, Context context) throws IOException, InterruptedException { String line = value.toString(); String array[] = line.split(\",\"); //æŒ‡å®šé€—å·ä¸ºåˆ†éš”ç¬¦ï¼Œç»„æˆæ•°ç»„ String keyOutput = array[1]; //æå–æ•°ç»„ä¸­çš„è®¿é—®æ—¥æœŸä½œä¸ºkey context.write(new Text(keyOutput), one); //ç»„æˆé”®å€¼å¯¹ } } public static class MyReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; { private IntWritable result = new IntWritable(); public void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException { int sum = 0; //å®šä¹‰ç´¯åŠ å™¨ï¼Œåˆå§‹å€¼ä¸º0 for (IntWritable val : values) { sum += val.get(); //å°†ç›¸åŒé”®çš„æ‰€æœ‰å€¼è¿›è¡Œç´¯åŠ  } result.set(sum); context.write(key, result); //è¾“å‡ºè®¿é—®æ—¥æœŸï¼Œæ€»è®¿é—®æ¬¡æ•° } } public static void main(String[] args) throws Exception { Configuration conf = new Configuration(); Job job = Job.getInstance(conf, \"Daily Access Count\"); //æ–°å»ºJobå¹¶è®¾ç½®ä¸»ç±» job.setJarByClass(DailyAccessCount.class); job.setMapperClass(MyMapper.class); //ä¸ºä½œä¸šè®¾ç½®mapç±» job.setReducerClass(MyReducer.class); //ä¸ºä½œä¸šè®¾ç½®reduceç±» job.setMapOutputKeyClass(Text.class); //è®¾ç½®mapè¾“å‡ºkeyçš„æ ¼å¼ç±» job.setMapOutputValueClass(IntWritable.class); //è®¾ç½®mapè¾“å‡ºvalueçš„æ ¼å¼ç±» job.setOutputKeyClass(Text.class); //è®¾ç½®è¾“å‡ºé”®çš„æ ¼å¼ç±» job.setOutputValueClass(IntWritable.class); //è®¾ç½®è¾“å‡ºå€¼çš„æ ¼å¼ç±» //å®šä¹‰è¾“å…¥æ•°æ®çš„è·¯å¾„,å¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶,ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•(æ­¤æ—¶,å°†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å½“åšè¾“å…¥) FileInputFormat.addInputPath(job, new Path(\"hdfs://localhost:8020/DailyAccessCount/input/user_login.txt\")); //å®šä¹‰è¾“å‡ºè·¯å¾„,æŒ‡å®šreduceå‡½æ•°è¾“å‡ºæ–‡ä»¶çš„å†™å…¥ç›®å½•ã€‚åœ¨è¿è¡Œä½œä¸šå‰è¯¥ç›®å½•æ˜¯ä¸åº”è¯¥å­˜åœ¨çš„ï¼Œå¦åˆ™Hadoopä¼šæŠ¥é”™å¹¶æ‹’ç»è¿è¡Œä½œä¸š FileOutputFormat.setOutputPath(job, new Path(\"hdfs://localhost:8020/DailyAccessCount/output\")); System.exit(job.waitForCompletion(true) ? 0 : 1); //é€šçŸ¥é›†ç¾¤è¿è¡Œè¿™ä¸ªä½œä¸šï¼Œå¹¶é˜»å¡ç›´åˆ°ä½œä¸šå®Œæˆ }} å®éªŒç»“æœ è¿è¡Œç¨‹åºï¼ŒæˆåŠŸåå¯ä»¥çœ‹åˆ°åœ¨ /DailyAccessCount/output/ ä¸‹å¤šå‡ºä¸¤ä¸ªæ–‡ä»¶ å…¶ä¸­ç¬¬äºŒä¸ªæ–‡ä»¶é‡Œä¸ºè¿è¡Œå®Œæˆåçš„ç»“æœ ç»Ÿè®¡è®¿é—®æ¬¡æ•°å®Œæˆï¼ ç»Ÿè®¡æ¯å¹´æœ€é«˜æ°”æ¸©æœ‰å¦‚ä¸‹æ–‡ä»¶ input_temperature.txtï¼Œå…¶ä¸­ 2010012325 è¡¨ç¤ºåœ¨ 2010 å¹´ 01 æœˆ 23 æ—¥çš„æ°”æ¸©ä¸º 25 åº¦ã€‚ä½¿ç”¨ MapReduceï¼Œè®¡ç®—æ¯ä¸€å¹´å‡ºç°è¿‡çš„æœ€å¤§æ°”æ¸©ã€‚ å°†å…¶ä¸Šä¼ åˆ° HDFS ä¸­ï¼Œè·¯å¾„ä¸º /Temperature/input 123456789101112131415161718192021222324252627282930313233343536373839402014010114201401021620140103172014010410201401050620120106092012010732201201081220120109192012011023200101011620010102122001010310200101041120010105292013010619201301072220130108122013010929201301102320080101052008010216200801033720080104142008010516200701061920070107122007010812200701099920070110232010010114201001021620100103172010010410201001050620150106492015010722201501081220150109992015011023 è®¾è®¡ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import java.io.IOException;public class Temperature { /* * å››ä¸ªæ³›å‹ç±»å‹åˆ†åˆ«ä»£è¡¨ï¼š * KeyIn Mapperçš„è¾“å…¥æ•°æ®çš„Keyï¼Œè¿™é‡Œæ˜¯æ¯è¡Œæ–‡å­—çš„èµ·å§‹ä½ç½®ï¼ˆ0,11,....ï¼‰ * ValueIn Mapperçš„è¾“å…¥æ•°æ®çš„Valueï¼Œè¿™é‡Œæ˜¯æ¯è¡Œæ–‡å­— * KeyOut Mapperçš„è¾“å‡ºæ•°æ®çš„Keyï¼Œè¿™é‡Œæ˜¯æ¯è¡Œæ–‡å­—ä¸­çš„â€œå¹´ä»½â€ * ValueOut Mapperçš„è¾“å‡ºæ•°æ®çš„Valueï¼Œè¿™é‡Œæ˜¯æ¯è¡Œæ–‡å­—ä¸­çš„â€œæ°”æ¸©â€ */ public static class TempMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt; { public void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException { //æ‰“å°æ ·æœ¬ï¼šBefore Mapper:0,2014010114 System.out.print(\"Before Mapper:\" + key + \",\" + value); String line = value.toString(); String year = line.substring(0, 4); int temperature = Integer.parseInt(line.substring(8)); context.write(new Text(year), new IntWritable(temperature)); //æ‰“å°æ ·æœ¬ï¼šAfter Mapper:2014,14 System.out.println(\" ==&gt; After Mapper:\" + new Text(year) + \",\" + new IntWritable(temperature)); } } /* * å››ä¸ªæ³›å‹ç±»å‹åˆ†åˆ«ä»£è¡¨ï¼š * KeyIn Reducerçš„è¾“å…¥æ•°æ®çš„Keyï¼Œè¿™é‡Œæ˜¯æ¯è¡Œæ–‡å­—ä¸­çš„â€œå¹´ä»½â€ * ValueIn Reducerçš„è¾“å…¥æ•°æ®çš„Valueï¼Œè¿™é‡Œæ˜¯æ¯è¡Œæ–‡å­—ä¸­çš„â€œæ°”æ¸©â€ * KeyOut Reducerçš„è¾“å‡ºæ•°æ®çš„Keyï¼Œè¿™é‡Œæ˜¯ä¸é‡å¤çš„â€œå¹´ä»½â€ * ValueOut Reducerçš„è¾“å‡ºæ•°æ®çš„Valueï¼Œè¿™é‡Œæ˜¯è¿™ä¸€å¹´ä¸­çš„â€œæœ€é«˜æ°”æ¸©â€ */ public static class TempReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; { public void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException { int maxValue = Integer.MIN_VALUE; StringBuffer sb = new StringBuffer(); //å–valuesçš„æœ€å¤§å€¼ for (IntWritable value : values) { maxValue = Math.max(maxValue, value.get()); sb.append(value).append(\",\"); } //æ‰“å°æ ·æœ¬ï¼šBefore Reduce:2001,12,10,11,29,16, System.out.print(\"Before Reduce:\" + key + \",\" + sb.toString()); context.write(key, new IntWritable(maxValue)); //æ‰“å°æ ·æœ¬ï¼šAfter Reduce:2001,29 System.out.println(\" ==&gt; After Reduce:\" + key + \",\" + maxValue); } } public static void main(String[] args) throws Exception { Configuration conf = new Configuration(); Job job = Job.getInstance(conf, \"Temperature\"); job.setJarByClass(Temperature.class); job.setMapperClass(TempMapper.class); //ä¸ºä½œä¸šè®¾ç½®mapç±» job.setReducerClass(TempReducer.class); //ä¸ºä½œä¸šè®¾ç½®reduceç±» job.setMapOutputKeyClass(Text.class); //è®¾ç½®mapè¾“å‡ºkeyçš„æ ¼å¼ç±» job.setMapOutputValueClass(IntWritable.class); //è®¾ç½®mapè¾“å‡ºvalueçš„æ ¼å¼ç±» job.setOutputKeyClass(Text.class); //è®¾ç½®è¾“å‡ºé”®çš„æ ¼å¼ç±» job.setOutputValueClass(IntWritable.class); //è®¾ç½®è¾“å‡ºå€¼çš„æ ¼å¼ç±» //å®šä¹‰è¾“å…¥æ•°æ®çš„è·¯å¾„,å¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶,ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•(æ­¤æ—¶,å°†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å½“åšè¾“å…¥) FileInputFormat.addInputPath(job, new Path(\"hdfs://localhost:8020/Temperature/input/input_temperature.txt\")); //å®šä¹‰è¾“å‡ºè·¯å¾„,æŒ‡å®šreduceå‡½æ•°è¾“å‡ºæ–‡ä»¶çš„å†™å…¥ç›®å½•ã€‚åœ¨è¿è¡Œä½œä¸šå‰è¯¥ç›®å½•æ˜¯ä¸åº”è¯¥å­˜åœ¨çš„ï¼Œå¦åˆ™Hadoopä¼šæŠ¥é”™å¹¶æ‹’ç»è¿è¡Œä½œä¸š FileOutputFormat.setOutputPath(job, new Path(\"hdfs://localhost:8020/Temperature/output\")); System.exit(job.waitForCompletion(true) ? 0 : 1); //é€šçŸ¥é›†ç¾¤è¿è¡Œè¿™ä¸ªä½œä¸šï¼Œå¹¶é˜»å¡ç›´åˆ°ä½œä¸šå®Œæˆ }} å®éªŒç»“æœ è¿è¡Œç¨‹åºï¼ŒæˆåŠŸåå¯ä»¥çœ‹åˆ°åœ¨ /Temperature/output/ ä¸‹å¤šå‡ºä¸¤ä¸ªæ–‡ä»¶ å…¶ä¸­ç¬¬äºŒä¸ªæ–‡ä»¶é‡Œä¸ºè¿è¡Œå®Œæˆåçš„ç»“æœ ç»Ÿè®¡æ¯å¹´æœ€é«˜æ°”æ¸©å®Œæˆï¼ æ•°æ®å»é‡å®éªŒåŸç† â€œæ•°æ®å»é‡â€ ä¸»è¦æ˜¯ä¸ºäº†æŒæ¡å’Œåˆ©ç”¨å¹¶è¡ŒåŒ–æ€æƒ³æ¥å¯¹æ•°æ®è¿›è¡Œæœ‰æ„ä¹‰çš„ç­›é€‰ã€‚ç»Ÿè®¡å¤§æ•°æ®é›†ä¸Šçš„æ•°æ®ç§ç±»ä¸ªæ•°ã€ä»ç½‘ç«™æ—¥å¿—ä¸­è®¡ç®—è®¿é—®åœ°ç­‰è¿™äº›çœ‹ä¼¼åºæ‚çš„ä»»åŠ¡éƒ½ä¼šæ¶‰åŠæ•°æ®å»é‡ã€‚ æ•°æ®å»é‡çš„æœ€ç»ˆç›®æ ‡æ˜¯è®©åŸå§‹æ•°æ®ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€æ¬¡çš„æ•°æ®åœ¨è¾“å‡ºæ–‡ä»¶ä¸­åªå‡ºç°ä¸€æ¬¡ã€‚åœ¨ MapReduce æµç¨‹ä¸­ï¼Œmap çš„è¾“å‡º &lt;key,value&gt; ç»è¿‡ shuffle è¿‡ç¨‹èšé›†æˆ &lt;key,value-list&gt; åäº¤ç»™ reduceã€‚æˆ‘ä»¬è‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°å°†åŒä¸€ä¸ªæ•°æ®çš„æ‰€æœ‰è®°å½•éƒ½äº¤ç»™ä¸€å° reduce æœºå™¨ï¼Œæ— è®ºè¿™ä¸ªæ•°æ®å‡ºç°å¤šå°‘æ¬¡ï¼Œåªè¦åœ¨æœ€ç»ˆç»“æœä¸­è¾“å‡ºä¸€æ¬¡å°±å¯ä»¥äº†ã€‚å…·ä½“å°±æ˜¯ reduce çš„è¾“å…¥åº”è¯¥ä»¥æ•°æ®ä½œä¸º keyï¼Œè€Œå¯¹ value-list åˆ™æ²¡æœ‰è¦æ±‚ï¼ˆå¯ä»¥è®¾ç½®ä¸ºç©ºï¼‰ã€‚å½“ reduce æ¥æ”¶åˆ°ä¸€ä¸ª &lt;key,value-list&gt; æ—¶å°±ç›´æ¥å°†è¾“å…¥çš„ key å¤åˆ¶åˆ°è¾“å‡ºçš„ key ä¸­ï¼Œå¹¶å°† value è®¾ç½®æˆç©ºå€¼ï¼Œç„¶åè¾“å‡º &lt;key,value&gt;ã€‚ å®éªŒæ•°æ® ç°æœ‰ä¸€ä¸ªæŸç”µå•†ç½‘ç«™çš„æ•°æ®æ–‡ä»¶ï¼Œåä¸º buyer_favorite1ï¼Œè®°å½•äº†ç”¨æˆ·æ”¶è—çš„å•†å“ä»¥åŠæ”¶è—çš„æ—¥æœŸï¼Œæ–‡ä»¶ buyer_favorite1 ä¸­åŒ…å«ï¼ˆç”¨æˆ· idï¼Œå•†å“ idï¼Œæ”¶è—æ—¥æœŸï¼‰ä¸‰ä¸ªå­—æ®µï¼Œæ•°æ®å†…å®¹ä»¥ \\t åˆ†å‰²ï¼Œç”±äºæ•°æ®å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ç»Ÿè®¡æˆ‘ä»¬åªæˆªå–å®ƒçš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå†…å®¹å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031user_id product_id date10181 1000481 2010-04-04 16:54:3120001 1001597 2010-04-07 15:07:5220001 1001560 2010-04-07 15:08:2720042 1001368 2010-04-08 08:20:3020067 1002061 2010-04-08 16:45:3320056 1003289 2010-04-12 10:50:5520056 1003290 2010-04-12 11:57:3520056 1003292 2010-04-12 12:05:2920054 1002420 2010-04-14 15:24:1220055 1001679 2010-04-14 19:46:0420054 1010675 2010-04-14 15:23:5320054 1002429 2010-04-14 17:52:4520076 1002427 2010-04-14 19:35:3920054 1003326 2010-04-20 12:54:4420056 1002420 2010-04-15 11:24:4920064 1002422 2010-04-15 11:35:5420056 1003066 2010-04-15 11:43:0120056 1003055 2010-04-15 11:43:0620056 1010183 2010-04-15 11:45:2420056 1002422 2010-04-15 11:45:4920056 1003100 2010-04-15 11:45:5420056 1003094 2010-04-15 11:45:5720056 1003064 2010-04-15 11:46:0420056 1010178 2010-04-15 16:15:2020076 1003101 2010-04-15 16:37:2720076 1003103 2010-04-15 16:37:0520076 1003100 2010-04-15 16:37:1820076 1003066 2010-04-15 16:37:3120054 1003103 2010-04-15 16:40:1420054 1003100 2010-04-15 16:40:16 å°†å…¶ä¸Šä¼ åˆ° HDFS ä¸­ï¼Œè·¯å¾„ä¸º /Filter/input è¦æ±‚ç”¨ Java ç¼–å†™ MapReduce ç¨‹åºï¼Œæ ¹æ®å•†å“ id è¿›è¡Œå»é‡ï¼Œç»Ÿè®¡ç”¨æˆ·æ”¶è—å•†å“ä¸­éƒ½æœ‰å“ªäº›å•†å“è¢«æ”¶è—ã€‚ å®éªŒæºç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.input.TextInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import org.apache.hadoop.mapreduce.lib.output.TextOutputFormat;import java.io.IOException;public class Filter { public static class Map extends Mapper&lt;Object, Text, Text, NullWritable&gt; { private static Text newKey = new Text(); public void map(Object key, Text value, Context context) throws IOException, InterruptedException { String line = value.toString(); System.out.println(\"line is \" + line); if (line != null) { String arr[] = line.split(\" \"); System.out.println(\"a[1] is \" + arr[1]); newKey.set(arr[1]); context.write(newKey, NullWritable.get()); System.out.println(\"the new key is \" + newKey); } } } public static class Reduce extends Reducer&lt;Text, NullWritable, Text, NullWritable&gt; { public void reduce(Text key, Iterable&lt;NullWritable&gt; values, Context context) throws IOException,InterruptedException { context.write(key, NullWritable.get()); } } public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException{ Configuration conf = new Configuration(); Job job = Job.getInstance(conf, \"Filter\"); job.setJarByClass(Filter.class); job.setMapperClass(Map.class); job.setReducerClass(Reduce.class); job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(NullWritable.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(NullWritable.class); job.setInputFormatClass(TextInputFormat.class); job.setOutputFormatClass(TextOutputFormat.class); FileInputFormat.addInputPath(job ,new Path(\"hdfs://localhost:8020/Filter/input/buyer_favorite.txt\")); FileOutputFormat.setOutputPath(job, new Path(\"hdfs://localhost:8020/Filter/output\")); System.exit(job.waitForCompletion(true) ? 0 : 1); }} å®éªŒç»“æœ è¿è¡Œç¨‹åºï¼ŒæˆåŠŸåå¯ä»¥çœ‹åˆ°åœ¨ /Filter/output/ ä¸‹å¤šå‡ºä¸¤ä¸ªæ–‡ä»¶ å…¶ä¸­ç¬¬äºŒä¸ªæ–‡ä»¶é‡Œä¸ºè¿è¡Œå®Œæˆåçš„ç»“æœ æ•°æ®å»é‡å®Œæˆï¼ æ—¥å¿—åˆ†æï¼šåˆ†æéç»“æ„åŒ–æ–‡ä»¶æ ¹æ® tomcat æ—¥å¿—è®¡ç®— url è®¿é—®æƒ…å†µ è¦æ±‚ï¼šåŒºåˆ«ç»Ÿè®¡ GET å’Œ POST URL è®¿é—®é‡ ç»“æœä¸ºï¼šè®¿é—®æ–¹å¼ã€URLã€è®¿é—®é‡ æµ‹è¯•æ•°æ®é›†ï¼š 123456789101112131415161718192021196.168.2.1 - - [03/Jul/2014:23:36:38 +0800] \"GET /course/detail/3.htm HTTP/1.0\" 200 38435 0.038182.131.89.195 - - [03/Jul/2014:23:37:43 +0800] \"GET /html/notes/20140617/888.html HTTP/1.0\" 301 - 0.000196.168.2.1 - - [03/Jul/2014:23:38:27 +0800] \"POST /service/notes/addViewTimes_23.htm HTTP/1.0\" 200 2 0.003196.168.2.1 - - [03/Jul/2014:23:39:03 +0800] \"GET /html/notes/20140617/779.html HTTP/1.0\" 200 69539 0.046196.168.2.1 - - [03/Jul/2014:23:43:00 +0800] \"GET /html/notes/20140318/24.html HTTP/1.0\" 200 67171 0.049196.168.2.1 - - [03/Jul/2014:23:43:59 +0800] \"POST /service/notes/addViewTimes_779.htm HTTP/1.0\" 200 1 0.003196.168.2.1 - - [03/Jul/2014:23:45:51 +0800] \"GET /html/notes/20140617/888.html HTTP/1.0\" 200 70044 0.060196.168.2.1 - - [03/Jul/2014:23:46:17 +0800] \"GET /course/list/73.htm HTTP/1.0\" 200 12125 0.010196.168.2.1 - - [03/Jul/2014:23:46:58 +0800] \"GET /html/notes/20140609/542.html HTTP/1.0\" 200 94971 0.077196.168.2.1 - - [03/Jul/2014:23:48:31 +0800] \"POST /service/notes/addViewTimes_24.htm HTTP/1.0\" 200 2 0.003196.168.2.1 - - [03/Jul/2014:23:48:34 +0800] \"POST /service/notes/addViewTimes_542.htm HTTP/1.0\" 200 2 0.003196.168.2.1 - - [03/Jul/2014:23:49:31 +0800] \"GET /notes/index-top-3.htm HTTP/1.0\" 200 53494 0.041196.168.2.1 - - [03/Jul/2014:23:50:55 +0800] \"GET /html/notes/20140609/544.html HTTP/1.0\" 200 183694 0.076196.168.2.1 - - [03/Jul/2014:23:53:32 +0800] \"POST /service/notes/addViewTimes_544.htm HTTP/1.0\" 200 2 0.004196.168.2.1 - - [03/Jul/2014:23:54:53 +0800] \"GET /service/notes/addViewTimes_900.htm HTTP/1.0\" 200 151770 0.054196.168.2.1 - - [03/Jul/2014:23:57:42 +0800] \"GET /html/notes/20140620/872.html HTTP/1.0\" 200 52373 0.034196.168.2.1 - - [03/Jul/2014:23:58:17 +0800] \"POST /service/notes/addViewTimes_900.htm HTTP/1.0\" 200 2 0.003196.168.2.1 - - [03/Jul/2014:23:58:51 +0800] \"GET /html/notes/20140617/888.html HTTP/1.0\" 200 70044 0.057186.76.76.76 - - [03/Jul/2014:23:48:34 +0800] \"POST /service/notes/addViewTimes_542.htm HTTP/1.0\" 200 2 0.003186.76.76.76 - - [03/Jul/2014:23:46:17 +0800] \"GET /course/list/73.htm HTTP/1.0\" 200 12125 0.0108.8.8.8 - - [03/Jul/2014:23:46:58 +0800] \"GET /html/notes/20140609/542.html HTTP/1.0\" 200 94971 0.077 å°†å…¶ä¸Šä¼ åˆ° HDFS ä¸­ï¼Œè·¯å¾„ä¸º /LogAnalyze/input ç”±äº Tomcat æ—¥å¿—æ˜¯ä¸è§„åˆ™çš„ï¼Œéœ€è¦å…ˆè¿‡æ»¤æ¸…æ´—æ•°æ®ã€‚è¿™é‡Œä½¿ç”¨ MapReduce è¿›è¡Œæ“ä½œã€‚ ä»£ç å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.Mapper;import org.apache.hadoop.mapreduce.Reducer;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import java.io.IOException;public class LogAnalyze { public static class LogMapper extends Mapper&lt;LongWritable, Text, Text , IntWritable&gt; { private IntWritable val = new IntWritable(1); public void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException { String line = value.toString().trim(); String tmp = handlerLog(line); if (tmp.length() &gt; 0) { context.write(new Text(tmp), val); } } //196.168.2.1 - - [03/Jul/2014:23:36:38 +0800] \"GET /course/detail/3.htm HTTP/1.0\" 200 38435 0.038 private String handlerLog(String line) { String result = \"\"; try { if (line.length() &gt; 20) { if (line.indexOf(\"GET\") &gt; 0) { result = line.substring(line.indexOf(\"GET\"), line.indexOf(\"HTTP/1.0\")).trim(); } else if (line.indexOf(\"POST\") &gt; 0) { result = line.substring(line.indexOf(\"POST\"), line.indexOf(\"HTTP/1.0\")).trim(); } } } catch (Exception e) { System.out.println(line); } return result; } } public static class LogReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; { public void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException,InterruptedException { int sum = 0; for (IntWritable val : values) { sum += val.get(); } context.write(key, new IntWritable(sum)); } } public static void main(String[] args) throws Exception { Configuration conf = new Configuration(); Job job = Job.getInstance(conf, \"Log Analyze\"); job.setJarByClass(LogAnalyze.class); job.setMapperClass(LogMapper.class); job.setReducerClass(LogReducer.class); job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(IntWritable.class); job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); FileInputFormat.addInputPath(job, new Path(\"hdfs://localhost:8020/LogAnalyze/input/data.txt\")); FileOutputFormat.setOutputPath(job, new Path(\"hdfs://localhost:8020/LogAnalyze/output\")); System.exit(job.waitForCompletion(true) ? 0 : 1); }} åˆ†æç»“æœ Log åˆ†æå®Œæˆï¼","link":"/2019/mapreduce/"},{"title":"Spark â€”â€” æ·˜å®åŒ 11 æ•°æ®åˆ†æ","text":"é—®é¢˜å®šä¹‰ å®éªŒå†…å®¹ æ•°æ®é›† SparkRDD å®éªŒè¿‡ç¨‹åŠå…¶ç»“æœ å®éªŒä¸€ï¼šæŸ¥çœ‹æ—¥å¿—å‰ 10 ä¸ªäº¤æ˜“æ—¥å¿—çš„å•†å“å“ç‰Œ å®éªŒäºŒï¼šæŸ¥è¯¢å‰ 20 ä¸ªäº¤æ˜“æ—¥å¿—ä¸­è´­ä¹°å•†å“æ—¶çš„æ—¶é—´å’Œå•†å“çš„ç§ç±» å®éªŒä¸‰ï¼šæŸ¥è¯¢åŒåä¸€é‚£å¤©æœ‰å¤šå°‘äººè´­ä¹°äº†å•†å“ å®éªŒå››ï¼šå–ç»™å®šæ—¶é—´å’Œç»™å®šå“ç‰Œï¼Œæ±‚å½“å¤©è´­ä¹°çš„æ­¤å“ç‰Œå•†å“çš„æ•°é‡ å®éªŒäº”ï¼šæŸ¥è¯¢æœ‰å¤šå°‘ç”¨æˆ·åœ¨åŒåä¸€ç‚¹å‡»äº†è¯¥åº— å®éªŒå…­ï¼šæŸ¥è¯¢åŒåä¸€é‚£å¤©å¥³æ€§è´­ä¹°å•†å“çš„æ•°é‡ å®éªŒä¸ƒï¼šæŸ¥è¯¢åŒåä¸€é‚£å¤©ç”·æ€§è´­ä¹°å•†å“çš„æ•°é‡ å®éªŒå…«ï¼šæŸ¥è¯¢æŸä¸€å¤©åœ¨è¯¥ç½‘ç«™è´­ä¹°å•†å“è¶…è¿‡ 5 æ¬¡çš„ç”¨æˆ· ID ä½¿ç”¨ ECharts è¿›è¡Œå¯è§†åŒ– å¯è§†åŒ–å®éªŒä¸€ï¼šåŒåä¸€æ‰€æœ‰ä¹°å®¶æ¶ˆè´¹è¡Œä¸ºæ¯”ä¾‹ å¯è§†åŒ–å®éªŒäºŒï¼šåŒåä¸€å½“å¤©é”€é‡å‰åçš„å•†å“ç±»åˆ« å¯è§†åŒ–å®éªŒä¸‰ï¼šåŒåä¸€ç”·å¥³ä¹°å®¶å„ä¸ªå¹´é¾„æ®µäº¤æ˜“å¯¹æ¯” å¯è§†åŒ–å®éªŒå››ï¼šåŒåä¸€ç”·å¥³ä¹°å®¶äº¤æ˜“å¯¹æ¯” å¯è§†åŒ–å®éªŒäº”ï¼šå„ä¸ªçœä»½çš„æ€»æˆäº¤é‡å¯¹æ¯” å®éªŒè¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜ é—®é¢˜å®šä¹‰å®éªŒå†…å®¹ä½¿ç”¨ Spark å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶åˆ†æåŒåä¸€çš„ç”¨æˆ·äº¤æ˜“ç­‰ä¿¡æ¯ï¼Œç”¨ Scala è¯­è¨€è¿›è¡Œç¨‹åºç¼–å†™ï¼Œæœ€åå°†å¤„ç†çš„æ•°æ®ç»“æœä½¿ç”¨ Echarts è¿›è¡Œå¯è§†åŒ–ã€‚ å®éªŒç¯å¢ƒä»¥åŠä½¿ç”¨çš„ç›¸å…³åº”ç”¨ï¼š Spark 2.4.3 Scala 2.12 Tomcat 9.0.20 å¯è§†åŒ–å·¥å…·ï¼šECharts Java åŒ…ï¼šfastjson ç³»ç»Ÿç¯å¢ƒï¼šmacOS Mojave 10.14.5 æ•°æ®é›†æœ¬æ¡ˆåˆ—ä¸»è¦åˆ†ææ·˜å®åŒåä¸€çš„æ•°æ®ï¼Œæ•°æ®é›†æ˜¯æ·˜å® 2015 å¹´åŒåä¸€å‰ 6 ä¸ªæœˆï¼ˆåŒ…å«åŒåä¸€ï¼‰çš„äº¤æ˜“æ•°æ®ï¼Œæ•°æ®é›† user_log.csvï¼Œæ˜¯è®°å½•äº†ç”¨æˆ·çš„è¡Œä¸ºçš„æ—¥å¿—æ–‡ä»¶ã€‚ æ—¥å¿— user_log.csv çš„å­—æ®µå®šä¹‰å¦‚ä¸‹ï¼š åºå· å­—æ®µ å®šä¹‰ 0 user_id ä¹°å®¶ id 1 item_id å•†å“ id 2 cat_id å•†å“ç±»åˆ« id 3 merchant_id å–å®¶ id 4 brand_id å“ç‰Œ id 5 month äº¤æ˜“æ—¶é—´ï¼šæœˆ 6 day äº¤æ˜“äº‹ä»¶ï¼šæ—¥ 7 action è¡Œä¸ºï¼Œå–å€¼èŒƒå›´ {0,1,2,3}ï¼Œ0 è¡¨ç¤ºç‚¹å‡»ï¼Œ1 è¡¨ç¤ºåŠ å…¥è´­ç‰©è½¦ï¼Œ2 è¡¨ç¤ºè´­ä¹°ï¼Œ3 è¡¨ç¤ºå…³æ³¨å•†å“ 8 age_range ä¹°å®¶å¹´é¾„åˆ†æ®µï¼š1 è¡¨ç¤ºå¹´é¾„ &lt;18ï¼›2 è¡¨ç¤ºå¹´é¾„åœ¨ [18,24]ï¼›3 è¡¨ç¤ºå¹´é¾„åœ¨ [25,29]ï¼›4 è¡¨ç¤ºå¹´é¾„åœ¨ [30,34]ï¼›5 è¡¨ç¤ºå¹´é¾„åœ¨ [35,39]ï¼›6 è¡¨ç¤ºå¹´é¾„åœ¨ [40,49]ï¼›7 å’Œ 8 è¡¨ç¤ºå¹´é¾„ &gt;=50ï¼›0 å’Œ NULL åˆ™è¡¨ç¤ºæœªçŸ¥ 9 gender æ€§åˆ«ï¼š0 è¡¨ç¤ºå¥³æ€§ï¼Œ1 è¡¨ç¤ºç”·æ€§ï¼Œ2 å’Œ NULL è¡¨ç¤ºæœªçŸ¥ 10 province æ”¶è´§åœ°å€çœä»½ å‰äº”æ¡è®°å½•æ ·ä¾‹ï¼š 12345user_id,item_id,cat_id,merchant_id,brand_id,month,day,action,age_range,gender,province328862,323294,833,2882,2661,08,29,0,0,1,å†…è’™å¤328862,844400,1271,2882,2661,08,29,0,1,1,å±±è¥¿328862,575153,1271,2882,2661,08,29,0,2,1,å±±è¥¿328862,996875,1271,2882,2661,08,29,0,1,1,å†…è’™å¤ SparkRDD å®éªŒè¿‡ç¨‹åŠå…¶ç»“æœå®éªŒä¸€ï¼šæŸ¥çœ‹æ—¥å¿—å‰ 10 ä¸ªäº¤æ˜“æ—¥å¿—çš„å•†å“å“ç‰Œåˆ†æï¼šä½¿ç”¨ take() å‡½æ•°ï¼Œå–å»æ‰é¦–è¡Œåçš„å‰ 10 è¡Œæ•°æ®ï¼ŒæŒ‰æ¡ä»¶ä¸º brand_id çš„é¡¹è¿›è¡Œç­›é€‰ï¼Œå¹¶é€ä¸ªè¾“å‡º ä½¿ç”¨ take() å‡½æ•°å–å‡ºå»æ‰é¦–è¡Œåçš„å‰ 10 è¡Œæ•°æ® è¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($å•†å“å“ç‰Œ) æ ·å¼ è¾“å‡º map åçš„ç»“æœ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910def transformationOps(sc: SparkContext): Unit = { // æŸ¥çœ‹æ—¥å¿—å‰10ä¸ªäº¤æ˜“æ—¥å¿—çš„å•†å“å“ç‰Œ val raw_data = sc.textFile(\"./data/user_log.csv\") val header = raw_data.first() val lines = raw_data.filter(row =&gt; row != header) lines.take(10).flatMap(line =&gt; line.split(\" \")) .map(line =&gt; (line.split(\",\")(4))) .foreach(println)} ç»“æœå¦‚å›¾ï¼š å®éªŒäºŒï¼šæŸ¥è¯¢å‰ 20 ä¸ªäº¤æ˜“æ—¥å¿—ä¸­è´­ä¹°å•†å“æ—¶çš„æ—¶é—´å’Œå•†å“çš„ç§ç±»åˆ†æï¼šä½¿ç”¨ take() å‡½æ•°ï¼Œå–å»æ‰é¦–è¡Œåçš„å‰ 20 è¡Œæ•°æ®ï¼ŒæŒ‰æ¡ä»¶ä¸º month, day, cat_id çš„é¡¹è¿›è¡Œç­›é€‰ï¼Œå¹¶é€ä¸ªè¾“å‡ºã€‚ï¼ˆè¿™é‡Œå°† month å’Œ day åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰ ä½¿ç”¨ take() å‡½æ•°å–å‡ºå»æ‰é¦–è¡Œåçš„å‰ 20 è¡Œæ•°æ® è¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($æ—¥æœŸ, $å•†å“ç§ç±») æ ·å¼ è¾“å‡º map åçš„ç»“æœ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 1234567891011def transformationOps(sc: SparkContext): Unit = { // æŸ¥è¯¢å‰20ä¸ªäº¤æ˜“æ—¥å¿—ä¸­è´­ä¹°å•†å“æ—¶çš„æ—¶é—´å’Œå•†å“çš„ç§ç±» val raw_data = sc.textFile(\"./data/user_log.csv\") val header = raw_data.first() val lines = raw_data.filter(row =&gt; row != header) val data = lines.take(20) .flatMap(line =&gt; line.split(\" \")) .map(line =&gt; (line.split(\",\")(5) +line.split(\",\")(6), line.split(\",\")(2))) data.foreach(println)} ç»“æœå¦‚å›¾ï¼š å®éªŒä¸‰ï¼šæŸ¥è¯¢åŒåä¸€é‚£å¤©æœ‰å¤šå°‘äººè´­ä¹°äº†å•†å“åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($æ—¥æœŸ, $ç”¨æˆ·ID, $ç”¨æˆ·è¡Œä¸º) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°è¿‡æ»¤å‡º 11 æœˆ 11 æ—¥æ‰€æœ‰ç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°çš„æ¡ç›®ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œè¡Œä¸º action == 2 è€ƒè™‘åˆ°å•ä¸ªç”¨æˆ·å¯èƒ½è´­ä¹°å¤šä¸ªå•†å“ï¼Œæ‰€ä»¥éœ€è¦å»é‡ï¼Œä½¿ç”¨ distinct() å‡½æ•°å»é‡ æœ€åä½¿ç”¨ count() å‡½æ•°è®¡æ•°å¹¶è¾“å‡º æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 1234567891011def transformationOps(sc: SparkContext): Unit = { // æŸ¥è¯¢åŒåä¸€é‚£å¤©æœ‰å¤šå°‘äººè´­ä¹°äº†å•†å“ val raw_data = sc.textFile(\"./data/user_log.csv\") val Users = raw_data.flatMap(line =&gt; line.split(\" \")) .map(line =&gt; (line.split(\",\")(5) + line.split(\",\")(6), line.split(\",\")(0), line.split(\",\")(7))) val output = Users.filter(line =&gt; line._3.contains(\"2\")) .filter(line =&gt; line._1.contains(\"1111\")) .distinct() println(\"åŒåä¸€æœ‰ \" + output.count() + \" äººè´­ä¹°äº†å•†å“ã€‚\")} ç»“æœå¦‚å›¾ï¼š å®éªŒå››ï¼šå–ç»™å®šæ—¶é—´å’Œç»™å®šå“ç‰Œï¼Œæ±‚å½“å¤©è´­ä¹°çš„æ­¤å“ç‰Œå•†å“çš„æ•°é‡åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($å“ç‰ŒID, $æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°è¿‡æ»¤å‡º 11 æœˆ 11 æ—¥å“ç‰Œ 2661 ä¸­ç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°çš„æ¡ç›®ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œå“ç‰Œ IDbrand_id == 2661ï¼Œè¡Œä¸º action == 2 ä½¿ç”¨ count() å‡½æ•°è®¡æ•°å¹¶è¾“å‡º æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 1234567891011def transformationOps(sc: SparkContext): Unit = { // å–ç»™å®šæ—¶é—´å’Œç»™å®šå“ç‰Œï¼Œæ±‚å½“å¤©è´­ä¹°çš„æ­¤å“ç‰Œå•†å“çš„æ•°é‡ val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\" \")) .map(line =&gt; (line.split(\",\")(4), line.split(\",\")(5) + line.split(\",\")(6), line.split(\",\")(7))) val output = data.filter(line =&gt; line._1.contains(\"2661\")) .filter(line =&gt; line._2.contains(\"1111\")) .filter(line =&gt; line._3.contains(\"2\")) println(\"11æœˆ11æ—¥ï¼Œå“ç‰Œ2661çš„å•†å“å”®å‡ºçš„æ•°é‡ä¸ºï¼š\" + output.count())} ç»“æœå¦‚å›¾ï¼š å®éªŒäº”ï¼šæŸ¥è¯¢æœ‰å¤šå°‘ç”¨æˆ·åœ¨åŒåä¸€ç‚¹å‡»äº†è¯¥åº—åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($ç”¨æˆ·ID, $å–å®¶ID, $æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°è¿‡æ»¤å‡º 11 æœˆ 11 æ—¥åº—é“º 2882 ä¸­ç”¨æˆ·è¡Œä¸ºä¸ºç‚¹å‡»çš„ç”¨æˆ·ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œå–å®¶ IDmerchant_id == 2882ï¼Œè¡Œä¸º action == 0 è€ƒè™‘åˆ°æ¯ä¸ªç”¨æˆ·å¯èƒ½å¤šæ¬¡ç‚¹å‡»åŒä¸€åº—é“ºï¼Œæ‰€ä»¥éœ€è¦å»é‡ï¼Œä½¿ç”¨ distinct() å‡½æ•°ã€‚ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 1234567891011121314def transformationOps(sc: SparkContext): Unit = { // æŸ¥è¯¢æœ‰å¤šå°‘ç”¨æˆ·åœ¨åŒåä¸€ç‚¹å‡»äº†è¯¥åº— val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\" \")) .map(line =&gt; (line.split(\",\")(0), // ç”¨æˆ·ID line.split(\",\")(3), // å–å®¶ID line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(7))) // è¡Œä¸º val output = data.filter(line =&gt; line._3.contains(\"1111\")) .filter(line =&gt; line._2.contains(\"2882\")) .filter(line =&gt; line._4.contains(\"0\")).distinct() println(\"ä¸€å…±æœ‰\" + output.count() + \"ä¸ªç”¨æˆ·åœ¨åŒåä¸€ç‚¹å‡»äº†åº—é“º2882\")} ç»“æœå¦‚å›¾ï¼š å®éªŒå…­ï¼šæŸ¥è¯¢åŒåä¸€é‚£å¤©å¥³æ€§è´­ä¹°å•†å“çš„æ•°é‡åˆ†æï¼šç»Ÿè®¡åŒæ—¶æ»¡è¶³æ—¥æœŸ month == 11, day == 11ï¼Œè¡Œä¸º action == 2ï¼Œæ€§åˆ« gender == 0 çš„ä¸ªæ•°ã€‚ é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ (($ç”¨æˆ·ID, $æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º), 1) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°è¿‡æ»¤å‡º 11 æœˆ 11 æ—¥ç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°çš„ç”¨æˆ·ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œè¡Œä¸º action == 2 ç„¶åä½¿ç”¨ reduceByKey() ç»Ÿè®¡æ‰€æœ‰ç”¨æˆ·çš„è´­ä¹°é‡ï¼Œç„¶åä½¿ç”¨ filter() ç­›é€‰å‡ºå¤§äº 5 æ¬¡çš„ç”¨æˆ·ï¼Œå¹¶é€ä¸ªè¾“å‡º æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213def transformationOps(sc: SparkContext): Unit = { // æŸ¥è¯¢åŒåä¸€é‚£å¤©å¥³æ€§è´­ä¹°å•†å“çš„æ•°é‡ val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\" \")) .map(line =&gt; (line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(7), // è¡Œä¸º line.split(\",\")(9))) // æ€§åˆ« val res = data.filter(line =&gt; line._1.contains(\"1111\")) .filter(line =&gt; line._2.contains(\"2\")) .filter(line =&gt; line._3.contains(\"0\")) println(\"åŒåä¸€é‚£å¤©å¥³æ€§è´­ä¹°å•†å“çš„æ•°é‡ä¸ºï¼š\" + res.count())} ç»“æœå¦‚å›¾ï¼š å®éªŒä¸ƒï¼šæŸ¥è¯¢åŒåä¸€é‚£å¤©ç”·æ€§è´­ä¹°å•†å“çš„æ•°é‡åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º, $æ€§åˆ«) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°è¿‡æ»¤å‡º 11 æœˆ 11 æ—¥ç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°çš„ç”·æ€§ç”¨æˆ·ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œè¡Œä¸º action == 2ï¼Œæ€§åˆ« gender == 1 ç„¶åä½¿ç”¨ count() å‡½æ•°ç»Ÿè®¡æ‰€æœ‰è¿‡æ»¤åçš„æ•°æ®é‡ï¼Œå¹¶è¾“å‡º æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213def transformationOps(sc: SparkContext): Unit = { // æŸ¥è¯¢åŒåä¸€é‚£å¤©ç”·æ€§è´­ä¹°å•†å“çš„æ•°é‡ val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\" \")) .map(line =&gt; (line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(7), // è¡Œä¸º line.split(\",\")(9))) // æ€§åˆ« val res = data.filter(line =&gt; line._1.contains(\"1111\")) .filter(line =&gt; line._2.contains(\"2\")) .filter(line =&gt; line._3.contains(\"1\")) println(\"åŒåä¸€é‚£å¤©ç”·æ€§è´­ä¹°å•†å“çš„æ•°é‡ä¸ºï¼š\" + res.count())} ç»“æœå¦‚å›¾ï¼š å®éªŒå…«ï¼šæŸ¥è¯¢æŸä¸€å¤©åœ¨è¯¥ç½‘ç«™è´­ä¹°å•†å“è¶…è¿‡ 5 æ¬¡çš„ç”¨æˆ· IDåˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ (($ç”¨æˆ·ID, $æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º), 1) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°è¿‡æ»¤å‡º 11 æœˆ 11 æ—¥ç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°çš„ç”¨æˆ·ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œè¡Œä¸º action == 2 ç„¶åä½¿ç”¨ reduceByKey() ç»Ÿè®¡æ‰€æœ‰ç”¨æˆ·çš„è´­ä¹°é‡ï¼Œç„¶åä½¿ç”¨ filter() ç­›é€‰å‡ºå¤§äº 5 æ¬¡çš„ç”¨æˆ·ï¼Œå¹¶é€ä¸ªè¾“å‡º æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213def transformationOps(sc: SparkContext): Unit = { // æŸ¥è¯¢æŸä¸€å¤©åœ¨è¯¥ç½‘ç«™è´­ä¹°å•†å“è¶…è¿‡5æ¬¡çš„ç”¨æˆ·ID val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\" \")) .map(line =&gt; ((line.split(\",\")(0), //ç”¨æˆ·ID line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(7)), 1)) // è¡Œä¸º val lines = data.filter(line =&gt; line._1._2.contains(\"1111\")).filter(line =&gt; line._1._3.contains(\"2\")) val Users = lines.reduceByKey((v1, v2) =&gt; v1 + v2).filter(t =&gt; t._2 &gt; 5) Users.foreach(userID =&gt; println(\"ç”¨æˆ· \" + userID._1._1 + \" åœ¨ \" + userID._1._2 + \" è´­ä¹°äº† \" + userID._2 + \" ä»¶å•†å“\")) println(\"11æœˆ11æ—¥è´­ä¹°è¶…è¿‡5æ¬¡çš„ç”¨æˆ·ä¸€å…±æœ‰ï¼š\" + Users.count() + \"ä¸ª\")} ç»“æœå¦‚å›¾ï¼š ä½¿ç”¨ ECharts è¿›è¡Œå¯è§†åŒ– EChartsï¼Œä¸€ä¸ªä½¿ç”¨ JavaScript å®ç°çš„å¼€æºå¯è§†åŒ–åº“ï¼Œå¯ä»¥æµç•…çš„è¿è¡Œåœ¨ PC å’Œç§»åŠ¨è®¾å¤‡ä¸Šï¼Œå…¼å®¹å½“å‰ç»å¤§éƒ¨åˆ†æµè§ˆå™¨ï¼ˆIE8/9/10/11ï¼ŒChromeï¼ŒFirefoxï¼ŒSafari ç­‰ï¼‰ï¼Œåº•å±‚ä¾èµ–è½»é‡çº§çš„çŸ¢é‡å›¾å½¢åº“ ZRenderï¼Œæä¾›ç›´è§‚ï¼Œäº¤äº’ä¸°å¯Œï¼Œå¯é«˜åº¦ä¸ªæ€§åŒ–å®šåˆ¶çš„æ•°æ®å¯è§†åŒ–å›¾è¡¨ã€‚ é¦–å…ˆä½¿ç”¨ SparkRDD å¤„ç†æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œä½¿ç”¨é˜¿é‡Œå·´å·´çš„ Java åº“ fastjsonï¼Œå°† SparkRDD è¾“å‡ºçš„æ•°æ®è½¬æ¢æˆ JSON æ ¼å¼çš„æ–‡æ¡£ã€‚ç„¶åä½¿ç”¨ Tomcat æ­å»º JSP æœåŠ¡ï¼Œç”¨ jQuery å°† *.json æ–‡ä»¶å†…çš„æ•°æ®å¯¼å…¥åˆ° EChartsï¼Œæœ€åå‘ˆç°æ•°æ®ã€‚ å¯è§†åŒ–å®éªŒä¸€ï¼šåŒåä¸€æ‰€æœ‰ä¹°å®¶æ¶ˆè´¹è¡Œä¸ºæ¯”ä¾‹æ•°æ®å¤„ç† åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°ç¡®å®šæ—¶é—´ä¸º 11 æœˆ 11 æ—¥ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11 ä½¿ç”¨ map() å‡½æ•°å°†æ•°æ®å¤„ç†ä¸º ($ç”¨æˆ·è¡Œä¸º, 1) ä½¿ç”¨ reduceByKey() è®¡ç®—å‡ºæ¯ä¸ªç”¨æˆ·è¡Œä¸ºå¯¹åº”çš„æ¡ç›®æ•° å°†ç»“æœè½¬æ¢æˆ JSON æ ¼å¼æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºå¤„ç†ç»“æœ æ•°æ®å¤„ç†æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 1234567891011121314def transformationOps(sc: SparkContext): Unit = { // åŒåä¸€æ‰€æœ‰ä¹°å®¶æ¶ˆè´¹è¡Œä¸ºæ¯”ä¾‹ val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\"\\n\")) .map(line =&gt; ((line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(7)), 1)) // è¡Œä¸º .filter(line =&gt; line._1._1.equals(\"1111\")) .map(t =&gt; (t._1._2, t._2)) val Output = data.reduceByKey((v1, v2) =&gt; v1 + v2).collect() toJSON_Pie(Output, sc) // è¾“å‡ºæˆJSONæ ¼å¼ Output.foreach(println)} è½¬æ¢æˆ JSON æ–‡ä»¶ ç¼–å†™ toJSON_Pie() å‡½æ•°ï¼Œå°† SparkRDD å¤„ç†çš„ç»“æœè½¬æ¢æˆ JSON æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºç”Ÿæˆé¥¼çŠ¶å›¾ ä½¿ç”¨é˜¿é‡Œå·´å·´ Java åº“ fastjsonï¼Œæ–°å»ºä¸€ä¸ª JSONObject å¯¹è±¡ æ–°å»ºä¸€ä¸ªæ•°ç»„å‡†å¤‡å­˜æ”¾ç»˜åˆ¶ EChart é¥¼çŠ¶å›¾è¦æ±‚çš„ {\"name\":\"\",\"value\":\"\"} å¯¹ ä½¿ç”¨å¾ªç¯ï¼ŒæŒ‰è¡Œè¯»å–ï¼Œæ”¾å…¥ SparkRDD å¤„ç†çš„ç»“æœ å¯¼å‡ºï¼Œä¿å­˜ å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314def toJSON_Pie(data: Array[(String, Int)], sc: SparkContext): Unit = { val JSONObject = new JSONObject() val m = data.length val list: util.List[Any] = new util.ArrayList[Any]() for (i &lt;- 0 until m) { val pair = new util.HashMap[String, Any]() pair.put(\"name\", data(i)._1.toString) pair.put(\"value\", data(i)._2.toString) list.add(pair) } JSONObject.put(\"data\", list) val output = sc.parallelize(List(JSONObject)) output.repartition(1).saveAsTextFile(\"../Visualization/web/data/v_1\")} å¯¼å‡ºåçš„æ–‡ä»¶ä¸º Spark å¤„ç†çš„æ–‡ä»¶ï¼Œåç§°ä¸º part-00000ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶åŠ ä¸Š json åç¼€ä¸º part-00000.json ç”±äºåŸå§‹æ•°æ®ä¸­ä»£è¡¨ç”¨æˆ·è¡Œä¸ºçš„æ•°æ®ä¸º 0~3ï¼Œæ•°å­—å¯¹å¯è§†åŒ–å‘ˆç°ä¸ç›´è§‚ï¼Œæ‰€ä»¥æ‰‹åŠ¨æ›´æ”¹äº† json æ–‡ä»¶çš„å¯¹åº”å†…å®¹ part-00000.json æ–‡ä»¶å†…å®¹ä¸ºï¼š 1234567891011121314151617181920{ \"data\": [ { \"name\": \"ç‚¹å‡»\", \"value\": \"9188104\" }, { \"name\": \"åŠ å…¥è´­ç‰©è½¦\", \"value\": \"14725\" }, { \"name\": \"è´­ä¹°\", \"value\": \"1223354\" }, { \"name\": \"å…³æ³¨\", \"value\": \"156450\" } ]} å¯è§†åŒ–å‘ˆç° ä½¿ç”¨ Tomcat æ­å»ºæœ¬åœ° Java Web Serverï¼Œç¼–å†™ jsp ç½‘é¡µï¼Œå°† *.json æ–‡ä»¶å¯¼å…¥ï¼Œä½¿ç”¨ ECharts å‘ˆç° æ ¹æ® ECharts å®˜æ–¹æ–‡æ¡£ï¼šå¼‚æ­¥æ•°æ®åŠ è½½å’Œæ›´æ–°ï¼Œä½¿ç”¨ jQuery å·¥å…·å°† json æ–‡ä»¶å¯¼å…¥ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647var myChart = echarts.init(document.getElementById('main'), 'shine');myChart.setOption({ title: { text: 'åŒåä¸€æ‰€æœ‰ä¹°å®¶æ¶ˆè´¹è¡Œä¸ºæ¯”ä¾‹', x: 'center' }, tooltip: { trigger: 'item', formatter: \"{a} &lt;br/&gt; {b} : {c} ({d}%)\" }, legend: { orient: 'vertical', right: 50, top: 150, // bottom: 20, data: ['ç‚¹å‡»', 'åŠ å…¥è´­ç‰©è½¦', 'è´­ä¹°', 'å…³æ³¨'] }, label: { formatter: '{b}: {c}' }, series: [ { name: 'è¡Œä¸º', type: 'pie', radius: '60%', center: ['40%', '50%'], data: [], selectedMode: 'single', itemStyle: { emphasis: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)' } } } ]});$.get('./data/v_1/part-00000.json').done(function (data) { myChart.setOption({ series: [{ data: data.data }] });}); å¯è§†åŒ–ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š å¯è§†åŒ–å®éªŒäºŒï¼šåŒåä¸€å½“å¤©é”€é‡å‰åçš„å•†å“ç±»åˆ«æ•°æ®å¤„ç† åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ ($æ—¥æœŸ, $å•†å“ç±»åˆ«, $ç”¨æˆ·è¡Œä¸º) æ ·å¼ ä½¿ç”¨ filter() å‡½æ•°ç¡®å®šæ—¶é—´ä¸º 11 æœˆ 11 æ—¥ï¼Œç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°çš„æ•°æ®ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œç”¨æˆ·è¡Œä¸º action == 2 ä½¿ç”¨ map() å‡½æ•°å°†æ•°æ®å¤„ç†ä¸º ($å•†å“ç±»åˆ«, 1) ä½¿ç”¨ reduceByKey() è®¡ç®—å‡ºæ¯ä¸ªå•†å“ç±»åˆ«å¯¹åº”çš„æ¡ç›®æ•° ä½¿ç”¨ sortBy() æŒ‰æ¡ç›®æ•°é‡é™åºæ’åº ä½¿ç”¨ take() å–å‰ 10 ä¸ªæ•°æ®ï¼Œç„¶åå°†ç»“æœè½¬æ¢æˆ JSON æ ¼å¼æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºå¤„ç†ç»“æœ æ•°æ®å¤„ç†æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718def transformationOps(sc: SparkContext): Unit = { // åŒåä¸€å½“å¤©é”€é‡å‰åçš„å•†å“ç±»åˆ« val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\"\\n\")) .map(line =&gt; ((line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(2), // å•†å“ç±»åˆ« line.split(\",\")(7)), 1)) .filter(_._1._1.equals(\"1111\")) .filter(_._1._3.equals(\"2\")) .map(t =&gt; (t._1._2, t._2)) val Output = data.reduceByKey((v1, v2) =&gt; v1 + v2) .sortBy(_._2, ascending = false, numPartitions = 1).collect() toJSON_Bar(Output.take(10), sc) Output.take(10).foreach(println)} è½¬æ¢æˆ JSON æ–‡ä»¶ ç¼–å†™ toJSON_Bar() å‡½æ•°ï¼Œå°† SparkRDD å¤„ç†çš„ç»“æœè½¬æ¢æˆ JSON æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºç”ŸæˆæŸ±çŠ¶å›¾ ä½¿ç”¨é˜¿é‡Œå·´å·´ Java åº“ fastjsonï¼Œæ–°å»ºä¸€ä¸ª JSONObject å¯¹è±¡ æ–°å»ºä¸¤ä¸ªæ•°ç»„å‡†å¤‡å­˜æ”¾ç»˜åˆ¶ EChart æŸ±çŠ¶å›¾è¦æ±‚çš„æ•°æ® ä½¿ç”¨å¾ªç¯ï¼ŒæŒ‰è¡Œè¯»å–ï¼Œæ”¾å…¥ SparkRDD å¤„ç†çš„ç»“æœ å¯¼å‡ºï¼Œä¿å­˜ å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314def toJSON_Bar(data: Array[(String, Int)], sc: SparkContext): Unit = { val JSONObject = new JSONObject() val m = data.length val key: Array[Any] = new Array[Any](m) val value: Array[Any] = new Array[Any](m) for (i &lt;- 0 until m) { key(i) = data(i)._1.toString value(i) = data(i)._2.toString } JSONObject.put(\"key\", key) JSONObject.put(\"value\", value) val output = sc.parallelize(List(JSONObject)) output.repartition(1).saveAsTextFile(\"../Visualization/web/data/v_2\")} å¯¼å‡ºåçš„æ–‡ä»¶ä¸º Spark å¤„ç†çš„æ–‡ä»¶ï¼Œåç§°ä¸º part-00000ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶åŠ ä¸Š json åç¼€ä¸º part-00000.json part-00000.json æ–‡ä»¶å†…å®¹ä¸ºï¼š 1234{ \"value\":[\"48687\",\"41951\",\"29531\",\"28883\",\"28530\",\"28097\",\"27372\",\"26264\",\"25851\",\"23519\"], \"key\":[\"656\",\"1208\",\"602\",\"662\",\"737\",\"1142\",\"389\",\"177\",\"1213\",\"1438\"]} å…¶ä¸­ï¼Œkey è¡¨ç¤ºå•†å“ç§ç±»ï¼Œvalue è¡¨ç¤ºå¯¹åº”å•†å“ç§ç±»çš„é”€é‡ å¯è§†åŒ–å‘ˆç° ä½¿ç”¨ Tomcat æ­å»ºæœ¬åœ° Java Web Serverï¼Œç¼–å†™ jsp ç½‘é¡µï¼Œå°† *.json æ–‡ä»¶å¯¼å…¥ï¼Œä½¿ç”¨ ECharts å‘ˆç° æ ¹æ® ECharts å®˜æ–¹æ–‡æ¡£ï¼šå¼‚æ­¥æ•°æ®åŠ è½½å’Œæ›´æ–°ï¼Œä½¿ç”¨ jQuery å·¥å…·å°† json æ–‡ä»¶å¯¼å…¥ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364// åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹var myChart = echarts.init(document.getElementById('main'), 'shine');myChart.setOption({ title: { text: 'åŒåä¸€å½“å¤©é”€é‡å‰10çš„å•†å“ç±»åˆ«', // x: 'center' }, legend: { data: [\"é”€é‡\"], top: '3' }, tooltip: { trigger: 'axis', axisPointer: { // åæ ‡è½´æŒ‡ç¤ºå™¨ï¼Œåæ ‡è½´è§¦å‘æœ‰æ•ˆ type: 'shadow' // é»˜è®¤ä¸ºç›´çº¿ï¼Œå¯é€‰ä¸ºï¼š'line' | 'shadow' } }, grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true }, xAxis: [ { type: 'category', data: [], axisTick: { alignWithLabel: true } } ], yAxis: [ { type: 'value' } ], series: [ { name: 'é”€é‡', type: 'bar', barWidth: '60%', data: [], label: { normal: { show: true, position: 'top' } } } ]});$.get('./data/v_2/part-00000.json').done(function (data) { myChart.setOption({ xAxis: [{ data: data.key }], series: [{ data: data.value }] });}); å¯è§†åŒ–ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š å¯è§†åŒ–å®éªŒä¸‰ï¼šåŒåä¸€ç”·å¥³ä¹°å®¶å„ä¸ªå¹´é¾„æ®µäº¤æ˜“å¯¹æ¯”æ•°æ®å¤„ç† åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ (($æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º, $å¹´é¾„æ®µ, $æ€§åˆ«), 1) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°ç¡®å®šæ—¶é—´ä¸º 11 æœˆ 11 æ—¥ï¼Œç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œç”¨æˆ·è¡Œä¸º action == 2 ä½¿ç”¨ map() å‡½æ•°å°†æ•°æ®å¤„ç†ä¸º (($å¹´é¾„æ®µ, $æ€§åˆ«), 1) ä½¿ç”¨ reduceByKey() è®¡ç®—å‡ºæ¯ä¸ªå¹´é¾„æ®µæ¯ä¸ªæ€§åˆ«å¯¹åº”çš„æ¡ç›®æ•° ä¸ºäº†æ–¹ä¾¿åç»­ç”Ÿæˆå¯¹åº”çš„ JSON æ ¼å¼æ•°æ®ï¼Œä½¿ç”¨ä¸¤ä¸ª sortBy() å‡½æ•°å°†æ•°æ®æŒ‰å¹´é¾„æ®µä»å°åˆ°å¤§ï¼Œæ€§åˆ« â€œå¥³ï¼Œç”·ï¼ŒæœªçŸ¥â€ é¡ºåºæ’åº å°†ç»“æœè½¬æ¢æˆ JSON æ ¼å¼æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºå¤„ç†ç»“æœ æ•°æ®å¤„ç†æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718def transformationOps(sc: SparkContext): Unit = { // åŒåä¸€ç”·å¥³ä¹°å®¶å„ä¸ªå¹´é¾„æ®µäº¤æ˜“å¯¹æ¯” val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\"\\n\")) .map(line =&gt; ((line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(7), // è¡Œä¸º line.split(\",\")(8), // å¹´é¾„æ®µ line.split(\",\")(9)), 1)) // æ€§åˆ« .filter(line =&gt; line._1._1.equals(\"1111\")) .filter(line =&gt; line._1._2.equals(\"2\")) .map(t =&gt; ((t._1._3, t._1._4), t._2)) val Output = data.reduceByKey((v1, v2) =&gt; v1 + v2) .sortBy(_._1._2).sortBy(_._1._1).collect() toJSON_MultiBar(Output, sc) Output.foreach(println)} è½¬æ¢æˆ JSON æ–‡ä»¶ ç¼–å†™ toJSON_MultiBar() å‡½æ•°ï¼Œå°† SparkRDD å¤„ç†çš„ç»“æœè½¬æ¢æˆ JSON æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºç”ŸæˆæŸ±çŠ¶å›¾ ä½¿ç”¨é˜¿é‡Œå·´å·´ Java åº“ fastjsonï¼Œæ–°å»ºä¸€ä¸ª JSONObject å¯¹è±¡ æ–°å»ºå››ä¸ªæ•°ç»„åˆ†åˆ«å­˜æ”¾ï¼šå¹´é¾„æ®µï¼›å¥³æ€§ã€ç”·æ€§ã€å…¶ä»–åœ¨å„ä¸ªå¹´é¾„æ®µçš„äº¤æ˜“é‡ ä½¿ç”¨å¾ªç¯ï¼ŒæŒ‰è¡Œè¯»å–ï¼ŒæŒ‰ç…§ä¸åŒæ€§åˆ«ç­›é€‰ï¼Œå°† SparkRDD å¤„ç†çš„ç»“æœæ”¾å…¥å¯¹åº”çš„æ•°ç»„ å¯¼å‡ºï¼Œä¿å­˜ å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839def toJSON_MultiBar(data: Array[((String, String), Int)], sc: SparkContext): Unit = { val JSONObject = new JSONObject() val m = data.length val age: Array[Any] = new Array[Any](8) val woman: Array[Any] = new Array[Any](8) val man: Array[Any] = new Array[Any](8) val other: Array[Any] = new Array[Any](8) for (j &lt;- 0 to 7) { age(j) = j.toString // 7ä¸ªå¯¹åº”çš„å¹´é¾„æ®µ } JSONObject.put(\"age\", age) var x1 = 0 var x2 = 0 var x3 = 0 for (i &lt;- 0 until m) { if (data(i)._1._2 == \"0\") { woman(x1) = data(i)._2.toString // å°†æ€§åˆ«å¥³å¯¹åº”çš„æ¡ç›®å†™å…¥ woman æ•°ç»„ x1 = x1 + 1 } else if (data(i)._1._2 == \"1\") { man(x2) = data(i)._2.toString // å°†æ€§åˆ«ç”·å¯¹åº”çš„æ¡ç›®å†™å…¥ man æ•°ç»„ x2 += 1 } else { other(x3) = data(i)._2.toString // å°†æ€§åˆ«æœªçŸ¥å¯¹åº”çš„æ¡ç›®å†™å…¥ other æ•°ç»„ x3 += 1 } } JSONObject.put(\"woman\", woman) JSONObject.put(\"man\", man) JSONObject.put(\"other\", other) val output = sc.parallelize(List(JSONObject)) output.repartition(1).saveAsTextFile(\"./Visualization/web/data/v_3\")} å¯¼å‡ºåçš„æ–‡ä»¶ä¸º Spark å¤„ç†çš„æ–‡ä»¶ï¼Œåç§°ä¸º part-00000ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶åŠ ä¸Š json åç¼€ä¸º part-00000.json part-00000.json æ–‡ä»¶å†…å®¹ä¸ºï¼š 123456{ \"other\":[\"51126\",\"50628\",\"50989\",\"51169\",\"50916\",\"50706\",\"51183\",\"51029\"], \"woman\":[\"50590\",\"51337\",\"50854\",\"50978\",\"51259\",\"51244\",\"51517\",\"50872\"], \"man\":[\"50855\",\"50732\",\"51195\",\"51076\",\"50798\",\"50555\",\"50855\",\"50891\"], \"age\":[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\"]} å¯è§†åŒ–å‘ˆç° ä½¿ç”¨ Tomcat æ­å»ºæœ¬åœ° Java Web Serverï¼Œç¼–å†™ jsp ç½‘é¡µï¼Œå°† *.json æ–‡ä»¶å¯¼å…¥ï¼Œä½¿ç”¨ ECharts å‘ˆç° æ ¹æ® ECharts å®˜æ–¹æ–‡æ¡£ï¼šå¼‚æ­¥æ•°æ®åŠ è½½å’Œæ›´æ–°ï¼Œä½¿ç”¨ jQuery å·¥å…·å°† json æ–‡ä»¶å¯¼å…¥ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859// åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹var myChart = echarts.init(document.getElementById('main'), 'shine');$.get('./data/v_3/part-00000.json').done(function (data) { myChart.setOption({ title: { text: 'åŒåä¸€ç”·å¥³ä¹°å®¶å„ä¸ªå¹´é¾„æ®µäº¤æ˜“å¯¹æ¯”', x: 'center' }, legend: { data: [\"å¥³\", \"ç”·\", \"æœªçŸ¥\"], right: '20', top: '30' }, tooltip: { trigger: 'axis', axisPointer: { // åæ ‡è½´æŒ‡ç¤ºå™¨ï¼Œåæ ‡è½´è§¦å‘æœ‰æ•ˆ type: 'shadow' // é»˜è®¤ä¸ºç›´çº¿ï¼Œå¯é€‰ä¸ºï¼š'line' | 'shadow' } }, grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true }, xAxis: [ { type: 'category', data: data.age, axisTick: { alignWithLabel: true } } ], yAxis: [ { type: 'value' } ], series: [ { type: 'bar', name: 'å¥³', data: data.woman }, { type: 'bar', name: 'ç”·', data: data.man }, { type: 'bar', name: 'æœªçŸ¥', data: data.other } ] });}); å¯è§†åŒ–ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š å¯è§†åŒ–å®éªŒå››ï¼šåŒåä¸€ç”·å¥³ä¹°å®¶äº¤æ˜“å¯¹æ¯”æ•°æ®å¤„ç† åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ (($æ—¥æœŸ, $ç”¨æˆ·è¡Œä¸º, $æ€§åˆ«), 1) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°ç¡®å®šæ—¶é—´ä¸º 11 æœˆ 11 æ—¥ï¼Œç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°ï¼Œå…·ä½“ä¸ºæ—¥æœŸ month == 11, day == 11ï¼Œç”¨æˆ·è¡Œä¸º action == 2 ä½¿ç”¨ map() å‡½æ•°å°†æ•°æ®å¤„ç†ä¸º ($æ€§åˆ«, 1) ä½¿ç”¨ reduceByKey() è®¡ç®—å‡ºæ¯ä¸ªæ€§åˆ«å¯¹åº”çš„æ¡ç›®æ•° å°†ç»“æœè½¬æ¢æˆ JSON æ ¼å¼æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºå¤„ç†ç»“æœ æ•°æ®å¤„ç†æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516def transformationOps(sc: SparkContext): Unit = { // åŒåä¸€ç”·å¥³ä¹°å®¶äº¤æ˜“å¯¹æ¯” val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\"\\n\")) .map(line =&gt; ((line.split(\",\")(5) + line.split(\",\")(6), // æ—¥æœŸ line.split(\",\")(7), // è¡Œä¸º line.split(\",\")(9)), 1)) // æ€§åˆ« .filter(line =&gt; line._1._1.equals(\"1111\")) .filter(line =&gt; line._1._2.equals(\"2\")) .map(t =&gt; (t._1._3, t._2)) val Output = data.reduceByKey((v1, v2) =&gt; v1 + v2).collect() toJSON_Pie(Output, sc) Output.foreach(println)} è½¬æ¢æˆ JSON æ–‡ä»¶ ç¼–å†™ toJSON_Pie() å‡½æ•°ï¼Œå°† SparkRDD å¤„ç†çš„ç»“æœè½¬æ¢æˆ JSON æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºç”Ÿæˆé¥¼çŠ¶å›¾ ä½¿ç”¨é˜¿é‡Œå·´å·´ Java åº“ fastjsonï¼Œæ–°å»ºä¸€ä¸ª JSONObject å¯¹è±¡ æ–°å»ºä¸€ä¸ªæ•°ç»„å‡†å¤‡å­˜æ”¾ç»˜åˆ¶ EChart é¥¼çŠ¶å›¾è¦æ±‚çš„ {\"name\":\"\",\"value\":\"\"} å¯¹ ä½¿ç”¨å¾ªç¯ï¼ŒæŒ‰è¡Œè¯»å–ï¼Œæ”¾å…¥ SparkRDD å¤„ç†çš„ç»“æœ å¯¼å‡ºï¼Œä¿å­˜ å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314def toJSON_Pie(data: Array[(String, Int)], sc: SparkContext): Unit = { val JSONObject = new JSONObject() val m = data.length val list: util.List[Any] = new util.ArrayList[Any]() for (i &lt;- 0 until m) { val pair = new util.HashMap[String, Any]() pair.put(\"name\", data(i)._1.toString) pair.put(\"value\", data(i)._2.toString) list.add(pair) } JSONObject.put(\"data\", list) val output = sc.parallelize(List(JSONObject)) output.repartition(1).saveAsTextFile(\"./Visualization/web/data/v_4\")} å¯¼å‡ºåçš„æ–‡ä»¶ä¸º Spark å¤„ç†çš„æ–‡ä»¶ï¼Œåç§°ä¸º part-00000ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶åŠ ä¸Š json åç¼€ä¸º part-00000.json ç”±äºåŸå§‹æ•°æ®ä¸­ä»£è¡¨ç”¨æˆ·è¡Œä¸ºçš„æ•°æ®ä¸º 0~3ï¼Œæ•°å­—å¯¹å¯è§†åŒ–å‘ˆç°ä¸ç›´è§‚ï¼Œæ‰€ä»¥æ‰‹åŠ¨æ›´æ”¹äº† json æ–‡ä»¶çš„å¯¹åº”å†…å®¹ part-00000.json æ–‡ä»¶å†…å®¹ä¸ºï¼š 12345678910111213141516{ \"data\": [ { \"name\": \"å¥³\", \"value\": \"408651\" }, { \"name\": \"ç”·\", \"value\": \"406957\" }, { \"name\": \"æœªçŸ¥\", \"value\": \"407746\" } ]} å¯è§†åŒ–å‘ˆç° ä½¿ç”¨ Tomcat æ­å»ºæœ¬åœ° Java Web Serverï¼Œç¼–å†™ jsp ç½‘é¡µï¼Œå°† *.json æ–‡ä»¶å¯¼å…¥ï¼Œä½¿ç”¨ ECharts å‘ˆç° æ ¹æ® ECharts å®˜æ–¹æ–‡æ¡£ï¼šå¼‚æ­¥æ•°æ®åŠ è½½å’Œæ›´æ–°ï¼Œä½¿ç”¨ jQuery å·¥å…·å°† json æ–‡ä»¶å¯¼å…¥ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹var myChart = echarts.init(document.getElementById('main'), 'shine');// $.getJSON('./data/v_1/part-00000.json').done(function (data) {myChart.setOption({ title: { text: 'åŒåä¸€ç”·å¥³ä¹°å®¶äº¤æ˜“å¯¹æ¯”', x: 'center' }, tooltip: { trigger: 'item', formatter: \"{a} &lt;br/&gt; {b}: {c} ({d}%)\" }, label: { formatter: \"{b}: {c}\" }, legend: { orient: 'vertical', right: 50, top: 150, // bottom: 20, data: ['å¥³', 'ç”·', 'æœªçŸ¥'] }, series: [ { name: 'æ€§åˆ«', type: 'pie', radius: '60%', center: ['40%', '50%'], data: [], selectedMode: 'single', itemStyle: { emphasis: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0, 0, 0, 0.5)' } } } ]});$.get('./data/v_4/part-00000.json').done(function (data) { myChart.setOption({ series: [{ data: data.data }] });}); å¯è§†åŒ–ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š å¯è§†åŒ–å®éªŒäº”ï¼šå„ä¸ªçœä»½çš„æ€»æˆäº¤é‡å¯¹æ¯”æ•°æ®å¤„ç† åˆ†æï¼š é¦–å…ˆè¿›è¡Œ map æ“ä½œï¼Œå°†æ•°æ®å¤„ç†æˆ (($çœä»½, $ç”¨æˆ·è¡Œä¸º), 1) æ ·å¼ ç„¶åä½¿ç”¨ filter() å‡½æ•°ç¡®å®šç”¨æˆ·è¡Œä¸ºä¸ºè´­ä¹°ï¼Œå…·ä½“ä¸ºç”¨æˆ·è¡Œä¸º action == 2 ä½¿ç”¨ map() å‡½æ•°å°†æ•°æ®å¤„ç†ä¸º ($çœä»½, 1) ä½¿ç”¨ reduceByKey() è®¡ç®—å‡ºæ¯ä¸ªçœä»½å¯¹åº”çš„æ¡ç›®æ•° å°†ç»“æœè½¬æ¢æˆ JSON æ ¼å¼æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºå¤„ç†ç»“æœ æ•°æ®å¤„ç†æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213def transformationOps(sc: SparkContext): Unit = { // å„ä¸ªçœä»½çš„æ€»æˆäº¤é‡å¯¹æ¯” val raw_data = sc.textFile(\"./data/user_log.csv\") val data = raw_data.flatMap(line =&gt; line.split(\"\\n\")) .map(line =&gt; ((line.split(\",\")(10), line.split(\",\")(7)), 1)) .filter(line =&gt; line._1._2.contains(\"2\")) .map(t =&gt; (t._1._1, t._2)) val Output = data.reduceByKey((v1, v2) =&gt; v1 + v2).collect() toJSON_Map(Output, sc) Output.foreach(println)} è½¬æ¢æˆ JSON æ–‡ä»¶ ç¼–å†™ toJSON_Pie() å‡½æ•°ï¼Œå°† SparkRDD å¤„ç†çš„ç»“æœè½¬æ¢æˆ JSON æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºç”Ÿæˆé¥¼çŠ¶å›¾ ä½¿ç”¨é˜¿é‡Œå·´å·´ Java åº“ fastjsonï¼Œæ–°å»ºä¸€ä¸ª JSONObject å¯¹è±¡ æ–°å»ºä¸€ä¸ªæ•°ç»„å‡†å¤‡å­˜æ”¾ç»˜åˆ¶ EChart åœ°å›¾è¦æ±‚çš„ {\"name\":\"\",\"value\":\"\"} å¯¹ ä½¿ç”¨å¾ªç¯ï¼ŒæŒ‰è¡Œè¯»å–ï¼Œæ”¾å…¥ SparkRDD å¤„ç†çš„ç»“æœ å¯¼å‡ºï¼Œä¿å­˜ å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314def toJSON_Map(data: Array[(String, Int)], sc: SparkContext): Unit = { val JSONObject = new JSONObject() val m = data.length val list: util.List[Any] = new util.ArrayList[Any]() for (i &lt;- 0 until m) { val pair = new util.HashMap[String, Any]() pair.put(\"name\", data(i)._1.toString) pair.put(\"value\", data(i)._2.toString) list.add(pair) } JSONObject.put(\"data\", list) val output = sc.parallelize(List(JSONObject)) output.repartition(1).saveAsTextFile(\"./Visualization/web/data/v_5\")} å¯¼å‡ºåçš„æ–‡ä»¶ä¸º Spark å¤„ç†çš„æ–‡ä»¶ï¼Œåç§°ä¸º part-00000ï¼Œéœ€è¦æ‰‹åŠ¨å°†å…¶åŠ ä¸Š json åç¼€ä¸º part-00000.json part-00000.json æ–‡ä»¶å†…å®¹ä¸ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738{ \"data\":[ {\"name\":\"å¤©æ´¥\",\"value\":\"97134\"}, {\"name\":\"å‰æ—\",\"value\":\"96992\"}, {\"name\":\"å››å·\",\"value\":\"96743\"}, {\"name\":\"å†…è’™å¤\",\"value\":\"96619\"}, {\"name\":\"ä¸Šæµ·å¸‚\",\"value\":\"96893\"}, {\"name\":\"æµ™æ±Ÿ\",\"value\":\"97162\"}, {\"name\":\"é’æµ·\",\"value\":\"96991\"}, {\"name\":\"æ²³åŒ—\",\"value\":\"96674\"}, {\"name\":\"äº‘å—\",\"value\":\"96377\"}, {\"name\":\"é¦™æ¸¯\",\"value\":\"96587\"}, {\"name\":\"å®å¤\",\"value\":\"96494\"}, {\"name\":\"ç”˜è‚ƒ\",\"value\":\"96822\"}, {\"name\":\"å®‰å¾½\",\"value\":\"96488\"}, {\"name\":\"æ±Ÿè¥¿\",\"value\":\"96679\"}, {\"name\":\"æ±Ÿè‹\",\"value\":\"96802\"}, {\"name\":\"æ¹–å—\",\"value\":\"97125\"}, {\"name\":\"è¥¿è—\",\"value\":\"97116\"}, {\"name\":\"ç¦å»º\",\"value\":\"96625\"}, {\"name\":\"åŒ—äº¬\",\"value\":\"96911\"}, {\"name\":\"é™•è¥¿\",\"value\":\"96517\"}, {\"name\":\"å±±è¥¿\",\"value\":\"96861\"}, {\"name\":\"å¹¿è¥¿\",\"value\":\"96675\"}, {\"name\":\"æ¾³é—¨\",\"value\":\"96710\"}, {\"name\":\"æ¹–åŒ—\",\"value\":\"96943\"}, {\"name\":\"å±±ä¸œ\",\"value\":\"97123\"}, {\"name\":\"å¹¿ä¸œ\",\"value\":\"97338\"}, {\"name\":\"å°æ¹¾\",\"value\":\"96543\"}, {\"name\":\"è¾½å®\",\"value\":\"96714\"}, {\"name\":\"æ–°ç–†\",\"value\":\"96960\"}, {\"name\":\"é»‘é¾™æ±Ÿ\",\"value\":\"97169\"}, {\"name\":\"é‡åº†\",\"value\":\"96813\"}, {\"name\":\"æµ·å—\",\"value\":\"96722\"}, {\"name\":\"æ²³å—\",\"value\":\"96980\"}, {\"name\":\"è´µå·\",\"value\":\"96842\"} ]} å¯è§†åŒ–å‘ˆç° ä½¿ç”¨ Tomcat æ­å»ºæœ¬åœ° Java Web Serverï¼Œç¼–å†™ jsp ç½‘é¡µï¼Œå°† *.json æ–‡ä»¶å¯¼å…¥ï¼Œä½¿ç”¨ ECharts å‘ˆç° æ ¹æ® ECharts å®˜æ–¹æ–‡æ¡£ï¼šå¼‚æ­¥æ•°æ®åŠ è½½å’Œæ›´æ–°ï¼Œä½¿ç”¨ jQuery å·¥å…·å°† json æ–‡ä»¶å¯¼å…¥ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263// åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹var myChart = echarts.init(document.getElementById('main'), 'shine');myChart.showLoading();$.getJSON('./data/china.json', function (geoJson) { myChart.hideLoading(); echarts.registerMap('CN', geoJson); myChart.setOption({ title: { text: 'å„ä¸ªçœä»½çš„æ€»æˆäº¤é‡å¯¹æ¯”', x: 'center' }, tooltip: { trigger: 'item', formatter: \"{b} &lt;br/&gt; {c} (ä»¶)\" }, toolbox: { show: true, orient: 'vertical', left: 'right', top: 'center', feature: { dataView: {readOnly: false}, restore: {}, saveAsImage: {} } }, visualMap: { min: 96000, max: 98000, text: ['é«˜', 'ä½'], realtime: false, calculable: true, inRange: { color: ['lightskyblue', 'yellow', 'orangered'] } }, series: [ { name: 'å„ä¸ªçœä»½çš„æ€»æˆäº¤é‡å¯¹æ¯”', type: 'map', map: 'CN', // è‡ªå®šä¹‰æ‰©å±•å›¾è¡¨ç±»å‹ itemStyle: { normal: {label: {show: true}}, emphasis: {label: {show: true}} }, data: [] } ] })});$.get('./data/v_5/part-00000.json').done(function (data) { myChart.setOption({ series: [{ data: data.data }] });}); å¯è§†åŒ–ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š å®éªŒè¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜åœ¨æœ¬æ¬¡å®éªŒè¿‡ç¨‹ä¸­å‘ç°äº†ä¸å°‘é—®é¢˜ï¼Œæœ‰äº›é€šè¿‡åœ¨ç½‘ç»œæœç´¢è§£å†³äº†ï¼Œä½†æœ‰äº›æ²¡æœ‰æ‰¾åˆ°å¾ˆå¥½çš„è§£å†³æ–¹æ³•ï¼Œåœ¨æ­¤æå‡ºã€‚ åœ¨ç¼–å†™å¯è§†åŒ–éƒ¨åˆ†çš„ä»£ç æ—¶ï¼Œä½¿ç”¨ SparkRDD ç”Ÿæˆçš„ JSON æ ¼å¼çš„æ–‡ä»¶æ²¡æœ‰åç¼€ï¼Œè¿™æ—¶ jQuery æ— æ³•è¯»å–åˆ°æ–‡ä»¶çš„å†…å®¹ï¼Œå¿…é¡»æ‰‹åŠ¨æ›´æ”¹ part-00000 æ–‡ä»¶åä¸º part-00000.json æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ä¿®æ”¹ SparkRDD é‡Œçš„æ•°æ®ï¼Œå½“ç»˜åˆ¶å¯è§†åŒ–å®éªŒä¸€ï¼šåŒåä¸€æ‰€æœ‰ä¹°å®¶æ¶ˆè´¹è¡Œä¸ºæ¯”ä¾‹å’Œå¯è§†åŒ–å®éªŒå››ï¼šåŒåä¸€ç”·å¥³ä¹°å®¶äº¤æ˜“å¯¹æ¯”æ—¶ï¼Œç”±äºåŸå§‹æ•°æ®ä¸­ä»£è¡¨ç”¨æˆ·è¡Œä¸ºçš„æ•°æ®ä¸º 0 ~ 3ï¼Œä»£è¡¨ç”¨æˆ·æ€§åˆ«çš„æ•°æ®ä¸º 0 ~ 1ï¼Œæ•°å­—å¯¹å¯è§†åŒ–å‘ˆç°ä¸ç›´è§‚ï¼Œæ‰€ä»¥æ‰‹åŠ¨éœ€è¦æ›´æ”¹ json æ–‡ä»¶çš„å¯¹åº”å†…å®¹ã€‚åŒæ ·åœ¨ç»˜åˆ¶å¯è§†åŒ–å®éªŒäº”ï¼šå„ä¸ªçœä»½çš„æ€»æˆäº¤é‡å¯¹æ¯”æ—¶ï¼Œæ•°æ®é‡Œæœ‰äº›çœä»½çš„åå­—å’Œ china.js ä¸­çš„çœä»½åç§°ä¸ä¸€æ ·ï¼Œæ¯”å¦‚åŒ—äº¬å’ŒåŒ—äº¬å¸‚ï¼Œè¿™æ ·å¯è§†åŒ–çš„æ—¶å€™æ•°æ®ä¼šä¸æ˜¾ç¤ºï¼Œä¹Ÿéœ€è¦æ‰‹åŠ¨æ›´æ”¹ JSON æ–‡ä»¶å†…å®¹ã€‚","link":"/2019/spark-taobao/"},{"title":"ä¸€äº›å®¹æ˜“å¿˜æ‰çš„çŸ¥è¯†ç‚¹ - Java","text":"1 Java åŸºç¡€1.1 å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰å’Œå®‰å…¨å¤±è´¥ï¼ˆfail-safeï¼‰æœºåˆ¶å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰æ˜¯ Java é›†åˆçš„ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ã€‚ åœ¨ä½¿ç”¨è¿­ä»£å™¨å¯¹é›†åˆè¿›è¡Œéå†çš„æ—¶å€™ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹æ“ä½œéå®‰å…¨å¤±è´¥ï¼ˆfail-safeï¼‰çš„é›†åˆç±»å¯èƒ½å°±ä¼šè§¦å‘ fail-fast æœºåˆ¶ï¼Œå¯¼è‡´æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚ åœ¨å•çº¿ç¨‹ä¸‹ï¼Œå¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹çš„è¯ä¹Ÿä¼šè§¦å‘ fail-fast æœºåˆ¶ã€‚ ä¾‹å¦‚ï¼šå¤šçº¿ç¨‹ä¸‹ï¼Œå¦‚æœçº¿ç¨‹ 1 æ­£åœ¨å¯¹é›†åˆè¿›è¡Œéå†ï¼Œæ­¤æ—¶çº¿ç¨‹ 2 å¯¹é›†åˆè¿›è¡Œä¿®æ”¹ï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ï¼Œæˆ–è€…çº¿ç¨‹ 1 åœ¨éå†è¿‡ç¨‹ä¸­å¯¹é›†åˆè¿›è¡Œä¿®æ”¹ï¼Œéƒ½ä¼šå¯¼è‡´çº¿ç¨‹ 1 æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚ åŸç† è¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª modCount å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜ modCount çš„å€¼ã€‚ æ¯å½“è¿­ä»£å™¨ä½¿ç”¨ hashNext ()/next () éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹ modCount å˜é‡æ˜¯å¦ä¸º expectedmodCount å€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚ é‡‡ç”¨å®‰å…¨å¤±è´¥ï¼ˆfail-safeï¼‰æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼ˆJUC åŒ…ä¸‹çš„å®¹å™¨ï¼‰ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚æ‰€ä»¥ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ•…ä¸ä¼šæŠ› ConcurrentModificationException å¼‚å¸¸ã€‚ 1.2 HashMap ä¸ ConcurrentHashMap å¯¹ null å€¼çš„å¤„ç†é—®é¢˜ç»“è®ºï¼šHashMap çš„ key å’Œ value éƒ½å¯ä»¥ä¸º nullï¼ŒConcurrentHashMap çš„å‡ä¸å¯ä»¥ä¸º null HashTable ä¹Ÿæ˜¯ä¸å…è®¸ key å’Œ value ä¸ºç©ºçš„ï¼ŒåŸå› å’Œ ConcurrentHashMap ä¸€è‡´ ä¸Šæºç ï¼ HashMapï¼Œå½“ key ä¸º null çš„æ—¶å€™ï¼Œhash å€¼ä¸º 0ï¼Œåç»­çš„ put æ–¹æ³•ä¸­ä¹Ÿæ²¡æœ‰åˆ¤æ–­ value æ˜¯å¦ä¸º null çš„ä»£ç ã€‚ 1234static final int hash(Object key) { int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);} ConcurrentHashMapï¼Œkey æˆ– value ä¸º null ç›´æ¥æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ 123final V putVal(K key, V value, boolean onlyIfAbsent) { if (key == null || value == null) throw new NullPointerException(); ...... è¿™ä¹ˆåšçš„åŸå› ï¼š ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“é€šè¿‡ get(k) è·å–å¯¹åº”çš„ value æ—¶ï¼Œå¦‚æœè·å–åˆ°çš„æ˜¯ nullï¼Œæ— æ³•åˆ¤æ–­å®ƒæ˜¯ put(k,v) çš„æ—¶å€™ value ä¸º nullï¼Œè¿˜æ˜¯è¿™ä¸ª key ä»æ¥æ²¡æœ‰åšè¿‡æ˜ å°„ã€‚ HashMap å¤šç”¨äºéå¹¶å‘åœºæ™¯ä¸­ï¼Œå¯ä»¥é€šè¿‡ contains(key) æ¥åšè¿™ä¸ªåˆ¤æ–­ã€‚è€Œåœ¨å¤šç”¨äºå¹¶å‘åœºæ™¯ä¸­çš„ ConcurrentHashMap ä¸­è°ƒç”¨ m.contains(key) åˆ¤æ–­ç„¶åå† m.get(key) æ—¶ï¼Œ\u001dm å¯èƒ½å·²ç»è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è€Œä¸åŒäº†ã€‚ä¸ºäº†é¿å…è¿™ç§äºŒä¹‰æ€§ï¼ŒConcurrentHashMap åœ¨è®¾è®¡ä¹‹åˆå°±ç›´æ¥ä»¤ key å’Œ value éƒ½ä¸ä¸º nullã€‚ 1.3 Arrays.asList()å‚è€ƒï¼šArrays.asList () é¿å‘æŒ‡å— ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹å¯¹ Arrays.asList() çš„æè¿°ï¼š æ³¨æ„ 1 ä¼ é€’çš„æ•°ç»„å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»å‹ã€‚ å› ä¸º Arrays.asList() æ˜¯æ³›å‹æ–¹æ³•ï¼Œä¼ å…¥çš„å¯¹è±¡å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ã€‚å¯¹åŸºæœ¬ç±»å‹æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨åŒ…è£…ç±»å‹æ•°ç»„å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 1Integer[] myArray = {1, 2, 3}; æ³¨æ„ 2 ä½¿ç”¨é›†åˆçš„ä¿®æ”¹æ–¹æ³•: add()ã€remove()ã€clear() ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ Arrays.asList() æ–¹æ³•è¿”å›çš„å¹¶ä¸æ˜¯ java.util.ArrayList ï¼Œè€Œæ˜¯ java.util.Arrays çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œè¿™ä¸ªå†…éƒ¨ç±»å¹¶æ²¡æœ‰å®ç°é›†åˆçš„ä¿®æ”¹æ–¹æ³•æˆ–è€…è¯´å¹¶æ²¡æœ‰é‡å†™è¿™äº›æ–¹æ³•ã€‚ 1234List myList = Arrays.asList(1, 2, 3);myList.add(4); // è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationExceptionmyList.remove(1); // è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationExceptionmyList.clear(); // è¿è¡Œæ—¶æŠ¥é”™ï¼šUnsupportedOperationException 1.4 Java ä¸­ç”¨åˆ°çš„æ’åºç®—æ³•Arrays.sort() åœ¨è¯¥æ–¹æ³•çš„æºç ä¸­è°ƒç”¨äº† DualPivotQuicksort.sort()ï¼Œå‘ç°åœ¨æ­¤æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹åˆ¤æ–­ï¼š 123456789static void sort(int[] a, int left, int right, int[] work, int workBase, int workLen) { // Use Quicksort on small arrays if (right - left &lt; QUICKSORT_THRESHOLD) { sort(a, left, right, true); return; } ... å¯ä»¥å‘ç°å¦‚æœæ•°ç»„çš„é•¿åº¦å°äº QUICKSORT_THRESHOLD çš„è¯å°±ä¼šä½¿ç”¨åŒè½´å¿«é€Ÿæ’åºï¼ˆDualPivotQuicksortï¼‰ï¼Œè¿™ä¸ªå€¼ä¸º 286ã€‚ åœ¨åŒè½´å¿«é€Ÿæ’åºä¸­ï¼Œæœ‰å¦‚ä¸‹åˆ¤æ–­ã€‚å¦‚æœæ•°ç»„é•¿åº¦å°äº INSERTION_SORT_THRESHOLD == 47ï¼Œåˆ™ä½¿ç”¨æ’å…¥æ’åºã€‚ 1234// Use insertion sort on tiny arraysif (length &lt; INSERTION_SORT_THRESHOLD) { ...} å¦‚æœæ•°ç»„é•¿åº¦ä¸å°äº 286ï¼Œä¼šç»§ç»­æ£€æŸ¥è¯¥æ•°ç»„çš„è¿ç»­å‡åºå’Œè¿ç»­é™åºæ€§å¥½ä¸å¥½ (Check if the array is nearly sorted)ï¼Œå¦‚æœå¥½çš„è¯å°±ç”¨å½’å¹¶æ’åºï¼Œä¸å¥½å°±ç”¨åŒè½´å¿«é€Ÿæ’åºã€‚ æ€»ç»“ï¼šArrays.sort() æ–¹æ³•ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å°äº 286 ä¸”å¤§äºç­‰äº 47 çš„è¯å°±ç”¨åŒè½´å¿«é€Ÿæ’åºï¼Œå¦‚æœé•¿åº¦å°äº 47 çš„è¯å°±ç”¨æ’å…¥æ’åºã€‚å¦‚æœæ•°ç»„é•¿åº¦å¤§äºç­‰äº 286 ä¸”è¿ç»­æ€§å¥½çš„è¯ï¼Œå°±ç”¨ TimSort å½’å¹¶æ’åºï¼ˆå½’å¹¶æ’åºçš„ä¼˜åŒ–ç‰ˆæœ¬ï¼‰ï¼Œå¦‚æœå¤§äºç­‰äº 286 ä¸”è¿ç»­æ€§ä¸å¥½çš„è¯å°±ç”¨åŒè½´å¿«é€Ÿæ’åºã€‚ æ•°ç»„é•¿åº¦ l æ’åºæ–¹æ³• l &lt; 47 æ’å…¥æ’åº 47 &lt;= l &lt; 286 åŒè½´å¿«é€Ÿæ’åº 286 &lt;= l ï¼ˆè¿ç»­æ€§å¥½ï¼‰ TimSort å½’å¹¶æ’åº 286 &lt;= l ï¼ˆè¿ç»­æ€§ä¸å¥½ï¼‰ åŒè½´å¿«é€Ÿæ’åº Collections.sort() é’ˆå¯¹é›†åˆç±»å®¹å™¨æ’åºï¼Œé¦–å…ˆè°ƒç”¨ this.toArray() æ–¹æ³•å°†é›†åˆå…ƒç´ æ”¾è¿› Object æ•°ç»„ï¼Œä½¿ç”¨ Array.sort() çš„é‡è½½æ–¹æ³•å¯¹è¯¥ Object æ•°ç»„æ’åºã€‚å¦‚æœç”¨æˆ·æŒ‡å®š LegacyMergeSort.userRequested == trueï¼Œåˆ™ä½¿ç”¨å½’å¹¶æ’åºï¼Œå¦åˆ™ä½¿ç”¨ TimSort æ’åº 1.5 BIOã€NIOåŒæ­¥å’Œå¼‚æ­¥ï¼š åŒæ­¥ï¼šä¸¤ä¸ªåŒæ­¥ä»»åŠ¡ç›¸äº’ä¾èµ–ï¼Œå¹¶ä¸”ä¸€ä¸ªä»»åŠ¡å¿…é¡»ä»¥ä¾èµ–äºå¦ä¸€ä»»åŠ¡çš„æŸç§æ–¹å¼æ‰§è¡Œã€‚ æ¯”å¦‚åœ¨ A-&gt;B äº‹ä»¶æ¨¡å‹ä¸­ï¼Œä½ éœ€è¦å…ˆå®Œæˆ A æ‰èƒ½æ‰§è¡Œ Bã€‚ å†æ¢å¥è¯è¯´ï¼ŒåŒæ­¥è°ƒç”¨ä¸­è¢«è°ƒç”¨è€…æœªå¤„ç†å®Œè¯·æ±‚ä¹‹å‰ï¼Œè°ƒç”¨ä¸è¿”å›ï¼Œè°ƒç”¨è€…ä¼šä¸€ç›´ç­‰å¾…ç»“æœçš„è¿”å›ã€‚ å¼‚æ­¥ï¼šä¸¤ä¸ªå¼‚æ­¥çš„ä»»åŠ¡å®Œå…¨ç‹¬ç«‹çš„ï¼Œä¸€æ–¹çš„æ‰§è¡Œä¸éœ€è¦ç­‰å¾…å¦å¤–ä¸€æ–¹çš„æ‰§è¡Œã€‚å†æ¢å¥è¯è¯´ï¼Œå¼‚æ­¥è°ƒç”¨ç§ä¸€è°ƒç”¨å°±è¿”å›ç»“æœä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå½“ç»“æœè¿”å›çš„æ—¶å€™é€šè¿‡å›è°ƒå‡½æ•°æˆ–è€…å…¶ä»–æ–¹å¼æ‹¿ç€ç»“æœå†åšç›¸å…³äº‹æƒ…ï¼Œ é˜»å¡å’Œéé˜»å¡ï¼š é˜»å¡ï¼šé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸€ç›´ç­‰å¾…è¯·æ±‚ç»“æœè¿”å›ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ— æ³•ä»äº‹å…¶ä»–ä»»åŠ¡ï¼Œåªæœ‰å½“æ¡ä»¶å°±ç»ªæ‰èƒ½ç»§ç»­ã€‚ éé˜»å¡ï¼šéé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸ç”¨ä¸€ç›´ç­‰ç€ç»“æœè¿”å›ï¼Œå¯ä»¥å…ˆå»å¹²å…¶ä»–äº‹æƒ…ã€‚ åœ¨ç¨‹åºé‡Œï¼š åŒæ­¥é˜»å¡ï¼Œç›¸å½“äºä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ã€‚ åŒæ­¥éé˜»å¡ï¼Œç›¸å½“äºä¸€ä¸ªçº¿ç¨‹åœ¨æ­£å¸¸è¿è¡Œã€‚ å¼‚æ­¥é˜»å¡ï¼Œç›¸å½“äºå¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…ã€‚ å¼‚æ­¥éé˜»å¡ï¼Œç›¸å½“äºå¤šä¸ªçº¿ç¨‹éƒ½åœ¨æ­£å¸¸è¿è¡Œã€‚ BIOï¼šåŒæ­¥é˜»å¡ IO (Blocking I/O) åŒæ­¥å¹¶é˜»å¡ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ã€‚ BIO æ–¹å¼é€‚ç”¨äºè¿æ¥æ•°æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ NIOï¼šåŒæ­¥éé˜»å¡ IOï¼ˆNew I/O, Non-blocking I/Oï¼‰ åŒæ­¥éé˜»å¡ï¼ŒæœåŠ¡å™¨å®ç°ä¸ºä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚éƒ½ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ï¼ˆSelectorï¼‰ä¸Šï¼ŒSelector è½®è¯¢åˆ°è¿æ¥æœ‰ IO è¯·æ±‚æ—¶æ‰å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç† NIO é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”æ¯”è¾ƒçŸ­çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œç¼–ç¨‹å¤æ‚ï¼ŒJDK1.4 æ‰å¼€å§‹æ”¯æŒ ä¸ºä»€ä¹ˆ NIO æ˜¯åŒæ­¥éé˜»å¡çš„ï¼Ÿ å› ä¸ºæ— è®ºå¤šå°‘å®¢æˆ·ç«¯éƒ½å¯ä»¥æ¥å…¥æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯æ¥å…¥å¹¶ä¸ä¼šè€—è´¹ä¸€ä¸ªçº¿ç¨‹ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªè¿æ¥ç„¶åæ³¨å†Œåˆ° Selector ä¸Šå»ï¼Œè¿™æ ·å°±å¯ä»¥å»å¹²å…¶ä»–æƒ³å¹²çš„å…¶ä»–äº‹æƒ…äº†ã€‚ä¸€ä¸ª Selector çº¿ç¨‹ä¸æ–­çš„è½®è¯¢æ‰€æœ‰çš„ Socket è¿æ¥ï¼ˆChannelï¼‰ï¼Œå‘ç°æœ‰äº‹ä»¶äº†å°±é€šçŸ¥ï¼Œç„¶åå°±å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚å³å¯ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„è¯å°±æ˜¯éé˜»å¡çš„ã€‚ä½†æ˜¯è¿™ä¸ªå¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯è¦å…ˆè¯»å–æ•°æ®ï¼Œå¤„ç†ï¼Œå†è¿”å›çš„ï¼Œè¿™æ˜¯ä¸ªåŒæ­¥çš„è¿‡ç¨‹ã€‚ å¤šè·¯å¤ç”¨æœºåˆ¶æ˜¯å¦‚ä½•æ”¯æŒæµ·é‡è¿æ¥ï¼Ÿ NIO çš„çº¿ç¨‹æ¨¡å‹å¯¹ Socket å‘èµ·çš„è¿æ¥ä¸éœ€è¦æ¯ä¸ªéƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨ä¸€ä¸ª Selector æ¥å¤šè·¯å¤ç”¨ç›‘å¬ N å¤šä¸ª Channel æ˜¯å¦æœ‰è¯·æ±‚ï¼Œè¯¥è¯·æ±‚æ˜¯å¯¹åº”çš„è¿æ¥è¯·æ±‚ï¼Œè¿˜æ˜¯å‘é€æ•°æ®çš„è¯·æ±‚ã€‚ ä¸€ä¸ª Selector ä¸æ–­çš„è½®è¯¢å¤šä¸ª Channelï¼Œè¿™æ ·é¿å…äº†åˆ›å»ºå¤šä¸ªçº¿ç¨‹ã€‚åªæœ‰å½“æŸä¸ª Channel æœ‰å¯¹åº”çš„è¯·æ±‚çš„æ—¶å€™æ‰ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œå¯èƒ½è¯´ 1000 ä¸ªè¯·æ±‚ä¸­åªæœ‰ 100 ä¸ªè¯·æ±‚æ˜¯æœ‰æ•°æ®äº¤äº’çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½ Server ç«¯å°±æä¾› 10 ä¸ªçº¿ç¨‹å°±èƒ½å¤Ÿå¤„ç†è¿™äº›è¯·æ±‚ã€‚è¿™æ ·çš„è¯å°±å¯ä»¥é¿å…äº†åˆ›å»ºå¤§é‡çš„çº¿ç¨‹ã€‚ é€‰æ‹©å™¨ Selector ä½¿ç”¨å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªé€šé“ã€‚å› æ­¤ï¼Œå®ƒéœ€è¦è¾ƒå°‘çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº›é€šé“ã€‚ NIO ä¸­çš„ Buffer æ˜¯ä»€ä¹ˆï¼Ÿ IO é¢å‘æµï¼ˆStream orientedï¼‰ï¼ŒNIO é¢å‘ç¼“å†²åŒºï¼ˆBuffer orientedï¼‰ é€šè¿‡ NIO å†™æ•°æ®åˆ°æ–‡ä»¶æˆ–è€…ç½‘ç»œï¼Œæˆ–è€…æ˜¯ä»æ–‡ä»¶å’Œç½‘ç»œè¯»å–æ•°æ®å‡ºæ¥ï¼Œæ­¤æ—¶å°±éœ€è¦é€šè¿‡ Buffer ç¼“å†²åŒºæ¥è¿›è¡Œã€‚ åœ¨ NIO åº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œè¯»åˆ°ç¼“å†²åŒºä¸­ï¼›åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå†™å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚ä»»ä½•æ—¶å€™è®¿é—® NIO ä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºè¿›è¡Œæ“ä½œã€‚ æ¯ä¸€ç§ Java åŸºæœ¬ç±»å‹ï¼ˆé™¤äº† Boolean ç±»å‹ï¼‰éƒ½å¯¹åº”æœ‰ä¸€ç§ç¼“å†²åŒºã€‚ NIO ä¸­çš„ Channel æ˜¯ä»€ä¹ˆï¼Ÿ Channelï¼ˆé€šé“ï¼‰æ˜¯ NIO ä¸­çš„æ•°æ®é€šé“ï¼ŒNIO é€šè¿‡ Channel è¿›è¡Œè¯»å†™ã€‚ç±»ä¼¼æµï¼Œä½†æ˜¯åˆæœ‰äº›ä¸åŒ é€šé“æ˜¯åŒå‘çš„ï¼Œæ—¢å¯ä» Channel ä¸­è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å†™æ•°æ®åˆ° Channel ä¸­ã€‚æµçš„è¯»å†™é€šå¸¸æ˜¯å•å‘çš„ Channel ä¸­çš„æ•°æ®æ€»æ˜¯è¦å…ˆè¯»åˆ°ä¸€ä¸ª Buffer ä¸­ï¼Œæˆ–è€…ä» Buffer ä¸­å°†æ•°æ®å†™åˆ° Channel ä¸­ã€‚å› ä¸º Bufferï¼ŒChannel å¯ä»¥å¼‚æ­¥çš„è¯»å†™ 1.6 HashMap çš„ put () æ–¹æ³• ä¸ºä»€ä¹ˆè¦é‡å†™ hashCode æ–¹æ³•ï¼Ÿ ä¿è¯ç›¸åŒçš„å¯¹è±¡è¿”å›ç›¸åŒçš„ hash å€¼ï¼Œä¸åŒçš„å¯¹è±¡è¿”å›ä¸åŒçš„ hash å€¼ã€‚å’Œé‡å†™ equals ç±»ä¼¼ã€‚ hash ç®—æ³• 1234static final int hash(Object key) { int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);} h å³ç§» 16 ä½ï¼Œå‘ä¸‹ä¼ æ’­è¾ƒé«˜ä½çš„å½±å“ï¼Œå¼‚æˆ–æ˜¯åˆå¹¶è¿™äº›å½±å“ã€‚åº”ä¸ºåœ¨å°è¡¨ä¸­å¯èƒ½æ°¸è¿œç”¨ä¸åˆ°é«˜ä½ä¿¡æ¯ã€‚ 1.7 HashMap çš„ resize () æ–¹æ³• ä¸ºä»€ä¹ˆé“¾è¡¨å¤§å°è¶…è¿‡ 8 ä¸ªæ—¶ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œå½“åˆ é™¤å°äº 6 æ—¶é‡æ–°å˜ä¸ºé“¾è¡¨ï¼Ÿ æ ¹æ®æ³Šæ¾åˆ†å¸ƒï¼Œåœ¨è´Ÿè½½å› å­é»˜è®¤ä¸º 0.75 çš„æ—¶å€™ï¼Œå•ä¸ª hash æ§½å†…å…ƒç´ ä¸ªæ•°ä¸º 8 çš„æ¦‚ç‡å°äºç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼Œæ‰€ä»¥å°† 7 ä½œä¸ºä¸€ä¸ªåˆ†æ°´å²­ï¼Œç­‰äº 7 çš„æ—¶å€™ä¸è½¬æ¢ï¼Œå¤§äºç­‰äº 8 çš„æ—¶å€™æ‰è¿›è¡Œè½¬æ¢ï¼Œå°äºç­‰äº 6 çš„æ—¶å€™å°±åŒ–ä¸ºé“¾è¡¨ã€‚ loadFactor ä¸ºä»€ä¹ˆé»˜è®¤ä¸º 0.75ï¼Ÿ loadFactor åŠ è½½å› å­æ˜¯æ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦ï¼ŒloadFactor è¶Šè¶‹è¿‘äº 1ï¼Œé‚£ä¹ˆæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®ï¼ˆentryï¼‰ä¹Ÿå°±è¶Šå¤šã€è¶Šå¯†ï¼Œä¼šè®©é“¾è¡¨çš„é•¿åº¦å¢åŠ ï¼›loadFactor è¶Šå°ï¼Œä¹Ÿå°±æ˜¯è¶‹è¿‘äº 0ï¼Œæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®ï¼ˆentryï¼‰ä¹Ÿå°±è¶Šå°‘ï¼Œä¹Ÿå°±è¶Šç¨€ç–ã€‚ loadFactor å¤ªå¤§å¯¼è‡´æŸ¥æ‰¾å…ƒç´ æ•ˆç‡ä½ï¼Œå¤ªå°å¯¼è‡´æ•°ç»„çš„åˆ©ç”¨ç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®ä¼šå¾ˆåˆ†æ•£ã€‚loadFactor çš„é»˜è®¤å€¼ä¸º 0.75f æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸´ç•Œå€¼ã€‚ 1.8 HashMap è·å–æ‰€æœ‰çš„ Keyéå†è·å– HashMap ä¸­æ‰€æœ‰çš„ value æ—¶ï¼Œä½¿ç”¨éå† EntrySet çš„æ–¹æ³•æ¯”å…ˆå– KeySet å†å–å€¼å¿«ã€‚ 1234567HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;();Set&lt;String&gt; keySet = map.keySet(); // è·å–æ‰€æœ‰çš„ keySet&lt;Map.Entry&lt;String, String&gt;&gt; entrySet = map.entrySet(); // è·å–æ‰€æœ‰çš„ entryfor (Map.Entry&lt;String, String&gt; entry : entrySet) { String key = entry.getKey(); // å•ä¸ª entry çš„ key String value = entry.getValue(); // å•ä¸ª entry çš„ value} 1.9 ConcurrentHashMapConcurrentHashMap &amp; Hashtable JDK 1.8 ä¸­ï¼šé‡‡ç”¨äº† è‡ªæ—‹ + CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚è·Ÿ HashMap å¾ˆåƒï¼ŒæŠŠ Node ä¸­çš„ value å’Œ next ä½¿ç”¨ volatile ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ï¼Œå¹¶ä¸”ä¹Ÿå¼•å…¥äº†çº¢é»‘æ ‘ï¼Œåœ¨é“¾è¡¨å¤§äºä¸€å®šå€¼çš„æ—¶å€™ä¼šè½¬æ¢ï¼ˆé»˜è®¤æ˜¯ 8ï¼‰ã€‚ ConcurrentHashMap çš„ put æ“ä½œå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š æ ¹æ® key è®¡ç®—å‡º hashcode åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ï¼Œè‹¥éœ€è¦ï¼Œæ‰§è¡Œ initTable() å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸ å¦‚æœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1, åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ helpTransfer() å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ® å¦‚æœæ•°é‡å¤§äº TREEIFY_THRESHOLD åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ ConcurrentHashMap çš„åˆå§‹åŒ– initTable() æ˜¯é€šè¿‡è‡ªæ—‹å’Œ CAS æ“ä½œå®Œæˆçš„ã€‚é‡Œé¢éœ€è¦æ³¨æ„çš„æ˜¯å˜é‡ sizeCtl ï¼Œå®ƒçš„å€¼å†³å®šç€å½“å‰çš„åˆå§‹åŒ–çŠ¶æ€ã€‚ -1 è¯´æ˜æ­£åœ¨åˆå§‹åŒ– -N è¯´æ˜æœ‰ N-1 ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹ è¡¨ç¤º table åˆå§‹åŒ–å¤§å°ï¼Œå¦‚æœ table æ²¡æœ‰åˆå§‹åŒ– è¡¨ç¤º table å®¹é‡ï¼Œå¦‚æœ table å·²ç»åˆå§‹åŒ–ã€‚ 1.10 å†…éƒ¨ç±»æœ‰ä»€ä¹ˆä½œç”¨ å°è£…æ€§ ä½œä¸ºä¸€ä¸ªç±»çš„ç¼–å†™è€…ï¼Œå¾ˆæ˜¾ç„¶éœ€è¦å¯¹è¿™ä¸ªç±»çš„ä½¿ç”¨è®¿é—®è€…çš„è®¿é—®æƒé™åšå‡ºä¸€å®šçš„é™åˆ¶ï¼Œå°†ä¸€äº›æˆ‘ä»¬ä¸æ„¿æ„è®©åˆ«äººçœ‹åˆ°çš„æ“ä½œéšè—èµ·æ¥ï¼Œå¦‚æœæˆ‘ä»¬çš„å†…éƒ¨ç±»ä¸æƒ³è½»æ˜“è¢«ä»»ä½•äººè®¿é—®ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ private ä¿®é¥°å†…éƒ¨ç±»ï¼ˆå¯¹äºæ™®é€šç±»æ˜¯ä¸èƒ½ç”¨çš„ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ— æ³•é€šè¿‡åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•æ¥è®¿é—®ï¼Œæƒ³è¦è®¿é—®åªéœ€è¦åœ¨å¤–éƒ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª public ä¿®é¥°çš„æ–¹æ³•ï¼Œé—´æ¥è°ƒç”¨ã€‚ 123456789101112131415public interface Demo { void show();}class Outer { private class test implements Demo { public void show() { System.out.println(\"å¯†ç å¤‡ä»½æ–‡ä»¶\"); } } public Demo getInner() { return new test(); }} å®ç°å¤šç»§æ‰¿ Java æ˜¯ä¸å¯ä»¥å®ç°å¤šç»§æ‰¿çš„ï¼Œä¸€æ¬¡åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå¯ä»¥ç”¨æ¥å£æ¥å®ç°å¤šç»§æ‰¿çš„æ•ˆæœï¼Œå³ä¸€ä¸ªæ¥å£æœ‰å¤šä¸ªå®ç°ï¼Œä½†æ˜¯è¿™é‡Œä¹Ÿæ˜¯æœ‰ä¸€ç‚¹å¼Šç«¯çš„ï¼Œé‚£å°±æ˜¯ï¼Œä¸€æ—¦å®ç°ä¸€ä¸ªæ¥å£å°±å¿…é¡»å®ç°é‡Œé¢çš„æ‰€æœ‰æ–¹æ³•ï¼Œæœ‰æ—¶å€™å°±ä¼šå‡ºç°ä¸€äº›ç´¯èµ˜ï¼Œä½†æ˜¯ä½¿ç”¨å†…éƒ¨ç±»å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™äº›é—®é¢˜ã€‚ ç¼–å†™ä¸¤ä¸ªå¾…ç»§æ‰¿çš„ç±» Demo1 å’Œ Demo2ï¼Œåœ¨ MyDemo ç±»ä¸­ä¹¦å†™äº†ä¸¤ä¸ªå†…éƒ¨ç±»ï¼Œtest1 å’Œ test2 ä¸¤è€…åˆ†åˆ«ç»§æ‰¿äº† Demo1 å’Œ Demo2 ç±»ï¼Œè¿™æ · MyDemo ä¸­å°±é—´æ¥çš„å®ç°äº†å¤šç»§æ‰¿ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940 public class Demo1 { public String name() { return \"BWH_Steven\"; } } public class Demo2 { public String email() { return \"xxx.@163.com\"; } } public class MyDemo { private class test1 extends Demo1 { public String name() { return super.name(); } } private class test2 extends Demo2 { public String email() { return super.email(); } } public String name() { return new test1().name(); } public String email() { return new test2().email(); } public static void main(String args[]) { MyDemo md = new MyDemo(); System.out.println(\"æˆ‘çš„å§“å:\" + md.name()); System.out.println(\"æˆ‘çš„é‚®ç®±:\" + md.email()); }} 1.11 åˆ›å»ºå¯¹è±¡çš„å‡ ç§æ–¹å¼ ä½¿ç”¨ new å…³é”®å­—ï¼ˆæœ€å¸¸è§ï¼‰ ä½¿ç”¨ Class ç±»çš„ newInstance() æ–¹æ³•ï¼ˆåå°„ï¼‰ åªèƒ½è°ƒç”¨æ— å‚æ„é€ å‡½æ•°ï¼Œä¸èƒ½è°ƒç”¨ç§æœ‰çš„æ„é€ å‡½æ•° 123User user = (User)Class.forName(\"cn.morooi.User\").newInstance();// æˆ–User user = User.class.newInstance(); ä½¿ç”¨ Constructor ç±»çš„ newInstance() æ–¹æ³•ï¼ˆåå°„ï¼‰ 12Constructor constructor = Class.forName(\"cn.morooi.User\").getConstructor();User user = (User)constructor.newInstance() ä½¿ç”¨ clone() æ–¹æ³•ï¼ˆä¸ä¼šè°ƒç”¨ä»»ä½•æ„é€ å‡½æ•°ï¼‰ ååºåˆ—åŒ– 1.12 åŒäº²å§”æ´¾æœºåˆ¶åŒäº²å§”æ´¾æ¨¡å‹ åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚åŠ è½½çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæŠŠè¯¥è¯·æ±‚å§”æ´¾è¯¥çˆ¶ç±»åŠ è½½å™¨çš„ loadClass() å¤„ç†ï¼Œå› æ­¤æ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader ä¸­ã€‚å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•å¤„ç†æ—¶ï¼Œæ‰ç”±è‡ªå·±æ¥å¤„ç†ã€‚å½“çˆ¶ç±»åŠ è½½å™¨ä¸º null æ—¶ï¼Œä¼šä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader ä½œä¸ºçˆ¶ç±»åŠ è½½å™¨ã€‚ å¥½å¤„ï¼š åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº† Java ç¨‹åºçš„ç¨³å®šè¿è¡Œï¼Œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼ˆJVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»åï¼Œç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼‰ï¼Œä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹ã€‚ å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º java.lang.Object ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„ Object ç±»ã€‚ ä¸‰ä¸ª Classloaderï¼š BootstrapClassLoaderï¼ˆå¯åŠ¨ç±»åŠ è½½å™¨ï¼‰ï¼šæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C++ å®ç°ï¼Œè´Ÿè´£åŠ è½½ %JAVA_HOME%/lib ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»æˆ–è€…æˆ–è¢« -Xbootclasspath å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»ã€‚ ExtensionClassLoaderï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰ï¼šä¸»è¦è´Ÿè´£åŠ è½½ç›®å½• %JRE_HOME%/lib/ext ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ï¼Œæˆ–è¢« java.ext.dirs ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„ jar åŒ…ã€‚ AppClassLoaderï¼ˆåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼‰ï¼šé¢å‘ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ classpath ä¸‹çš„æ‰€æœ‰ jar åŒ…å’Œç±»ã€‚ 1.13 å®ç°åªè¯»é›†åˆCollections.unmodifiable...() å¯ä»¥å®ç°åªè¯»é›†åˆ 1234567891011121314151617181920import java.util.*; public class Main { public static void main(String[] argv) throws Exception { List stuff = Arrays.asList(new String[] { \"a\", \"b\" }); List list = new ArrayList(stuff); list = Collections.unmodifiableList(list); try { list.set(0, \"new value\"); } catch (UnsupportedOperationException e) { } Set set = new HashSet(stuff); set = Collections.unmodifiableSet(set); Map map = new HashMap(); map = Collections.unmodifiableMap(map); System.out.println(\"é›†åˆç°åœ¨æ˜¯åªè¯»\"); }} 1.14 æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ« æ¥å£æ–¹æ³•çš„é»˜è®¤ä¿®é¥°ç¬¦æ˜¯ publicï¼Œåœ¨ JDK 8 ä»¥å‰æ‰€æœ‰æ–¹æ³•åœ¨æ¥å£ä¸­ä¸èƒ½æœ‰å®ç°ã€‚JDK 8 ä¸­å¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ã€‚é™æ€æ–¹æ³•ç›´æ¥ç”¨æ¥å£åè°ƒç”¨ï¼Œå®ç°ç±»å’Œå®ç°æ˜¯ä¸å¯ä»¥è°ƒç”¨çš„ã€‚å¦‚æœåŒæ—¶å®ç°ä¸¤ä¸ªæ¥å£ï¼Œæ¥å£ä¸­å®šä¹‰äº†ä¸€æ ·çš„é»˜è®¤æ–¹æ³•ï¼Œåˆ™å¿…é¡»é‡å†™ã€‚ æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰ publicã€protected å’Œ default è¿™äº›ä¿®é¥°ç¬¦ï¼Œä¹Ÿå¯ä»¥æœ‰éæŠ½è±¡çš„æ–¹æ³•ã€‚ ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†åªèƒ½å®ç°ä¸€ä¸ªæŠ½è±¡ç±»ã€‚æ¥å£è‡ªå·±æœ¬èº«å¯ä»¥é€šè¿‡ extends å…³é”®å­—æ‰©å±•å¤šä¸ªæ¥å£ã€‚ æ¥å£ä¸­çš„å˜é‡åªèƒ½ç”¨ static final ä¿®é¥°ï¼Œä¸èƒ½æœ‰å…¶ä»–å˜é‡ï¼Œè€ŒæŠ½è±¡ç±»ä¸­åˆ™ä¸ä¸€å®šã€‚ ä»è®¾è®¡å±‚é¢æ¥è¯´ï¼ŒæŠ½è±¡æ˜¯å¯¹ç±»çš„æŠ½è±¡ï¼Œæ˜¯ä¸€ç§æ¨¡æ¿è®¾è®¡ï¼Œè€Œæ¥å£æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ï¼Œæ˜¯ä¸€ç§è¡Œä¸ºçš„è§„èŒƒã€‚ JDK 9 åœ¨æ¥å£ä¸­å¼•å…¥äº†ç§æœ‰æ–¹æ³•å’Œç§æœ‰é™æ€æ–¹æ³•ã€‚ 1.15 ç±»çš„ç”Ÿå‘½å‘¨æœŸã€ç±»åŠ è½½è¿‡ç¨‹ç±»çš„ç”Ÿå‘½å‘¨æœŸå’Œç±»åŠ è½½è¿‡ç¨‹ 1.16 å‡ ä¸ªå®¹å™¨çš„å£°æ˜123456789101112131415161718192021222324252627282930// ArrayListpublic class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable {...} // LinkedListpublic class LinkedList&lt;E&gt; extends AbstractSequentialList&lt;E&gt; implements List&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable {...}// HashMappublic class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable {...}// ConcurrentHashMappublic class ConcurrentHashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements ConcurrentMap&lt;K,V&gt;, Serializable {...}// HashTablepublic class Hashtable&lt;K,V&gt; extends Dictionary&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, java.io.Serializable {...}// CopyOnWriteArrayListpublic class CopyOnWriteArrayList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable {...}// HashSetpublic class HashSet&lt;E&gt; extends AbstractSet&lt;E&gt; implements Set&lt;E&gt;, Cloneable, java.io.Serializable {...} 1.17 StringBuilder å’Œ StringBuffer çš„åŒºåˆ«String StringBuffer å’Œ StringBuilder çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ StringBuilder ä¸ StringBuffer éƒ½ç»§æ‰¿è‡ª AbstractStringBuilder æŠ½è±¡ç±»ï¼Œåœ¨ AbstractStringBuilder ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸² char[]valueï¼Œä½†æ˜¯æ²¡æœ‰ç”¨ final å…³é”®å­—ä¿®é¥°ï¼Œæ‰€ä»¥è¿™ä¸¤ç§å¯¹è±¡éƒ½æ˜¯å¯å˜çš„ã€‚ StringBuilder ä¸ StringBuffer çš„æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°çš„ï¼ŒåŒºåˆ«åœ¨äº StringBuffer çš„æ–¹æ³•éƒ½ä½¿ç”¨ synchronized å…³é”®å­—ä¿®é¥°ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ 1.18 é”™è¯¯ä¸å¼‚å¸¸Java ä¸­æ‰€æœ‰çš„å¼‚å¸¸éƒ½ç»§æ‰¿äº java.lang.Throwable ç±»ã€‚Throwable æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±»ï¼šExceptionï¼ˆå¼‚å¸¸ï¼‰ å’Œ Errorï¼ˆé”™è¯¯ï¼‰ã€‚ é”™è¯¯ Errorï¼šæ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œè¡¨ç¤ºè¿è¡Œåº”ç”¨ç¨‹åºä¸­è¾ƒä¸¥é‡é—®é¢˜ã€‚å¤§å¤šæ•°é”™è¯¯ä¸ä»£ç ç¼–å†™è€…æ‰§è¡Œçš„æ“ä½œæ— å…³ï¼Œè€Œè¡¨ç¤ºä»£ç è¿è¡Œæ—¶ JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰å‡ºç°çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒJava è™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼ˆVirtual MachineErrorï¼‰ï¼Œå½“ JVM ä¸å†æœ‰ç»§ç»­æ‰§è¡Œæ“ä½œæ‰€éœ€çš„å†…å­˜èµ„æºæ—¶ï¼Œå°†å‡ºç° OutOfMemoryErrorã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJava è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚ å¼‚å¸¸ Exceptionï¼šæ˜¯ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ã€‚Exception ç±»æœ‰ä¸€ä¸ªé‡è¦çš„å­ç±» RuntimeExceptionã€‚RuntimeException å¼‚å¸¸ç”± Java è™šæ‹ŸæœºæŠ›å‡ºã€‚NullPointerExceptionï¼ˆè¦è®¿é—®çš„å˜é‡æ²¡æœ‰å¼•ç”¨ä»»ä½•å¯¹è±¡æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ï¼‰ã€ArithmeticExceptionï¼ˆç®—æœ¯è¿ç®—å¼‚å¸¸ï¼Œä¸€ä¸ªæ•´æ•°é™¤ä»¥ 0 æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ï¼‰å’Œ ArrayIndexOutOfBoundsExceptionï¼ˆä¸‹æ ‡è¶Šç•Œå¼‚å¸¸ï¼‰ å¼‚å¸¸å’Œé”™è¯¯çš„åŒºåˆ«ï¼šå¼‚å¸¸èƒ½è¢«ç¨‹åºæœ¬èº«å¤„ç†ï¼Œé”™è¯¯æ— æ³•å¤„ç† 1.19 String ç±»çš„ä¸€äº›ç”¨æ³• æ–°å»ºä¸€ä¸ª String å¯¹è±¡ 1234567String s1 = \"s\";String s2 = new String(\"s\"); // s2 == \"s\"char[] chars = {'a', 'b', 'c', 'd'};String s3 = new String(chars); // s3 == \"abcd\"String s4 = new String(chars, 1, 2); // s4 == \"bc\"byte[] bytes = new byte[]{65, 66};String s5 = new String(bytes); // s5 == \"AB\" å¸¸ç”¨æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738// æå–å­ä¸²String s = \"abcdef\";String s1 = s.substring(s, 2); // s1 == \"cdef\"String s2 = s.substring(s, 2, 4); // s2 == \"cd\"ï¼Œå·¦é—­å³å¼€åŒºé—´// å­—ç¬¦ä¸²è¿æ¥String s = \"aa\".concat(\"bb\").concat(\"cc\"); // s == \"aabbcc\", ç›¸å½“äº \"aa\" + \"bb\" + \"cc\"// æŸ¥æ‰¾å‚æ•°å­—ç¬¦ä¸²åœ¨æœ¬å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ä½ç½®ï¼Œæ²¡æœ‰è¿”å› -1String str = \"I am a good student\";int a = str.indexOf('a'); // a == 2int b = str.indexOf(\"good\"); // b == 7int c = str.indexOf(\"w\", 2); // c == -1ï¼Œè¯¥æ–¹æ³•ä»ç¬¬äºŒä¸ªå‚æ•°ä½ç½®å‘åæŸ¥æ‰¾int d = str.lastIndexOf(\"a\"); // d == 5ï¼Œè¯¥æ–¹æ³•ä»å­—ç¬¦ä¸²çš„æœ«å°¾ä½ç½®å‘å‰æŸ¥æ‰¾int e = str.lastIndexOf(\"a\", 3); // e == 2ï¼Œè¯¥æ–¹æ³•ä»ç¬¬äºŒä¸ªå‚æ•°ä½ç½®å‘å‰æŸ¥æ‰¾// è½¬æ¢public char[] toCharArray(); // å°†å½“å‰å­—ç¬¦ä¸²æ‹†åˆ†æˆä¸ºå­—ç¬¦æ•°ç»„ä½œä¸ºè¿”å›å€¼public byte[] getBytes(); // è·å–å½“å‰å­—ç¬¦ä¸²åº•å±‚çš„å­—èŠ‚æ•°ç»„public String toLowerCase(); //è¿”å›å°†å½“å‰å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—ç¬¦è½¬æ¢æˆå°å†™åçš„æ–°ä¸²public String toUpperCase(); //è¿”å›å°†å½“å‰å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—ç¬¦è½¬æ¢æˆå¤§å†™åçš„æ–°ä¸²// æ›¿æ¢// å°†æ‰€æœ‰å‡ºç°çš„è€å­—ç¬¦ä¸²æ›¿æ¢æˆä¸ºæ–°çš„å­—ç¬¦ä¸²ï¼Œè¿”å›æ›¿æ¢åçš„ç»“æœæ–°å­—ç¬¦ä¸²public String replace(CharSequence oldString, CharSequence newString);// ç”¨å­—ç¬¦ replacement çš„å†…å®¹æ›¿æ¢å½“å‰å­—ç¬¦ä¸²ä¸­é‡åˆ°çš„ç¬¬ä¸€ä¸ªå’Œå­—ç¬¦ä¸² regex ç›¸åŒ¹é…çš„å­ä¸²public String replaceFirst(String regex, String replacement);// ç”¨å­—ç¬¦ replacement çš„å†…å®¹æ›¿æ¢å½“å‰å­—ç¬¦ä¸²ä¸­é‡åˆ°çš„æ‰€æœ‰å’Œå­—ç¬¦ä¸²regexç›¸åŒ¹é…çš„å­ä¸²public String replaceAll(String regex, String replacement);// å»æ‰ç©ºæ ¼public String trim(); // å»æ‰é¦–å°¾çš„ç©ºæ ¼ï¼Œä¸­é—´çš„ä¸å¤„ç†str.replace(\" \", \"\"); // ä½¿ç”¨ replace() æ–¹æ³•å»æ‰æ‰€æœ‰ç©ºæ ¼ï¼ŒåŒ…æ‹¬é¦–å°¾ã€ä¸­é—´str.replaceAll(\" \", \"\"); // ä½¿ç”¨ replaceAll() æ–¹æ³•å»æ‰æ‰€æœ‰ç©ºæ ¼ï¼ŒåŒ…æ‹¬é¦–å°¾ã€ä¸­é—´str.replaceAll(\"\\\\s*\", \"\"); // ä½¿ç”¨ replaceAll() æ–¹æ³•å»æ‰æ‰€æœ‰ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰// åˆ†å‰²public String[] split(String regex); // æŒ‰ç…§å‚æ•°è§„åˆ™å°†å­—ç¬¦ä¸²åˆ‡åˆ†æˆè‹¥å¹²éƒ¨åˆ†ï¼Œè¿”å› String æ•°ç»„ å­—ç¬¦ä¸²ä¸åŸºæœ¬ç±»å‹çš„è½¬æ¢ 1234567891011121314151617// åŸºæœ¬ç±»å‹è½¬å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ String ç±»ä¸­çš„ valueOf() æ–¹æ³•public static String valueOf(char data[])public static String valueOf(char data[], int offset, int count)public static String valueOf(boolean b)public static String valueOf(char c)public static String valueOf(int i)public static String valueOf(long l)public static String valueOf(float f)public static String valueOf(double d)// å­—ç¬¦ä¸²è½¬åŸºæœ¬ç±»å‹ï¼Œä½¿ç”¨åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ä¸­çš„ parseXxx() æ–¹æ³•public static byte parseByte(String s)public static short parseShort(String s)public static int parseInt(String s)public static long parseLong(String s)public static float parseFloat(String s)public static double parseDouble(String s) 1.20 çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ åŒæ­¥å®¹å™¨ï¼šHashTable, Vector å¹¶å‘å®¹å™¨ï¼šConcurrentHashMap, CopyOnWriteArrayList, CopyOnWriteArraySet é˜Ÿåˆ—ï¼šConcurrentLinkedQueue, ConcurrentLinkedDeque é˜»å¡é˜Ÿåˆ—ï¼šArrayBlockingQueue, LinkedBlockingQueue, PriorityBlockingQueue, DelayQueue, SynchronousQueue 2 å¤šçº¿ç¨‹2.1 sleep ()ã€wait ()ã€join () çš„åŒºåˆ« sleep() æ˜¯çº¿ç¨‹çº¿ç¨‹ç±»ï¼ˆThreadï¼‰çš„æ–¹æ³•ï¼Œè°ƒç”¨ä¼šæš‚åœæ­¤çº¿ç¨‹æŒ‡å®šçš„æ—¶é—´ï¼Œä½†ç›‘æ§ä¾ç„¶ä¿æŒï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œåˆ°æ—¶é—´è‡ªåŠ¨æ¢å¤ã€‚ wait() æ˜¯ Object çš„æ–¹æ³•ï¼Œå¹¶ä¸”åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­ä½¿ç”¨ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯é”çš„æŒæœ‰è€…ï¼Œè¯¥æ–¹æ³•æŠ›å‡ºä¸€ä¸ª IllegalMonitorStateException å¼‚å¸¸ã€‚è°ƒç”¨ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¾…è°ƒç”¨ notify() / notifyAll() å”¤é†’æŒ‡å®šçš„çº¿ç¨‹æˆ–è€…æ‰€æœ‰çº¿ç¨‹åæ‰ä¼šè¿›å…¥é”æ± ï¼Œå†æ¬¡è·å¾—å¯¹è±¡é”æ‰ä¼šè¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚ join() æ˜¯çº¿ç¨‹çº¿ç¨‹ç±»ï¼ˆThreadï¼‰çš„æ–¹æ³•ï¼Œè°ƒç”¨ join() æ–¹æ³•ä¸ä¼šé‡Šæ”¾é”ï¼Œè°ƒç”¨çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ˆè½¬æ¢ä¸º TERMINATED çŠ¶æ€ï¼‰ sleep() æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¸”å¿…é¡»è¦æŒ‡å®šæ—¶é—´ï¼Œwait() æ–¹æ³•åˆ™åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥å—ä¸­ä½¿ç”¨ã€‚ 2.2 çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€Java çº¿ç¨‹åœ¨è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­çš„æŒ‡å®šæ—¶åˆ»åªå¯èƒ½å¤„äºä¸‹é¢ 6 ç§ä¸åŒçŠ¶æ€çš„å…¶ä¸­ä¸€ä¸ªçŠ¶æ€ã€‚ çº¿ç¨‹åœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¹¶ä¸æ˜¯å›ºå®šå¤„äºæŸä¸€ä¸ªçŠ¶æ€è€Œæ˜¯éšç€ä»£ç çš„æ‰§è¡Œåœ¨ä¸åŒçŠ¶æ€ä¹‹é—´åˆ‡æ¢ã€‚ 2.3 é”å‡çº§è§ï¼šsynchronize ä¸é” å…ˆä½¿ç”¨åå‘é”ä¼˜å…ˆåŒä¸€çº¿ç¨‹ç„¶åå†æ¬¡è·å–é”ï¼Œå¦‚æœå¤±è´¥ï¼Œå°±å‡çº§ä¸º CAS è½»é‡çº§é”ï¼Œå¦‚æœå¤±è´¥å°±ä¼šçŸ­æš‚è‡ªæ—‹ï¼Œé˜²æ­¢çº¿ç¨‹è¢«ç³»ç»ŸæŒ‚èµ·ã€‚æœ€åå¦‚æœä»¥ä¸Šéƒ½å¤±è´¥å°±å‡çº§ä¸ºé‡é‡çº§é”ã€‚ é” ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ åå‘é” åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·ã€‚ å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—ã€‚ é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—åœºæ™¯ã€‚ è½»é‡çº§é” ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚ å¦‚æœå§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€— CPUã€‚ è¿½æ±‚å“åº”æ—¶é—´ã€‚åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ã€‚ é‡é‡çº§é” çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€— CPUã€‚ çº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´ç¼“æ…¢ã€‚ è¿½æ±‚ååé‡ã€‚åŒæ­¥å—æ‰§è¡Œæ—¶é—´è¾ƒé•¿ã€‚ 2.4 çº¿ç¨‹ä¸ºä»€ä¹ˆæ¯”è¿›ç¨‹å¿«è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« è¿›ç¨‹æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œè€Œçº¿ç¨‹æ˜¯åœ¨è¿›ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ä¸ªä»»åŠ¡ã€‚ä»–ä»¬ä¸¤ä¸ªæœ¬è´¨çš„åŒºåˆ«æ˜¯æ˜¯å¦å•ç‹¬å æœ‰å†…å­˜åœ°å€ç©ºé—´åŠå…¶å®ƒç³»ç»Ÿèµ„æºï¼ˆæ¯”å¦‚ I/Oï¼‰ï¼š è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥è¿›ç¨‹é—´å­˜åœ¨å†…å­˜éš”ç¦»ï¼Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œæ•°æ®å…±äº«å¤æ‚ä½†æ˜¯åŒæ­¥ç®€å•ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ï¼›è€Œçº¿ç¨‹å…±äº«æ‰€å±è¿›ç¨‹å æœ‰çš„å†…å­˜åœ°å€ç©ºé—´å’Œèµ„æºï¼Œæ•°æ®å…±äº«ç®€å•ï¼Œä½†æ˜¯åŒæ­¥å¤æ‚ã€‚ è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å‡ºç°é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œä¸å½±å“ä¸»ç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§é«˜ï¼›ä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½å½±å“æ•´ä¸ªç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§è¾ƒä½ã€‚ è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ä¸ä»…éœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œè¿˜éœ€è¦èµ„æºçš„åˆ†é…å›æ”¶ä»¥åŠé¡µè°ƒåº¦ï¼Œå¼€é”€è¾ƒå¤§ï¼›çº¿ç¨‹åªéœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œå¼€é”€è¾ƒå°ã€‚ å¦å¤–ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯ï¼Œè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œå³ CPU åˆ†é…æ—¶é—´çš„å•ä½ ã€‚ 2.5 ä½¿ç”¨å¤šçº¿ç¨‹çš„å¥½å¤„å¤šè¿›ç¨‹çš„æ–¹å¼ä¹Ÿå¯ä»¥å®ç°å¹¶å‘ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ å¤šè¿›ç¨‹æ–¹å¼ç¡®å®å¯ä»¥å®ç°å¹¶å‘ï¼Œä½†ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š è¿›ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå¤æ‚ï¼Œè€Œçº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…±äº«èµ„æºï¼Œè¿™äº›èµ„æºåœ¨çº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå®¹æ˜“ã€‚ è¿›ç¨‹æ˜¯é‡é‡çº§çš„ï¼Œè€Œçº¿ç¨‹æ˜¯è½»é‡çº§çš„ï¼Œæ•…å¤šçº¿ç¨‹æ–¹å¼çš„ç³»ç»Ÿå¼€é”€æ›´å°ã€‚ 2.6 ä½¿ç”¨å¤šçº¿ç¨‹å¯èƒ½ä¼šå¸¦æ¥çš„é—®é¢˜å†…å­˜æ³„æ¼ æ­»é” çº¿ç¨‹ A æŒæœ‰èµ„æº 2ï¼Œçº¿ç¨‹ B æŒæœ‰èµ„æº 1ï¼Œä»–ä»¬åŒæ—¶éƒ½æƒ³ç”³è¯·å¯¹æ–¹çš„èµ„æºï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šäº’ç›¸ç­‰å¾…è€Œè¿›å…¥æ­»é”çŠ¶æ€ã€‚ æ­»é”å‘ç”Ÿçš„æ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šèµ„æº x çš„ä»»æ„ä¸€ä¸ªæ—¶åˆ»åªè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ å æœ‰ä¸”ç­‰å¾…ï¼šçº¿ç¨‹ 1 å æœ‰èµ„æº x çš„åŒæ—¶ç­‰å¾…èµ„æº y ï¼Œå¹¶ä¸é‡Šæ”¾ x ä¸å¯æŠ¢å ï¼šèµ„æº x ä¸€æ—¦è¢«çº¿ç¨‹ 1 å æœ‰ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½æŠ¢å  x å¾ªç¯ç­‰å¾…ï¼šçº¿ç¨‹ 1 æŒæœ‰ xï¼Œç­‰å¾… yï¼Œçº¿ç¨‹ 2 æŒæœ‰ yï¼Œç­‰å¾… xï¼Œå½“å…¨éƒ¨æ»¡è¶³æ—¶æ‰ä¼šæ­»é” é¿å…æ­»é”ï¼š ç ´åäº’æ–¥æ¡ä»¶ ï¼šè¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç ´åï¼Œå› ä¸ºæˆ‘ä»¬ç”¨é”æœ¬æ¥å°±æ˜¯æƒ³è®©ä»–ä»¬äº’æ–¥çš„ï¼ˆä¸´ç•Œèµ„æºéœ€è¦äº’æ–¥è®¿é—®ï¼‰ã€‚ ç ´åå æœ‰ä¸”ç­‰å¾… ï¼šä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰çš„èµ„æºã€‚ ç ´åä¸å¯æŠ¢å  ï¼šå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æºã€‚ ç ´åå¾ªç¯ç­‰å¾… ï¼šé æŒ‰åºç”³è¯·èµ„æºæ¥é¢„é˜²ã€‚æŒ‰æŸä¸€é¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾èµ„æºåˆ™ååºé‡Šæ”¾ã€‚ ä½¿ç”¨ tryLock æ–¹æ³•ï¼ˆReentrantLockã€ReentrantReadWriteLockï¼‰ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶å¯ä»¥é€€å‡ºé˜²æ­¢æ­»é”ã€‚ çº¿ç¨‹ä¸å®‰å…¨ 2.7 synchronized ä¸ Lock çš„åŒºåˆ« ç±»åˆ« synchronized Lock å­˜åœ¨å±‚æ¬¡ Java çš„å…³é”®å­—ï¼Œåœ¨ JVM å±‚é¢ä¸Š æ˜¯ä¸€ä¸ªç±» é”çš„é‡Šæ”¾ 1. å·²è·å–é”çš„çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ï¼Œé‡Šæ”¾é”2. çº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼ŒJVM ä¼šè®©çº¿ç¨‹é‡Šæ”¾é” å¿…é¡»åœ¨ finally ä¸­é‡Šæ”¾é”ï¼Œä¸ç„¶å®¹æ˜“é€ æˆçº¿ç¨‹æ­»é” é”çš„è·å– å‡è®¾ A çº¿ç¨‹è·å¾—é”ï¼ŒB çº¿ç¨‹ç­‰å¾…å¦‚æœ A çº¿ç¨‹é˜»å¡ï¼ŒB çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾… åˆ†æƒ…å†µè€Œå®šï¼ŒLock æœ‰å¤šä¸ªé”è·å–çš„æ–¹å¼å¤§è‡´å°±æ˜¯å¯ä»¥å°è¯•è·å¾—é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾… é”çŠ¶æ€ æ— æ³•åˆ¤æ–­ å¯ä»¥åˆ¤æ–­ é”ç±»å‹ å¯é‡å…¥ã€ä¸å¯ä¸­æ–­ã€éå…¬å¹³ å¯é‡å…¥ã€å¯åˆ¤æ–­ã€å¯å…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰ æ€§èƒ½ å°‘é‡åŒæ­¥ å¤§é‡åŒæ­¥ synchronized æœ‰ä»€ä¹ˆä¸è¶³ä¹‹å¤„ï¼Ÿ å¦‚æœä¸´ç•ŒåŒºæ˜¯åªè¯»æ“ä½œï¼Œå…¶å®å¯ä»¥å¤šçº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼Œä½†ä½¿ç”¨ synchronized çš„è¯ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ synchronized æ— æ³•çŸ¥é“çº¿ç¨‹æœ‰æ²¡æœ‰æˆåŠŸè·å–åˆ°é” ä½¿ç”¨ synchronizedï¼Œå¦‚æœä¸´ç•ŒåŒºå› ä¸º IO æˆ–è€… sleep æ–¹æ³•ç­‰åŸå› é˜»å¡äº†ï¼Œè€Œå½“å‰çº¿ç¨‹åˆæ²¡æœ‰é‡Šæ”¾é”ï¼Œå°±ä¼šå¯¼è‡´æ‰€æœ‰çº¿ç¨‹ç­‰å¾…ã€‚ Lock æ¥å£æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ å¯ä»¥ä½¿é”æ›´å…¬å¹³ å¯ä»¥ä½¿çº¿ç¨‹åœ¨ç­‰å¾…é”çš„æ—¶å€™å“åº”ä¸­æ–­ å¯ä»¥è®©çº¿ç¨‹å°è¯•è·å–é”ï¼Œå¹¶åœ¨æ— æ³•è·å–é”çš„æ—¶å€™ç«‹å³è¿”å›æˆ–è€…ç­‰å¾…ä¸€æ®µæ—¶é—´ å¯ä»¥åœ¨ä¸åŒçš„èŒƒå›´ï¼Œä»¥ä¸åŒçš„é¡ºåºè·å–å’Œé‡Šæ”¾é” æ•´ä½“ä¸Šæ¥è¯´ Lock æ˜¯ synchronized çš„æ‰©å±•ç‰ˆï¼ŒLock æä¾›äº†æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ï¼ˆtryLock æ–¹æ³•ï¼‰ã€å®šæ—¶çš„ï¼ˆtryLock å¸¦å‚æ–¹æ³•ï¼‰ã€å¯ä¸­æ–­çš„ï¼ˆlockInterruptiblyï¼‰ã€å¯å¤šæ¡ä»¶é˜Ÿåˆ—çš„ï¼ˆnewCondition æ–¹æ³•ï¼‰é”æ“ä½œã€‚å¦å¤– Lock çš„å®ç°ç±»åŸºæœ¬éƒ½æ”¯æŒéå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰å’Œå…¬å¹³é”ï¼Œsynchronized åªæ”¯æŒéå…¬å¹³é”ï¼Œå½“ç„¶ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéå…¬å¹³é”æ˜¯é«˜æ•ˆçš„é€‰æ‹©ã€‚ ReentrantLock ReentrantLock æ˜¯ Lock æ¥å£çš„ JDK é»˜è®¤å®ç°ï¼Œç‰¹ç‚¹ï¼š å¯é‡å…¥é” æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é” åœ¨ ReentrantLock çš„æ„é€ æ–¹æ³•é‡Œï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ª boolean ç±»å‹çš„å‚æ•°ï¼Œæ¥æŒ‡å®šå®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªå…¬å¹³é”ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³çš„ã€‚è¿™ä¸ªå‚æ•°ä¸€æ—¦å®ä¾‹åŒ–åå°±ä¸èƒ½ä¿®æ”¹ï¼Œåªèƒ½é€šè¿‡ isFair() æ–¹æ³•æ¥æŸ¥çœ‹ã€‚ æ˜¯æ’ä»–é”ï¼Œç‹¬å ä¸èƒ½å…±äº« ReentrantReadWriteLock ReentrantReadWriteLock æ˜¯ ReadWriteLock æ¥å£çš„ JDK é»˜è®¤å®ç°ï¼Œç‰¹ç‚¹ï¼š å¯é‡å…¥é” æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é” æ”¯æŒè¯»å†™é”ï¼Œåœ¨ â€œå†™â€ æ“ä½œçš„æ—¶å€™ï¼Œå…¶å®ƒçº¿ç¨‹ä¸èƒ½å†™ä¹Ÿä¸èƒ½è¯»ï¼Œç§°è¿™ç§ç°è±¡ä¸º â€œå†™é¥¥é¥¿â€ã€‚ StampedLock StampedLock æŠŠè¯»åˆ†ä¸ºäº†æ‚²è§‚è¯»å’Œä¹è§‚è¯»ï¼Œæ‚²è§‚è¯»å°±ç­‰ä»·äº ReadWriteLock çš„è¯»ï¼Œè€Œä¹è§‚è¯»åœ¨ä¸€ä¸ªçº¿ç¨‹å†™å…±äº«å˜é‡æ—¶ï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œä¹è§‚è¯»æ˜¯ä¸åŠ é”çš„ã€‚æ‰€ä»¥æ²¡é”è‚¯å®šæ˜¯æ¯”æœ‰é”çš„æ€§èƒ½å¥½ï¼Œè¿™æ ·çš„è¯åœ¨å¤§å¹¶å‘è¯»æƒ…å†µä¸‹æ•ˆç‡å°±æ›´é«˜äº†ã€‚StampedLock åœ¨è·å–é”å’Œä¹è§‚è¯»æ—¶ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª stampï¼Œè§£é”æ—¶éœ€è¦ä¼ å…¥è¿™ä¸ª stampï¼Œåœ¨ä¹è§‚è¯»æ—¶æ˜¯ç”¨æ¥éªŒè¯å…±äº«å˜é‡æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹å†™è¿‡ã€‚ 2.8 çº¿ç¨‹æ± æ¥è‡ªï¼šçº¿ç¨‹æ± åŸç† ä½¿ç”¨çº¿ç¨‹æ± ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š åˆ›å»º / é”€æ¯çº¿ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œçº¿ç¨‹æ± å¯ä»¥å¤ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ã€‚ æ§åˆ¶å¹¶å‘çš„æ•°é‡ã€‚å¹¶å‘æ•°é‡è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¶ˆè€—è¿‡å¤šï¼Œä»è€Œé€ æˆæœåŠ¡å™¨å´©æºƒã€‚ï¼ˆä¸»è¦åŸå› ï¼‰ å¯ä»¥å¯¹çº¿ç¨‹åšç»Ÿä¸€ç®¡ç†ã€‚ Java ä¸­çš„çº¿ç¨‹æ± é¡¶å±‚æ¥å£æ˜¯ Executor æ¥å£ï¼ŒThreadPoolExecutor æ˜¯è¿™ä¸ªæ¥å£çš„å®ç°ç±»ã€‚ å››ç§å¸¸è§çš„çº¿ç¨‹æ±  Executors ç±»ä¸­æä¾›çš„å‡ ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚ newFixedThreadPool 12345public static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());} æ ¸å¿ƒçº¿ç¨‹æ•°é‡å’Œæ€»çº¿ç¨‹æ•°é‡ç›¸ç­‰ï¼Œéƒ½æ˜¯ä¼ å…¥çš„å‚æ•° nThreadsï¼Œæ‰€ä»¥åªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œä¸èƒ½åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚ newSingleThreadExecutor 123456public static ExecutorService newSingleThreadExecutor() { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()));} æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼ˆcorePoolSize == maximumPoolSize == 1ï¼‰ï¼Œä½¿ç”¨äº† LinkedBlockingQueueï¼ˆå®¹é‡å¾ˆå¤§ï¼‰ï¼Œæ‰€ä»¥ï¼Œä¸ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ã€‚æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§å…ˆæ¥å…ˆæ‰§è¡Œçš„é¡ºåºæ‰§è¡Œã€‚å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹ä¸ç©ºé—²ï¼Œé‚£ä¹ˆæ–°æ¥çš„ä»»åŠ¡ä¼šå­˜å‚¨åœ¨ä»»åŠ¡é˜Ÿåˆ—é‡Œç­‰å¾…æ‰§è¡Œã€‚ newCachedThreadPool 12345public static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());} ä¸åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œçº¿ç¨‹æ± æœ€å¤§ä¸º Integer.MAX_VALUEã€‚å°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ° SynchronousQueue é˜Ÿåˆ—ã€‚å¦‚æœ SynchronousQueue å…¥åˆ—æˆåŠŸï¼Œç­‰å¾…è¢«å½“å‰è¿è¡Œçš„çº¿ç¨‹ç©ºé—²åæ‹‰å–æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹ï¼Œç„¶åä» SynchronousQueue æ‹‰å–ä»»åŠ¡å¹¶åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚å¦‚æœ SynchronousQueue å·²æœ‰ä»»åŠ¡åœ¨ç­‰å¾…ï¼Œå…¥åˆ—æ“ä½œå°†ä¼šé˜»å¡ã€‚ newScheduledThreadPool 123456789public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) { return new ScheduledThreadPoolExecutor(corePoolSize);}// class ScheduledThreadPoolExecutorpublic ScheduledThreadPoolExecutor(int corePoolSize) { super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue());} åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ çº¿ç¨‹æ± çš„å‚æ•° int corePoolSizeï¼šè¯¥çº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹æ•°æœ€å¤§å€¼ int maximumPoolSizeï¼šè¯¥çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ€»æ•°æœ€å¤§å€¼ã€‚(ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ + éæ ¸å¿ƒçº¿ç¨‹æ•°é‡) long keepAliveTimeï¼šéæ ¸å¿ƒçº¿ç¨‹é—²ç½®è¶…æ—¶æ—¶é•¿ã€‚ éæ ¸å¿ƒçº¿ç¨‹å¦‚æœå¤„äºé—²ç½®çŠ¶æ€è¶…è¿‡è¯¥å€¼ï¼Œå°±ä¼šè¢«é”€æ¯ã€‚ å¦‚æœè®¾ç½® allowCoreThreadTimeOut(true)ï¼Œåˆ™ä¼šä¹Ÿä½œç”¨äºæ ¸å¿ƒçº¿ç¨‹ã€‚ TimeUnit unitï¼škeepAliveTime çš„å•ä½ã€‚ BlockingQueue workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼Œç»´æŠ¤ç€ç­‰å¾…æ‰§è¡Œçš„ Runnable ä»»åŠ¡å¯¹è±¡ã€‚ ThreadFactory threadFactoryï¼šåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ ï¼Œç”¨äºæ‰¹é‡åˆ›å»ºçº¿ç¨‹ã€‚ RejectedExecutionHandler handlerï¼šæ‹’ç»å¤„ç†ç­–ç•¥ï¼Œçº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°å°±ä¼šé‡‡ç”¨æ‹’ç»å¤„ç†ç­–ç•¥ã€‚ æ ¸å¿ƒçº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¸­æœ‰ä¸¤ç±»çº¿ç¨‹ï¼Œæ ¸å¿ƒçº¿ç¨‹å’Œéæ ¸å¿ƒçº¿ç¨‹ã€‚æ ¸å¿ƒçº¿ç¨‹é»˜è®¤æƒ…å†µä¸‹ä¼šä¸€ç›´å­˜åœ¨äºçº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿è¿™ä¸ªæ ¸å¿ƒçº¿ç¨‹ä»€ä¹ˆéƒ½ä¸å¹²ï¼ˆé“é¥­ç¢—ï¼‰ï¼Œè€Œéæ ¸å¿ƒçº¿ç¨‹å¦‚æœé•¿æ—¶é—´çš„é—²ç½®ï¼Œå°±ä¼šè¢«é”€æ¯ï¼ˆä¸´æ—¶å·¥ï¼‰ã€‚ å¸¸ç”¨çš„å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š LinkedBlockingQueue é“¾å¼é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œé»˜è®¤å¤§å°æ˜¯ Integer.MAX_VALUEï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤§å°ã€‚ ArrayBlockingQueue æ•°ç»„é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œéœ€è¦æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ã€‚ SynchronousQueue åŒæ­¥é˜Ÿåˆ—ï¼Œå†…éƒ¨å®¹é‡ä¸º 0ï¼Œæ¯ä¸ª put æ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ª take æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚ DelayQueue å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´ ã€‚ å››ç§æ‹’ç»å¤„ç†ç­–ç•¥ï¼š ThreadPoolExecutor.AbortPolicyï¼šé»˜è®¤æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardPolicyï¼šä¸¢å¼ƒæ–°æ¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨ï¼ˆæœ€æ—§çš„ï¼‰çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚ ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚ çº¿ç¨‹æ± ä¸»è¦çš„ä»»åŠ¡å¤„ç†æµç¨‹ï¼š çº¿ç¨‹æ€»æ•°é‡ &lt; corePoolSizeï¼Œæ— è®ºçº¿ç¨‹æ˜¯å¦ç©ºé—²ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼ˆè®©æ ¸å¿ƒçº¿ç¨‹æ•°é‡å¿«é€Ÿè¾¾åˆ° corePoolSizeï¼Œåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°é‡ &lt; corePoolSize æ—¶ï¼‰ã€‚æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚ çº¿ç¨‹æ€»æ•°é‡ &gt;= corePoolSize æ—¶ï¼Œæ–°æ¥çš„çº¿ç¨‹ä»»åŠ¡ä¼šè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç„¶åç©ºé—²çš„æ ¸å¿ƒçº¿ç¨‹ä¼šä¾æ¬¡å»ç¼“å­˜é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ¥æ‰§è¡Œï¼ˆä½“ç°äº†çº¿ç¨‹å¤ç”¨ï¼‰ã€‚ å½“ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œè¯´æ˜è¿™ä¸ªæ—¶å€™ä»»åŠ¡å·²ç»å¤šåˆ°çˆ†æ£šï¼Œéœ€è¦ä¸€äº› â€œä¸´æ—¶å·¥â€ æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡äº†ã€‚äºæ˜¯ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚æ³¨æ„ï¼Œè¿™ä¸€æ­¥éœ€è¦è·å¾—å…¨å±€é”ã€‚ ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ï¼Œ ä¸”æ€»çº¿ç¨‹æ•°è¾¾åˆ°äº† maximumPoolSizeï¼Œåˆ™ä¼šé‡‡å–ä¸Šé¢æåˆ°çš„æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚ 3 JVM3.1 CMS æ”¶é›†å™¨æ¥è‡ªï¼šåƒåœ¾æ”¶é›†å™¨ã€G1 æ”¶é›†å™¨ CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚ CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚ ä»åå­—ä¸­çš„ Mark Sweep è¿™ä¸¤ä¸ªè¯å¯ä»¥çœ‹å‡ºï¼ŒCMS æ”¶é›†å™¨æ˜¯ä¸€ç§ â€œæ ‡è®° - æ¸…é™¤â€ ç®—æ³•å®ç°çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼šæš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚ å¹¶å‘æ ‡è®°ï¼šåŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚ é‡æ–°æ ‡è®°ï¼šé‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­ã€‚ å¹¶å‘æ¸…é™¤ï¼šå¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚ ä¸»è¦ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ ä¸»è¦ç¼ºç‚¹ï¼š å¯¹ CPU èµ„æºæ•æ„Ÿ æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ å®ƒä½¿ç”¨çš„ â€œæ ‡è®° - æ¸…é™¤â€ ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿ 3.2 G1 æ”¶é›†å™¨æ¥è‡ªï¼šåƒåœ¾æ”¶é›†å™¨ã€G1 æ”¶é›†å™¨ G1 (Garbage-First) æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨ã€‚ä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶ï¼Œè¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾. è¢«è§†ä¸º JDK1.7 ä¸­ HotSpot è™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ã€‚å®ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š å¹¶è¡Œä¸å¹¶å‘ï¼šG1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚ åˆ†ä»£æ”¶é›†ï¼šè™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚ ç©ºé—´æ•´åˆï¼šä¸ CMS çš„ â€œæ ‡è®° - æ¸…ç†â€ ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº â€œæ ‡è®° - æ•´ç†â€ ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäº â€œå¤åˆ¶â€ ç®—æ³•å®ç°çš„ã€‚ å¯é¢„æµ‹çš„åœé¡¿ï¼šè¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚ G1 ä¹‹å‰çš„ JVM å†…å­˜æ¨¡å‹ G1 æ”¶é›†å™¨çš„å†…å­˜æ¨¡å‹ G1 å †å†…å­˜ç»“æ„å †å†…å­˜ä¼šè¢«åˆ‡åˆ†æˆä¸ºå¾ˆå¤šä¸ªå›ºå®šå¤§å°åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ¯ä¸ªæ˜¯è¿ç»­èŒƒå›´çš„è™šæ‹Ÿå†…å­˜ã€‚ å †å†…å­˜ä¸­ä¸€ä¸ªåŒºåŸŸï¼ˆRegionï¼‰çš„å¤§å°å¯ä»¥é€šè¿‡ -XX:G1HeapRegionSize å‚æ•°æŒ‡å®šï¼Œå¤§å°åŒºé—´æœ€å° 1Mã€æœ€å¤§ 32Mï¼Œæ€»ä¹‹æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚ é»˜è®¤æŠŠå †å†…å­˜æŒ‰ç…§ 2048 ä»½å‡åˆ†ã€‚ G1 å †å†…å­˜åˆ†é…æ¯ä¸ª Region è¢«æ ‡è®°äº† Eã€Sã€O å’Œ Hï¼Œè¿™äº›åŒºåŸŸåœ¨é€»è¾‘ä¸Šè¢«æ˜ å°„ä¸º Edenï¼ŒSurvivor å’Œè€å¹´ä»£ã€‚ å­˜æ´»çš„å¯¹è±¡ä»ä¸€ä¸ªåŒºåŸŸè½¬ç§»ï¼ˆå³å¤åˆ¶æˆ–ç§»åŠ¨ï¼‰åˆ°å¦ä¸€ä¸ªåŒºåŸŸã€‚åŒºåŸŸè¢«è®¾è®¡ä¸ºå¹¶è¡Œæ”¶é›†åƒåœ¾ï¼Œå¯èƒ½ä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŒºåŸŸå¯ä»¥åˆ†é…åˆ° Edenï¼Œsurvivor å’Œè€å¹´ä»£ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ç¬¬å››ç§ç±»å‹ï¼Œè¢«ç§°ä¸ºå·¨å‹åŒºåŸŸï¼ˆHumongous Regionï¼‰ã€‚Humongous åŒºåŸŸæ˜¯ä¸ºäº†é‚£äº›å­˜å‚¨è¶…è¿‡ 50% æ ‡å‡† region å¤§å°çš„å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œå®ƒç”¨æ¥ä¸“é—¨å­˜æ”¾å·¨å‹å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ª H åŒºè£…ä¸ä¸‹ä¸€ä¸ªå·¨å‹å¯¹è±¡ï¼Œé‚£ä¹ˆ G1 ä¼šå¯»æ‰¾è¿ç»­çš„ H åˆ†åŒºæ¥å­˜å‚¨ã€‚ä¸ºäº†èƒ½æ‰¾åˆ°è¿ç»­çš„ H åŒºï¼Œæœ‰æ—¶å€™ä¸å¾—ä¸å¯åŠ¨ Full GCã€‚ G1 å›æ”¶æµç¨‹G1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼ˆç±»ä¼¼äº CMS æ”¶é›†å™¨ï¼‰ï¼š åˆå§‹æ ‡è®°ï¼šè¿™ä¸ªé˜¶æ®µæ˜¯ STW (Stop the World) çš„ï¼Œæ‰€æœ‰åº”ç”¨çº¿ç¨‹ä¼šè¢«æš‚åœï¼Œæ ‡è®°å‡ºä» GC Root å¼€å§‹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚ å¹¶å‘æ ‡è®°ï¼šä» GC Roots å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ï¼Œè€—æ—¶è¾ƒé•¿ã€‚å½“å¹¶å‘æ ‡è®°å®Œæˆåï¼Œå¼€å§‹æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰é˜¶æ®µ æœ€ç»ˆæ ‡è®°ï¼šæ ‡è®°é‚£äº›åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ï¼Œå°†è¢«å›æ”¶ã€‚ ç­›é€‰å›æ”¶ï¼šé¦–å…ˆå¯¹å„ä¸ª Regin çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸå¾…çš„ GC åœé¡¿æ—¶é—´æŒ‡å®šå›æ”¶è®¡åˆ’ï¼Œå›æ”¶ä¸€éƒ¨åˆ† Regionã€‚ G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region (è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥)ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™æ—¶é—´å†…å¯ä»¥å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ï¼ˆæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ï¼‰ã€‚ 3.3 Java å†…å­˜ä¸­å„éƒ¨åˆ†çš„å†…å®¹å‚è€ƒï¼šå¯èƒ½æ˜¯æŠŠ Java å†…å­˜åŒºåŸŸè®²çš„æœ€æ¸…æ¥šçš„ä¸€ç¯‡æ–‡ç«  çº¿ç¨‹å…±äº«çš„ å † Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚ æ–¹æ³•åŒº å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ è¿è¡Œæ—¶å¸¸é‡æ±  JDK1.7 å‰åœ¨æ–¹æ³•åŒºä¸­ï¼Œ1.7 åŠä¹‹ååœ¨ Java å †ä¸­çš„ä¸€å—åŒºåŸŸå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚ çº¿ç¨‹ç§æœ‰çš„ ç¨‹åºè®¡æ•°å™¨ å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° OutOfMemoryError çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚ ä¸¤ä¸ªä½œç”¨ï¼š å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ è™šæ‹Ÿæœºæ ˆ ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œè€Œæ¯ä¸ªæ ˆå¸§ä¸­éƒ½æ‹¥æœ‰ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ä¿¡æ¯ å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ã€‚ æœ¬åœ°æ–¹æ³•æ ˆ å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼Œè™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚ 3.4 æ°¸ä¹…ä»£ä¼šæœ‰åƒåœ¾å›æ”¶å—æ°¸ä¹…ä»£ä¹Ÿæ˜¯å¯ä»¥å›æ”¶çš„ï¼Œæ¡ä»¶æ˜¯ è¯¥ç±»çš„å®ä¾‹éƒ½è¢«å›æ”¶ åŠ è½½è¯¥ç±»çš„ classLoader å·²ç»è¢«å›æ”¶ è¯¥ç±»ä¸èƒ½é€šè¿‡åå°„è®¿é—®åˆ°å…¶æ–¹æ³•ï¼Œè€Œä¸”è¯¥ç±»çš„ java.lang.class æ²¡æœ‰è¢«å¼•ç”¨ å½“æ»¡è¶³è¿™ 3 ä¸ªæ¡ä»¶æ—¶ï¼Œæ˜¯å¯ä»¥å›æ”¶ï¼Œä½†å›ä¸å›æ”¶è¿˜å¾—çœ‹ JVMã€‚ 3.5 JDK 8 çš„é»˜è®¤åƒåœ¾å›æ”¶å™¨ä½¿ç”¨ java -XX:+PrintCommandLineFlags -version å¯ä»¥æŸ¥çœ‹ 123456java -XX:+PrintCommandLineFlags -version-XX:InitialHeapSize=268435456 -XX:MaxHeapSize=4294967296 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGCjava version \"1.8.0_231\"Java(TM) SE Runtime Environment (build 1.8.0_231-b11)Java HotSpot(TM) 64-Bit Server VM (build 25.231-b11, mixed mode) å…¶ä¸­ UseParallelGC è¡¨ç¤ºä½¿ç”¨ Parallel Scavenge + Parallel Old åƒåœ¾æ”¶é›†å™¨ã€‚ 3.6 JVM æ€ç»´å¯¼å›¾ 4 æ•°æ®åº“4.1 MyISAM ä¸ InnoDB çš„åŒºåˆ«MySQL 5.5 ç‰ˆä¹‹å‰ MyISAM æ˜¯é»˜è®¤æ•°æ®åº“å¼•æ“ï¼Œ5.5 ç‰ˆæœ¬åé»˜è®¤çš„å­˜å‚¨å¼•æ“ä¸º InnoDBã€‚ ä¸¤è€…çš„å¯¹æ¯”ï¼š æ˜¯å¦æ”¯æŒè¡Œçº§é” MyISAM åªæœ‰è¡¨çº§é” (table-level locking)ï¼Œè€Œ InnoDB æ”¯æŒè¡Œçº§é” (row-level locking) å’Œè¡¨çº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é” æ˜¯å¦æ”¯æŒäº‹åŠ¡å’Œå´©æºƒåçš„å®‰å…¨æ¢å¤ MyISAM å¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œæ¯æ¬¡æŸ¥è¯¢å…·æœ‰åŸå­æ€§ï¼Œå…¶æ‰§è¡Œé€Ÿåº¦æ¯” InnoDB ç±»å‹æ›´å¿«ï¼Œä½†æ˜¯ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚ä½†æ˜¯ InnoDB æä¾›äº‹åŠ¡æ”¯æŒäº‹åŠ¡ï¼Œå¤–éƒ¨é”®ç­‰é«˜çº§æ•°æ®åº“åŠŸèƒ½ã€‚å…·æœ‰äº‹åŠ¡ (commit)ã€å›æ»š (rollback) å’Œå´©æºƒä¿®å¤èƒ½åŠ› (crash recovery capabilities) çš„äº‹åŠ¡å®‰å…¨ (transaction-safe (ACID compliant)) å‹è¡¨ã€‚ æ˜¯å¦æ”¯æŒå¤–é”® MyISAM ä¸æ”¯æŒï¼ŒInnoDB æ”¯æŒã€‚ æ˜¯å¦æ”¯æŒ MVCC ä»… InnoDB æ”¯æŒã€‚åº”å¯¹é«˜å¹¶å‘äº‹åŠ¡ MVCC æ¯”å•çº¯çš„åŠ é”æ›´é«˜æ•ˆï¼ŒMVCC åªåœ¨ READ COMMITTED å’Œ REPEATABLE READ ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œï¼ŒMVCC å¯ä»¥ä½¿ç”¨ä¹è§‚é”å’Œæ‚²è§‚é”æ¥å®ç°ã€‚ 4.2 æ•°æ®åº“ç´¢å¼•ã€Šçˆ±ä¸Šé¢è¯•å®˜ã€‹ç³»åˆ— - æ•°æ®åº“ç´¢å¼• ç´¢å¼•çš„ä½¿ç”¨ MySQL çš„ç´¢å¼•æ˜¯æ€ä¹ˆåŠ é€ŸæŸ¥è¯¢çš„ï¼Ÿ æ•°æ®åº“ç´¢å¼•æ€»ç»“ 1 æ•°æ®åº“ç´¢å¼•æ€»ç»“ 2 åˆé€‚å»ºç´¢å¼•çš„å­—æ®µï¼š ä¸ä¸º NULL çš„å­—æ®µ è¢«é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µ è¢«ä½œä¸ºæ¡ä»¶æŸ¥è¯¢çš„å­—æ®µ è¢«ç»å¸¸é¢‘ç¹ç”¨äºè¿æ¥çš„å­—æ®µ ç»å¸¸éœ€è¦æ’åºçš„åˆ— ä¸åˆé€‚åˆ›å»ºç´¢å¼•çš„å­—æ®µï¼š è¢«é¢‘ç¹æ›´æ–°çš„å­—æ®µ ä¸è¢«ç»å¸¸æŸ¥è¯¢çš„å­—æ®µ ç‰¹å¤§å‹è¡¨çš„è¯ç»´æŠ¤å¼€é”€ä¼šå¾ˆå¤§ï¼Œä¸é€‚åˆå»ºç´¢å¼• å…¶ä»–æ³¨æ„ï¼š æ³¨æ„éµå®ˆæœ€å·¦å‰ç¼€åŸåˆ™ å°½å¯èƒ½çš„è€ƒè™‘å»ºç«‹è”åˆç´¢å¼•è€Œä¸æ˜¯å•åˆ—ç´¢å¼• æ³¨æ„é¿å…å†—ä½™ç´¢å¼• è€ƒè™‘åœ¨å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µä¸Šä½¿ç”¨å‰ç¼€ç´¢å¼•ä»£æ›¿æ™®é€šç´¢å¼• 4.3 SQL è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹è§ï¼šä¸€æ¡ sql è¯­å¥åœ¨ mysql ä¸­å¦‚ä½•æ‰§è¡Œçš„ 4.4 MySQL çš„é”æœºåˆ¶è§ï¼šMySQL é”æœºåˆ¶ç®€å•äº†è§£ä¸€ä¸‹ 4.5 MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶MVCC å’Œäº‹åŠ¡éš”ç¦»çº§åˆ«çš„å…³ç³» MySQL-InnoDB-MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ 4.6 delete , truncate, drop åˆ é™¤çš„åŒºåˆ«ç‰¹ç‚¹ deleteï¼š åˆ é™¤æŒ‡å®šæ•°æ®ï¼šdelete from test where username = 'abc' åˆ é™¤æ•´ä¸ªè¡¨ï¼šdelete * from test æˆ– delete from testï¼Œä»…åˆ é™¤è¡¨å†…çš„æ‰€æœ‰å†…å®¹ï¼Œä¿ç•™è¡¨çš„å®šä¹‰ï¼Œä¸é‡Šæ”¾ç©ºé—´ï¼Œå¯ä»¥å›æ»šæ¢å¤ã€‚ dropï¼šdrop è¡¨åï¼Œåˆ é™¤è¡¨ï¼Œå¹¶é‡Šæ”¾ç©ºé—´ï¼Œå°†è¡¨åˆ é™¤çš„ä¸€å¹²äºŒå‡€ã€‚ truncateï¼štruncate è¡¨åï¼Œåˆ é™¤è¡¨é‡Œçš„å†…å®¹ï¼Œå¹¶é‡Šæ”¾ç©ºé—´ï¼Œä½†è¡¨ç»“æ„åŠå…¶åˆ—ã€çº¦æŸã€ç´¢å¼•ç­‰ä¿æŒä¸å˜ã€‚ æ˜¯å¦å¯ä»¥æ¢å¤ï¼Ÿ delete è¯­å¥æ˜¯æ•°æ®åº“æ“ä½œè¯­è¨€ï¼ˆDMLï¼‰ï¼Œè¿™ä¸ªæ“ä½œä¼šæ”¾åˆ° rollback segement ä¸­ï¼Œäº‹åŠ¡æäº¤ä¹‹åæ‰ç”Ÿæ•ˆï¼Œå¯ä»¥å›æ»šã€‚ truncate å’Œ drop æ˜¯æ•°æ®åº“å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰ï¼Œæ“ä½œç«‹å³ç”Ÿæ•ˆï¼ŒåŸæ•°æ®ä¸æ”¾åˆ° rollback segment ä¸­ï¼Œä¸èƒ½å›æ»šã€‚ æ‰§è¡Œé€Ÿåº¦ï¼šdrop &gt; truncate &gt; delete 4.7 å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥ å†…è¿æ¥ï¼ˆinner joinï¼‰ï¼Œäº¤é›† 12345678select *from a_table a inner join b_table b on a.a_id = b.b_id;# æˆ–çœå» innerselect *from a_table a join b_table b on a.a_id = b.b_id; ä»¥ä¸Šè¯­å¥ç­‰ä»·äº 1234select *from a_table a, b_table bwhere a.a_id = b.b_id; å·¦å¤–è¿æ¥ï¼ˆå·¦è¿æ¥ï¼Œleft outer joinï¼‰ï¼Œå·®é›† 12345678select * from a_table a left outer join b_table b on a.a_id = b.b_id;# æˆ–çœå» outerselect * from a_table a left join b_table b on a.a_id = b.b_id; å·¦è¿æ¥ï¼Œå·¦è¡¨ï¼ˆa_tableï¼‰çš„è®°å½•å°†ä¼šå…¨éƒ¨è¡¨ç¤ºå‡ºæ¥ï¼Œè€Œå³è¡¨ï¼ˆb_tableï¼‰åªä¼šæ˜¾ç¤ºç¬¦åˆæœç´¢æ¡ä»¶çš„è®°å½•ï¼Œå³è¡¨è®°å½•ä¸è¶³çš„åœ°æ–¹å‡ä¸º NULLã€‚ å³å¤–è¿æ¥ï¼ˆå³è¿æ¥ï¼Œright outer joinï¼‰ï¼Œå·®é›† 12345678select * from a_table a right outer join b_table b on a.a_id = b.b_id;# æˆ–çœå» outerselect * from a_table a right join b_table b on a.a_id = b.b_id; ä¸å·¦è¿æ¥ç›¸åï¼Œå³è¿æ¥ï¼Œå·¦è¡¨ï¼ˆa_tableï¼‰åªä¼šæ˜¾ç¤ºç¬¦åˆæœç´¢æ¡ä»¶çš„è®°å½•ï¼Œè€Œå³è¡¨ï¼ˆb_tableï¼‰çš„è®°å½•å°†ä¼šå…¨éƒ¨è¡¨ç¤ºå‡ºæ¥ã€‚å·¦è¡¨è®°å½•ä¸è¶³çš„åœ°æ–¹å‡ä¸º NULLã€‚ å³è¿æ¥å¯ä»¥ä¸å·¦è¿æ¥ç­‰ä»·äº’æ¢ åˆå¹¶ï¼ˆunionï¼‰ï¼Œå¹¶é›† 123456789101112131415161718/*union è”åˆ åˆå¹¶: å°†å¤šæ¡æŸ¥è¯¢è¯­å¥çš„ç»“æœåˆå¹¶æˆä¸€ä¸ªç»“æœè¯­æ³•ï¼š æŸ¥è¯¢è¯­å¥1 union æŸ¥è¯¢è¯­å¥2 union ...*/SELECT *FROM employeesWHERE email LIKE '%a%'UNIONSELECT *FROM employeesWHERE department_id &gt; 90; union ç‰¹ç‚¹ï¼š è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢åˆ—æ•°æ˜¯ä¸€è‡´çš„ è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢çš„æ¯ä¸€åˆ—çš„ç±»å‹å’Œé¡ºåºæœ€å¥½ä¸€è‡´ union å…³é”®å­—é»˜è®¤å»é‡ï¼Œå¦‚æœä½¿ç”¨ union all å¯ä»¥åŒ…å«é‡å¤é¡¹ ç”¨äºè¦æŸ¥è¯¢çš„ç»“æœæ¥è‡ªäºå¤šä¸ªè¡¨ï¼Œä¸”å¤šä¸ªè¡¨æ²¡æœ‰ç›´æ¥çš„è¿æ¥å…³ç³»ï¼Œä½†æŸ¥è¯¢çš„ä¿¡æ¯ä¸€è‡´æ—¶ 4.8 MySQL ä¸­çš„å¸¸ç”¨å‡½æ•°123456789101112131415161718192021222324252627282930313233343536373839404142434445# èšåˆå‡½æ•°COUNT(col) # ç»Ÿè®¡æŸ¥è¯¢ç»“æœçš„è¡Œæ•°MIN(col) # æŸ¥è¯¢æŒ‡å®šåˆ—çš„æœ€å°å€¼MAX(col) # æŸ¥è¯¢æŒ‡å®šåˆ—çš„æœ€å¤§å€¼SUM(col) # æ±‚å’Œï¼Œè¿”å›æŒ‡å®šåˆ—çš„æ€»å’ŒAVG(col) # æ±‚å¹³å‡å€¼ï¼Œè¿”å›æŒ‡å®šåˆ—æ•°æ®çš„å¹³å‡å€¼# æ•°å€¼å‡½æ•°ABS(x) &nbsp;# è¿”å›xçš„ç»å¯¹å€¼BIN(x) &nbsp;# è¿”å›xçš„äºŒè¿›åˆ¶CEILING(x) &nbsp;# è¿”å›å¤§äºxçš„æœ€å°æ•´æ•°å€¼EXP(x) &nbsp;# è¿”å›å€¼eï¼ˆè‡ªç„¶å¯¹æ•°çš„åº•ï¼‰çš„xæ¬¡æ–¹FLOOR(x) &nbsp;# è¿”å›å°äºxçš„æœ€å¤§æ•´æ•°å€¼GREATEST(x1,x2,...,xn) &nbsp;# è¿”å›é›†åˆä¸­æœ€å¤§çš„å€¼LEAST(x1,x2,...,xn) &nbsp;# è¿”å›é›†åˆä¸­æœ€å°çš„å€¼LN(x) &nbsp;# è¿”å›xçš„è‡ªç„¶å¯¹æ•°LOG(x,y) &nbsp;# è¿”å›xçš„ä»¥yä¸ºåº•çš„å¯¹æ•°MOD(x,y) &nbsp;# è¿”å›x/yçš„æ¨¡ï¼ˆä½™æ•°ï¼‰PI() &nbsp;# è¿”å›piçš„å€¼ï¼ˆåœ†å‘¨ç‡ï¼‰RAND() &nbsp;# è¿”å›ï¼åˆ°ï¼‘å†…çš„éšæœºå€¼,å¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªå‚æ•°(ç§å­)ä½¿RAND()éšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆä¸€ä¸ªæŒ‡å®šçš„å€¼ROUND(x,y) &nbsp;# è¿”å›å‚æ•°xçš„å››èˆäº”å…¥çš„æœ‰yä½å°æ•°çš„å€¼TRUNCATE(x,y) &nbsp;# è¿”å›æ•°å­—xæˆªçŸ­ä¸ºyä½å°æ•°çš„ç»“æœ# å­—ç¬¦ä¸²å‡½æ•°LENGTH(s) &nbsp;# è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦CONCAT(s1, s2..., sn) &nbsp;# åˆå¹¶å­—ç¬¦ä¸²å‡½æ•°ï¼Œè¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªINSERT(str, x, y, instr) &nbsp;# å°†å­—ç¬¦ä¸²strä»ç¬¬xä½ç½®å¼€å§‹ï¼Œyä¸ªå­—ç¬¦é•¿çš„å­ä¸²æ›¿æ¢ä¸ºå­—ç¬¦ä¸²instrï¼Œè¿”å›ç»“æœLOWER(str) &nbsp;# å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå°å†™UPPER(str) &nbsp;# å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå¤§å†™LEFT(str, x) &nbsp;# è¿”å›å­—ç¬¦ä¸²strä¸­æœ€å·¦è¾¹çš„xä¸ªå­—ç¬¦RIGHT(str, x) &nbsp;# è¿”å›å­—ç¬¦ä¸²strä¸­æœ€å³è¾¹çš„xä¸ªå­—ç¬¦TRIM(str) &nbsp;# åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤ä¾§çš„ç©ºæ ¼REPLACE(sï¼Œs1ï¼Œs2) &nbsp;# ä½¿ç”¨å­—ç¬¦ä¸² s2 æ›¿æ¢å­—ç¬¦ä¸² s ä¸­æ‰€æœ‰çš„å­—ç¬¦ä¸² s1SUBSTRING(sï¼Œnï¼Œlen) &nbsp;# ä»å­—ç¬¦ä¸² s è¿”å›ä¸€ä¸ªé•¿åº¦åŒ len å­—ç¬¦ç›¸åŒçš„å­å­—ç¬¦ä¸²ï¼Œèµ·å§‹äºä½ç½® nREVERSE(str) &nbsp;# è¿”å›é¢ å€’å­—ç¬¦ä¸²strçš„ç»“æœ# æ—¶é—´å‡½æ•°CURDATE() / CURRENT_DATE() # ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå€¼CURTIME() / CURRENT_TIME() # ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¶é—´å€¼NOW() / SYSDATE() # ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´å€¼UNIX_TIMESTAMP() # è·å– UNIX æ—¶é—´æˆ³TIMETOSEC() # å°†æ—¶é—´å‚æ•°è½¬æ¢ä¸ºç§’æ•°SECTOTIME() # å°†ç§’æ•°è½¬æ¢ä¸ºæ—¶é—´ADDTIME() # æ—¶é—´åŠ æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šæ·»åŠ æŒ‡å®šçš„æ—¶é—´SUBTIME() # æ—¶é—´å‡æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šå‡å»æŒ‡å®šçš„æ—¶é—´ 5 åˆ†å¸ƒå¼5.1 åˆ†å¸ƒå¼æ¶æ„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç»å…¸åŸºç¡€ç†è®º ä¸‰æ­ªéè¦å¬æˆ‘è¯´å®Œåˆ†å¸ƒå¼æ‰è‚¯ç¡ 5.2 åˆ†å¸ƒå¼äº‹åŠ¡å°ç±³ - åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº† æ•–ä¸™ - åˆ†å¸ƒå¼äº‹åŠ¡ ä¸¤é˜¶æ®µæäº¤ / XA TCC (Try-Confirm-Cancel) æœ¬åœ°æ¶ˆæ¯è¡¨ å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ (æ¶ˆæ¯äº‹åŠ¡) 5.3 Spring Cloud æŠ€æœ¯å›¾ 6 Redisç¼“å­˜é›ªå´©ã€ç©¿é€ï¼Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´ å¦ˆå¦ˆå†ä¹Ÿä¸æ‹…å¿ƒæˆ‘é¢è¯•è¢« Redis é—®å¾—è„¸éƒ½ç»¿äº† 6.1 æ•°æ®åº“çš„åŒå†™ä¸€è‡´æ€§é—®é¢˜é¢è¯•å‰å¿…é¡»è¦çŸ¥é“çš„ Redis é¢è¯•é¢˜ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜ï¼ˆå¤šç”¨ï¼‰ æ­£å¸¸çš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼š å…ˆæ“ä½œæ•°æ®åº“ï¼ŒæˆåŠŸï¼› å†åˆ é™¤ç¼“å­˜ï¼Œä¹ŸæˆåŠŸï¼› å¦‚æœåŸå­æ€§è¢«ç ´åäº†ï¼š ç¬¬ä¸€æ­¥æˆåŠŸï¼ˆæ“ä½œæ•°æ®åº“ï¼‰ï¼Œç¬¬äºŒæ­¥å¤±è´¥ï¼ˆåˆ é™¤ç¼“å­˜ï¼‰ï¼Œä¼šå¯¼è‡´æ•°æ®åº“é‡Œæ˜¯æ–°æ•°æ®ï¼Œè€Œç¼“å­˜é‡Œæ˜¯æ—§æ•°æ®ã€‚ å¦‚æœç¬¬ä¸€æ­¥ï¼ˆæ“ä½œæ•°æ®åº“ï¼‰å°±å¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯ï¼ˆExceptionï¼‰ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ã€‚ å¦‚æœåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå‡ºç°æ•°æ®åº“ä¸ç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„æ¦‚ç‡ç‰¹åˆ«ä½ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼š ç¼“å­˜åˆšå¥½å¤±æ•ˆ çº¿ç¨‹ A æŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—ä¸€ä¸ªæ—§å€¼ çº¿ç¨‹ B å°†æ–°å€¼å†™å…¥æ•°æ®åº“ çº¿ç¨‹ B åˆ é™¤ç¼“å­˜ çº¿ç¨‹ A å°†æŸ¥åˆ°çš„æ—§å€¼å†™å…¥ç¼“å­˜ è¦è¾¾æˆä¸Šè¿°æƒ…å†µï¼Œè¿˜æ˜¯è¯´ä¸€å¥æ¦‚ç‡ç‰¹åˆ«ä½ï¼š å› ä¸ºè¿™ä¸ªæ¡ä»¶éœ€è¦å‘ç”Ÿåœ¨è¯»ç¼“å­˜æ—¶ç¼“å­˜å¤±æ•ˆï¼Œè€Œä¸”å¹¶å‘ç€æœ‰ä¸€ä¸ªå†™æ“ä½œã€‚è€Œå®é™…ä¸Šæ•°æ®åº“çš„å†™æ“ä½œä¼šæ¯”è¯»æ“ä½œæ…¢å¾—å¤šï¼Œè€Œä¸”è¿˜è¦é”è¡¨ï¼Œè€Œè¯»æ“ä½œå¿…éœ€åœ¨å†™æ“ä½œå‰è¿›å…¥æ•°æ®åº“æ“ä½œï¼Œè€Œåˆè¦æ™šäºå†™æ“ä½œæ›´æ–°ç¼“å­˜ï¼Œæ‰€æœ‰çš„è¿™äº›æ¡ä»¶éƒ½å…·å¤‡çš„æ¦‚ç‡åŸºæœ¬å¹¶ä¸å¤§ã€‚ åˆ é™¤ç¼“å­˜å¤±è´¥çš„è§£å†³æ€è·¯ï¼š å°†éœ€è¦åˆ é™¤çš„ key å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„ key ä¸æ–­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“ æ­£å¸¸æƒ…å†µæ˜¯è¿™æ ·çš„ï¼š å…ˆåˆ é™¤ç¼“å­˜ï¼ŒæˆåŠŸï¼› å†æ›´æ–°æ•°æ®åº“ï¼Œä¹ŸæˆåŠŸï¼› å¦‚æœåŸå­æ€§è¢«ç ´åäº†ï¼š ç¬¬ä¸€æ­¥æˆåŠŸï¼ˆåˆ é™¤ç¼“å­˜ï¼‰ï¼Œç¬¬äºŒæ­¥å¤±è´¥ï¼ˆæ›´æ–°æ•°æ®åº“ï¼‰ï¼Œæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®è¿˜æ˜¯ä¸€è‡´çš„ã€‚ å¦‚æœç¬¬ä¸€æ­¥ï¼ˆåˆ é™¤ç¼“å­˜ï¼‰å°±å¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯ï¼ˆExceptionï¼‰ï¼Œæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®è¿˜æ˜¯ä¸€è‡´çš„ã€‚ çœ‹èµ·æ¥æ˜¯å¾ˆç¾å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å¹¶å‘åœºæ™¯ä¸‹åˆ†æä¸€ä¸‹ï¼Œå°±çŸ¥é“è¿˜æ˜¯æœ‰é—®é¢˜çš„äº†ï¼š çº¿ç¨‹ A åˆ é™¤äº†ç¼“å­˜ çº¿ç¨‹ B æŸ¥è¯¢ï¼Œå‘ç°ç¼“å­˜å·²ä¸å­˜åœ¨ çº¿ç¨‹ B å»æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°æ—§å€¼ çº¿ç¨‹ B å°†æ—§å€¼å†™å…¥ç¼“å­˜ çº¿ç¨‹ A å°†æ–°å€¼å†™å…¥æ•°æ®åº“ æ‰€ä»¥ä¹Ÿä¼šå¯¼è‡´æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ å¹¶å‘ä¸‹è§£å†³æ•°æ®åº“ä¸ç¼“å­˜ä¸ä¸€è‡´çš„æ€è·¯ï¼š å°†åˆ é™¤ç¼“å­˜ã€ä¿®æ”¹æ•°æ®åº“ã€è¯»å–ç¼“å­˜ç­‰çš„æ“ä½œç§¯å‹åˆ°é˜Ÿåˆ—é‡Œè¾¹ï¼Œå®ç°ä¸²è¡ŒåŒ–ã€‚ ä¸¤ç§ç­–ç•¥å„è‡ªæœ‰ä¼˜ç¼ºç‚¹ï¼š å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ åœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¸å¦‚æ„ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¼˜å¼‚ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼ˆCache Aside Pattern è®¾è®¡æ¨¡å¼ï¼‰ åœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¼˜å¼‚ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¸å¦‚æ„ 6.2 RDB ä¸ AOFRDB ä¼˜ç‚¹ åªæœ‰ä¸€ä¸ªæ–‡ä»¶ dump.rdbï¼Œæ–¹ä¾¿æŒä¹…åŒ–ã€‚ å®¹ç¾æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚ æ€§èƒ½æœ€å¤§åŒ–ï¼Œfork å­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥ä½¿ IO æœ€å¤§åŒ–ã€‚ä½¿ç”¨å•ç‹¬å­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¿›è¡Œä»»ä½• IO æ“ä½œï¼Œä¿è¯äº† Redis çš„é«˜æ€§èƒ½ ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯” AOF çš„ å¯åŠ¨æ•ˆç‡ æ›´é«˜ã€‚ RDB ç¼ºç‚¹ æ•°æ®å®‰å…¨æ€§ä½ã€‚RDB æ˜¯é—´éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ä¹‹é—´ Redis å‘ç”Ÿæ•…éšœï¼Œä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼æ›´é€‚åˆæ•°æ®è¦æ±‚ä¸ä¸¥è°¨çš„æ—¶å€™ã€‚ AOF ä¼˜ç‚¹ æ•°æ®å®‰å…¨ï¼Œaof æŒä¹…åŒ–å¯ä»¥é…ç½® appendfsync å±æ€§ï¼Œæœ‰ alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡å‘½ä»¤æ“ä½œå°±è®°å½•åˆ° aof æ–‡ä»¶ä¸­ä¸€æ¬¡ã€‚ é€šè¿‡ append æ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡ redis-check-aof å·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ AOF æœºåˆ¶çš„ rewrite æ¨¡å¼ã€‚AOF æ–‡ä»¶æ²¡è¢« rewrite ä¹‹å‰ï¼ˆæ–‡ä»¶è¿‡å¤§æ—¶ä¼šå¯¹å‘½ä»¤ è¿›è¡Œåˆå¹¶é‡å†™ï¼‰ï¼Œå¯ä»¥åˆ é™¤å…¶ä¸­çš„æŸäº›å‘½ä»¤ï¼ˆæ¯”å¦‚è¯¯æ“ä½œçš„ flushallï¼‰ AOF ç¼ºç‚¹ AOF æ–‡ä»¶æ¯” RDB æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚ æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯” RDB å¯åŠ¨æ•ˆç‡ä½ã€‚ Redis çš„æ•°æ®æ¢å¤æœ‰ç€å¦‚ä¸‹çš„ä¼˜å…ˆçº§ å¦‚æœåªé…ç½® AOF ï¼Œé‡å¯æ—¶åŠ è½½ AOF æ–‡ä»¶æ¢å¤æ•°æ®ï¼› å¦‚æœåŒæ—¶é…ç½®äº† RDB å’Œ AOF ï¼Œå¯åŠ¨åªåŠ è½½ AOF æ–‡ä»¶æ¢å¤æ•°æ®ï¼› å¦‚æœåªé…ç½® RDBï¼Œå¯åŠ¨å°†åŠ è½½ dump æ–‡ä»¶æ¢å¤æ•°æ®ã€‚ æœ‰ AOF å°±ç”¨ AOFï¼Œæ²¡æœ‰å°± RDB 6.3 è·³è¡¨Redis â€” è·³è·ƒè¡¨ 6.4 Redis é›†ç¾¤å²ä¸Šæœ€å¼ºã€Œé›†ç¾¤ã€å…¥é—¨å®è·µæ•™ç¨‹ 6.5 Redis è¿‡æœŸ key çš„åˆ é™¤ç­–ç•¥ å®šæ—¶åˆ é™¤ï¼šåœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±å®šæ—¶å™¨ä»»åŠ¡ç«‹å³æ‰§è¡Œå¯¹åº”é”®çš„åˆ é™¤æ“ä½œã€‚ æƒ°æ€§åˆ é™¤ï¼šæ”¾ä»»é”®è¿‡æœŸä¸ç®¡ï¼Œä½†æ˜¯æ¯æ¬¡è·å–é”®æ—¶ï¼Œéƒ½æ£€æŸ¥å–å¾—çš„é”®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œå°±åˆ é™¤è¯¥é”®ï¼›å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œå°±è¿”å›è¯¥é”®ã€‚ å®šæœŸåˆ é™¤ï¼šå‘¨æœŸæ€§è½®è®­ Redis åº“ä¸­çš„æ—¶æ•ˆæ€§æ•°æ®ï¼Œé‡‡ç”¨éšæœºæŠ½å–çš„ç­–ç•¥ï¼Œåˆ©ç”¨è¿‡æœŸæ•°æ®å æ¯”çš„æ–¹å¼æ§åˆ¶åˆ é™¤é¢‘åº¦ã€‚ åˆ é™¤ç­–ç•¥ å†…å­˜å ç”¨ CPU å ç”¨ ç‰¹ç‚¹ å®šæ—¶åˆ é™¤ èŠ‚çº¦å†…å­˜ï¼Œæ— å ç”¨ ä¸åˆ†æ—¶æ®µå ç”¨ CPU èµ„æºï¼Œé¢‘åº¦é«˜ ç”¨æ—¶é—´æ¢ç©ºé—´ æƒ°æ€§åˆ é™¤ å†…å­˜å ç”¨ä¸¥é‡ å»¶æ—¶æ‰§è¡Œï¼ŒCPU åˆ©ç”¨ç‡é«˜ ç”¨ç©ºé—´æ¢æ—¶é—´ å®šæœŸåˆ é™¤ å†…å­˜å®šæœŸéšæœºæ¸…ç† æ¯ç§’èŠ±è´¹å›ºå®šçš„ CPU èµ„æºç»´æŠ¤å†…å­˜ éšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥ 6.6 å†…å­˜æ·˜æ±°æœºåˆ¶ volatile-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ volatile-lfuï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è¿‡æœŸå¯†é›†çš„é”®ä¸­ï¼Œä½¿ç”¨ LFU ç®—æ³•è¿›è¡Œåˆ é™¤ keyã€‚ allkeys-lfuï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œä½¿ç”¨ LFU ç®—æ³•ç§»é™¤æ‰€æœ‰çš„ keyã€‚ volatile-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸçš„é”®ä¸­ï¼Œéšæœºåˆ é™¤ä¸€ä¸ª keyã€‚ allkeys-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œéšæœºåˆ é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ª keyã€‚ volatile-ttlï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„ key ä¼˜å…ˆç§»é™¤ã€‚ noevictionï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚ 6.7 scan å‘½ä»¤ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10 ä¸‡ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ ä½¿ç”¨ keys æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚ä½†æ˜¯å®ƒæœ‰ä¸¤ä¸ªä¸»è¦çš„ç¼ºç‚¹ï¼š æ²¡æœ‰ offsetã€limit å‚æ•°ï¼Œä¸€æ¬¡æ€§åå‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ key keys ç®—æ³•æ˜¯éå†ç®—æ³•ï¼Œå¤æ‚åº¦æ˜¯ O (n)ï¼Œå¦‚æœå®ä¾‹ä¸­æœ‰åƒä¸‡çº§ä»¥ä¸Šçš„ keyï¼Œè¿™ä¸ªæŒ‡ä»¤å°±ä¼šå¯¼è‡´ Redis æœåŠ¡å¡é¡¿ï¼Œæ‰€æœ‰è¯»å†™ Redis çš„å…¶å®ƒçš„æŒ‡ä»¤éƒ½ä¼šè¢«å»¶åç”šè‡³ä¼šè¶…æ—¶æŠ¥é”™ï¼Œå› ä¸º Redis æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œé¡ºåºæ‰§è¡Œæ‰€æœ‰æŒ‡ä»¤ï¼Œå…¶å®ƒæŒ‡ä»¤å¿…é¡»ç­‰åˆ°å½“å‰çš„ keys æŒ‡ä»¤æ‰§è¡Œå®Œäº†æ‰å¯ä»¥ç»§ç»­ã€‚ scan ç›¸æ¯” keys å…·å¤‡æœ‰ä»¥ä¸‹ç‰¹ç‚¹: å¤æ‚åº¦è™½ç„¶ä¹Ÿæ˜¯ O (n)ï¼Œä½†æ˜¯å®ƒæ˜¯é€šè¿‡æ¸¸æ ‡åˆ†æ­¥è¿›è¡Œçš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ æä¾› limit å‚æ•°ï¼Œå¯ä»¥æ§åˆ¶æ¯æ¬¡è¿”å›ç»“æœçš„æœ€å¤§æ¡æ•° åŒ keys ä¸€æ ·ï¼Œå®ƒä¹Ÿæä¾›æ¨¡å¼åŒ¹é…åŠŸèƒ½ æœåŠ¡å™¨ä¸éœ€è¦ä¸ºæ¸¸æ ‡ä¿å­˜çŠ¶æ€ï¼Œæ¸¸æ ‡çš„å”¯ä¸€çŠ¶æ€å°±æ˜¯ scan è¿”å›ç»™å®¢æˆ·ç«¯çš„æ¸¸æ ‡æ•´æ•° è¿”å›çš„ç»“æœå¯èƒ½ä¼šæœ‰é‡å¤ï¼Œéœ€è¦å®¢æˆ·ç«¯å»é‡å¤ï¼Œè¿™ç‚¹éå¸¸é‡è¦ éå†çš„è¿‡ç¨‹ä¸­å¦‚æœæœ‰æ•°æ®ä¿®æ”¹ï¼Œæ”¹åŠ¨åçš„æ•°æ®èƒ½ä¸èƒ½éå†åˆ°æ˜¯ä¸ç¡®å®šçš„ å•æ¬¡è¿”å›çš„ç»“æœæ˜¯ç©ºçš„å¹¶ä¸æ„å‘³ç€éå†ç»“æŸï¼Œè€Œè¦çœ‹è¿”å›çš„æ¸¸æ ‡å€¼æ˜¯å¦ä¸º 0 scan æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº† ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ keys æŒ‡ä»¤é•¿ã€‚ 6.8 å¼‚æ­¥é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—å¼‚æ­¥é˜Ÿåˆ— Redis é€šè¿‡ list æ•°æ®ç»“æ„æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸»è¦ä½¿ç”¨åˆ°å¦‚ä¸‹å‘½ä»¤ï¼š lpush å’Œ rpush å…¥é˜Ÿåˆ— lpop å’Œ rpop å‡ºé˜Ÿåˆ— blpop å’Œ brpop é˜»å¡å¼å‡ºé˜Ÿåˆ— å½“é˜Ÿåˆ—é‡Œé¢æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œä½¿ç”¨ sleep é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯ sleep ä¼šå¯¼è‡´æ¶ˆæ¯çš„å¤„ç†å»¶è¿Ÿå¢åŠ ã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡ blpop / brpop æ¥é˜»å¡å¼è¯»å–é˜Ÿåˆ—ã€‚ blpop / brpop åœ¨é˜Ÿåˆ—æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œä¼šç«‹å³è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œä¸€æ—¦æ•°æ®åˆ°æ¥ï¼Œåˆ™ç«‹åˆ»é†’è¿‡æ¥ã€‚æ¶ˆæ¯çš„å»¶è¿Ÿå‡ ä¹ä¸ºé›¶ã€‚ å»¶è¿Ÿé˜Ÿåˆ— å¦‚ä¸‹åœºæ™¯ï¼š è®¢å•ä¸‹å•åè¶…è¿‡ä¸€å°æ—¶ç”¨æˆ·æœªæ”¯ä»˜ï¼Œéœ€è¦å…³é—­è®¢å• è®¢å•çš„è¯„è®ºå¦‚æœ 7 å¤©æœªè¯„ä»·ï¼Œç³»ç»Ÿéœ€è¦è‡ªåŠ¨äº§ç”Ÿä¸€æ¡è¯„è®º å¯ä»¥ä½¿ç”¨å»¶æ—¶é˜Ÿåˆ—ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯éœ€è¦å»¶è¿Ÿä¸€æ®µæ—¶é—´åæ‰§è¡Œã€‚Redis å¯é€šè¿‡ zset å®ç°ã€‚æƒ³è¦æ‰§è¡Œæ—¶é—´çš„æ—¶é—´æˆ³ä½œä¸º scoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸º key è°ƒç”¨ zadd æ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨ zrangebyscore æŒ‡ä»¤è·å– N ç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚ 6.9 Redis äº‹åŠ¡TO DO 7 Spring å…¨å®¶æ¡¶7.1 Spring ä¸­ä¾èµ–æ³¨å…¥çš„æ–¹å¼æµ…è°ˆ Spring ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨æ„é€ å™¨æ³¨å…¥ å¸¸è§çš„ä¸‰ç§æ³¨å…¥æ–¹å¼: field æ³¨å…¥ æ„é€ å™¨æ³¨å…¥ï¼ˆSpring æ¨èï¼‰ setter æ³¨å…¥ æ„é€ å™¨æ³¨å…¥çš„å¥½å¤„ï¼š ä¿è¯ä¾èµ–ä¸å¯å˜ï¼ˆfinal å…³é”®å­—ï¼‰ ä¿è¯ä¾èµ–ä¸ä¸ºç©ºï¼ˆçœå»äº†æˆ‘ä»¬å¯¹å…¶æ£€æŸ¥ï¼‰ ä¿è¯è¿”å›å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨ï¼‰çš„ä»£ç çš„æ—¶å€™æ˜¯å®Œå…¨åˆå§‹åŒ–çš„çŠ¶æ€ é¿å…äº†å¾ªç¯ä¾èµ–ï¼ˆå¦‚æœæœ‰å¾ªç¯ä¾èµ–ä¼šä¸»åŠ¨æé†’ï¼‰ æå‡äº†ä»£ç çš„å¯å¤ç”¨æ€§ 7.2 å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–TO DO 7.3 Spring IoC æµç¨‹TO DO 7.4 è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨æœ‰ä»€ä¹ˆåŒºåˆ«ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼Ÿ ä¸ Servlet ç›¸ä¼¼ï¼Œè¿‡æ»¤å™¨æ˜¯ä¸€äº› web åº”ç”¨ç¨‹åºç»„ä»¶ï¼Œå¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ª web åº”ç”¨ç¨‹åºä¸­ã€‚ä½†æ˜¯ä¸å…¶ä»– web åº”ç”¨ç»„ä»¶ä¸åŒçš„æ˜¯ï¼Œè¿‡æ»¤å™¨æ˜¯ â€œé“¾â€ åœ¨å®¹å™¨çš„å¤„ç†è¿‡ç¨‹ä¸­çš„ã€‚è¿™å°±æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨è¯·æ±‚è¾¾åˆ° Servlet ä¹‹å‰å¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œä¹Ÿå¯ä»¥åœ¨å“åº”ä¿¡æ¯è¿”å›åˆ°å®¢æˆ·ç«¯ä¹‹å‰å¯¹å…¶è¿›è¡Œæ‹¦æˆªã€‚è¿™ç§è®¿é—®ä½¿å¾—è¿‡æ»¤å™¨å¯ä»¥æ£€æŸ¥å¹¶ä¿®æ”¹è¯·æ±‚å’Œå“åº”çš„å†…å®¹ã€‚ ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ï¼Ÿ æ‹¦æˆªå™¨æ˜¯ AOP çš„ä¸€ç§å®ç°ç­–ç•¥ï¼Œç”¨äºåœ¨æŸä¸ªæ–¹æ³•æˆ–å­—æ®µè¢«è®¿é—®å‰å¯¹å®ƒè¿›è¡Œæ‹¦æˆªï¼Œç„¶ååœ¨å…¶ä¹‹å‰æˆ–ä¹‹ååŠ ä¸ŠæŸäº›æ“ä½œã€‚åŒ Filter ä¸€æ ·ï¼ŒInterceptor ä¹Ÿæ˜¯é“¾å¼è°ƒç”¨ã€‚æ¯ä¸ª Interceptor çš„è°ƒç”¨ä¼šä¾æ®å®ƒçš„å£°æ˜é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ä¸€èˆ¬æ¥è¯´æ‹¦æˆªå™¨å¯ä»¥ç”¨äºä»¥ä¸‹æ–¹é¢ ï¼š æ—¥å¿—è®°å½• ï¼šè®°å½•è¯·æ±‚ä¿¡æ¯çš„æ—¥å¿—ï¼Œä»¥ä¾¿è¿›è¡Œä¿¡æ¯ç›‘æ§ã€ä¿¡æ¯ç»Ÿè®¡ç­‰ æƒé™æ£€æŸ¥ ï¼šå¯¹ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œè®¤è¯ï¼Œæˆ–æˆæƒç­‰è¿›è¡Œæ£€æŸ¥ æ€§èƒ½ç›‘æ§ ï¼šé€šè¿‡æ‹¦æˆªå™¨åœ¨è¿›å…¥å¤„ç†å™¨å‰ååˆ†åˆ«è®°å½•å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œä»è€Œå¾—åˆ°è¯·æ±‚çš„å¤„ç†æ—¶é—´ é€šç”¨è¡Œä¸º ï¼šè¯»å– cookie å¾—åˆ°ç”¨æˆ·ä¿¡æ¯å¹¶å°†ç”¨æˆ·å¯¹è±¡æ”¾å…¥è¯·æ±‚å¤´ä¸­ï¼Œä»è€Œæ–¹ä¾¿åç»­æµç¨‹ä½¿ç”¨ åŒºåˆ«ï¼Ÿ ä¸¤è€…æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šè¿‡æ»¤å™¨æ˜¯åœ¨ Servlet è§„èŒƒä¸­å®šä¹‰çš„ï¼Œæ˜¯ç”± Servlet å®¹å™¨æ”¯æŒçš„ï¼Œåªèƒ½ç”¨äºè¿‡æ»¤è¯·æ±‚ï¼›æ‹¦æˆªå™¨æ˜¯åœ¨ Spring å®¹å™¨å†…çš„ï¼Œç”± Spring æ¡†æ¶æ”¯æŒã€‚ è¿‡æ»¤å™¨ä½œç”¨äºè¯·æ±‚åˆ°è¾¾ Servlet ä¹‹å‰ï¼Œåœ¨ Spring ä¸­ä¹Ÿå°±æ˜¯åœ¨ DispacherServlet ä¹‹å‰ã€‚ æ‹¦æˆªå™¨æœ€æ—©åªèƒ½ä½œç”¨äºè¯·æ±‚åˆ°è¾¾ Servlet ä¹‹åã€‚ æ‹¦æˆªå™¨ä½œä¸º Spring çš„ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ IOC å®¹å™¨è¿›è¡Œç®¡ç†ï¼Œè·å–å…¶ä¸­çš„å„ä¸ª bean å®ä¾‹ï¼Œå¯¹ Spring ä¸­çš„å„ç§èµ„æºã€å¯¹è±¡ï¼Œå¦‚ Service å¯¹è±¡ã€æ•°æ®æºã€äº‹åŠ¡ç®¡ç†ç­‰è¿›è¡Œè°ƒç”¨ï¼›è€Œè¿‡æ»¤å™¨åˆ™ä¸èƒ½ã€‚ æ€»çš„æ¥è¯´ï¼Œä¸¤è€…ä¸»è¦åœ¨å¦‚ä¸‹æ–¹é¢å­˜åœ¨ç€å·®å¼‚ ï¼š è¿‡æ»¤å™¨æ˜¯åŸºäºå‡½æ•°çš„å›è°ƒï¼Œè€Œæ‹¦æˆªå™¨æ˜¯åŸºäº Java åå°„æœºåˆ¶çš„ è¿‡æ»¤å™¨å¯ä»¥ä¿®æ”¹ Requestï¼Œè€Œæ‹¦æˆªå™¨åˆ™ä¸èƒ½ è¿‡æ»¤å™¨éœ€è¦åœ¨ Servlet å®¹å™¨ä¸­å®ç°ï¼Œæ‹¦æˆªå™¨å¯ä»¥é€‚ç”¨äº JavaEEã€JavaSE ç­‰å„ç§ç¯å¢ƒ æ‹¦æˆªå™¨å¯ä»¥è°ƒç”¨ IOC å®¹å™¨ä¸­çš„å„ç§ä¾èµ–ï¼Œè€Œè¿‡æ»¤å™¨ä¸èƒ½ è¿‡æ»¤å™¨åªèƒ½åœ¨è¯·æ±‚çš„å‰åä½¿ç”¨ï¼Œè€Œæ‹¦æˆªå™¨å¯ä»¥è¯¦ç»†åˆ°æ¯ä¸ªæ–¹æ³• Spring ä¸­çš„è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨ 7.5 Spring Boot è‡ªåŠ¨é…ç½®åŸç†TO DO 7.6 Spring IoC å®¹å™¨ä¸­ Bean çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä½•è®°å¿† Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ Bean çš„ç”Ÿå‘½å‘¨æœŸæ¦‚æ‹¬èµ·æ¥å°±æ˜¯ 4 ä¸ªé˜¶æ®µï¼š å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰ å±æ€§èµ‹å€¼ï¼ˆPopulateï¼‰ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ é”€æ¯ï¼ˆDestructionï¼‰ å®ä¾‹åŒ–ï¼šç¬¬ 1 æ­¥ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª bean å¯¹è±¡ï¼› å±æ€§èµ‹å€¼ï¼šç¬¬ 2 æ­¥ï¼Œä¸º bean è®¾ç½®ç›¸å…³å±æ€§å’Œä¾èµ–ï¼› åˆå§‹åŒ–ï¼šç¬¬ 3~7 æ­¥ï¼Œæ­¥éª¤è¾ƒå¤šï¼Œå…¶ä¸­ç¬¬ 5ã€6 æ­¥ä¸ºåˆå§‹åŒ–æ“ä½œï¼Œç¬¬ 3ã€4 æ­¥ä¸ºåœ¨åˆå§‹åŒ–å‰æ‰§è¡Œï¼Œç¬¬ 7 æ­¥åœ¨åˆå§‹åŒ–åæ‰§è¡Œï¼Œè¯¥é˜¶æ®µç»“æŸï¼Œæ‰èƒ½è¢«ç”¨æˆ·ä½¿ç”¨ï¼› é”€æ¯ï¼šç¬¬ 8~10 æ­¥ï¼Œç¬¬ 8 æ­¥ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„é”€æ¯ï¼ˆè¿˜æ²¡ä½¿ç”¨å‘¢ï¼‰ï¼Œè€Œæ˜¯å…ˆåœ¨ä½¿ç”¨å‰æ³¨å†Œäº†é”€æ¯çš„ç›¸å…³è°ƒç”¨æ¥å£ï¼Œä¸ºäº†åé¢ç¬¬ 9ã€10 æ­¥çœŸæ­£é”€æ¯ bean æ—¶å†æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ã€‚ 7.7 SpringMVC çš„å·¥ä½œæµç¨‹SpringMVC æ‰§è¡Œæµç¨‹åŠå·¥ä½œåŸç† 8 è®¡ç®—æœºç½‘ç»œ8.1 HTTP/1.1 ä¸ HTTP/2TO DO 8.2 HTTP çš„å¤´TO DO 9 Linux9.1 å¸¸ç”¨å‘½ä»¤æŸ¥çœ‹å‰©ä½™å†…å­˜ï¼šfree -h æ˜¾ç¤ºç›®å‰æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨ç©ºé—´åŠä½¿ç”¨æƒ…å½¢ï¼šdf -h æŸ¥çœ‹æŸä¸ªè·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼šdu -h --max-depth=1 . chown chmod mount tail cat 9.2 ä¿®æ”¹æ‰§è¡Œæƒé™é€šè¿‡ ls -lah å‘½ä»¤å¯ä»¥æŸ¥çœ‹æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚ ç¬¬ä¸€åˆ—çš„å†…å®¹çš„ä¿¡æ¯è§£é‡Šå¦‚ä¸‹ï¼š æ–‡ä»¶çš„ç±»å‹ï¼š dï¼š ä»£è¡¨ç›®å½• -ï¼š ä»£è¡¨æ–‡ä»¶ lï¼š ä»£è¡¨è½¯é“¾æ¥ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ window ä¸­çš„å¿«æ·æ–¹å¼ï¼‰ Linux ä¸­æƒé™åˆ†ä¸ºä»¥ä¸‹å‡ ç§ rï¼šä»£è¡¨æƒé™æ˜¯å¯è¯»ï¼Œr ä¹Ÿå¯ä»¥ç”¨æ•°å­— 4 è¡¨ç¤º wï¼šä»£è¡¨æƒé™æ˜¯å¯å†™ï¼Œw ä¹Ÿå¯ä»¥ç”¨æ•°å­— 2 è¡¨ç¤º xï¼šä»£è¡¨æƒé™æ˜¯å¯æ‰§è¡Œï¼Œx ä¹Ÿå¯ä»¥ç”¨æ•°å­— 1 è¡¨ç¤º æ–‡ä»¶å’Œç›®å½•æƒé™çš„åŒºåˆ«ï¼š å¯¹æ–‡ä»¶å’Œç›®å½•è€Œè¨€ï¼Œè¯»å†™æ‰§è¡Œè¡¨ç¤ºä¸åŒçš„æ„ä¹‰ã€‚ å¯¹äºæ–‡ä»¶ï¼š æƒé™åç§° å¯æ‰§è¡Œæ“ä½œ r å¯ä»¥ä½¿ç”¨ cat æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹ w å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„å†…å®¹ x å¯ä»¥å°†å…¶è¿è¡Œä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ å¯¹äºç›®å½•ï¼š æƒé™åç§° å¯æ‰§è¡Œæ“ä½œ r å¯ä»¥æŸ¥çœ‹ç›®å½•ä¸‹åˆ—è¡¨ w å¯ä»¥åˆ›å»ºå’Œåˆ é™¤ç›®å½•ä¸‹æ–‡ä»¶ x å¯ä»¥ä½¿ç”¨ cd è¿›å…¥ç›®å½• éœ€è¦æ³¨æ„çš„æ˜¯ï¼š è¶…çº§ç”¨æˆ·å¯ä»¥æ— è§†æ™®é€šç”¨æˆ·çš„æƒé™ï¼Œå³ä½¿æ–‡ä»¶ç›®å½•æƒé™æ˜¯ 000ï¼Œä¾æ—§å¯ä»¥è®¿é—®ã€‚ ä¿®æ”¹æ–‡ä»¶ / ç›®å½•çš„æƒé™çš„å‘½ä»¤ï¼šchmod ç¤ºä¾‹ï¼šä¿®æ”¹ aaa.txt çš„æƒé™ä¸ºæ–‡ä»¶æ‰€æœ‰è€…æœ‰å…¨éƒ¨æƒé™ï¼Œæ–‡ä»¶æ‰€æœ‰è€…æ‰€åœ¨çš„ç»„æœ‰è¯»å†™æƒé™ï¼Œå…¶ä»–ç”¨æˆ·åªæœ‰è¯»çš„æƒé™ã€‚ chmod u=rwx,g=rw,o=r aaa.txt æˆ–è€… chmod 764 aaa.txt 10 MyBatisMyBatis é¢è¯•å¸¸è§é—®é¢˜ 10.1 MyBatis æ€ä¹ˆé˜²æ­¢ SQL æ³¨å…¥MyBatis ä¸­ä½¿ç”¨ #{} é˜²æ­¢ SQL æ³¨å…¥ 1234567@ResultMap(\"BaseResultMap\")@Select(\"select * from user where username = #{username}\")User getUserByParas1(@Param(\"username\") String username);@ResultMap(\"BaseResultMap\")@Select(\"select * from user where username = ${username}\")List&lt;User&gt; getUserByParas2(@Param(\"username\") String username); #{} ä½¿ç”¨äº† PreparedStatement æ¥è¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åé€šè¿‡ set çš„æ–¹å¼å¯¹å ä½ç¬¦è¿›è¡Œè®¾ç½®ï¼Œè€Œ ${} åˆ™æ˜¯é€šè¿‡ Statement ç›´æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå½“æœ‰å‚æ•°æ—¶ç›´æ¥æ‹¼æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚ Mybatis ä¸­ä½¿ç”¨ #{} å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥ï¼Œ${} å¹¶ä¸èƒ½é˜²æ­¢ SQL æ³¨å…¥ Mybatis å®ç°é˜²æ­¢ SQL æ³¨å…¥çš„åŸç†æ˜¯è°ƒç”¨äº† JDBC ä¸­çš„ PreparedStatement æ¥è¿›è¡Œé¢„å¤„ç†ã€‚ 10.2 å®ä½“ç±»çš„å±æ€§åå’Œè¡¨ä¸­çš„å­—æ®µåä¸ä¸€æ ·æ€ä¹ˆåŠTO DO 10.3 ç¼“å­˜TO DO å…¶ä»–çº¢é»‘æ ‘çº¢é»‘æ ‘ç‰¹ç‚¹ æ¯ä¸ªèŠ‚ç‚¹éçº¢å³é»‘ æ ¹èŠ‚ç‚¹æ€»æ˜¯é»‘è‰²çš„ æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNIL èŠ‚ç‚¹ï¼‰ å¦‚æœèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼ˆåä¹‹ä¸ä¸€å®šï¼‰ ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æˆ–ç©ºå­èŠ‚ç‚¹çš„æ¯æ¡è·¯å¾„ï¼Œå¿…é¡»åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆå³ç›¸åŒçš„é»‘è‰²é«˜åº¦ï¼‰ çº¢é»‘æ ‘çš„åº”ç”¨ TreeMapã€TreeSet ä»¥åŠ JDK1.8 çš„ HashMapã€ConcurrentHashMap åº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨çº¢é»‘æ ‘ï¼Ÿ ç®€å•æ¥è¯´çº¢é»‘æ ‘å°±æ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¼ºé™·ï¼Œå› ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘åœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€€åŒ–æˆä¸€ä¸ªçº¿æ€§ç»“æ„ã€‚ å›¾è§£çº¢é»‘æ ‘ æ’åºç®—æ³• æ’åºç®—æ³• å¹³å‡æ—¶é—´å¤æ‚åº¦ æœ€åæ—¶é—´å¤æ‚åº¦ æœ€å¥½æ—¶é—´å¤æ‚åº¦ ç©ºé—´å¤æ‚åº¦ ç¨³å®šæ€§ å†’æ³¡æ’åº O(nÂ²) O(nÂ²) O(n) O(1) ç¨³å®š ç›´æ¥é€‰æ‹©æ’åº O(nÂ²) O(nÂ²) O(nÂ²) O(1) ä¸ç¨³å®š ç›´æ¥æ’å…¥æ’åº O(nÂ²) O(nÂ²) O(n) O(1) ç¨³å®š å¿«é€Ÿæ’åº O(nlogn) O(nÂ²) O(nlogn) O(nlogn) ä¸ç¨³å®š å †æ’åº O(nlogn) O(nlogn) O(nlogn) O(1) ä¸ç¨³å®š å¸Œå°”æ’åº O(nlogn) O(nÂ²) O(n) O(1) ä¸ç¨³å®š å½’å¹¶æ’åº O(nlogn) O(nlogn) O(nlogn) O(n) ç¨³å®š è®¡æ•°æ’åº O(n+k) O(n+k) O(n+k) O(n+k) ç¨³å®š åŸºæ•°æ’åº O(N*M) O(N*M) O(N*M) O(M) ç¨³å®š æ³¨ï¼šåŸºæ•°æ’åºæ—¶é—´å¤æ‚åº¦ä¸º O (N*M)ï¼Œå…¶ä¸­ N ä¸ºæ•°æ®ä¸ªæ•°ï¼ŒM ä¸ºæ•°æ®ä½æ•°ã€‚ ç›´æ¥é€‰æ‹©æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸åˆå§‹åºåˆ—æ— å…³ï¼Œéƒ½ä¸º O (nÂ²) è¾…åŠ©è®°å¿† æ—¶é—´å¤æ‚åº¦è®°å¿† å†’æ³¡ã€é€‰æ‹©ã€æ’å…¥æ’åºéœ€è¦ä¸¤ä¸ª for å¾ªç¯ï¼Œæ¯æ¬¡åªå…³æ³¨ä¸€ä¸ªå…ƒç´ ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O (nÂ²)ï¼ˆä¸€éæ‰¾å…ƒç´  O (n)ï¼Œä¸€éæ‰¾ä½ç½® O (n)ï¼‰ å¿«é€Ÿã€å½’å¹¶ã€å¸Œå°”ã€å †åŸºäºäºŒåˆ†æ€æƒ³ï¼Œlog ä»¥ 2 ä¸ºåº•ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O (nlogn)ï¼ˆä¸€éæ‰¾å…ƒç´  O (n)ï¼Œä¸€éæ‰¾ä½ç½® O (logn)ï¼‰ ç¨³å®šæ€§è®°å¿† å¿«é€Ÿæ’åºã€å¸Œå°”æ’åºã€é€‰æ‹©æ’åºã€å †æ’åºï¼Œä¸ç¨³å®š â€œå¿«å¸Œé€‰å †â€ï¼ˆå¿«ç‰ºç‰²ç¨³å®šæ€§ï¼‰ å¿«é€Ÿæ’åºæ˜¯æœ€å¿«çš„é€šç”¨æ’åºç®—æ³•ï¼Œå®ƒçš„å†…å¾ªç¯çš„æŒ‡ä»¤å¾ˆå°‘ï¼Œè€Œä¸”å®ƒè¿˜èƒ½åˆ©ç”¨ç¼“å­˜ï¼Œå› ä¸ºå®ƒæ€»æ˜¯é¡ºåºåœ°è®¿é—®æ•°æ®ã€‚å®ƒçš„è¿è¡Œæ—¶é—´è¿‘ä¼¼ä¸ºï½cNlogNï¼Œè¿™é‡Œçš„ c æ¯”å…¶å®ƒçº¿æ€§å¯¹æ•°çº§åˆ«çš„æ’åºç®—æ³•éƒ½è¦å°ã€‚ ä½¿ç”¨ä¸‰å‘åˆ‡åˆ†å¿«é€Ÿæ’åºï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½å‡ºç°çš„æŸäº›åˆ†å¸ƒçš„è¾“å…¥èƒ½å¤Ÿè¾¾åˆ°çº¿æ€§çº§åˆ«ï¼Œè€Œå…¶å®ƒæ’åºç®—æ³•ä»ç„¶éœ€è¦çº¿æ€§å¯¹æ•°æ—¶é—´ã€‚ æ’åºç®—æ³•çš„æ¯”è¾ƒ æ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦ã€ç©ºé—´å¤æ‚åº¦ã€ç¨³å®šæ€§æ¯”è¾ƒ LRU ç®—æ³•LRU åŸç†å’Œ Redis å®ç° 12345678910111213141516171819import java.util.LinkedHashMap;import java.util.Map;public class LRU&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; { private final int CACHE_SIZE; public LRU(int cacheSize) { // true è¡¨ç¤ºæŒ‰è®¿é—®é¡ºåºæ’åºï¼Œæœ€è¿‘è®¿é—®æ”¾åœ¨å¤´éƒ¨ï¼Œæœ€è€è®¿é—®æ”¾åœ¨å°¾éƒ¨ super((int)Math.ceil(cacheSize / 0.75) + 1, 0.75f, true); CACHE_SIZE = cacheSize; } @Override protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) { // å½“å®¹é‡å¤§äºè®¾å®šå¥½çš„ cache size æ—¶åˆ é™¤æœ€æ—©çš„èŠ‚ç‚¹ return size() &gt; CACHE_SIZE; }} è®¾è®¡æ¨¡å¼å›¾è¯´è®¾è®¡æ¨¡å¼ é¢è¯•å®˜ï¼šâ€œè°ˆè°ˆ Spring ä¸­éƒ½ç”¨åˆ°äº†é‚£äº›è®¾è®¡æ¨¡å¼ï¼Ÿâ€ å•ä¾‹æ¨¡å¼å¥½å¤„ï¼š å¯¹äºé¢‘ç¹ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥çœç•¥åˆ›å»ºå¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™å¯¹äºé‚£äº›é‡é‡çº§å¯¹è±¡è€Œè¨€ï¼Œæ˜¯éå¸¸å¯è§‚çš„ä¸€ç¬”ç³»ç»Ÿå¼€é”€ ç”±äº new æ“ä½œçš„æ¬¡æ•°å‡å°‘ï¼Œå› è€Œå¯¹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿä¼šé™ä½ï¼Œè¿™å°†å‡è½» GC å‹åŠ›ï¼Œç¼©çŸ­ GC åœé¡¿æ—¶é—´ã€‚ 1ã€é¥¿æ±‰å¼ï¼šå…¨å±€çš„å•ä¾‹å®ä¾‹åœ¨ç±»è£…è½½æ—¶æ„å»ºï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ 1234567891011public class Singleton { private static final Singleton INSTANCE = new Singleton(); // ç”¨æˆ·æ— æ³•é€šè¿‡ new æ–¹æ³•åˆ›å»ºè¯¥å¯¹è±¡å®ä¾‹ private Singleton() { } public static Singleton getInstence() { return INSTANCE; }} 2ã€æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ 12345678910111213public class Singleton { private static Singleton instance; private Singleton() { } public static Singleton getInstance() { if (instance == null) { instance = new Singleton(); } return instance; }} 3ã€æ‡’æ±‰å¼ï¼šåŒé‡æ£€æŸ¥ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ 123456789101112131415161718public class Singleton { // volatileä¿è¯å½“ instance å˜é‡è¢«åˆå§‹åŒ–æˆ Singleton å®ä¾‹æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥æ­£ç¡®å¤„ç† instance å˜é‡ private volatile static Singleton instance; private Singleton() { } public static Singleton getInstance() { if (instance == null) { synchronized (Singleton.class) { if (instance == null) { instance = new Singleton(); } } } return instance; }} 4ã€æ‡’æ±‰å¼ï¼šé™æ€å†…éƒ¨ç±»ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ 12345678910111213public class Singleton { private Singleton() { } private static class SingletonHolder { private static final Singleton INSTANCE = new Singleton(); } public static Singleton getInstance() { return SingletonHolder.INSTANCE; }} 5ã€æšä¸¾ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½é˜²æ­¢ååºåˆ—åŒ–å¯¼è‡´é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ï¼‰ 123public enum Singleton{ INSTANCE;} å·¥å‚æ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼æ±‚æœ€å¤§å…¬çº¦æ•°å’Œæœ€å°å…¬å€æ•°æœ€å¤§å…¬çº¦æ•° GCDï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * é€’å½’æ±‚æœ€å¤§å…¬çº¦æ•° */public int GCD(int a, int b) { if (b == 0) { return a; } return GCD(b, a % b);}/** * è¾—è½¬ç›¸é™¤æ³•æ±‚æœ€å¤§å…¬çº¦æ•° * æœ‰ä¸¤æ•´æ•° a å’Œ bï¼š * 1. a % b å¾—ä½™æ•° c * 2. è‹¥ c = 0ï¼Œåˆ™ b å³ä¸ºä¸¤æ•°çš„æœ€å¤§å…¬çº¦æ•° * 3. è‹¥ c != 0ï¼Œåˆ™ a = bï¼Œb = cï¼Œå†å›å»æ‰§è¡Œ 1 */public int divisionGCD(int a, int b) { int c; while (b != 0) { c = a % b; a = b; b = c; } return a;}/** * ç›¸å‡æ³•æ±‚æœ€å¤§å…¬çº¦æ•° * æœ‰ä¸¤æ•´æ•° a å’Œ bï¼š * 1. è‹¥ a &gt; bï¼Œåˆ™ a = a - b * 2. è‹¥ a &lt; bï¼Œåˆ™ b = b - a * 3. è‹¥ a = bï¼Œåˆ™ aï¼ˆæˆ– bï¼‰å³ä¸ºä¸¤æ•°çš„æœ€å¤§å…¬çº¦æ•° * 4. è‹¥ a != bï¼Œåˆ™å†å›å»æ‰§è¡Œ 1 */public int subtractionGCD(int a, int b) { while (a != b) { if (a &gt; b) { a = a - b; } else { b = b - a; } } return a;} æœ€å°å…¬å€æ•° LCMï¼š 123public int LCM(int a, int b) { return a * b / GCD(a, b);} å¤šçº¿ç¨‹ç¼–ç¨‹ç”¨ä¸‰ä¸ªçº¿ç¨‹ï¼Œé¡ºåºæ‰“å°å­—æ¯ A-Zï¼Œè¾“å‡ºç»“æœæ˜¯ 1A 2B 3C 1D 2Eâ€¦ 1234567891011121314151617181920212223242526272829303132public class Test { private static char c = 'A'; private static int i = 0; public static void main(String[] args) { Runnable runnable = new Runnable() { @Override public void run() { synchronized (this) { try { int id = Integer.parseInt(Thread.currentThread().getName()); while (i &lt; 26) { if (i % 3 == id - 1) { System.out.println(\"çº¿ç¨‹: \" + id + \" \" + c++); i++; notifyAll(); } else { wait(); } } } catch (InterruptedException e) { e.printStackTrace(); } } } }; new Thread(runnable, \"1\").start(); new Thread(runnable, \"2\").start(); new Thread(runnable, \"3\").start(); }}","link":"/2020/Java-%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"macOS","slug":"macOS","link":"/tags/macOS/"},{"name":"acme.sh","slug":"acme-sh","link":"/tags/acme-sh/"},{"name":"Conda","slug":"Conda","link":"/tags/Conda/"},{"name":"Python","slug":"Python","link":"/tags/Python/"},{"name":"Docker","slug":"Docker","link":"/tags/Docker/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"CentOS","slug":"CentOS","link":"/tags/CentOS/"},{"name":"Java","slug":"Java","link":"/tags/Java/"},{"name":"dockerfile-maven-plugin","slug":"dockerfile-maven-plugin","link":"/tags/dockerfile-maven-plugin/"},{"name":"GPG","slug":"GPG","link":"/tags/GPG/"},{"name":"Github","slug":"Github","link":"/tags/Github/"},{"name":"Git","slug":"Git","link":"/tags/Git/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"Next","slug":"Next","link":"/tags/Next/"},{"name":"Hadoop","slug":"Hadoop","link":"/tags/Hadoop/"},{"name":"HBase","slug":"HBase","link":"/tags/HBase/"},{"name":"æ˜¾å¡é©±åŠ¨","slug":"æ˜¾å¡é©±åŠ¨","link":"/tags/%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8/"},{"name":"Ubuntu","slug":"Ubuntu","link":"/tags/Ubuntu/"},{"name":"Maven","slug":"Maven","link":"/tags/Maven/"},{"name":"Idea","slug":"Idea","link":"/tags/Idea/"},{"name":"Shell","slug":"Shell","link":"/tags/Shell/"},{"name":"RDD","slug":"RDD","link":"/tags/RDD/"},{"name":"Spark","slug":"Spark","link":"/tags/Spark/"},{"name":"ssh","slug":"ssh","link":"/tags/ssh/"},{"name":"Tmux","slug":"Tmux","link":"/tags/Tmux/"},{"name":"ç½‘æ˜“äº‘éŸ³ä¹","slug":"ç½‘æ˜“äº‘éŸ³ä¹","link":"/tags/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/"},{"name":"iOS","slug":"iOS","link":"/tags/iOS/"},{"name":"Windows","slug":"Windows","link":"/tags/Windows/"},{"name":"zsh","slug":"zsh","link":"/tags/zsh/"},{"name":"DNS","slug":"DNS","link":"/tags/DNS/"},{"name":"DoH","slug":"DoH","link":"/tags/DoH/"},{"name":"DoT","slug":"DoT","link":"/tags/DoT/"},{"name":"AdguardHome","slug":"AdguardHome","link":"/tags/AdguardHome/"},{"name":"MapReduce","slug":"MapReduce","link":"/tags/MapReduce/"},{"name":"wordcount","slug":"wordcount","link":"/tags/wordcount/"},{"name":"ECharts","slug":"ECharts","link":"/tags/ECharts/"}],"categories":[{"name":"è®°å½•","slug":"è®°å½•","link":"/categories/%E8%AE%B0%E5%BD%95/"},{"name":"å­¦ä¹ ç¬”è®°","slug":"å­¦ä¹ ç¬”è®°","link":"/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"name":"Linux ä½¿ç”¨","slug":"Linux-ä½¿ç”¨","link":"/categories/Linux-%E4%BD%BF%E7%94%A8/"},{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","link":"/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}]}